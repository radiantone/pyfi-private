(function(){void 0===Math.sgn&&(Math.sgn=function(t){return 0==t?0:0<t?1:-1});function o(t,e){for(var n=[],o=g(t,e),i=e.length-1,r=m(o,2*i-1,n,0),s=y(t,e[0]),a=p(s),l=0,u=0;u<r;u++){s=y(t,C(e,i,n[u],null,null));var d=p(s);d<a&&(a=d,l=n[u])}return s=y(t,e[i]),(d=p(s))<a&&(a=d,l=1),{location:l,distance:a}}function s(e){var t=j[e];if(!t){function n(e){return function(t){return e}}function o(){return function(t){return t}}function i(){return function(t){return 1-t}}function r(o){return function(t){for(var e=1,n=0;n<o.length;n++)e*=o[n](t);return e}}(t=[]).push(new function(){return function(t){return Math.pow(t,e)}});for(var s=1;s<e;s++){for(var a=[new n(e)],l=0;l<e-s;l++)a.push(new o);for(l=0;l<s;l++)a.push(new i);t.push(new r(a))}t.push(new function(){return function(t){return Math.pow(1-t,e)}}),j[e]=t}return t}function l(t,e){for(var n=s(t.length-1),o=0,i=0,r=0;r<t.length;r++)o+=t[r].x*n[r](e),i+=t[r].y*n[r](e);return{x:o,y:i}}function u(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function d(t){return t[0].x===t[1].x&&t[0].y===t[1].y}function c(t,e,n){if(d(t))return{point:t[0],location:e};for(var o=l(t,e),i=0,r=e,s=0<n?1:-1,a=null;i<Math.abs(n);)a=l(t,r+=.005*s),i+=u(a,o),o=a;return{point:a,location:r}}function h(t,e){var n=l(t,e),o=l(t.slice(0,t.length-1),e),i=o.y-n.y,r=o.x-n.x;return 0==i?1/0:Math.atan(i/r)}function a(t,e,n,o,i){var r=o-e,s=t-n,a=t*(e-o)+e*(n-t),l=function(t){return[_(t,"x"),_(t,"y")]}(i),u=[r*l[0][0]+s*l[1][0],r*l[0][1]+s*l[1][1],r*l[0][2]+s*l[1][2],r*l[0][3]+s*l[1][3]+a],d=function(t,e,n,o){var i,r,s=e/t,a=n/t,l=o/t,u=(3*a-Math.pow(s,2))/9,d=(9*s*a-27*l-2*Math.pow(s,3))/54,c=Math.pow(u,3)+Math.pow(d,2),h=[];if(0<=c)i=w(d+Math.sqrt(c))*Math.pow(Math.abs(d+Math.sqrt(c)),1/3),r=w(d-Math.sqrt(c))*Math.pow(Math.abs(d-Math.sqrt(c)),1/3),h[0]=-s/3+(i+r),h[1]=-s/3-(i+r)/2,h[2]=-s/3-(i+r)/2,0!==Math.abs(Math.sqrt(3)*(i-r)/2)&&(h[1]=-1,h[2]=-1);else{var p=Math.acos(d/Math.sqrt(-Math.pow(u,3)));h[0]=2*Math.sqrt(-u)*Math.cos(p/3)-s/3,h[1]=2*Math.sqrt(-u)*Math.cos((p+2*Math.PI)/3)-s/3,h[2]=2*Math.sqrt(-u)*Math.cos((p+4*Math.PI)/3)-s/3}for(var f=0;f<3;f++)(h[f]<0||1<h[f])&&(h[f]=-1);return h}.apply(null,u),c=[];if(null!=d)for(var h=0;h<3;h++){var p,f=d[h],g=Math.pow(f,2),m=Math.pow(f,3),v=[l[0][0]*m+l[0][1]*g+l[0][2]*f+l[0][3],l[1][0]*m+l[1][1]*g+l[1][2]*f+l[1][3]];p=n-t!=0?(v[0]-t)/(n-t):(v[1]-e)/(o-e),0<=f&&f<=1&&0<=p&&p<=1&&c.push(v)}return c}var y=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},b=function(t,e){return t.x*e.x+t.y*e.y},p=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},P=function(t,e){return{x:t.x*e,y:t.y*e}},f=Math.pow(2,-65),g=function(t,e){for(var n=e.length-1,o=2*n-1,i=[],r=[],s=[],a=[],l=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],u=0;u<=n;u++)i[u]=y(e[u],t);for(u=0;u<=n-1;u++)r[u]=y(e[u+1],e[u]),r[u]=P(r[u],3);for(var d=0;d<=n-1;d++)for(var c=0;c<=n;c++)s[d]||(s[d]=[]),s[d][c]=b(r[d],i[c]);for(u=0;u<=o;u++)a[u]||(a[u]=[]),a[u].y=0,a[u].x=parseFloat(u)/o;for(var h=n,p=n-1,f=0;f<=h+p;f++){var g=Math.max(0,f-p),m=Math.min(f,h);for(u=g;u<=m;u++){var v=f-u;a[u+v].y+=s[v][u]*l[v][u]}}return a},m=function(t,e,n,o){var i,r,s=[],a=[],l=[],u=[];switch(v(t,e)){case 0:return 0;case 1:if(64<=o)return n[0]=(t[0].x+t[e].x)/2,1;if(E(t,e))return n[0]=x(t,e),1}C(t,e,.5,s,a),i=m(s,e,l,o+1),r=m(a,e,u,o+1);for(var d=0;d<i;d++)n[d]=l[d];for(d=0;d<r;d++)n[d+i]=u[d];return i+r},v=function(t,e){var n,o,i=0;n=o=Math.sgn(t[0].y);for(var r=1;r<=e;r++)(n=Math.sgn(t[r].y))!=o&&i++,o=n;return i},E=function(t,e){var n,o,i,r,s,a,l,u,d;r=t[0].y-t[e].y,s=t[e].x-t[0].x,a=t[0].x*t[e].y-t[e].x*t[0].y,u=d=0;for(var c=1;c<e;c++){var h=r*t[c].x+s*t[c].y+a;u<h?u=h:h<d&&(d=h)}return n=(1*(a-u)-0*(l=s))*(1/(0*l-1*r)),o=(1*(a-d)-0*(l=s))*(1/(0*l-1*r)),i=Math.min(n,o),Math.max(n,o)-i<f?1:0},x=function(t,e){var n=t[e].x-t[0].x,o=t[e].y-t[0].y,i=t[0].x-0;return 0+1*((n*(t[0].y-0)-o*i)*(1/(0*n-1*o)))},C=function(t,e,n,o,i){for(var r=[[]],s=0;s<=e;s++)r[0][s]=t[s];for(var a=1;a<=e;a++)for(s=0;s<=e-a;s++)r[a]||(r[a]=[]),r[a][s]||(r[a][s]={}),r[a][s].x=(1-n)*r[a-1][s].x+n*r[a-1][s+1].x,r[a][s].y=(1-n)*r[a-1][s].y+n*r[a-1][s+1].y;if(null!=o)for(s=0;s<=e;s++)o[s]=r[s][0];if(null!=i)for(s=0;s<=e;s++)i[s]=r[e-s][s];return r[e][0]},j={};function _(t,e){return[-t[0][e]+3*t[1][e]+-3*t[2][e]+t[3][e],3*t[0][e]-6*t[1][e]+3*t[2][e],-3*t[0][e]+3*t[1][e],t[0][e]]}function w(t){return t<0?-1:0<t?1:0}var t=this.jsBezier={distanceFromCurve:o,gradientAtPoint:h,gradientAtPointAlongCurveFrom:function(t,e,n){var o=c(t,e,n);return 1<o.location&&(o.location=1),o.location<0&&(o.location=0),h(t,o.location)},nearestPointOnCurve:function(t,e){var n=o(t,e);return{point:C(e,e.length-1,n.location,null,null),location:n.location}},pointOnCurve:l,pointAlongCurveFrom:function(t,e,n){return c(t,e,n).point},perpendicularToCurveAt:function(t,e,n,o){var i=c(t,e,o=null==o?0:o),r=h(t,i.location),s=Math.atan(-1/r),a=n/2*Math.sin(s),l=n/2*Math.cos(s);return[{x:i.point.x+l,y:i.point.y+a},{x:i.point.x-l,y:i.point.y-a}]},locationAlongCurveFrom:function(t,e,n){return c(t,e,n).location},getLength:function(t){if(d(t))return 0;for(var e=l(t,0),n=0,o=0,i=null;o<1;)i=l(t,o+=.005),n+=u(i,e),e=i;return n},lineIntersection:a,boxIntersection:function(t,e,n,o,i){var r=[];return r.push.apply(r,a(t,e,t+n,e,i)),r.push.apply(r,a(t+n,e,t+n,e+o,i)),r.push.apply(r,a(t+n,e+o,t,e+o,i)),r.push.apply(r,a(t,e+o,t,e,i)),r},boundingBoxIntersection:function(t,e){var n=[];return n.push.apply(n,a(t.x,t.y,t.x+t.w,t.y,e)),n.push.apply(n,a(t.x+t.w,t.y,t.x+t.w,t.y+t.h,e)),n.push.apply(n,a(t.x+t.w,t.y+t.h,t.x,t.y+t.h,e)),n.push.apply(n,a(t.x,t.y+t.h,t.x,t.y,e)),n},version:"0.9.0"};"undefined"!=typeof exports&&(exports.jsBezier=t)}).call("undefined"!=typeof window?window:this),function(){"use strict";function f(){return function(){var t=[];return Array.prototype.push.apply(t,arguments),t.item=function(t){return this[t]},t}(function(t,e,n,o,i,r,s,a){return new Touch({target:e,identifier:k(),pageX:n,pageY:o,screenX:i,screenY:r,clientX:s||i,clientY:a||r})}.apply(null,arguments))}function p(t,e,n){for(var o=(n=n||t.parentNode).querySelectorAll(e),i=0;i<o.length;i++)if(o[i]===t)return!0;return!1}function g(t){return"string"==typeof t||t.constructor===String?document.getElementById(t):t}function m(t){return t.srcElement||t.target}function v(t,e,n,o){if(o){if(void 0!==t.path&&t.path.indexOf)return{path:t.path,end:t.path.indexOf(n)};var i={path:[],end:-1},r=function(t){i.path.push(t),t===n?i.end=i.path.length-1:null!=t.parentNode&&r(t.parentNode)};return r(e),i}return{path:[e],end:1}}function y(t,e){for(var n=0,o=t.length;n<o&&t[n]!=e;n++);n<t.length&&t.splice(n,1)}function a(t,e,n){var o=i++;return t.__ta=t.__ta||{},t.__ta[e]=t.__ta[e]||{},(t.__ta[e][o]=n).__tauid=o}function l(s,a,l,t){if(null==s)return l;var u=s.split(","),d=function(t){d.__tauid=l.__tauid;var e=m(t),n=e,o=v(t,e,a,null!=s);if(-1!=o.end)for(var i=0;i<o.end;i++){n=o.path[i];for(var r=0;r<u.length;r++)p(n,u[r],a)&&l.apply(n,arguments)}};return e(l,t,d),d}function b(t,e,n,o){if(x&&j[e]){var i=l(o,t,n,j[e]);h(t,j[e],i,n)}"focus"===e&&null==t.getAttribute("tabindex")&&t.setAttribute("tabindex","1"),h(t,e,l(o,t,n,e),n)}function o(c,h){return function(u,t,e,s){if("contextmenu"==t&&C)b(u,t,e,s);else{if(null==u.__taTapHandler){var d=u.__taTapHandler={tap:[],dbltap:[],contextmenu:[],down:!1,taps:0,downSelectors:[]},a=function(){d.down=!1},l=function(){d.taps=0};b(u,"mousedown",function(t){for(var e=m(t),n=v(t,e,u,null!=s),o=!1,i=0;i<n.end;i++){if(o)return;e=n.path[i];for(var r=0;r<d.downSelectors.length;r++)if(null==d.downSelectors[r]||p(e,d.downSelectors[r],u)){d.down=!0,setTimeout(a,c),setTimeout(l,h),o=!0;break}}}),b(u,"mouseup",function(t){if(d.down){var e,n,o=m(t);d.taps++;var i=w(t);for(var r in E)if(E.hasOwnProperty(r)){var s=E[r];if(s.touches===i&&(1===s.taps||s.taps===d.taps))for(var a=0;a<d[r].length;a++){n=v(t,o,u,null!=d[r][a][1]);for(var l=0;l<n.end;l++)if(e=n.path[l],null==d[r][a][1]||p(e,d[r][a][1],u)){d[r][a][0].apply(e,[t]);break}}}}})}u.__taTapHandler.downSelectors.push(s),u.__taTapHandler[t].push([e,s]),e.__taUnstore=function(){y(u.__taTapHandler[t],e)}}}}function u(t,e,n,o){for(var i in n.__tamee[t])n.__tamee[t].hasOwnProperty(i)&&n.__tamee[t][i].apply(o,[e])}function d(){var s=[];return function(o,t,e,n){if(!o.__tamee){o.__tamee={over:!1,mouseenter:[],mouseexit:[]};var i=function(t){var e=m(t);(null!=n||e!=o||o.__tamee.over)&&(!p(e,n,o)||null!=e.__tamee&&e.__tamee.over)||(u("mouseenter",t,o,e),e.__tamee=e.__tamee||{},e.__tamee.over=!0,s.push(e))},r=function(t){for(var e=m(t),n=0;n<s.length;n++)e!=s[n]||p(t.relatedTarget||t.toElement,"*",e)||(e.__tamee.over=!1,s.splice(n,1),u("mouseexit",t,o,e))};h(o,"mouseover",l(n,o,i,"mouseover"),i),h(o,"mouseout",l(n,o,r,"mouseout"),r)}e.__taUnstore=function(){delete o.__tamee[t][e.__tauid]},a(o,t,e),o.__tamee[t][e.__tauid]=e}}function P(t,e){if(null==t)return[0,0];var n=c(t),o=s(n,0);return[o[e+"X"],o[e+"Y"]]}var t=this,i=1,e=function(t,e,n){t.__taExtra=t.__taExtra||[],t.__taExtra.push([e,n])},E={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}},x="ontouchstart"in document.documentElement||navigator.maxTouchPoints,C="onmousedown"in document.documentElement,j={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},n=function(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var e=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))}return t}(),r=-1<n&&n<9,_=function(t){return null==t?[0,0]:r?[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop]:P(t,"page")},s=function(t,e){return t.item?t.item(e):t[e]},c=function(t){return t.touches&&0<t.touches.length?t.touches:t.changedTouches&&0<t.changedTouches.length?t.changedTouches:t.targetTouches&&0<t.targetTouches.length?t.targetTouches:[t]},w=function(t){return c(t).length},h=function(t,e,n,o){if(a(t,e,n),o.__tauid=n.__tauid,t.addEventListener)t.addEventListener(e,n,!1);else if(t.attachEvent){var i=e+n.__tauid;t["e"+i]=n,t[i]=function(){t["e"+i]&&t["e"+i](window.event)},t.attachEvent("on"+e,t[i])}},S=function(n,o,i){null!=i&&I(n,function(){var t=g(this);if(!function(t,e,n){if(t.__ta&&t.__ta[e]&&delete t.__ta[e][n.__tauid],n.__taExtra){for(var o=0;o<n.__taExtra.length;o++)S(t,n.__taExtra[o][0],n.__taExtra[o][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(t,o,i),null!=i.__tauid)if(t.removeEventListener)t.removeEventListener(o,i,!1),x&&j[o]&&t.removeEventListener(j[o],i,!1);else if(this.detachEvent){var e=o+i.__tauid;t[e]&&t.detachEvent("on"+o,t[e]),t[e]=null,t["e"+e]=null}i.__taTouchProxy&&S(n,i.__taTouchProxy[1],i.__taTouchProxy[0])})},I=function(t,e){if(null!=t){t="undefined"!=typeof Window&&"unknown"!=typeof t.top&&t==t.top?[t]:"string"!=typeof t&&null==t.tagName&&null!=t.length?t:"string"==typeof t?document.querySelectorAll(t):[t];for(var n=0;n<t.length;n++)e.apply(t[n])}},k=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})};t.Mottle=function(t){function i(t,e,n,o){null!=n&&I(t,function(){var t=g(this);a&&"click"===e?function(n,t,e,o){if(null==n.__taSmartClicks){b(n,"mousedown",function(t){n.__tad=_(t)},o),b(n,"mouseup",function(t){n.__tau=_(t)},o),b(n,"click",function(t){if(n.__tad&&n.__tau&&n.__tad[0]===n.__tau[0]&&n.__tad[1]===n.__tau[1])for(var e=0;e<n.__taSmartClicks.length;e++)n.__taSmartClicks[e].apply(m(t),[t])},o),n.__taSmartClicks=[]}n.__taSmartClicks.push(e),e.__taUnstore=function(){y(n.__taSmartClicks,e)}}(t,0,n,o):"tap"===e||"dbltap"===e||"contextmenu"===e?s(t,e,n,o):"mouseenter"===e||"mouseexit"==e?r(t,e,n,o):b(t,e,n,o)})}var e=(t=t||{}).clickThreshold||250,n=t.dblClickThreshold||450,r=new d,s=new o(e,n),a=t.smartClicks;this.remove=function(t){return I(t,function(){var t=g(this);if(t.__ta)for(var e in t.__ta)if(t.__ta.hasOwnProperty(e))for(var n in t.__ta[e])t.__ta[e].hasOwnProperty(n)&&S(t,e,t.__ta[e][n]);t.parentNode&&t.parentNode.removeChild(t)}),this},this.on=function(t,e,n,o){return i(t,e,arguments[arguments.length-1],4==arguments.length?n:null),this},this.off=function(t,e,n){return S(t,e,n),this},this.trigger=function(t,r,s,a){var l=C&&("undefined"==typeof MouseEvent||null==s||s.constructor===MouseEvent),u=x&&!C&&j[r]?j[r]:r,d=!(x&&!C&&j[r]),c=_(s),h=function(t){return P(t,"screen")}(s),p=function(t){return P(t,"client")}(s);return I(t,function(){var t,n=g(this);s=s||{screenX:h[0],screenY:h[1],clientX:p[0],clientY:p[1]};function e(t){a&&(t.payload=a)}var o={TouchEvent:function(t){var e=f(window,n,0,c[0],c[1],h[0],h[1],p[0],p[1]);(t.initTouchEvent||t.initEvent)(u,!0,!0,window,null,h[0],h[1],p[0],p[1],!1,!1,!1,!1,e,e,e,1,0)},MouseEvents:function(t){t.initMouseEvent(u,!0,!0,window,0,h[0],h[1],p[0],p[1],!1,!1,!1,!1,1,n)}};if(document.createEvent){var i=!d&&!l&&x&&j[r]?"TouchEvent":"MouseEvents";t=document.createEvent(i),o[i](t),e(t),n.dispatchEvent(t)}else document.createEventObject&&((t=document.createEventObject()).eventType=t.eventName=u,t.screenX=h[0],t.screenY=h[1],t.clientX=p[0],t.clientY=p[1],e(t),n.fireEvent("on"+u,t))}),this}},t.Mottle.consume=function(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()},t.Mottle.pageLocation=_,t.Mottle.setForceTouchEvents=function(t){x=t},t.Mottle.setForceMouseEvents=function(t){C=t},t.Mottle.version="0.8.0","undefined"!=typeof exports&&(exports.Mottle=t.Mottle)}.call("undefined"==typeof window?this:window),function(){"use strict";var t=this.Biltong={version:"0.4.0"};"undefined"!=typeof exports&&(exports.Biltong=t);function o(t){return"[object Array]"===Object.prototype.toString.call(t)}function n(t,e,n){return n(t=o(t)?t:[t.x,t.y],e=o(e)?e:[e.x,e.y])}var u=t.gradient=function(t,e){return n(t,e,function(t,e){return e[0]==t[0]?e[1]>t[1]?1/0:-1/0:e[1]==t[1]?e[0]>t[0]?0:-0:(e[1]-t[1])/(e[0]-t[0])})},d=(t.normal=function(t,e){return-1/u(t,e)},t.lineLength=function(t,e){return n(t,e,function(t,e){return Math.sqrt(Math.pow(e[1]-t[1],2)+Math.pow(e[0]-t[0],2))})},t.quadrant=function(t,e){return n(t,e,function(t,e){return e[0]>t[0]?e[1]>t[1]?2:1:e[0]==t[0]?e[1]>t[1]?2:1:e[1]>t[1]?3:4})}),c=(t.theta=function(t,e){return n(t,e,function(t,e){var n=u(t,e),o=Math.atan(n),i=d(t,e);return 4!=i&&3!=i||(o+=Math.PI),o<0&&(o+=2*Math.PI),o})},t.intersects=function(t,e){var n=t.x,o=t.x+t.w,i=t.y,r=t.y+t.h,s=e.x,a=e.x+e.w,l=e.y,u=e.y+e.h;return n<=s&&s<=o&&i<=l&&l<=r||n<=a&&a<=o&&i<=l&&l<=r||n<=s&&s<=o&&i<=u&&u<=r||n<=a&&s<=o&&i<=u&&u<=r||s<=n&&n<=a&&l<=i&&i<=u||s<=o&&o<=a&&l<=i&&i<=u||s<=n&&n<=a&&l<=r&&r<=u||s<=o&&n<=a&&l<=r&&r<=u},t.encloses=function(t,e,i){function n(t,e,n,o){return i?t<=e&&o<=n:t<e&&o<n}var o=t.x,r=t.x+t.w,s=t.y,a=t.y+t.h,l=e.x,u=e.x+e.w,d=e.y,c=e.y+e.h;return n(o,l,r,u)&&n(s,d,a,c)},[null,[1,-1],[1,1],[-1,1],[-1,-1]]),h=[null,[-1,-1],[-1,1],[1,1],[1,-1]];t.pointOnLine=function(t,e,n){var o=u(t,e),i=d(t,e),r=0<n?c[i]:h[i],s=Math.atan(o),a=Math.abs(n*Math.sin(s))*r[1],l=Math.abs(n*Math.cos(s))*r[0];return{x:t.x+l,y:t.y+a}},t.perpendicularLineTo=function(t,e,n){var o=u(t,e),i=Math.atan(-1/o),r=n/2*Math.sin(i),s=n/2*Math.cos(i);return[{x:e.x+s,y:e.y+r},{x:e.x-s,y:e.y-r}]}}.call("undefined"!=typeof window?window:this),function(){"use strict";function b(t,e,n){return-1===t.indexOf(e)&&(n?t.unshift(e):t.push(e),!0)}function P(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}function U(t){return null!=t&&("string"==typeof t||t.constructor===String)}function B(t,e,n){for(var o=(n=n||t.parentNode).querySelectorAll(e),i=0;i<o.length;i++)if(o[i]===t)return!0;return!1}function V(t,e,n){if(B(e,n,t))return e;for(var o=e.parentNode;null!=o&&o!==t;){if(B(o,n,t))return o;o=o.parentNode}}function H(t){if(o)return[t.clientX+document.documentElement.scrollLeft,t.clientY+document.documentElement.scrollTop];var e=s(t),n=r(e,0);return i?[n.pageX||n.clientX,n.pageY||n.clientY]:[n.pageX,n.pageY]}function E(){}function W(){return!0}function x(t,e,n){for(var o=0;o<t.length;o++)t[o]!=n&&e(t[o])}function X(t,e,n,o){x(t,function(t){t.setActive(e),e&&t.updatePosition(),n&&t.setHover(o,e)})}function C(t,e){if(null!=t){t=U(t)||null!=t.tagName||null==t.length?[t]:t;for(var n=0;n<t.length;n++)e.apply(t[n],[t[n]])}}function Y(t){t.stopPropagation?(t.stopPropagation(),t.preventDefault()):t.returnValue=!1}function Z(t,e,n,o){this.params=e||{},this.el=t,this.params.addClass(this.el,this._class),this.uuid=$();var i=!0;return this.setEnabled=function(t){i=t},this.isEnabled=function(){return i},this.toggleEnabled=function(){i=!i},this.setScope=function(t){this.scopes=t?t.split(/\s+/):[o]},this.addScope=function(t){var e={};for(var n in C(this.scopes,function(t){e[t]=!0}),C(t?t.split(/\s+/):[],function(t){e[t]=!0}),this.scopes=[],e)this.scopes.push(n)},this.removeScope=function(t){var e={};for(var n in C(this.scopes,function(t){e[t]=!0}),C(t?t.split(/\s+/):[],function(t){delete e[t]}),this.scopes=[],e)this.scopes.push(n)},this.toggleScope=function(t){var e={};for(var n in C(this.scopes,function(t){e[t]=!0}),C(t?t.split(/\s+/):[],function(t){e[t]?delete e[t]:e[t]=!0}),this.scopes=[],e)this.scopes.push(n)},this.setScope(e.scope),this.k=e.katavorio,e.katavorio}function q(){return!0}function J(){return!1}function j(i,c,r,t){this._class=r.draggable;var a=Z.apply(this,arguments);this.rightButtonCanDrag=this.params.rightButtonCanDrag;var h,p,f,g,m,v,s=[0,0],y=null,n=null,b=[0,0],l=!1,u=[0,0],d=!1!==this.params.consumeStartEvent,P=this.el,E=this.params.clone,x=(this.params.scroll,!1!==c.multipleDrop),C=!1,j=null,_=[],w=null,S=c.ghostProxyParent;if(h=!0===c.ghostProxy?q:c.ghostProxy&&"function"==typeof c.ghostProxy?c.ghostProxy:function(t,e){return!(!w||!w.useGhostProxy)&&w.useGhostProxy(t,e)},p=c.makeGhostProxy?c.makeGhostProxy:function(t){return w&&w.makeGhostProxy?w.makeGhostProxy(t):t.cloneNode(!0)},c.selector){var e=i.getAttribute("katavorio-draggable");null==e&&(e=""+(new Date).getTime(),i.setAttribute("katavorio-draggable",e)),_.push(c)}function I(t,e,n,o,i){var r=e*Math.floor(t[0]/e),s=r+e,a=Math.abs(t[0]-r)<=o?r:Math.abs(s-t[0])<=o?s:t[0],l=n*Math.floor(t[1]/n),u=l+n;return[a,Math.abs(t[1]-l)<=i?l:Math.abs(u-t[1])<=i?u:t[1]]}var k,A=c.snapThreshold;function T(t){return!1===c.allowNegative?[Math.max(0,t[0]),Math.max(0,t[1])]:t}this.posses=[],this.posseRoles={},this.toGrid=function(t){if(null==this.params.grid)return t;var e=this.params.grid?this.params.grid[0]/2:A||5,n=this.params.grid?this.params.grid[1]/2:A||5;return I(t,this.params.grid[0],this.params.grid[1],e,n)},this.snap=function(t,e){if(null!=P){t=t||(this.params.grid?this.params.grid[0]:10),e=e||(this.params.grid?this.params.grid[1]:10);var n=this.params.getPosition(P),o=this.params.grid?this.params.grid[0]/2:A,i=this.params.grid?this.params.grid[1]/2:A,r=I(n,t,e,o,i);return this.params.setPosition(P,r),r}},this.setUseGhostProxy=function(t){h=t?q:J};var o,D=function(t){k="function"==typeof t?t:t?function(t,e,n,o){return T([Math.max(0,Math.min(n.w-o[0],t[0])),Math.max(0,Math.min(n.h-o[1],t[1]))])}.bind(this):function(t){return T(t)}}.bind(this);D("function"==typeof this.params.constrain?this.params.constrain:this.params.constrain||this.params.containment),this.setConstrain=function(t){D(t)},this.setRevert=function(t){o=t},this.params.revert&&(o=this.params.revert);var M={},N=this.setFilter=function(o,t){if(o){var e=function(t){return"function"==typeof t?(t._katavorioId=$(),t._katavorioId):t}(o);M[e]=[function(t){var e,n=t.srcElement||t.target;return U(o)?e=B(n,o,i):"function"==typeof o&&(e=o(t,i)),e},!1!==t]}};this.addFilter=N,this.removeFilter=function(t){var e="function"==typeof t?t._katavorioId:t;delete M[e]},this.clearAllFilters=function(){M={}},this.canDrag=this.params.canDrag||W;var O,F=[],L=[];this.addSelector=function(t){t.selector&&_.push(t)},this.downListener=function(t){if(!t.defaultPrevented&&((this.rightButtonCanDrag||3!==t.which&&2!==t.button)&&this.isEnabled()&&this.canDrag()))if(function(t){for(var e in M){var n=M[e],o=n[0](t);if(n[1]&&(o=!o),!o)return!1}return!0}(t)&&function(t,e,n){var o=t.srcElement||t.target;return!B(o,n.getInputFilterSelector(),e)}(t,this.el,this.k)){if(j=w=null,0<_.length){var e=function(t,e,n){for(var o=null,i=e.getAttribute("katavorio-draggable"),r=null!=i?"[katavorio-draggable='"+i+"'] ":"",s=0;s<t.length;s++)if(null!=(o=V(e,n,r+t[s].selector))){if(t[s].filter){var a=B(n,t[s].filter,o);if(!0===t[s].filterExclude&&!a||a)return null}return[t[s],o]}return null}(_,this.el,t.target||t.srcElement);if(null!=e&&(w=e[0],j=e[1]),null==j)return}else j=this.el;if(E)if(P=j.cloneNode(!0),this.params.addClass(P,K.clonedDrag),P.setAttribute("id",null),P.style.position="absolute",null!=this.params.parent){var n=this.params.getPosition(this.el);P.style.left=n[0]+"px",P.style.top=n[1]+"px",this.params.parent.appendChild(P)}else{var o=function(t){var e=t.getBoundingClientRect(),n=document.body,o=document.documentElement,i=window.pageYOffset||o.scrollTop||n.scrollTop,r=window.pageXOffset||o.scrollLeft||n.scrollLeft,s=o.clientTop||n.clientTop||0,a=o.clientLeft||n.clientLeft||0,l=e.top+i-s,u=e.left+r-a;return{top:Math.round(l),left:Math.round(u)}}(j);P.style.left=o.left+"px",P.style.top=o.top+"px",document.body.appendChild(P)}else P=j;d&&Y(t),s=H(t),P&&P.parentNode&&(u=[P.parentNode.scrollLeft,P.parentNode.scrollTop]),this.params.bind(document,"mousemove",this.moveListener),this.params.bind(document,"mouseup",this.upListener),a.markSelection(this),a.markPosses(this),this.params.addClass(document.body,r.noSelect),z("beforeStart",{el:this.el,pos:y,e:t,drag:this})}else this.params.consumeFilteredEvents&&Y(t)}.bind(this),this.moveListener=function(t){if(s){if(!l)if(!1!==z("start",{el:this.el,pos:y,e:t,drag:this})){if(!s)return;this.mark(!0),l=!0}else this.abort();if(s){L.length=0;var e=H(t),n=e[0]-s[0],o=e[1]-s[1],i=this.params.ignoreZoom?1:a.getZoom();P&&P.parentNode&&(n+=P.parentNode.scrollLeft-u[0],o+=P.parentNode.scrollTop-u[1]),n/=i,o/=i,this.moveBy(n,o,t),a.updateSelection(n,o,this),a.updatePosses(n,o,this)}}}.bind(this),this.upListener=function(t){s&&(s=null,this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.params.removeClass(document.body,r.noSelect),this.unmark(t),a.unmarkSelection(this,t),a.unmarkPosses(this,t),this.stop(t),a.notifyPosseDragStop(this,t),l=!1,L.length=0,E?(P&&P.parentNode&&P.parentNode.removeChild(P),P=null):o&&!0===o(P,this.params.getPosition(P))&&(this.params.setPosition(P,y),z("revert",P)))}.bind(this),this.getFilters=function(){return M},this.abort=function(){null!=s&&this.upListener()},this.getDragElement=function(t){return t?j||this.el:P||this.el};var R={start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]};c.events.start&&R.start.push(c.events.start),c.events.beforeStart&&R.beforeStart.push(c.events.beforeStart),c.events.stop&&R.stop.push(c.events.stop),c.events.drag&&R.drag.push(c.events.drag),c.events.revert&&R.revert.push(c.events.revert),this.on=function(t,e){R[t]&&R[t].push(e)},this.off=function(t,e){if(R[t]){for(var n=[],o=0;o<R[t].length;o++)R[t][o]!==e&&n.push(R[t][o]);R[t]=n}};var G,z=function(t,e){var n=null;if(w&&w[t])n=w[t](e);else if(R[t])for(var o=0;o<R[t].length;o++)try{var i=R[t][o](e);null!=i&&(n=i)}catch(t){}return n};this.notifyStart=function(t){z("start",{el:this.el,pos:this.params.getPosition(P),e:t,drag:this})},this.stop=function(t,e){if(e||l){var n=[],o=a.getSelection(),i=this.params.getPosition(P);if(0<o.length)for(var r=0;r<o.length;r++){var s=this.params.getPosition(o[r].el);n.push([o[r].el,{left:s[0],top:s[1]},o[r]])}else n.push([P,{left:i[0],top:i[1]},this]);z("stop",{el:P,pos:G||i,finalPos:i,e:t,drag:this,selection:n})}},this.mark=function(t){var e;y=this.params.getPosition(P),n=this.params.getPosition(P,!0),b=[n[0]-y[0],n[1]-y[1]],this.size=this.params.getSize(P),F=a.getMatchingDroppables(this),X(F,!0,!1,this),this.params.addClass(P,this.params.dragClass||r.drag),e=this.params.getConstrainingRectangle?this.params.getConstrainingRectangle(P):this.params.getSize(P.parentNode),O={w:e[0],h:e[1]},v=m=0,t&&a.notifySelectionDragStart(this)},this.unmark=function(t,e){if(X(F,!1,!0,this),C&&h(j,P)?(G=[P.offsetLeft-m,P.offsetTop-v],P.parentNode.removeChild(P),P=j):G=null,this.params.removeClass(P,this.params.dragClass||r.drag),F.length=0,C=!1,!e){0<L.length&&G&&c.setPosition(j,G),L.sort(Q);for(var n=0;n<L.length;n++){if(!0===L[n].drop(this,t))break}}},this.moveBy=function(t,e,n){L.length=0;var o=this.toGrid([y[0]+t,y[1]+e]),i=function(t,e,n,o){return null!=w&&w.constrain&&"function"==typeof w.constrain?w.constrain(t,e,n,o):k(t,e,n,o)}(o,P,O,this.size);if(h(this.el,P))if(o[0]!==i[0]||o[1]!==i[1]){if(!C){var r=p(j);c.addClass(r,K.ghostProxy),S?(S.appendChild(r),f=c.getPosition(j.parentNode,!0),g=c.getPosition(c.ghostProxyParent,!0),m=f[0]-g[0],v=f[1]-g[1]):j.parentNode.appendChild(r),P=r,C=!0}i=o}else C&&(P.parentNode.removeChild(P),P=j,C=!1,g=f=null,v=m=0);var s={x:i[0],y:i[1],w:this.size[0],h:this.size[1]},a={x:s.x+b[0],y:s.y+b[1],w:s.w,h:s.h},l=null;this.params.setPosition(P,[i[0]+m,i[1]+v]);for(var u=0;u<F.length;u++){var d={x:F[u].pagePosition[0],y:F[u].pagePosition[1],w:F[u].size[0],h:F[u].size[1]};this.params.intersects(a,d)&&(x||null==l||l===F[u].el)&&F[u].canDrop(this)?(l=l||F[u].el,L.push(F[u]),F[u].setHover(this,!0,n)):F[u].isHover()&&F[u].setHover(this,!1,n)}z("drag",{el:this.el,pos:i,e:n,drag:this})},this.destroy=function(){this.params.unbind(this.el,"mousedown",this.downListener),this.params.unbind(document,"mousemove",this.moveListener),this.params.unbind(document,"mouseup",this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null},this.params.bind(this.el,"mousedown",this.downListener),this.params.handle?N(this.params.handle,!1):N(this.params.filter,this.params.filterExclude)}function _(t,e,n,o){this._class=n.droppable,this.params=e||{},this.rank=e.rank||0,this._activeClass=this.params.activeClass||n.active,this._hoverClass=this.params.hoverClass||n.hover,Z.apply(this,arguments);var i=!1;this.allowLoopback=!1!==this.params.allowLoopback,this.setActive=function(t){this.params[t?"addClass":"removeClass"](this.el,this._activeClass)},this.updatePosition=function(){this.position=this.params.getPosition(this.el),this.pagePosition=this.params.getPosition(this.el,!0),this.size=this.params.getSize(this.el)},this.canDrop=this.params.canDrop||function(t){return!0},this.isHover=function(){return i},this.setHover=function(t,e,n){!e&&null!=this.el._katavorioDragHover&&this.el._katavorioDragHover!==t.el._katavorio||(this.params[e?"addClass":"removeClass"](this.el,this._hoverClass),this.el._katavorioDragHover=e?t.el._katavorio:null,i!==e&&this.params.events[e?"over":"out"]({el:this.el,e:n,drag:t,drop:this}),i=e)},this.drop=function(t,e){return this.params.events.drop({drag:t,e:e,drop:this})},this.destroy=function(){this._class=null,this._activeClass=null,this._hoverClass=null,i=null}}function w(t){return null==t?null:null==(t="string"==typeof t||t.constructor===String?document.getElementById(t):t)?null:(t._katavorio=t._katavorio||$(),t)}var t=function(){var t=-1;if("Microsoft Internet Explorer"===navigator.appName){var e=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(e)&&(t=parseFloat(RegExp.$1))}return t}(),o=-1<t&&t<9,i=9===t,r=function(t,e){return t.item?t.item(e):t[e]},s=function(t){return t.touches&&0<t.touches.length?t.touches:t.changedTouches&&0<t.changedTouches.length?t.changedTouches:t.targetTouches&&0<t.targetTouches.length?t.targetTouches:[t]},K={delegatedDraggable:"katavorio-delegated-draggable",draggable:"katavorio-draggable",droppable:"katavorio-droppable",drag:"katavorio-drag",selected:"katavorio-drag-selected",active:"katavorio-drag-active",hover:"katavorio-drag-hover",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"},S=["stop","start","drag","drop","over","out","beforeStart"],$=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},Q=function(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:0};this.Katavorio=function(r){var i=[],o={};this._dragsByScope={},this._dropsByScope={};function s(t,n){C(t,function(t){for(var e=0;e<t.scopes.length;e++)n[t.scopes[e]]=n[t.scopes[e]]||[],n[t.scopes[e]].push(t)})}function a(t,o){var i=0;return C(t,function(t){for(var e=0;e<t.scopes.length;e++)if(o[t.scopes[e]]){var n=r.indexOf(o[t.scopes[e]],t);-1!==n&&(o[t.scopes[e]].splice(n,1),i++)}}),0<i}var e=1,l=(this.getMatchingDroppables=function(t){for(var e=[],n={},o=0;o<t.scopes.length;o++){var i=this._dropsByScope[t.scopes[o]];if(i)for(var r=0;r<i.length;r++)!i[r].canDrop(t)||n[i[r].uuid]||!i[r].allowLoopback&&i[r].el===t.el||(n[i[r].uuid]=!0,e.push(i[r]))}return e.sort(Q),e},function(t){t=t||{};var e,n={events:{}};for(e in r)n[e]=r[e];for(e in t)n[e]=t[e];for(e=0;e<S.length;e++)n.events[S[e]]=t[S[e]]||E;return n.katavorio=this,n}.bind(this)),u=function(t,e){for(var n=0;n<S.length;n++)e[S[n]]&&t.on(S[n],e[S[n]])}.bind(this),d={},t=r.css||{},c=r.scope||"katavorio-drag-scope";for(var n in K)d[n]=K[n];for(var n in t)d[n]=t[n];var h=r.inputFilterSelector||"input,textarea,select,button,option";this.getInputFilterSelector=function(){return h},this.setInputFilterSelector=function(t){return h=t,this},this.draggable=function(t,n){var o=[];return C(t,function(t){if(null!=(t=w(t)))if(null==t._katavorioDrag){var e=l(n);t._katavorioDrag=new j(t,e,d,c),s(t._katavorioDrag,this._dragsByScope),o.push(t._katavorioDrag),r.addClass(t,e.selector?d.delegatedDraggable:d.draggable)}else u(t._katavorioDrag,n)}.bind(this)),o},this.droppable=function(t,n){var o=[];return C(t,function(t){if(null!=(t=w(t))){var e=new _(t,l(n),d,c);t._katavorioDrop=t._katavorioDrop||[],t._katavorioDrop.push(e),s(e,this._dropsByScope),o.push(e),r.addClass(t,d.droppable)}}.bind(this)),o},this.select=function(t){return C(t,function(){var t=w(this);t&&t._katavorioDrag&&(o[t._katavorio]||(i.push(t._katavorioDrag),o[t._katavorio]=[t,i.length-1],r.addClass(t,d.selected)))}),this},this.deselect=function(t){return C(t,function(){var t=w(this);if(t&&t._katavorio&&o[t._katavorio]){for(var e=[],n=0;n<i.length;n++)i[n].el!==t&&e.push(i[n]);i=e,delete o[t._katavorio],r.removeClass(t,d.selected)}}),this},this.deselectAll=function(){for(var t in o){var e=o[t];r.removeClass(e[0],d.selected)}i.length=0,o={}},this.markSelection=function(t){x(i,function(t){t.mark()},t)},this.markPosses=function(e){e.posses&&C(e.posses,function(t){e.posseRoles[t]&&y[t]&&x(y[t].members,function(t){t.mark()},e)})},this.unmarkSelection=function(t,e){x(i,function(t){t.unmark(e)},t)},this.unmarkPosses=function(e,n){e.posses&&C(e.posses,function(t){e.posseRoles[t]&&y[t]&&x(y[t].members,function(t){t.unmark(n,!0)},e)})},this.getSelection=function(){return i.slice(0)},this.updateSelection=function(e,n,t){x(i,function(t){t.moveBy(e,n)},t)};function p(e,n){n.posses&&C(n.posses,function(t){n.posseRoles[t]&&y[t]&&x(y[t].members,function(t){e(t)},n)})}this.updatePosses=function(e,n,t){p(function(t){t.moveBy(e,n)},t)},this.notifyPosseDragStop=function(t,e){p(function(t){t.stop(e,!0)},t)},this.notifySelectionDragStop=function(t,e){x(i,function(t){t.stop(e,!0)},t)},this.notifySelectionDragStart=function(t,e){x(i,function(t){t.notifyStart(e)},t)},this.setZoom=function(t){e=t},this.getZoom=function(){return e};function f(t,e,n,o){C(t,function(t){a(t,n),t[o](e),s(t,n)})}C(["set","add","remove","toggle"],function(n){this[n+"Scope"]=function(t,e){f(t._katavorioDrag,e,this._dragsByScope,n+"Scope"),f(t._katavorioDrop,e,this._dropsByScope,n+"Scope")}.bind(this),this[n+"DragScope"]=function(t,e){f(t.constructor===j?t:t._katavorioDrag,e,this._dragsByScope,n+"Scope")}.bind(this),this[n+"DropScope"]=function(t,e){f(t.constructor===_?t:t._katavorioDrop,e,this._dropsByScope,n+"Scope")}.bind(this)}.bind(this)),this.snapToGrid=function(e,n){for(var t in this._dragsByScope)x(this._dragsByScope[t],function(t){t.snap(e,n)})},this.getDragsForScope=function(t){return this._dragsByScope[t]},this.getDropsForScope=function(t){return this._dropsByScope[t]};function g(t,e,n){if((t=w(t))[e]){var o=i.indexOf(t[e]);0<=o&&i.splice(o,1),a(t[e],n)&&C(t[e],function(t){t.destroy()}),delete t[e]}}function m(t,e,n,o){(t=w(t))[e]&&t[e].off(n,o)}this.elementRemoved=function(t){t._katavorioDrag&&this.destroyDraggable(t),t._katavorioDrop&&this.destroyDroppable(t)},this.destroyDraggable=function(t,e,n){1===arguments.length?g(t,"_katavorioDrag",this._dragsByScope):m(t,"_katavorioDrag",e,n)},this.destroyDroppable=function(t,e,n){1===arguments.length?g(t,"_katavorioDrop",this._dropsByScope):m(t,"_katavorioDrop",e,n)},this.reset=function(){this._dragsByScope={},this._dropsByScope={},i=[],o={},y={}};function v(t,e,n){var o,i=U(e)?e:e.id,r=!!U(e)||!1!==e.active,s=y[i]||(o={name:i,members:[]},y[i]=o);return C(t,function(t){if(t._katavorioDrag){if(n&&null!=t._katavorioDrag.posseRoles[s.name])return;b(s.members,t._katavorioDrag),b(t._katavorioDrag.posses,s.name),t._katavorioDrag.posseRoles[s.name]=r}}),s}var y={};this.addToPosse=function(t,e){for(var n=[],o=1;o<arguments.length;o++)n.push(v(t,arguments[o]));return 1===n.length?n[0]:n},this.setPosse=function(t,e){for(var o=[],n=1;n<arguments.length;n++)o.push(v(t,arguments[n],!0).name);return C(t,function(t){if(t._katavorioDrag){var e=function(t,e){for(var n=[],o=0;o<t.length;o++)-1===e.indexOf(t[o])&&n.push(t[o]);return n}(t._katavorioDrag.posses,o);Array.prototype.push.apply([],t._katavorioDrag.posses);for(var n=0;n<e.length;n++)this.removeFromPosse(t,e[n])}}.bind(this)),1===o.length?o[0]:o},this.removeFromPosse=function(t,n){if(arguments.length<2)throw new TypeError("No posse id provided for remove operation");for(var e=1;e<arguments.length;e++)n=arguments[e],C(t,function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var e=t._katavorioDrag;C(n,function(t){P(y[t].members,e),P(e.posses,t),delete e.posseRoles[t]})}})},this.removeFromAllPosses=function(t){C(t,function(t){if(t._katavorioDrag&&t._katavorioDrag.posses){var e=t._katavorioDrag;C(e.posses,function(t){P(y[t].members,e)}),e.posses.length=0,e.posseRoles={}}})},this.setPosseState=function(t,e,n){var o=y[e];o&&C(t,function(t){t._katavorioDrag&&t._katavorioDrag.posses&&(t._katavorioDrag.posseRoles[o.name]=n)})}},this.Katavorio.version="1.0.0","undefined"!=typeof exports&&(exports.Katavorio=this.Katavorio)}.call("undefined"!=typeof window?window:this),function(){this.jsPlumbUtil=this.jsPlumbUtil||{};var o=this.jsPlumbUtil;function d(t){return"[object Array]"===Object.prototype.toString.call(t)}function c(t){return"string"==typeof t}function h(t){return"boolean"==typeof t}function p(t){return null!=t&&"[object Object]"===Object.prototype.toString.call(t)}function r(t){return"[object Date]"===Object.prototype.toString.call(t)}function u(t){return"[object Function]"===Object.prototype.toString.call(t)}function f(t){if(c(t))return""+t;if(h(t))return!!t;if(r(t))return new Date(t.getTime());if(u(t))return t;if(d(t)){for(var e=[],n=0;n<t.length;n++)e.push(f(t[n]));return e}if(p(t)){var o={};for(var i in t)o[i]=f(t[i]);return o}return t}function l(t,e,n,o){var i,r,s={},a={};for(n=n||[],o=o||[],r=0;r<n.length;r++)s[n[r]]=!0;for(r=0;r<o.length;r++)a[o[r]]=!0;var l=f(t);for(r in e)if(null==l[r]||a[r])l[r]=e[r];else if(c(e[r])||h(e[r]))s[r]?((i=[]).push.apply(i,d(l[r])?l[r]:[l[r]]),i.push.apply(i,h(e[r])?e[r]:[e[r]]),l[r]=i):l[r]=e[r];else if(d(e[r]))i=[],d(l[r])&&i.push.apply(i,l[r]),i.push.apply(i,e[r]),l[r]=i;else if(p(e[r]))for(var u in p(l[r])||(l[r]={}),e[r])l[r][u]=e[r][u];return l}function i(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1}function s(t,e){var n=t.indexOf(e);return-1<n&&t.splice(n,1),-1!==n}function a(t,e,n,o){var i=t[e];return null==i&&(i=[],t[e]=i),i[o?"unshift":"push"](n),i}"undefined"!=typeof exports&&(exports.jsPlumbUtil=o),o.isArray=d,o.isNumber=function(t){return"[object Number]"===Object.prototype.toString.call(t)},o.isString=c,o.isBoolean=h,o.isNull=function(t){return null==t},o.isObject=p,o.isDate=r,o.isFunction=u,o.isNamedFunction=function(t){return u(t)&&null!=t.name&&0<t.name.length},o.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},o.clone=f,o.merge=l,o.replace=function(t,e,a){if(null!=t){var l=t;return e.replace(/([^\.])+/g,function(t,e,n,o){function i(){return l[r[1]]||(l[r[1]]=[],l[r[1]])}var r=t.match(/([^\[0-9]+){1}(\[)([0-9+])/);if(n+t.length>=o.length)r?i()[r[3]]=a:l[t]=a;else if(r){var s=i();l=s[r[3]]||(s[r[3]]={},s[r[3]])}else l=l[t]||(l[t]={},l[t]);return""}),t}},o.functionChain=function(t,e,n){for(var o=0;o<n.length;o++){var i=n[o][0][n[o][1]].apply(n[o][0],n[o][2]);if(i===e)return i}return t},o.populate=function(t,r,s,a){var l=function(t){if(null!=t){if(c(t))return function(t){var e=t.match(/(\${.*?})/g);if(null!=e)for(var n=0;n<e.length;n++){var o=r[e[n].substring(2,e[n].length-1)]||"";null!=o&&(t=t.replace(e[n],o))}return t}(t);if(!u(t)||a||null!=s&&0!==(t.name||"").indexOf(s)){if(d(t)){for(var e=[],n=0;n<t.length;n++)e.push(l(t[n]));return e}if(p(t)){var o={};for(var i in t)o[i]=l(t[i]);return o}return t}return t(r)}};return l(t)},o.findWithFunction=i,o.removeWithFunction=function(t,e){var n=i(t,e);return-1<n&&t.splice(n,1),-1!==n},o.remove=s,o.addWithFunction=function(t,e,n){-1===i(t,n)&&t.push(e)},o.addToList=a,o.suggest=function(t,e,n){return-1===t.indexOf(e)&&(n?t.unshift(e):t.push(e),!0)},o.extend=function(o,n,t){var i;function e(t){for(var e=t.__proto__;null!=e;)if(null!=e.prototype){for(var n in e.prototype)e.prototype.hasOwnProperty(n)&&!o.prototype.hasOwnProperty(n)&&(o.prototype[n]=e.prototype[n]);e=e.prototype.__proto__}else e=null}for(n=d(n)?n:[n],i=0;i<n.length;i++){for(var r in n[i].prototype)n[i].prototype.hasOwnProperty(r)&&!o.prototype.hasOwnProperty(r)&&(o.prototype[r]=n[i].prototype[r]);e(n[i])}function s(t,e){return function(){for(i=0;i<n.length;i++)n[i].prototype[t]&&n[i].prototype[t].apply(this,arguments);return e.apply(this,arguments)}}function a(t){for(var e in t)o.prototype[e]=s(e,t[e])}if(2<arguments.length)for(i=2;i<arguments.length;i++)a(arguments[i]);return o};for(var g=[],t=0;t<256;t++)g[t]=(t<16?"0":"")+t.toString(16);function m(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return g[255&t]+g[t>>8&255]+g[t>>16&255]+g[t>>24&255]+"-"+g[255&e]+g[e>>8&255]+"-"+g[e>>16&15|64]+g[e>>24&255]+"-"+g[63&n|128]+g[n>>8&255]+"-"+g[n>>16&255]+g[n>>24&255]+g[255&o]+g[o>>8&255]+g[o>>16&255]+g[o>>24&255]}function v(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(o.logEnabled&&"undefined"!=typeof console)try{var n=arguments[arguments.length-1];console.log(n)}catch(t){}}o.uuid=m,o.fastTrim=function(t){if(null==t)return null;for(var e=t.replace(/^\s\s*/,""),n=/\s/,o=e.length;n.test(e.charAt(--o)););return e.slice(0,o+1)},o.each=function(t,e){t=null==t.length||"string"==typeof t?[t]:t;for(var n=0;n<t.length;n++)e(t[n])},o.map=function(t,e){for(var n=[],o=0;o<t.length;o++)n.push(e(t[o]));return n},o.mergeWithParents=function(t,e,n){function i(t){return t?e[t]:null}function r(t){return t?i(t[n]):null}n=n||"parent";var s=function(t,e){if(null==t)return e;var n=["anchor","anchors","cssClass","connector","paintStyle","hoverPaintStyle","endpoint","endpoints"];"override"===e.mergeStrategy&&Array.prototype.push.apply(n,["events","overlays"]);var o=l(t,e,[],n);return s(r(t),o)},a=function(t){if(null==t)return{};if("string"==typeof t)return i(t);if(t.length){for(var e=!1,n=0,o=void 0;!e&&n<t.length;)(o=a(t[n]))?e=!0:n++;return o}},o=a(t);return o?s(r(o),o):{}},o.logEnabled=!0,o.log=v,o.wrap=function(e,n,o){return function(){var t=null;try{null!=n&&(t=n.apply(this,arguments))}catch(t){v("jsPlumb function failed : "+t)}if(null!=e&&(null==o||t!==o))try{t=e.apply(this,arguments)}catch(t){v("wrapped function failed : "+t)}return t}};function e(){var r=this;this._listeners={},this.eventsSuspended=!1,this.tick=!1,this.eventsToDieOn={ready:!0},this.queue=[],this.bind=function(t,e,n){function o(t){a(r._listeners,t,e,n),e.__jsPlumb=e.__jsPlumb||{},e.__jsPlumb[m()]=t}if("string"==typeof t)o(t);else if(null!=t.length)for(var i=0;i<t.length;i++)o(t[i]);return r},this.fire=function(e,t,n){if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[e]){var o=this._listeners[e].length,i=0,r=!1,s=null;if(!this.shouldFireEvent||this.shouldFireEvent(e,t,n))for(;!r&&i<o&&!1!==s;){if(this.eventsToDieOn[e])this._listeners[e][i].apply(this,[t,n]);else try{s=this._listeners[e][i].apply(this,[t,n])}catch(t){v("jsPlumb: fire failed for event "+e+" : "+t)}i++,null!=this._listeners&&null!=this._listeners[e]||(r=!0)}}this.tick=!1,this._drain()}return this},this._drain=function(){var t=r.queue.pop();t&&r.fire.apply(r,t)},this.unbind=function(t,e){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb){var n=void 0;for(var o in t.__jsPlumb)n=t.__jsPlumb[o],s(this._listeners[n]||[],t)}}else 2===arguments.length&&s(this._listeners[t]||[],e);return this},this.getListener=function(t){return r._listeners[t]},this.setSuspendEvents=function(t){r.eventsSuspended=t},this.isSuspendEvents=function(){return r.eventsSuspended},this.silently=function(t){r.setSuspendEvents(!0);try{t()}catch(t){v("Cannot execute silent function "+t)}r.setSuspendEvents(!1)},this.cleanupListeners=function(){for(var t in r._listeners)r._listeners[t]=null}}function y(t,e,n){var o=[t[0]-e[0],t[1]-e[1]],i=Math.cos(n/360*Math.PI*2),r=Math.sin(n/360*Math.PI*2);return[o[0]*i-o[1]*r+e[0],o[1]*i+o[0]*r+e[1],i,r]}o.EventGenerator=e,o.rotatePoint=y,o.rotateAnchorOrientation=function(t,e){var n=y(t,[0,0],e);return[Math.round(n[0]),Math.round(n[1])]}}.call("undefined"!=typeof window?window:this),function(){"use strict";this.jsPlumbUtil.matchesSelector=function(t,e,n){for(var o=(n=n||t.parentNode).querySelectorAll(e),i=0;i<o.length;i++)if(o[i]===t)return!0;return!1},this.jsPlumbUtil.consume=function(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()},this.jsPlumbUtil.sizeElement=function(t,e,n,o,i){t&&(t.style.height=i+"px",t.height=i,t.style.width=o+"px",t.width=o,t.style.left=e+"px",t.style.top=n+"px")}}.call("undefined"!=typeof window?window:this),function(){function t(t,e){this.count=0,this.instance=t,this.lists={},this.options=e||{},this.instance.addList=function(t,e){return this.listManager.addList(t,e)},this.instance.removeList=function(t){this.listManager.removeList(t)},this.instance.bind("manageElement",function(t){for(var e=this.instance.getSelector(t.el,"[jtk-scrollable-list]"),n=0;n<e.length;n++)this.addList(e[n])}.bind(this)),this.instance.bind("unmanageElement",function(t){this.removeList(t.el)}),this.instance.bind("connection",function(t,e){null==e&&(this._maybeUpdateParentList(t.source),this._maybeUpdateParentList(t.target))}.bind(this))}var i={deriveAnchor:function(t,e,n,o){return{top:["TopRight","TopLeft"],bottom:["BottomRight","BottomLeft"]}[t][e]}};(this.jsPlumbListManager=t).prototype={addList:function(t,e){var n=this.instance.extend({},i);this.instance.extend(n,this.options),e=this.instance.extend(n,e||{});var o=[this.instance.getInstanceIndex(),this.count++].join("_");this.lists[o]=new r(this.instance,t,e,o)},removeList:function(t){var e=this.lists[t._jsPlumbList];e&&(e.destroy(),delete this.lists[t._jsPlumbList])},_maybeUpdateParentList:function(t){for(var e=t.parentNode,n=this.instance.getContainer();null!=e&&e!==n;){if(null!=e._jsPlumbList&&null!=this.lists[e._jsPlumbList])return void e._jsPlumbScrollHandler();e=e.parentNode}}};var r=function(r,s,i,t){function a(t,e,n,o){return i.anchor?i.anchor:i.deriveAnchor(t,e,n,o)}function l(t,e,n,o){return i.deriveEndpoint?i.deriveEndpoint(t,e,n,o):i.endpoint?i.endpoint:n.type}s._jsPlumbList=t;function u(t){for(var e=r.getSelector(s,".jtk-managed"),n=r.getId(s),o=0;o<e.length;o++){if(e[o].offsetTop<s.scrollTop)e[o]._jsPlumbProxies||(e[o]._jsPlumbProxies=e[o]._jsPlumbProxies||[],r.select({source:e[o]}).each(function(t){r.proxyConnection(t,0,s,n,function(){return l("top",0,t.endpoints[0],t)},function(){return a("top",0,t.endpoints[0],t)}),e[o]._jsPlumbProxies.push([t,0])}),r.select({target:e[o]}).each(function(t){r.proxyConnection(t,1,s,n,function(){return l("top",1,t.endpoints[1],t)},function(){return a("top",1,t.endpoints[1],t)}),e[o]._jsPlumbProxies.push([t,1])}));else if(e[o].offsetTop+e[o].offsetHeight>s.scrollTop+s.offsetHeight)e[o]._jsPlumbProxies||(e[o]._jsPlumbProxies=e[o]._jsPlumbProxies||[],r.select({source:e[o]}).each(function(t){r.proxyConnection(t,0,s,n,function(){return l("bottom",0,t.endpoints[0],t)},function(){return a("bottom",0,t.endpoints[0],t)}),e[o]._jsPlumbProxies.push([t,0])}),r.select({target:e[o]}).each(function(t){r.proxyConnection(t,1,s,n,function(){return l("bottom",1,t.endpoints[1],t)},function(){return a("bottom",1,t.endpoints[1],t)}),e[o]._jsPlumbProxies.push([t,1])}));else if(e[o]._jsPlumbProxies){for(var i=0;i<e[o]._jsPlumbProxies.length;i++)r.unproxyConnection(e[o]._jsPlumbProxies[i][0],e[o]._jsPlumbProxies[i][1],n);delete e[o]._jsPlumbProxies}r.revalidate(e[o])}!function(t){for(var e=t.parentNode,n=r.getContainer();null!=e&&e!==n;){if(r.hasClass(e,"jtk-managed"))return r.recalculateOffsets(e);e=e.parentNode}}(s)}r.setAttribute(s,"jtk-scrollable-list","true"),s._jsPlumbScrollHandler=u,r.on(s,"scroll",u),u(),this.destroy=function(){r.off(s,"scroll",u),delete s._jsPlumbScrollHandler;for(var t=r.getSelector(s,".jtk-managed"),e=r.getId(s),n=0;n<t.length;n++)if(t[n]._jsPlumbProxies){for(var o=0;o<t[n]._jsPlumbProxies.length;o++)r.unproxyConnection(t[n]._jsPlumbProxies[o][0],t[n]._jsPlumbProxies[o][1],e);delete t[n]._jsPlumbProxies}}}}.call("undefined"!=typeof window?window:this),function(){"use strict";function n(t){if(t._jsPlumb.paintStyle&&t._jsPlumb.hoverPaintStyle){var e={};dt.extend(e,t._jsPlumb.paintStyle),dt.extend(e,t._jsPlumb.hoverPaintStyle),delete t._jsPlumb.hoverPaintStyle,e.gradient&&t._jsPlumb.paintStyle.fill&&delete e.gradient,t._jsPlumb.hoverPaintStyle=e}}function l(t){return null==t?null:t.split(" ")}function p(t,e,n){for(var o in e)t[o]=n}function u(t,e,n){if(t.getDefaultType){var o=t.getTypeDescriptor(),i={},r=t.getDefaultType(),s=st.merge({},r);p(i,r,"__default");for(var a=0,l=t._jsPlumb.types.length;a<l;a++){var u=t._jsPlumb.types[a];if("__default"!==u){var d=t._jsPlumb.instance.getType(u,o);if(null!=d){var c=["anchor","anchors","connector","paintStyle","hoverPaintStyle","endpoint","endpoints","connectorOverlays","connectorStyle","connectorHoverStyle","endpointStyle","endpointHoverStyle"],h=[];"override"===d.mergeStrategy?Array.prototype.push.apply(c,["events","overlays","cssClass"]):h.push("cssClass"),s=st.merge(s,d,h,c),p(i,d,u)}}}e&&(s=st.populate(s,e,"_")),t.applyType(s,n,i),n||t.repaint()}}function d(t,e){var n=t._jsPlumb.types[e],o=t._jsPlumb.instance.getType(n,t.getTypeDescriptor());null!=o&&o.cssClass&&t.canvas&&t._jsPlumb.instance.removeClass(t.canvas,o.cssClass)}var rt=this,st=rt.jsPlumbUtil,at=["tap","dbltap","click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu"],lt=rt.jsPlumbUIComponent=function(t){st.EventGenerator.apply(this,arguments);var e=arguments,n=this.idPrefix+(new Date).getTime();this._jsPlumb={instance:t._jsPlumb,parameters:t.parameters||{},paintStyle:null,hoverPaintStyle:null,paintStyleInUse:null,hover:!1,beforeDetach:t.beforeDetach,beforeDrop:t.beforeDrop,overlayPlacements:[],hoverClass:t.hoverClass||t._jsPlumb.Defaults.HoverClass,types:[],typeCache:{}},this.cacheTypeItem=function(t,e,n){this._jsPlumb.typeCache[n]=this._jsPlumb.typeCache[n]||{},this._jsPlumb.typeCache[n][t]=e},this.getCachedTypeItem=function(t,e){return this._jsPlumb.typeCache[e]?this._jsPlumb.typeCache[e][t]:null},this.getId=function(){return n};var o=t.overlays||[],i={};if(this.defaultOverlayKeys){for(var r=0;r<this.defaultOverlayKeys.length;r++)Array.prototype.push.apply(o,this._jsPlumb.instance.Defaults[this.defaultOverlayKeys[r]]||[]);for(r=0;r<o.length;r++){var s=dt.convertToFullOverlaySpec(o[r]);i[s[1].id]=s}}var a={overlays:i,parameters:t.parameters||{},scope:t.scope||this._jsPlumb.instance.getDefaultScope()};if(this.getDefaultType=function(){return a},this.appendToDefaultType=function(t){for(var e in t)a[e]=t[e]},t.events)for(var l in t.events)this.bind(l,t.events[l]);this.clone=function(){var t=Object.create(this.constructor.prototype);return this.constructor.apply(t,e),t}.bind(this),this.isDetachAllowed=function(t){var e=!0;if(this._jsPlumb.beforeDetach)try{e=this._jsPlumb.beforeDetach(t)}catch(t){st.log("jsPlumb: beforeDetach callback failed",t)}return e},this.isDropAllowed=function(t,e,n,o,i,r,s){var a=this._jsPlumb.instance.checkCondition("beforeDrop",{sourceId:t,targetId:e,scope:n,connection:o,dropEndpoint:i,source:r,target:s});if(this._jsPlumb.beforeDrop)try{a=this._jsPlumb.beforeDrop({sourceId:t,targetId:e,scope:n,connection:o,dropEndpoint:i,source:r,target:s})}catch(t){st.log("jsPlumb: beforeDrop callback failed",t)}return a};var u=[];this.setListenerComponent=function(t){for(var e=0;e<u.length;e++)u[e][3]=t}};st.extend(rt.jsPlumbUIComponent,st.EventGenerator,{getParameter:function(t){return this._jsPlumb.parameters[t]},setParameter:function(t,e){this._jsPlumb.parameters[t]=e},getParameters:function(){return this._jsPlumb.parameters},setParameters:function(t){this._jsPlumb.parameters=t},getClass:function(){return dt.getClass(this.canvas)},hasClass:function(t){return dt.hasClass(this.canvas,t)},addClass:function(t){dt.addClass(this.canvas,t)},removeClass:function(t){dt.removeClass(this.canvas,t)},updateClasses:function(t,e){dt.updateClasses(this.canvas,t,e)},setType:function(t,e,n){this.clearTypes(),this._jsPlumb.types=l(t)||[],u(this,e,n)},getType:function(){return this._jsPlumb.types},reapplyTypes:function(t,e){u(this,t,e)},hasType:function(t){return-1!==this._jsPlumb.types.indexOf(t)},addType:function(t,e,n){var o=l(t),i=!1;if(null!=o){for(var r=0,s=o.length;r<s;r++)this.hasType(o[r])||(this._jsPlumb.types.push(o[r]),i=!0);i&&u(this,e,n)}},removeType:function(t,e,n){var o=l(t),i=!1,r=function(t){var e=this._jsPlumb.types.indexOf(t);return-1!==e&&(d(this,e),this._jsPlumb.types.splice(e,1),!0)}.bind(this);if(null!=o){for(var s=0,a=o.length;s<a;s++)i=r(o[s])||i;i&&u(this,e,n)}},clearTypes:function(t,e){for(var n=this._jsPlumb.types.length,o=0;o<n;o++)d(this,0),this._jsPlumb.types.splice(0,1);u(this,t,e)},toggleType:function(t,e,n){var o=l(t);if(null!=o){for(var i=0,r=o.length;i<r;i++){var s=this._jsPlumb.types.indexOf(o[i]);-1!==s?(d(this,s),this._jsPlumb.types.splice(s,1)):this._jsPlumb.types.push(o[i])}u(this,e,n)}},applyType:function(t,e){if(this.setPaintStyle(t.paintStyle,e),this.setHoverPaintStyle(t.hoverPaintStyle,e),t.parameters)for(var n in t.parameters)this.setParameter(n,t.parameters[n]);this._jsPlumb.paintStyleInUse=this.getPaintStyle()},setPaintStyle:function(t,e){this._jsPlumb.paintStyle=t,this._jsPlumb.paintStyleInUse=this._jsPlumb.paintStyle,n(this),e||this.repaint()},getPaintStyle:function(){return this._jsPlumb.paintStyle},setHoverPaintStyle:function(t,e){this._jsPlumb.hoverPaintStyle=t,n(this),e||this.repaint()},getHoverPaintStyle:function(){return this._jsPlumb.hoverPaintStyle},destroy:function(t){!t&&null!=this.typeId||(this.cleanupListeners(),this.clone=null,this._jsPlumb=null)},isHover:function(){return this._jsPlumb.hover},setHover:function(t,e,n){if(this._jsPlumb&&!this._jsPlumb.instance.currentlyDragging&&!this._jsPlumb.instance.isHoverSuspended()){var o=(this._jsPlumb.hover=t)?"addClass":"removeClass";null!=this.canvas&&(null!=this._jsPlumb.instance.hoverClass&&this._jsPlumb.instance[o](this.canvas,this._jsPlumb.instance.hoverClass),null!=this._jsPlumb.hoverClass&&this._jsPlumb.instance[o](this.canvas,this._jsPlumb.hoverClass)),null!=this._jsPlumb.hoverPaintStyle&&(this._jsPlumb.paintStyleInUse=t?this._jsPlumb.hoverPaintStyle:this._jsPlumb.paintStyle,this._jsPlumb.instance.isSuspendDrawing()||(n=n||jsPlumbUtil.uuid(),this.repaint({timestamp:n,recalc:!1}))),this.getAttachedElements&&!e&&function(t,e,n,o){var i=t.getAttachedElements();if(i)for(var r=0,s=i.length;r<s;r++)o&&o===i[r]||i[r].setHover(e,!0,n)}(this,t,jsPlumbUtil.uuid(),this)}}});var ut=0,i=rt.jsPlumbInstance=function(t){this.version="<% pkg.version %>",this.Defaults={Anchor:"Bottom",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:!1,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fill:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},ListStyle:{},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{"stroke-width":4,stroke:"#456"},ReattachConnections:!1,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"},t&&dt.extend(this.Defaults,t),this.logEnabled=this.Defaults.LogEnabled,this._connectionTypes={},this._endpointTypes={},st.EventGenerator.apply(this);function h(t){if(null==t)return null;if(3===t.nodeType||8===t.nodeType)return{el:t,text:!0};var e=P.getElement(t);return{el:e,id:st.isString(t)&&null==e?t:N(e)}}var P=this,i=function(){var t=ut+1;return ut++,t}(),n=P.bind,e={},E=1;for(var o in this.getInstanceIndex=function(){return i},this.setZoom=function(t,e){return E=t,P.fire("zoom",E),e&&P.repaintEverything(),!0},this.getZoom=function(){return E},this.Defaults)e[o]=this.Defaults[o];var u,d=[];this.unbindContainer=function(){if(null!=u&&0<d.length)for(var t=0;t<d.length;t++)P.off(u,d[t][0],d[t][1])},this.setContainer=function(e){this.unbindContainer(),e=this.getElement(e),this.select().each(function(t){t.moveParent(e)}),this.selectEndpoints().each(function(t){t.moveParent(e)});var t=u;u=e,d.length=0;for(var s={endpointclick:"endpointClick",endpointdblclick:"endpointDblClick"},n=function(t,e,n){var o=e.srcElement||e.target,i=(o&&o.parentNode?o.parentNode._jsPlumb:null)||(o?o._jsPlumb:null)||(o&&o.parentNode&&o.parentNode.parentNode?o.parentNode.parentNode._jsPlumb:null);if(i){i.fire(t,i,e);var r=n&&s[n+t]||t;P.fire(r,i.component||i,e)}},o=function(t,e,n){d.push([t,n]),P.on(u,t,e,n)},i=function(e){o(e,".jtk-connector",function(t){n(e,t)}),o(e,".jtk-endpoint",function(t){n(e,t,"endpoint")}),o(e,".jtk-overlay",function(t){n(e,t)})},r=0;r<at.length;r++)i(at[r]);for(var a in v){var l=v[a].el;l.parentNode===t&&(t.removeChild(l),u.appendChild(l))}},this.getContainer=function(){return u},this.bind=function(t,e){"ready"===t&&f?e():n.apply(P,[t,e])},P.importDefaults=function(t){for(var e in t)P.Defaults[e]=t[e];return t.Container&&P.setContainer(t.Container),P},P.restoreDefaults=function(){return P.Defaults=dt.extend({},e),P};function s(){return""+I++}function r(t,e,n,o){var i={c:[],e:[]};if(!_&&null!=(t=P.getElement(t))){var r=N(t),s=t.querySelectorAll(".jtk-managed");null==n&&(n=jsPlumbUtil.uuid());J({elId:r,offset:e,recalc:!1,timestamp:n});for(var a=0;a<s.length;a++)J({elId:s[a].getAttribute("id"),recalc:!0,timestamp:n});var l=P.router.redraw(r,e,n,null,o);if(Array.prototype.push.apply(i.c,l.c),Array.prototype.push.apply(i.e,l.e),s)for(var u=0;u<s.length;u++)l=P.router.redraw(s[u].getAttribute("id"),null,n,null,o,!0),Array.prototype.push.apply(i.c,l.c),Array.prototype.push.apply(i.e,l.e)}return i}function c(t){return m[t]}function a(t,e,n){var o=y[t];if(o&&o.length)for(var i=0,r=o.length;i<r;i++){for(var s=0,a=o[i].connections.length;s<a;s++){if(e(o[i].connections[s]))return}n&&n(o[i])}}function l(t,n,o){n="block"===n;var e=null;o&&(e=function(t){t.setVisible(n,!0,!0)});var i=h(t);a(i.id,function(t){if(n&&o){var e=t.sourceId===i.id?1:0;t.endpoints[e].isVisible()&&t.setVisible(!0)}else t.setVisible(n)},e)}var p=null,f=!1,g=[],y={},m={},v={},b={},x={},C=!1,j=[],_=!1,w=null,S=this.Defaults.Scope,I=1,k=function(t,e){u?u.appendChild(t):e?this.getElement(e).appendChild(t):this.appendToRoot(t)}.bind(this),A=function(t,e){var a=dt.extend({},t);if(e&&dt.extend(a,e),a.source&&(a.source.endpoint?a.sourceEndpoint=a.source:a.source=P.getElement(a.source)),a.target&&(a.target.endpoint?a.targetEndpoint=a.target:a.target=P.getElement(a.target)),t.uuids&&(a.sourceEndpoint=c(t.uuids[0]),a.targetEndpoint=c(t.uuids[1])),a.sourceEndpoint&&a.sourceEndpoint.isFull())st.log(P,"could not add connection; source endpoint is full");else if(a.targetEndpoint&&a.targetEndpoint.isFull())st.log(P,"could not add connection; target endpoint is full");else{if(!a.type&&a.sourceEndpoint&&(a.type=a.sourceEndpoint.connectionType),a.sourceEndpoint&&a.sourceEndpoint.connectorOverlays){a.overlays=a.overlays||[];for(var n=0,o=a.sourceEndpoint.connectorOverlays.length;n<o;n++)a.overlays.push(a.sourceEndpoint.connectorOverlays[n])}a.sourceEndpoint&&a.sourceEndpoint.scope&&(a.scope=a.sourceEndpoint.scope),!a["pointer-events"]&&a.sourceEndpoint&&a.sourceEndpoint.connectorPointerEvents&&(a["pointer-events"]=a.sourceEndpoint.connectorPointerEvents);var l=function(t,e,n){var o=function(t,e){var n=dt.extend({},t);for(var o in e)e[o]&&(n[o]=e[o]);return n}(e,{anchor:a.anchors?a.anchors[n]:a.anchor,endpoint:a.endpoints?a.endpoints[n]:a.endpoint,paintStyle:a.endpointStyles?a.endpointStyles[n]:a.endpointStyle,hoverPaintStyle:a.endpointHoverStyles?a.endpointHoverStyles[n]:a.endpointHoverStyle});return P.addEndpoint(t,o)},i=function(t,e,n,o){if(a[t]&&!a[t].endpoint&&!a[t+"Endpoint"]&&!a.newConnection){var i=n[N(a[t])];if(i=i?i[o]:null){if(!i.enabled)return!1;var r=dt.extend({},i.def);delete r.label;var s=null!=i.endpoint&&i.endpoint._jsPlumb?i.endpoint:l(a[t],r,e);if(s.isFull())return!1;a[t+"Endpoint"]=s,!a.scope&&r.scope&&(a.scope=r.scope),i.uniqueEndpoint?i.endpoint?s.finalEndpoint=i.endpoint:(i.endpoint=s).setDeleteOnEmpty(!1):s.setDeleteOnEmpty(!0),0===e&&i.def.connectorOverlays&&(a.overlays=a.overlays||[],Array.prototype.push.apply(a.overlays,i.def.connectorOverlays))}}};if(!1!==i("source",0,this.sourceEndpointDefinitions,a.type||"default")&&!1!==i("target",1,this.targetEndpointDefinitions,a.type||"default"))return a.sourceEndpoint&&a.targetEndpoint&&!function(t,e){for(var n=t.scope.split(/\s/),o=e.scope.split(/\s/),i=0;i<n.length;i++)for(var r=0;r<o.length;r++)if(o[r]===n[i])return!0;return!1}(a.sourceEndpoint,a.targetEndpoint)&&(a=null),a}}.bind(P),T=function(t){var e=P.Defaults.ConnectionType||P.getDefaultConnectionType();t._jsPlumb=P,t.newConnection=T,t.newEndpoint=M,t.endpointsByUUID=m,t.endpointsByElement=y,t.finaliseConnection=D,t.id="con_"+s();var n=new e(t);return n.isDetachable()&&(n.endpoints[0].initDraggable("_jsPlumbSource"),n.endpoints[1].initDraggable("_jsPlumbTarget")),n},D=P.finaliseConnection=function(t,e,n,o){if(e=e||{},t.suspendedEndpoint||g.push(t),t.pending=null,(t.endpoints[0].isTemporarySource=!1)!==o&&P.router.newConnection(t),r(t.source),!e.doNotFireConnectionEvent&&!1!==e.fireEvent){var i={connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]};P.fire("connection",i,n)}},M=function(t,e){var n=P.Defaults.EndpointType||dt.Endpoint,o=dt.extend({},t);o._jsPlumb=P,o.newConnection=T,o.newEndpoint=M,o.endpointsByUUID=m,o.endpointsByElement=y,o.fireDetachEvent=L,o.elementId=e||N(o.source);var i=new n(o);return i.id="ep_"+s(),q(o.elementId,o.source),dt.headless||P.getDragManager().endpointAdded(o.source,e),i},N=function(t,e,n){if(st.isString(t))return t;if(null==t)return null;var o=P.getAttribute(t,"id");return o&&"undefined"!==o||(2===arguments.length&&void 0!==e?o=e:1!==arguments.length&&(3!==arguments.length||n)||(o="jsPlumb_"+i+"_"+s()),n||P.setAttribute(t,"id",o)),o};this.setConnectionBeingDragged=function(t){C=t},this.isConnectionBeingDragged=function(){return C},this.getManagedElements=function(){return v},this.connectorClass="jtk-connector",this.connectorOutlineClass="jtk-connector-outline",this.connectedClass="jtk-connected",this.hoverClass="jtk-hover",this.endpointClass="jtk-endpoint",this.endpointConnectedClass="jtk-endpoint-connected",this.endpointFullClass="jtk-endpoint-full",this.endpointDropAllowedClass="jtk-endpoint-drop-allowed",this.endpointDropForbiddenClass="jtk-endpoint-drop-forbidden",this.overlayClass="jtk-overlay",this.draggingClass="jtk-dragging",this.elementDraggingClass="jtk-element-dragging",this.sourceElementDraggingClass="jtk-source-element-dragging",this.targetElementDraggingClass="jtk-target-element-dragging",this.endpointAnchorClassPrefix="jtk-endpoint-anchor",this.hoverSourceClass="jtk-source-hover",this.hoverTargetClass="jtk-target-hover",this.dragSelectClass="jtk-drag-select",this.Anchors={},this.Connectors={svg:{}},this.Endpoints={svg:{}},this.Overlays={svg:{}},this.ConnectorRenderers={},this.SVG="svg",this.addEndpoint=function(t,e,n){n=n||{};var o=dt.extend({},n);dt.extend(o,e),o.endpoint=o.endpoint||P.Defaults.Endpoint,o.paintStyle=o.paintStyle||P.Defaults.EndpointStyle;for(var i=[],r=st.isArray(t)||null!=t.length&&!st.isString(t)?t:[t],s=0,a=r.length;s<a;s++){o.source=P.getElement(r[s]),Z(o.source);var l=N(o.source),u=M(o,l),d=q(l,o.source,null,!_).info.o;st.addToList(y,l,u),_||u.paint({anchorLoc:u.anchor.compute({xy:[d.left,d.top],wh:j[l],element:u,timestamp:w,rotation:this.getRotation(l)}),timestamp:w}),i.push(u)}return 1===i.length?i[0]:i},this.addEndpoints=function(t,e,n){for(var o=[],i=0,r=e.length;i<r;i++){var s=P.addEndpoint(t,e[i],n);st.isArray(s)?Array.prototype.push.apply(o,s):o.push(s)}return o},this.animate=function(t,e,n){if(!this.animationSupported)return!1;n=n||{};var o=P.getElement(t),i=N(o),r=dt.animEvents.step,s=dt.animEvents.complete;n[r]=st.wrap(n[r],function(){P.revalidate(i)}),n[s]=st.wrap(n[s],function(){P.revalidate(i)}),P.doAnimate(o,e,n)},this.checkCondition=function(e,t){var n=P.getListener(e),o=!0;if(n&&0<n.length){var i=Array.prototype.slice.call(arguments,1);try{for(var r=0,s=n.length;r<s;r++)o=o&&n[r].apply(n[r],i)}catch(t){st.log(P,"cannot check condition ["+e+"]"+t)}}return o},this.connect=function(t,e){var n,o=A(t,e);if(o){if(null==o.source&&null==o.sourceEndpoint)return void st.log("Cannot establish connection - source does not exist");if(null==o.target&&null==o.targetEndpoint)return void st.log("Cannot establish connection - target does not exist");Z(o.source),n=T(o),D(n,o)}return n};var O=[{el:"source",elId:"sourceId",epDefs:"sourceEndpointDefinitions"},{el:"target",elId:"targetId",epDefs:"targetEndpointDefinitions"}],F=function(t,e,n,o){var i,r,s,a=O[n],l=t[a.elId],u=(t[a.el],t.endpoints[n]),d={index:n,originalSourceId:0===n?l:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===n?l:t.targetId,newTargetId:t.targetId,connection:t};if(e.constructor===dt.Endpoint)(i=e).addConnection(t),e=i.element;else if(r=N(e),s=this[a.epDefs][r],r===t[a.elId])i=null;else if(s)for(var c in s){if(!s[c].enabled)return;i=null!=s[c].endpoint&&s[c].endpoint._jsPlumb?s[c].endpoint:this.addEndpoint(e,s[c].def),s[c].uniqueEndpoint&&(s[c].endpoint=i),i.addConnection(t)}else i=t.makeEndpoint(0===n,e,r);return null!=i&&(u.detachFromConnection(t),t.endpoints[n]=i,t[a.el]=i.element,t[a.elId]=i.elementId,d[0===n?"newSourceId":"newTargetId"]=i.elementId,R(d),o||t.repaint()),d.element=e,d}.bind(this);this.setSource=function(t,e,n){var o=F(t,e,0,n);this.router.sourceOrTargetChanged(o.originalSourceId,o.newSourceId,t,o.el,0)},this.setTarget=function(t,e,n){var o=F(t,e,1,n);this.router.sourceOrTargetChanged(o.originalTargetId,o.newTargetId,t,o.el,1)},this.deleteEndpoint=function(t,e,n){var o="string"==typeof t?m[t]:t;return o&&P.deleteObject({endpoint:o,dontUpdateHover:e,deleteAttachedObjects:n}),P},this.deleteEveryEndpoint=function(){var t=P.setSuspendDrawing(!0);for(var e in y){var n=y[e];if(n&&n.length)for(var o=0,i=n.length;o<i;o++)P.deleteEndpoint(n[o],!0)}y={},v={},m={},b={},x={},P.router.reset();var r=P.getDragManager();return r&&r.reset(),t||P.setSuspendDrawing(!1),P};var L=function(t,e,n){var o=P.Defaults.ConnectionType||P.getDefaultConnectionType(),i=t.constructor===o?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;e&&P.fire("connectionDetached",i,n),P.fire("internal.connectionDetached",i,n),P.router.connectionDetached(i)},R=P.fireMoveEvent=function(t,e){P.fire("connectionMoved",t,e)};this.unregisterEndpoint=function(t){for(var e in t._jsPlumb.uuid&&(m[t._jsPlumb.uuid]=null),P.router.deleteEndpoint(t),y){var n=y[e];if(n){for(var o=[],i=0,r=n.length;i<r;i++)n[i]!==t&&o.push(n[i]);y[e]=o}y[e].length<1&&delete y[e]}};var G="isDetachAllowed";this.deleteConnection=function(e,t){return!(null==e||!(t=t||{}).force&&!st.functionChain(!0,!1,[[e.endpoints[0],G,[e]],[e.endpoints[1],G,[e]],[e,G,[e]],[P,"checkCondition",["beforeDetach",e]]]))&&(e.setHover(!1),L(e,!e.pending&&!1!==t.fireEvent,t.originalEvent),e.endpoints[0].detachFromConnection(e),e.endpoints[1].detachFromConnection(e),st.removeWithFunction(g,function(t){return e.id===t.id}),e.cleanup(),e.destroy(),!0)},this.deleteEveryConnection=function(e){e=e||{};var n=g.length,o=0;return P.batch(function(){for(var t=0;t<n;t++)o+=P.deleteConnection(g[0],e)?1:0}),o},this.deleteConnectionsForElement=function(t,e){e=e||{},t=P.getElement(t);var n=N(t),o=y[n];if(o&&o.length)for(var i=0,r=o.length;i<r;i++)o[i].deleteEveryConnection(e);return P},this.deleteObject=function(o){function i(t){null!=t&&null==r.connections[t.id]&&(o.dontUpdateHover||null==t._jsPlumb||t.setHover(!1),r.connections[t.id]=t,r.connectionCount++)}var r={endpoints:{},connections:{},endpointCount:0,connectionCount:0},s=!1!==o.deleteAttachedObjects;for(var t in o.connection?i(o.connection):function(t){if(null!=t&&null==r.endpoints[t.id]&&(o.dontUpdateHover||null==t._jsPlumb||t.setHover(!1),r.endpoints[t.id]=t,r.endpointCount++,s))for(var e=0;e<t.connections.length;e++){var n=t.connections[e];i(n)}}(o.endpoint),r.connections){var e=r.connections[t];if(e._jsPlumb){st.removeWithFunction(g,function(t){return e.id===t.id}),L(e,!1!==o.fireEvent&&!e.pending,o.originalEvent);var n=null==o.deleteAttachedObjects?null:!o.deleteAttachedObjects;e.endpoints[0].detachFromConnection(e,null,n),e.endpoints[1].detachFromConnection(e,null,n),e.cleanup(!0),e.destroy(!0)}}for(var a in r.endpoints){var l=r.endpoints[a];l._jsPlumb&&(P.unregisterEndpoint(l),l.cleanup(!0),l.destroy(!0))}return r};function z(t,e,n){return function(){return function(t,e,n,o){for(var i=0,r=t.length;i<r;i++)t[i][e].apply(t[i],n);return o(t)}(t,e,arguments,n)}}function U(t,e){return function(){return function(t,e,n){for(var o=[],i=0,r=t.length;i<r;i++)o.push([t[i][e].apply(t[i],n),t[i]]);return o}(t,e,arguments)}}function B(t,e){var n=[];if(t)if("string"==typeof t){if("*"===t)return t;n.push(t)}else if(e)n=t;else if(t.length)for(var o=0,i=t.length;o<i;o++)n.push(h(t[o]).id);else n.push(h(t).id);return n}function V(t,e,n){return"*"===t||(0<t.length?-1!==t.indexOf(e):!n)}this.getConnections=function(t,o){t?t.constructor===String&&(t={scope:t}):t={};for(var e=t.scope||P.getDefaultScope(),i=B(e,!0),n=B(t.source),r=B(t.target),s=!o&&1<i.length?{}:[],a=function(t,e){if(!o&&1<i.length){var n=s[t];null==n&&(n=s[t]=[]),n.push(e)}else s.push(e)},l=0,u=g.length;l<u;l++){var d=g[l],c=d.proxies&&d.proxies[0]?d.proxies[0].originalEp.elementId:d.sourceId,h=d.proxies&&d.proxies[1]?d.proxies[1].originalEp.elementId:d.targetId;V(i,d.scope)&&V(n,c)&&V(r,h)&&a(d.scope,d)}return s};function H(t,e){var n,o,i={length:t.length,each:function(o,i){return function(t){for(var e=0,n=o.length;e<n;e++)t(o[e]);return i(o)}}(t,e),get:function(e){return function(t){return e[t]}}(t)},r=["setHover","removeAllOverlays","setLabel","addClass","addOverlay","removeOverlay","removeOverlays","showOverlay","hideOverlay","showOverlays","hideOverlays","setPaintStyle","setHoverPaintStyle","setSuspendEvents","setParameter","setParameters","setVisible","repaint","addType","toggleType","removeType","removeClass","setType","bind","unbind"],s=["getLabel","getOverlay","isHover","getParameter","getParameters","getPaintStyle","getHoverPaintStyle","isVisible","hasType","getType","isSuspendEvents"];for(n=0,o=r.length;n<o;n++)i[r[n]]=z(t,r[n],e);for(n=0,o=s.length;n<o;n++)i[s[n]]=U(t,s[n]);return i}var W=function(n){var t=H(n,W);return dt.extend(t,{setDetachable:z(n,"setDetachable",W),setReattach:z(n,"setReattach",W),setConnector:z(n,"setConnector",W),delete:function(){for(var t=0,e=n.length;t<e;t++)P.deleteConnection(n[t])},isDetachable:U(n,"isDetachable"),isReattach:U(n,"isReattach")})},X=function(n){var t=H(n,X);return dt.extend(t,{setEnabled:z(n,"setEnabled",X),setAnchor:z(n,"setAnchor",X),isEnabled:U(n,"isEnabled"),deleteEveryConnection:function(){for(var t=0,e=n.length;t<e;t++)n[t].deleteEveryConnection()},delete:function(){for(var t=0,e=n.length;t<e;t++)P.deleteEndpoint(n[t])}})};this.select=function(t){return(t=t||{}).scope=t.scope||"*",W(t.connections||P.getConnections(t,!0))},this.selectEndpoints=function(t){(t=t||{}).scope=t.scope||"*";var e=!t.element&&!t.source&&!t.target,n=e?"*":B(t.element),o=e?"*":B(t.source),i=e?"*":B(t.target),r=B(t.scope,!0),s=[];for(var a in y){var l=V(n,a,!0),u=V(o,a,!0),d="*"!==o,c=V(i,a,!0),h="*"!==i;if(l||u||c)t:for(var p=0,f=y[a].length;p<f;p++){var g=y[a][p];if(V(r,g.scope,!0)){var m=d&&0<o.length&&!g.isSource,v=h&&0<i.length&&!g.isTarget;if(m||v)continue t;s.push(g)}}}return X(s)},this.getAllConnections=function(){return g},this.getDefaultScope=function(){return S},this.getEndpoint=c,this.getEndpoints=function(t){return y[h(t).id]||[]},this.getDefaultEndpointType=function(){return dt.Endpoint},this.getDefaultConnectionType=function(){return dt.Connection},this.getId=N,this.draw=r,this.info=h,this.appendElement=k;var Y=!1;this.isHoverSuspended=function(){return Y},this.setHoverSuspended=function(t){Y=t},this.hide=function(t,e){return l(t,"none",e),P},this.idstamp=s;var Z=function(t){if(!u&&t){var e=P.getElement(t);e.offsetParent&&P.setContainer(e.offsetParent)}},q=P.manage=function(t,e,n,o){return v[t]?o&&(v[t].info=J({elId:t,timestamp:w,recalc:!0})):(v[t]={el:e,endpoints:[],connections:[],rotation:0},v[t].info=J({elId:t,timestamp:w}),P.addClass(e,"jtk-managed"),n||P.fire("manageElement",{id:t,info:v[t].info,el:e})),v[t]};this.unmanage=function(t){if(v[t]){var e=v[t].el;P.removeClass(e,"jtk-managed"),delete v[t],P.fire("unmanageElement",{id:t,el:e})}},this.rotate=function(t,e,n){return v[t]&&(v[t].rotation=e,v[t].el.style.transform="rotate("+e+"deg)",v[t].el.style.transformOrigin="center center",!0!==n)?this.revalidate(t):{c:[],e:[]}},this.getRotation=function(t){return v[t]&&v[t].rotation||0};var J=function(t){var e,n=t.timestamp,o=t.recalc,i=t.offset,r=t.elId;return _&&!n&&(n=w),!o&&n&&n===x[r]?{o:t.offset||b[r],s:j[r]}:(o||!i&&null==b[r]?null!=(e=v[r]?v[r].el:null)&&(j[r]=P.getSize(e),b[r]=P.getOffset(e),x[r]=n):(b[r]=i||b[r],null==j[r]&&null!=(e=v[r].el)&&(j[r]=P.getSize(e)),x[r]=n),b[r]&&!b[r].right&&(b[r].right=b[r].left+j[r][0],b[r].bottom=b[r].top+j[r][1],b[r].width=j[r][0],b[r].height=j[r][1],b[r].centerx=b[r].left+b[r].width/2,b[r].centery=b[r].top+b[r].height/2),{o:b[r],s:j[r]})};this.updateOffset=J,this.init=function(){f||(P.Defaults.Container&&P.setContainer(P.Defaults.Container),P.router=new rt.jsPlumb.DefaultRouter(P),P.anchorManager=P.router.anchorManager,f=!0,P.fire("ready",P))}.bind(this),this.log=p,this.jsPlumbUIComponent=lt,this.makeAnchor=function(){function t(t,e){if(rt.jsPlumb.Anchors[t])return new rt.jsPlumb.Anchors[t](e);if(!P.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown anchor type '"+t+"'"}}var e;if(0===arguments.length)return null;var n=arguments[0],o=arguments[1],i=null;if(n.compute&&n.getOrientation)return n;if("string"==typeof n)i=t(arguments[0],{elementId:o,jsPlumbInstance:P});else if(st.isArray(n))if(st.isArray(n[0])||st.isString(n[0]))i=2===n.length&&st.isObject(n[1])?st.isString(n[0])?(e=rt.jsPlumb.extend({elementId:o,jsPlumbInstance:P},n[1]),t(n[0],e)):(e=rt.jsPlumb.extend({elementId:o,jsPlumbInstance:P,anchors:n[0]},n[1]),new rt.jsPlumb.DynamicAnchor(e)):new dt.DynamicAnchor({anchors:n,selector:null,elementId:o,jsPlumbInstance:P});else{var r={x:n[0],y:n[1],orientation:4<=n.length?[n[2],n[3]]:[0,0],offsets:6<=n.length?[n[4],n[5]]:[0,0],elementId:o,jsPlumbInstance:P,cssClass:7===n.length?n[6]:null};(i=new rt.jsPlumb.Anchor(r)).clone=function(){return new rt.jsPlumb.Anchor(r)}}return i.id||(i.id="anchor_"+s()),i},this.makeAnchors=function(t,e,n){for(var o=[],i=0,r=t.length;i<r;i++)"string"==typeof t[i]?o.push(rt.jsPlumb.Anchors[t[i]]({elementId:e,jsPlumbInstance:n})):st.isArray(t[i])&&o.push(P.makeAnchor(t[i],e,n));return o},this.makeDynamicAnchor=function(t,e){return new rt.jsPlumb.DynamicAnchor({anchors:t,selector:e,elementId:null,jsPlumbInstance:P})},this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={};function K(l,u,t,e,n){var o=new lt(u),i=u._jsPlumb.EndpointDropHandler({jsPlumb:P,enabled:function(){return l.def.enabled},isFull:function(){var t=P.select({target:l.id}).length;return 0<l.def.maxConnections&&t>=l.def.maxConnections},element:l.el,elementId:l.id,isSource:e,isTarget:n,addClass:function(t){P.addClass(l.el,t)},removeClass:function(t){P.removeClass(l.el,t)},onDrop:function(t){t.endpoints[0].anchor.locked=!1},isDropAllowed:function(){return o.isDropAllowed.apply(o,arguments)},isRedrop:function(t){return null!=t.suspendedElement&&null!=t.suspendedEndpoint&&t.suspendedEndpoint.element===l.el},getEndpoint:function(t){var e=l.def.endpoint;if(null==e||null==e._jsPlumb){var n=P.deriveEndpointAndAnchorSpec(t.getType().join(" "),!0),o=n.endpoints?rt.jsPlumb.extend(u,{endpoint:l.def.def.endpoint||n.endpoints[1]}):u;n.anchors&&(o=rt.jsPlumb.extend(o,{anchor:l.def.def.anchor||n.anchors[1]})),(e=P.addEndpoint(l.el,o))._mtNew=!0}if(u.uniqueEndpoint&&(l.def.endpoint=e),e.setDeleteOnEmpty(!0),t.isDetachable()&&e.initDraggable(),null!=e.anchor.positionFinder){var i=P.getUIPosition(arguments,P.getZoom()),r=P.getOffset(l.el),s=P.getSize(l.el),a=null==i?[0,0]:e.anchor.positionFinder(i,r,s,e.anchor.constructorParams);e.anchor.x=a[0],e.anchor.y=a[1]}return e},maybeCleanup:function(t){t._mtNew&&0===t.connections.length?P.deleteObject({endpoint:t}):delete t._mtNew}}),r=rt.jsPlumb.dragEvents.drop;return t.scope=t.scope||u.scope||P.Defaults.Scope,t[r]=st.wrap(t[r],i,!0),t.rank=u.rank||0,n&&(t[rt.jsPlumb.dragEvents.over]=function(){return!0}),!1===u.allowLoopback&&(t.canDrop=function(t){return t.getDragElement()._jsPlumbRelatedElement!==l.el}),P.initDroppable(l.el,t,"internal"),i}this.makeTarget=function(t,e,n){var s=rt.jsPlumb.extend({_jsPlumb:this},n);rt.jsPlumb.extend(s,e);for(var a=s.maxConnections||-1,o=function(t){var e=h(t),n=e.id,o=rt.jsPlumb.extend({},s.dropOptions||{}),i=s.connectionType||"default";this.targetEndpointDefinitions[n]=this.targetEndpointDefinitions[n]||{},Z(n),e.el._isJsPlumbGroup&&null==o.rank&&(o.rank=-1);var r={def:rt.jsPlumb.extend({},s),uniqueEndpoint:s.uniqueEndpoint,maxConnections:a,enabled:!0};s.createEndpoint&&(r.uniqueEndpoint=!0,r.endpoint=P.addEndpoint(t,r.def),r.endpoint.setDeleteOnEmpty(!1)),e.def=r,this.targetEndpointDefinitions[n][i]=r,K(e,s,o,!0===s.isSource,!0),e.el._katavorioDrop[e.el._katavorioDrop.length-1].targetDef=r}.bind(this),i=t.length&&t.constructor!==String?t:[t],r=0,l=i.length;r<l;r++)o(i[r]);return this},this.unmakeTarget=function(t,e){var n=h(t);return P.destroyDroppable(n.el,"internal"),e||delete this.targetEndpointDefinitions[n.id],this},this.makeSource=function(s,t,e){var m=rt.jsPlumb.extend({_jsPlumb:this},e);rt.jsPlumb.extend(m,t);var v=m.connectionType||"default",n=P.deriveEndpointAndAnchorSpec(v);m.endpoint=m.endpoint||n.endpoints[0],m.anchor=m.anchor||n.anchors[0];for(var y=m.maxConnections||-1,b=m.onMaxConnections,o=function(u){var d=u.id,c=this.getElement(u.el);this.sourceEndpointDefinitions[d]=this.sourceEndpointDefinitions[d]||{},Z(d);var t={def:rt.jsPlumb.extend({},m),uniqueEndpoint:m.uniqueEndpoint,maxConnections:y,enabled:!0};m.createEndpoint&&(t.uniqueEndpoint=!0,t.endpoint=P.addEndpoint(s,t.def),t.endpoint.setDeleteOnEmpty(!1)),this.sourceEndpointDefinitions[d][v]=t,u.def=t;var e=rt.jsPlumb.dragEvents.stop,n=rt.jsPlumb.dragEvents.drag,h=rt.jsPlumb.extend({},m.dragOptions||{}),o=h.drag,p=h.stop,f=null,g=!1;h.scope=h.scope||m.scope,h[n]=st.wrap(h[n],function(){o&&o.apply(this,arguments),g=!1}),h[e]=st.wrap(h[e],function(){if(p&&p.apply(this,arguments),this.currentlyDragging=!1,null!=f._jsPlumb){var t=m.anchor||this.Defaults.Anchor,e=f.anchor,n=f.connections[0],o=this.makeAnchor(t,d,this),i=f.element;if(null!=o.positionFinder){var r=P.getOffset(i),s=this.getSize(i),a={left:r.left+e.x*s[0],top:r.top+e.y*s[1]},l=o.positionFinder(a,r,s,o.constructorParams);o.x=l[0],o.y=l[1]}f.setAnchor(o,!0),f.repaint(),this.repaint(f.elementId),null!=n&&this.repaint(n.targetId)}}.bind(this));var i=function(t){if(3!==t.which&&2!==t.button){d=this.getId(this.getElement(u.el));var e=this.sourceEndpointDefinitions[d][v];if(e.enabled){if(m.filter)if(!1===(st.isString(m.filter)?function(t,e,n,o,i){for(var r=t.target||t.srcElement,s=!1,a=o.getSelector(e,n),l=0;l<a.length;l++)if(a[l]===r){s=!0;break}return i?!s:s}(t,u.el,m.filter,this,m.filterExclude):m.filter(t,u.el)))return;var n=this.select({source:d}).length;if(0<=e.maxConnections&&n>=e.maxConnections)return b&&b({element:u.el,maxConnections:y},t),!1;var o=rt.jsPlumb.getPositionOnElement(t,c,E),i={};rt.jsPlumb.extend(i,e.def),i.isTemporarySource=!0,i.anchor=[o[0],o[1],0,0],i.dragOptions=h,e.def.scope&&(i.scope=e.def.scope),f=this.addEndpoint(d,i),g=!0,f.setDeleteOnEmpty(!0),e.uniqueEndpoint&&(e.endpoint?f.finalEndpoint=e.endpoint:(e.endpoint=f).setDeleteOnEmpty(!1));var r=function(){P.off(f.canvas,"mouseup",r),P.off(u.el,"mouseup",r),g&&(g=!1,P.deleteEndpoint(f))};P.on(f.canvas,"mouseup",r),P.on(u.el,"mouseup",r);var s={};if(e.def.extract)for(var a in e.def.extract){var l=(t.srcElement||t.target).getAttribute(a);l&&(s[e.def.extract[a]]=l)}P.trigger(f.canvas,"mousedown",t,s),st.consume(t)}}}.bind(this);this.on(u.el,"mousedown",i),t.trigger=i,m.filter&&(st.isString(m.filter)||st.isFunction(m.filter))&&P.setDragFilter(u.el,m.filter);var r=rt.jsPlumb.extend({},m.dropOptions||{});K(u,m,r,!0,!0===m.isTarget)}.bind(this),i=s.length&&s.constructor!==String?s:[s],r=0,a=i.length;r<a;r++)o(h(i[r]));return this},this.unmakeSource=function(t,e,n){var o=h(t);P.destroyDroppable(o.el,"internal");var i=this.sourceEndpointDefinitions[o.id];if(i)for(var r in i)if(null==e||e===r){var s=i[r].trigger;s&&P.off(o.el,"mousedown",s),n||delete this.sourceEndpointDefinitions[o.id][r]}return this},this.unmakeEverySource=function(){for(var t in this.sourceEndpointDefinitions)P.unmakeSource(t,null,!0);return this.sourceEndpointDefinitions={},this};var $=function(t,e,n){e=st.isArray(e)?e:[e];var o=N(t);n=n||"default";for(var i=0;i<e.length;i++){var r=this[e[i]][o];if(r&&r[n])return r[n].def.scope||this.Defaults.Scope}}.bind(this),Q=function(t,e,n,o){n=st.isArray(n)?n:[n];var i=N(t);o=o||"default";for(var r=0;r<n.length;r++){var s=this[n[r]][i];s&&s[o]&&(s[o].def.scope=e)}}.bind(this);this.getScope=function(t,e){return $(t,["sourceEndpointDefinitions","targetEndpointDefinitions"])},this.getSourceScope=function(t){return $(t,"sourceEndpointDefinitions")},this.getTargetScope=function(t){return $(t,"targetEndpointDefinitions")},this.setScope=function(t,e,n){this.setSourceScope(t,e,n),this.setTargetScope(t,e,n)},this.setSourceScope=function(t,e,n){Q(t,e,"sourceEndpointDefinitions",n),this.setDragScope(t,e)},this.setTargetScope=function(t,e,n){Q(t,e,"targetEndpointDefinitions",n),this.setDropScope(t,e)},this.unmakeEveryTarget=function(){for(var t in this.targetEndpointDefinitions)P.unmakeTarget(t,!0);return this.targetEndpointDefinitions={},this};var tt=function(t,e,n,o,i){var r,s,a,l="source"===t?this.sourceEndpointDefinitions:this.targetEndpointDefinitions;if(i=i||"default",e.length&&!st.isString(e)){r=[];for(var u=0,d=e.length;u<d;u++)l[(s=h(e[u])).id]&&l[s.id][i]&&(r[u]=l[s.id][i].enabled,a=o?!r[u]:n,l[s.id][i].enabled=a,P[a?"removeClass":"addClass"](s.el,"jtk-"+t+"-disabled"))}else{var c=(s=h(e)).id;l[c]&&l[c][i]&&(r=l[c][i].enabled,a=o?!r:n,l[c][i].enabled=a,P[a?"removeClass":"addClass"](s.el,"jtk-"+t+"-disabled"))}return r}.bind(this),et=function(t,e){if(null!=t){if(st.isString(t)||!t.length)return e.apply(this,[t]);if(t.length)return e.apply(this,[t[0]])}}.bind(this);this.toggleSourceEnabled=function(t,e){return tt("source",t,null,!0,e),this.isSourceEnabled(t,e)},this.setSourceEnabled=function(t,e,n){return tt("source",t,e,null,n)},this.isSource=function(t,n){return n=n||"default",et(t,function(t){var e=this.sourceEndpointDefinitions[h(t).id];return null!=e&&null!=e[n]}.bind(this))},this.isSourceEnabled=function(t,n){return n=n||"default",et(t,function(t){var e=this.sourceEndpointDefinitions[h(t).id];return e&&e[n]&&!0===e[n].enabled}.bind(this))},this.toggleTargetEnabled=function(t,e){return tt("target",t,null,!0,e),this.isTargetEnabled(t,e)},this.isTarget=function(t,n){return n=n||"default",et(t,function(t){var e=this.targetEndpointDefinitions[h(t).id];return null!=e&&null!=e[n]}.bind(this))},this.isTargetEnabled=function(t,n){return n=n||"default",et(t,function(t){var e=this.targetEndpointDefinitions[h(t).id];return e&&e[n]&&!0===e[n].enabled}.bind(this))},this.setTargetEnabled=function(t,e,n){return tt("target",t,e,null,n)},this.ready=function(t){P.bind("ready",t)};this.repaint=function(t,e,n){return function(t,e){if("object"==typeof t&&t.length)for(var n=0,o=t.length;n<o;n++)e(t[n]);else e(t);return P}(t,function(t){r(t,e,n)})},this.revalidate=function(t,e,n){var o=n?t:P.getId(t);P.updateOffset({elId:o,recalc:!0,timestamp:e});var i=P.getDragManager();return i&&i.updateOffsets(o),r(t,null,e)},this.repaintEverything=function(){var t,e=jsPlumbUtil.uuid();for(t in y)P.updateOffset({elId:t,recalc:!0,timestamp:e});for(t in y)r(t,null,e);return this},this.removeAllEndpoints=function(t,r,s){s=s||[];var a=function(t){var e,n,o=h(t),i=y[o.id];if(i)for(s.push(o),e=0,n=i.length;e<n;e++)P.deleteEndpoint(i[e],!1);if(delete y[o.id],r&&o.el&&3!==o.el.nodeType&&8!==o.el.nodeType)for(e=0,n=o.el.childNodes.length;e<n;e++)a(o.el.childNodes[e])};return a(t),this};function nt(t,e){P.removeAllEndpoints(t.id,!0,e);for(var n=P.getDragManager(),o=function(t){n&&n.elementRemoved(t.id),P.router.elementRemoved(t.id),P.isSource(t.el)&&P.unmakeSource(t.el),P.isTarget(t.el)&&P.unmakeTarget(t.el),P.destroyDraggable(t.el),P.destroyDroppable(t.el),delete P.floatingConnections[t.id],delete v[t.id],delete b[t.id],t.el&&(P.removeElement(t.el),t.el._jsPlumb=null)},i=1;i<e.length;i++)o(e[i]);o(t)}this.remove=function(t,e){var n=h(t),o=[];return n.text&&n.el.parentNode?n.el.parentNode.removeChild(n.el):n.id&&P.batch(function(){nt(n,o)},!0===e),P},this.empty=function(t,e){var o=[],i=function(t,e){var n=h(t);if(n.text)n.el.parentNode.removeChild(n.el);else if(n.el){for(;0<n.el.childNodes.length;)i(n.el.childNodes[0]);e||nt(n,o)}};return P.batch(function(){i(t,!0)},!1===e),P},this.reset=function(t){P.silently(function(){Y=!1,P.removeAllGroups(),P.removeGroupManager(),P.deleteEveryEndpoint(),t||P.unbind(),this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={},g.length=0,this.doReset&&this.doReset()}.bind(this))},this.destroy=function(){this.reset(),d=u=null};function ot(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),t.cleanup(),t.destroy()}this.clear=function(){P.select().each(ot),P.selectEndpoints().each(ot),y={},m={}},this.setDefaultScope=function(t){return S=t,P},this.deriveEndpointAndAnchorSpec=function(t,e){for(var n=((e?"":"default ")+t).split(/[\s]/),o=null,i=null,r=null,s=null,a=0;a<n.length;a++){var l=P.getType(n[a],"connection");l&&(l.endpoints&&(o=l.endpoints),l.endpoint&&(i=l.endpoint),l.anchors&&(s=l.anchors),l.anchor&&(r=l.anchor))}return{endpoints:o||[i,i],anchors:s||[r,r]}},this.setId=function(r,s,t){var e;e=st.isString(r)?r:(r=this.getElement(r),this.getId(r));var n=this.getConnections({source:e,scope:"*"},!0),o=this.getConnections({target:e,scope:"*"},!0);s=""+s,t?r=this.getElement(s):(r=this.getElement(e),this.setAttribute(r,"id",s)),y[s]=y[e]||[];for(var i=0,a=y[s].length;i<a;i++)y[s][i].setElementId(s),y[s][i].setReferenceElement(r);delete y[e],this.sourceEndpointDefinitions[s]=this.sourceEndpointDefinitions[e],delete this.sourceEndpointDefinitions[e],this.targetEndpointDefinitions[s]=this.targetEndpointDefinitions[e],delete this.targetEndpointDefinitions[e],this.router.changeId(e,s);var l=this.getDragManager();l&&l.changeId(e,s),v[s]=v[e],delete v[e];function u(t,e,n){for(var o=0,i=t.length;o<i;o++)t[o].endpoints[e].setElementId(s),t[o].endpoints[e].setReferenceElement(r),t[o][n+"Id"]=s,t[o][n]=r}u(n,0,"source"),u(o,1,"target"),this.repaint(s)},this.setDebugLog=function(t){p=t},this.setSuspendDrawing=function(t,e){var n=_;return w=(_=t)?(new Date).getTime():null,e&&this.repaintEverything(),n},this.isSuspendDrawing=function(){return _},this.getSuspendedAt=function(){return w},this.batch=function(t,e){var n=this.isSuspendDrawing();n||this.setSuspendDrawing(!0);try{t()}catch(t){st.log("Function run while suspended failed",t)}n||this.setSuspendDrawing(!1,!e)},this.doWhileSuspended=this.batch,this.getCachedData=function(t){var e=b[t];return e?{o:e,s:j[t]}:J({elId:t})},this.show=function(t,e){return l(t,"block",e),P},this.toggleVisible=function(t,e){var n=null;e&&(n=function(t){var e=t.isVisible();t.setVisible(!e)}),a(t,function(t){var e=t.isVisible();t.setVisible(!e)},n)},this.addListener=this.bind;var it=[];this.registerFloatingConnection=function(t,e,n){it[t.id]=e,st.addToList(y,t.id,n)},this.getFloatingConnectionFor=function(t){return it[t]},this.listManager=new rt.jsPlumbListManager(this,this.Defaults.ListStyle)};st.extend(rt.jsPlumbInstance,st.EventGenerator,{setAttribute:function(t,e,n){this.setAttribute(t,e,n)},getAttribute:function(t,e){return this.getAttribute(rt.jsPlumb.getElement(t),e)},convertToFullOverlaySpec:function(t){return st.isString(t)&&(t=[t,{}]),t[1].id=t[1].id||st.uuid(),t},registerConnectionType:function(t,e){if(this._connectionTypes[t]=rt.jsPlumb.extend({},e),e.overlays){for(var n={},o=0;o<e.overlays.length;o++){var i=this.convertToFullOverlaySpec(e.overlays[o]);n[i[1].id]=i}this._connectionTypes[t].overlays=n}},registerConnectionTypes:function(t){for(var e in t)this.registerConnectionType(e,t[e])},registerEndpointType:function(t,e){if(this._endpointTypes[t]=rt.jsPlumb.extend({},e),e.overlays){for(var n={},o=0;o<e.overlays.length;o++){var i=this.convertToFullOverlaySpec(e.overlays[o]);n[i[1].id]=i}this._endpointTypes[t].overlays=n}},registerEndpointTypes:function(t){for(var e in t)this.registerEndpointType(e,t[e])},getType:function(t,e){return"connection"===e?this._connectionTypes[t]:this._endpointTypes[t]},setIdChanged:function(t,e){this.setId(t,e,!0)},setParent:function(t,e){var n=this.getElement(t),o=this.getId(n),i=this.getElement(e),r=this.getId(i),s=this.getDragManager();n.parentNode.removeChild(n),i.appendChild(n),s&&s.setParent(n,o,i,r)},extend:function(t,e,n){var o;if(n)for(o=0;o<n.length;o++)t[n[o]]=e[n[o]];else for(o in e)t[o]=e[o];return t},floatingConnections:{},getFloatingAnchorIndex:function(t){return t.endpoints[0].isFloating()?0:t.endpoints[1].isFloating()?1:-1},proxyConnection:function(t,e,n,o,i,r){var s,a=t.endpoints[e].elementId,l=t.endpoints[e];t.proxies=t.proxies||[],(s=t.proxies[e]?t.proxies[e].ep:this.addEndpoint(n,{endpoint:i(t,e),anchor:r(t,e),parameters:{isProxyEndpoint:!0}})).setDeleteOnEmpty(!0),t.proxies[e]={ep:s,originalEp:l},0===e?this.router.sourceOrTargetChanged(a,o,t,n,0):this.router.sourceOrTargetChanged(a,o,t,n,1),l.detachFromConnection(t,null,!0),s.connections=[t],t.endpoints[e]=s,l.setVisible(!1),t.setVisible(!0),this.revalidate(n)},unproxyConnection:function(t,e,n){if(null!=t._jsPlumb&&null!=t.proxies&&null!=t.proxies[e]){var o=t.proxies[e].originalEp.element,i=t.proxies[e].originalEp.elementId;t.endpoints[e]=t.proxies[e].originalEp,0===e?this.router.sourceOrTargetChanged(n,i,t,o,0):this.router.sourceOrTargetChanged(n,i,t,o,1),t.proxies[e].ep.detachFromConnection(t,null),t.proxies[e].originalEp.addConnection(t),t.isVisible()&&t.proxies[e].originalEp.setVisible(!0),delete t.proxies[e]}}});var dt=new i;(rt.jsPlumb=dt).getInstance=function(t,e){var n=new i(t);if(e)for(var o in e)n[o]=e[o];return n.init(),n},dt.each=function(t,e){if(null!=t)if("string"==typeof t)e(dt.getElement(t));else if(null!=t.length)for(var n=0;n<t.length;n++)e(dt.getElement(t[n]));else e(t)},"undefined"!=typeof exports&&(exports.jsPlumb=dt)}.call("undefined"!=typeof window?window:this),function(){"use strict";var e=this,a=e.jsPlumb,l=e.jsPlumbUtil,i="__label";a.OverlayCapableJsPlumbUIComponent=function(t){e.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.overlays={},this._jsPlumb.overlayPositions={},t.label&&(this.getDefaultType().overlays[i]=["Label",{label:t.label,location:t.labelLocation||this.defaultLabelLocation||.5,labelStyle:t.labelStyle||this._jsPlumb.instance.Defaults.LabelStyle,id:i}]),this.setListenerComponent=function(t){if(this._jsPlumb)for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].setListenerComponent(t)}},a.OverlayCapableJsPlumbUIComponent.applyType=function(t,e){if(e.overlays){var n,o={};for(n in e.overlays){var i=t._jsPlumb.overlays[e.overlays[n][1].id];if(i)i.updateFrom(e.overlays[n][1]),o[e.overlays[n][1].id]=!0,i.reattach(t._jsPlumb.instance,t);else{var r=t.getCachedTypeItem("overlay",e.overlays[n][1].id);null!=r?(r.reattach(t._jsPlumb.instance,t),r.setVisible(!0),r.updateFrom(e.overlays[n][1]),t._jsPlumb.overlays[r.id]=r):r=t.addOverlay(e.overlays[n],!0),o[r.id]=!0}}for(n in t._jsPlumb.overlays)null==o[t._jsPlumb.overlays[n].id]&&t.removeOverlay(t._jsPlumb.overlays[n].id,!0)}},l.extend(a.OverlayCapableJsPlumbUIComponent,e.jsPlumbUIComponent,{setHover:function(t,e){if(this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged())for(var n in this._jsPlumb.overlays)this._jsPlumb.overlays[n][t?"addClass":"removeClass"](this._jsPlumb.instance.hoverClass)},addOverlay:function(t,e){var n=function(t,e){var n=null;if(l.isArray(e)){var o=e[0],i=a.extend({component:t,_jsPlumb:t._jsPlumb.instance},e[1]);3===e.length&&a.extend(i,e[2]),n=new(a.Overlays[t._jsPlumb.instance.getRenderMode()][o])(i)}else n=e.constructor===String?new(a.Overlays[t._jsPlumb.instance.getRenderMode()][e])({component:t,_jsPlumb:t._jsPlumb.instance}):e;return n.id=n.id||l.uuid(),t.cacheTypeItem("overlay",n,n.id),t._jsPlumb.overlays[n.id]=n}(this,t);if(this.getData&&"Label"===n.type&&l.isArray(t)){var o=this.getData(),i=t[1];if(o){var r=i.labelLocationAttribute||"labelLocation",s=o?o[r]:null;s&&(n.loc=s)}}return e||this.repaint(),n},getOverlay:function(t){return this._jsPlumb.overlays[t]},getOverlays:function(){return this._jsPlumb.overlays},hideOverlay:function(t){var e=this.getOverlay(t);e&&e.hide()},hideOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].hide()},showOverlay:function(t){var e=this.getOverlay(t);e&&e.show()},showOverlays:function(){for(var t in this._jsPlumb.overlays)this._jsPlumb.overlays[t].show()},removeAllOverlays:function(t){for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].cleanup&&this._jsPlumb.overlays[e].cleanup();this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null,this._jsPlumb.overlayPlacements={},t||this.repaint()},removeOverlay:function(t,e){var n=this._jsPlumb.overlays[t];n&&(n.setVisible(!1),!e&&n.cleanup&&n.cleanup(),delete this._jsPlumb.overlays[t],this._jsPlumb.overlayPositions&&delete this._jsPlumb.overlayPositions[t],this._jsPlumb.overlayPlacements&&delete this._jsPlumb.overlayPlacements[t])},removeOverlays:function(){for(var t=0,e=arguments.length;t<e;t++)this.removeOverlay(arguments[t])},moveParent:function(t){if(this.bgCanvas&&(this.bgCanvas.parentNode.removeChild(this.bgCanvas),t.appendChild(this.bgCanvas)),this.canvas&&this.canvas.parentNode)for(var e in this.canvas.parentNode.removeChild(this.canvas),t.appendChild(this.canvas),this._jsPlumb.overlays)if(this._jsPlumb.overlays[e].isAppendedAtTopLevel){var n=this._jsPlumb.overlays[e].getElement();n.parentNode.removeChild(n),t.appendChild(n)}},getLabel:function(){var t=this.getOverlay(i);return null!=t?t.getLabel():null},getLabelOverlay:function(){return this.getOverlay(i)},setLabel:function(t){var e=this.getOverlay(i);e?t.constructor===String||t.constructor===Function?e.setLabel(t):(t.label&&e.setLabel(t.label),t.location&&e.setLocation(t.location)):(e=function(t,e){var n={cssClass:e.cssClass,labelStyle:t.labelStyle,id:i,component:t,_jsPlumb:t._jsPlumb.instance},o=a.extend(n,e);return new(a.Overlays[t._jsPlumb.instance.getRenderMode()].Label)(o)}(this,t.constructor===String||t.constructor===Function?{label:t}:t),this._jsPlumb.overlays[i]=e);this._jsPlumb.instance.isSuspendDrawing()||this.repaint()},cleanup:function(t){for(var e in this._jsPlumb.overlays)this._jsPlumb.overlays[e].cleanup(t),this._jsPlumb.overlays[e].destroy(t);t&&(this._jsPlumb.overlays={},this._jsPlumb.overlayPositions=null)},setVisible:function(t){this[t?"showOverlays":"hideOverlays"]()},setAbsoluteOverlayPosition:function(t,e){this._jsPlumb.overlayPositions[t.id]=e},getAbsoluteOverlayPosition:function(t){return this._jsPlumb.overlayPositions?this._jsPlumb.overlayPositions[t.id]:null},_clazzManip:function(t,e,n){if(!n)for(var o in this._jsPlumb.overlays)this._jsPlumb.overlays[o][t+"Class"](e)},addClass:function(t,e){this._clazzManip("add",t,e)},removeClass:function(t,e){this._clazzManip("remove",t,e)}})}.call("undefined"!=typeof window?window:this),function(){"use strict";var C=this.jsPlumb,j=this.jsPlumbUtil,l=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"];C.Endpoint=function(b){var P=b._jsPlumb,E=b.newConnection,x=b.newEndpoint;this.idPrefix="_jsplumb_e_",this.defaultLabelLocation=[.5,.5],this.defaultOverlayKeys=["Overlays","EndpointOverlays"],C.OverlayCapableJsPlumbUIComponent.apply(this,arguments),this.appendToDefaultType({connectionType:b.connectionType,maxConnections:null==b.maxConnections?this._jsPlumb.instance.Defaults.MaxConnections:b.maxConnections,paintStyle:b.endpointStyle||b.paintStyle||b.style||this._jsPlumb.instance.Defaults.EndpointStyle||C.Defaults.EndpointStyle,hoverPaintStyle:b.endpointHoverStyle||b.hoverPaintStyle||this._jsPlumb.instance.Defaults.EndpointHoverStyle||C.Defaults.EndpointHoverStyle,connectorStyle:b.connectorStyle,connectorHoverStyle:b.connectorHoverStyle,connectorClass:b.connectorClass,connectorHoverClass:b.connectorHoverClass,connectorOverlays:b.connectorOverlays,connector:b.connector,connectorTooltip:b.connectorTooltip}),this._jsPlumb.enabled=!(!1===b.enabled),this._jsPlumb.visible=!0,this.element=C.getElement(b.source),this._jsPlumb.uuid=b.uuid;this._jsPlumb.floatingEndpoint=null;this._jsPlumb.uuid&&(b.endpointsByUUID[this._jsPlumb.uuid]=this),this.elementId=b.elementId,this.dragProxy=b.dragProxy,this._jsPlumb.connectionCost=b.connectionCost,this._jsPlumb.connectionsDirected=b.connectionsDirected,this._jsPlumb.currentAnchorClass="",this._jsPlumb.events={};var o=!0===b.deleteOnEmpty;this.setDeleteOnEmpty=function(t){o=t};var n=function(){var t=P.endpointAnchorClassPrefix+"-"+this._jsPlumb.currentAnchorClass;this._jsPlumb.currentAnchorClass=this.anchor.getCssClass();var e=P.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");this.removeClass(t),this.addClass(e),C.updateClasses(this.element,e,t)}.bind(this);this.prepareAnchor=function(t){var e=this._jsPlumb.instance.makeAnchor(t,this.elementId,P);return e.bind("anchorChanged",function(t){this.fire("anchorChanged",{endpoint:this,anchor:t}),n()}.bind(this)),e},this.setPreparedAnchor=function(t,e){return this._jsPlumb.instance.continuousAnchorFactory.clear(this.elementId),this.anchor=t,n(),e||this._jsPlumb.instance.repaint(this.elementId),this},this.setAnchor=function(t,e){var n=this.prepareAnchor(t);return this.setPreparedAnchor(n,e),this};var t=function(t){if(0<this.connections.length)for(var e=0;e<this.connections.length;e++)this.connections[e].setHover(t,!1);else this.setHover(t)}.bind(this);this.bind("mouseover",function(){t(!0)}),this.bind("mouseout",function(){t(!1)}),b._transient||this._jsPlumb.instance.router.addEndpoint(this,this.elementId),this.prepareEndpoint=function(t,e){function n(t,e){var n=P.getRenderMode();if(C.Endpoints[n][t])return new C.Endpoints[n][t](e);if(!P.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown endpoint type '"+t+"'"}}var o,i={_jsPlumb:this._jsPlumb.instance,cssClass:b.cssClass,container:b.container,tooltip:b.tooltip,connectorTooltip:b.connectorTooltip,endpoint:this};return(o=j.isString(t)?n(t,i):j.isArray(t)?(i=j.merge(t[1],i),n(t[0],i)):t.clone()).clone=function(){return j.isString(t)?n(t,i):j.isArray(t)?(i=j.merge(t[1],i),n(t[0],i)):void 0}.bind(this),o.typeId=e,o},this.setEndpoint=function(t,e){var n=this.prepareEndpoint(t);this.setPreparedEndpoint(n,!0)},this.setPreparedEndpoint=function(t,e){null!=this.endpoint&&(this.endpoint.cleanup(),this.endpoint.destroy()),this.endpoint=t,this.type=this.endpoint.type,this.canvas=this.endpoint.canvas},C.extend(this,b,l),this.isSource=b.isSource||!1,this.isTemporarySource=b.isTemporarySource||!1,this.isTarget=b.isTarget||!1,this.connections=b.connections||[],this.connectorPointerEvents=b["connector-pointer-events"],this.scope=b.scope||P.getDefaultScope(),this.timestamp=null,this.reattachConnections=b.reattach||P.Defaults.ReattachConnections,this.connectionsDetachable=P.Defaults.ConnectionsDetachable,!1!==b.connectionsDetachable&&!1!==b.detachable||(this.connectionsDetachable=!1),this.dragAllowedWhenFull=!1!==b.dragAllowedWhenFull,b.onMaxConnections&&this.bind("maxConnections",b.onMaxConnections),this.addConnection=function(t){this.connections.push(t),this[(0<this.connections.length?"add":"remove")+"Class"](P.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](P.endpointFullClass)},this.detachFromConnection=function(t,e,n){0<=(e=null==e?this.connections.indexOf(t):e)&&(this.connections.splice(e,1),this[(0<this.connections.length?"add":"remove")+"Class"](P.endpointConnectedClass),this[(this.isFull()?"add":"remove")+"Class"](P.endpointFullClass)),!n&&o&&0===this.connections.length&&P.deleteObject({endpoint:this,fireEvent:!1,deleteAttachedObjects:!0!==n})},this.deleteEveryConnection=function(t){for(var e=this.connections.length,n=0;n<e;n++)P.deleteConnection(this.connections[0],t)},this.detachFrom=function(t,e,n){for(var o=[],i=0;i<this.connections.length;i++)this.connections[i].endpoints[1]!==t&&this.connections[i].endpoints[0]!==t||o.push(this.connections[i]);for(var r=0,s=o.length;r<s;r++)P.deleteConnection(o[0]);return this},this.getElement=function(){return this.element},this.setElement=function(t){var e=this._jsPlumb.instance.getId(t),n=this.elementId;return j.removeWithFunction(b.endpointsByElement[this.elementId],function(t){return t.id===this.id}.bind(this)),this.element=C.getElement(t),this.elementId=P.getId(this.element),P.router.rehomeEndpoint(this,n,this.element),P.dragManager.endpointAdded(this.element),j.addToList(b.endpointsByElement,e,this),this},this.makeInPlaceCopy=function(){var t=this.anchor.getCurrentLocation({element:this}),e=this.anchor.getOrientation(this),n=this.anchor.getCssClass(),o={bind:function(){},compute:function(){return[t[0],t[1]]},getCurrentLocation:function(){return[t[0],t[1]]},getOrientation:function(){return e},getCssClass:function(){return n}};return x({dropOptions:b.dropOptions,anchor:o,source:this.element,paintStyle:this.getPaintStyle(),endpoint:b.hideOnDrag?"Blank":this.endpoint,_transient:!0,scope:this.scope,reference:this})},this.connectorSelector=function(){return this.connections[0]},this.setStyle=this.setPaintStyle,this.paint=function(t){var e=(t=t||{}).timestamp,n=!(!1===t.recalc);if(!e||this.timestamp!==e){var o=P.updateOffset({elId:this.elementId,timestamp:e}),i=t.offset?t.offset.o:o.o;if(null!=i){var r=t.anchorPoint,s=t.connectorPaintStyle;if(null==r){var a=t.dimensions||o.s,l={xy:[i.left,i.top],wh:a,element:this,timestamp:e};if(n&&this.anchor.isDynamic&&0<this.connections.length){var u=function(t,e){var n=0;if(null!=e)for(var o=0;o<t.connections.length;o++)if(t.connections[o].sourceId===e||t.connections[o].targetId===e){n=o;break}return t.connections[n]}(this,t.elementWithPrecedence),d=u.endpoints[0]===this?1:0,c=0==d?u.sourceId:u.targetId,h=P.getCachedData(c),p=h.o,f=h.s;l.index=0==d?1:0,l.connection=u,l.txy=[p.left,p.top],l.twh=f,l.tElement=u.endpoints[d],l.tRotation=P.getRotation(c)}else 0<this.connections.length&&(l.connection=this.connections[0]);l.rotation=P.getRotation(this.elementId),r=this.anchor.compute(l)}for(var g in this.endpoint.compute(r,this.anchor.getOrientation(this),this._jsPlumb.paintStyleInUse,s||this.paintStyleInUse),this.endpoint.paint(this._jsPlumb.paintStyleInUse,this.anchor),this.timestamp=e,this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(g)){var m=this._jsPlumb.overlays[g];m.isVisible()&&(this._jsPlumb.overlayPlacements[g]=m.draw(this.endpoint,this._jsPlumb.paintStyleInUse),m.paint(this._jsPlumb.overlayPlacements[g]))}}}},this.getTypeDescriptor=function(){return"endpoint"},this.isVisible=function(){return this._jsPlumb.visible},this.repaint=this.paint;var a=!1;this.initDraggable=function(){if(!a&&C.isDragSupported(this.element)){var p,f={id:null,element:null},g=null,m=!1,v=null,y=function(e,n,o){var i=!1;return{drag:function(){if(i)return!(i=!1);if(n.element){var t=o.getUIPosition(arguments,o.getZoom());null!=t&&o.setPosition(n.element,t),o.repaint(n.element,t),e.paint({anchorPoint:e.anchor.getCurrentLocation({element:e})})}},stopDrag:function(){i=!0}}}(this,f,P),t=b.dragOptions||{},e=C.dragEvents.start,n=C.dragEvents.stop,o=C.dragEvents.drag,i=C.dragEvents.beforeStart,r=function(t){g=this.connectorSelector();var e=!0;this.isEnabled()||(e=!1),null!=g||this.isSource||this.isTemporarySource||(e=!1),!this.isSource||!this.isFull()||null!=g&&this.dragAllowedWhenFull||(e=!1),null==g||g.isDetachable(this)||(this.isFull()?e=!1:g=null);var n=P.checkCondition(null==g?"beforeDrag":"beforeStartDetach",{endpoint:this,source:this.element,sourceId:this.elementId,connection:g});if(!1===n?e=!1:"object"==typeof n?C.extend(n,p||{}):n=p||{},!1===e)return P.stopDrag&&P.stopDrag(this.canvas),y.stopDrag(),!1;for(var o=0;o<this.connections.length;o++)this.connections[o].setHover(!1);this.addClass("endpointDrag"),P.setConnectionBeingDragged(!0),g&&!this.isFull()&&this.isSource&&(g=null),P.updateOffset({elId:this.elementId});var i=this._jsPlumb.instance.getOffset(this.canvas),r=this.canvas,s=this._jsPlumb.instance.getSize(this.canvas);!function(t,e,n,o){var i=e.createElement("div",{position:"absolute"});e.appendElement(i);var r=e.getId(i);e.setPosition(i,n),i.style.width=o[0]+"px",i.style.height=o[1]+"px",e.manage(r,i,!0),t.id=r,t.element=i}(f,P,i,s),P.setAttributes(this.canvas,{dragId:f.id,elId:this.elementId});var a=this.dragProxy||this.endpoint;if(null==this.dragProxy&&null!=this.connectionType){var l=this._jsPlumb.instance.deriveEndpointAndAnchorSpec(this.connectionType);l.endpoints[1]&&(a=l.endpoints[1])}var u=this._jsPlumb.instance.makeAnchor("Center");u.isFloating=!0,this._jsPlumb.floatingEndpoint=function(t,e,n,o,i,r,s,a){return s({paintStyle:t,endpoint:n,anchor:new C.FloatingAnchor({reference:e,referenceCanvas:o,jsPlumbInstance:r}),source:i,scope:a})}(this.getPaintStyle(),u,a,this.canvas,f.element,P,x,this.scope);var d=this._jsPlumb.floatingEndpoint.anchor;if(null==g)this.setHover(!1,!1),(g=E({sourceEndpoint:this,targetEndpoint:this._jsPlumb.floatingEndpoint,source:this.element,target:f.element,anchors:[this.anchor,this._jsPlumb.floatingEndpoint.anchor],paintStyle:b.connectorStyle,hoverPaintStyle:b.connectorHoverStyle,connector:b.connector,overlays:b.connectorOverlays,type:this.connectionType,cssClass:this.connectorClass,hoverClass:this.connectorHoverClass,scope:b.scope,data:n})).pending=!0,g.addClass(P.draggingClass),this._jsPlumb.floatingEndpoint.addClass(P.draggingClass),this._jsPlumb.floatingEndpoint.anchor=d,P.fire("connectionDrag",g),P.router.newConnection(g);else{m=!0,g.setHover(!1);var c=g.endpoints[0].id===this.id?0:1;this.detachFromConnection(g,null,!0);var h=P.getDragScope(r);P.setAttribute(this.canvas,"originalScope",h),P.fire("connectionDrag",g),0==c?(v=[g.source,g.sourceId,r,h],P.router.sourceOrTargetChanged(g.endpoints[c].elementId,f.id,g,f.element,0)):(v=[g.target,g.targetId,r,h],P.router.sourceOrTargetChanged(g.endpoints[c].elementId,f.id,g,f.element,1)),g.suspendedEndpoint=g.endpoints[c],g.suspendedElement=g.endpoints[c].getElement(),g.suspendedElementId=g.endpoints[c].elementId,g.suspendedElementType=0==c?"source":"target",g.suspendedEndpoint.setHover(!1),this._jsPlumb.floatingEndpoint.referenceEndpoint=g.suspendedEndpoint,g.endpoints[c]=this._jsPlumb.floatingEndpoint,g.addClass(P.draggingClass),this._jsPlumb.floatingEndpoint.addClass(P.draggingClass)}P.registerFloatingConnection(f,g,this._jsPlumb.floatingEndpoint),P.currentlyDragging=!0}.bind(this),s=function(){if(P.setConnectionBeingDragged(!1),g&&null!=g.endpoints){var t=P.getDropEvent(arguments),e=P.getFloatingAnchorIndex(g);if(g.endpoints[0===e?1:0].anchor.locked=!1,g.removeClass(P.draggingClass),this._jsPlumb&&(g.deleteConnectionNow||g.endpoints[e]===this._jsPlumb.floatingEndpoint)&&m&&g.suspendedEndpoint){0===e?(g.floatingElement=g.source,g.floatingId=g.sourceId,g.floatingEndpoint=g.endpoints[0],g.floatingIndex=0,g.source=v[0],g.sourceId=v[1]):(g.floatingElement=g.target,g.floatingId=g.targetId,g.floatingEndpoint=g.endpoints[1],g.floatingIndex=1,g.target=v[0],g.targetId=v[1]);var n=this._jsPlumb.floatingEndpoint;P.setDragScope(v[2],v[3]),g.endpoints[e]=g.suspendedEndpoint,g.isReattach()||g._forceReattach||g._forceDetach||!P.deleteConnection(g,{originalEvent:t})?(g.setHover(!1),g._forceDetach=null,g._forceReattach=null,this._jsPlumb.floatingEndpoint.detachFromConnection(g),g.suspendedEndpoint.addConnection(g),1===e?P.router.sourceOrTargetChanged(g.floatingId,g.targetId,g,g.target,e):P.router.sourceOrTargetChanged(g.floatingId,g.sourceId,g,g.source,e),P.repaint(v[1])):P.deleteObject({endpoint:n})}this.deleteAfterDragStop?P.deleteObject({endpoint:this}):this._jsPlumb&&this.paint({recalc:!1}),P.fire("connectionDragStop",g,t),g.pending&&P.fire("connectionAborted",g,t),P.currentlyDragging=!1,g.suspendedElement=null,g.suspendedEndpoint=null,g=null}f.element&&P.remove(f.element,!1,!1),this._jsPlumb&&(this.canvas.style.visibility="visible",this.anchor.locked=!1,this._jsPlumb.floatingEndpoint=null)}.bind(this);(t=C.extend({},t)).scope=this.scope||t.scope,t[i]=j.wrap(t[i],function(t){p=t.e.payload||{}},!1),t[e]=j.wrap(t[e],r,!1),t[o]=j.wrap(t[o],y.drag),t[n]=j.wrap(t[n],s),t.multipleDrop=!1,t.canDrag=function(){return this.isSource||this.isTemporarySource||0<this.connections.length&&!1!==this.connectionsDetachable}.bind(this),P.initDraggable(this.canvas,t,"internal"),this.canvas._jsPlumbRelatedElement=this.element,a=!0}};var e=b.endpoint||this._jsPlumb.instance.Defaults.Endpoint||C.Defaults.Endpoint;this.setEndpoint(e,!0);var i=b.anchor?b.anchor:b.anchors?b.anchors:P.Defaults.Anchor||"Top";this.setAnchor(i,!0);var r=["default",b.type||""].join(" ");this.addType(r,b.data,!0),this.canvas=this.endpoint.canvas,(this.canvas._jsPlumb=this).initDraggable();var s=function(t,e,n,o){if(C.isDropSupported(this.element)){var i=b.dropOptions||P.Defaults.DropOptions||C.Defaults.DropOptions;(i=C.extend({},i)).scope=i.scope||this.scope;var r=C.dragEvents.drop,s=C.dragEvents.over,a=C.dragEvents.out,l=this,u=P.EndpointDropHandler({getEndpoint:function(){return l},jsPlumb:P,enabled:function(){return null==n||n.isEnabled()},isFull:function(){return n.isFull()},element:this.element,elementId:this.elementId,isSource:this.isSource,isTarget:this.isTarget,addClass:function(t){l.addClass(t)},removeClass:function(t){l.removeClass(t)},isDropAllowed:function(){return l.isDropAllowed.apply(l,arguments)},reference:o,isRedrop:function(t,e){return t.suspendedEndpoint&&e.reference&&t.suspendedEndpoint.id===e.reference.id}});i[r]=j.wrap(i[r],u,!0),i[s]=j.wrap(i[s],function(){var t=C.getDragObject(arguments),e=P.getAttribute(C.getElement(t),"dragId"),n=P.getFloatingConnectionFor(e);if(null!=n){var o=P.getFloatingAnchorIndex(n);if(this.isTarget&&0!==o||n.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===n.suspendedEndpoint.id){var i=P.checkCondition("checkDropAllowed",{sourceEndpoint:n.endpoints[o],targetEndpoint:this,connection:n});this[(i?"add":"remove")+"Class"](P.endpointDropAllowedClass),this[(i?"remove":"add")+"Class"](P.endpointDropForbiddenClass),n.endpoints[o].anchor.over(this.anchor,this)}}}.bind(this)),i[a]=j.wrap(i[a],function(){var t=C.getDragObject(arguments),e=null==t?null:P.getAttribute(C.getElement(t),"dragId"),n=e?P.getFloatingConnectionFor(e):null;if(null!=n){var o=P.getFloatingAnchorIndex(n);(this.isTarget&&0!==o||n.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id===n.suspendedEndpoint.id)&&(this.removeClass(P.endpointDropAllowedClass),this.removeClass(P.endpointDropForbiddenClass),n.endpoints[o].anchor.out())}}.bind(this)),P.initDroppable(t,i,"internal",e)}}.bind(this);return this.anchor.isFloating||s(this.canvas,!(b._transient||this.anchor.isFloating),this,b.reference),this},j.extend(C.Endpoint,C.OverlayCapableJsPlumbUIComponent,{setVisible:function(t,e,n){if(this._jsPlumb.visible=t,this.canvas&&(this.canvas.style.display=t?"block":"none"),this[t?"showOverlays":"hideOverlays"](),!e)for(var o=0;o<this.connections.length;o++)if(this.connections[o].setVisible(t),!n){var i=this===this.connections[o].endpoints[0]?1:0;1===this.connections[o].endpoints[i].connections.length&&this.connections[o].endpoints[i].setVisible(t,!0,!0)}},getAttachedElements:function(){return this.connections},applyType:function(t,e){this.setPaintStyle(t.endpointStyle||t.paintStyle,e),this.setHoverPaintStyle(t.endpointHoverStyle||t.hoverPaintStyle,e),null!=t.maxConnections&&(this._jsPlumb.maxConnections=t.maxConnections),t.scope&&(this.scope=t.scope),C.extend(this,t,l),null!=t.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,t.cssClass),C.OverlayCapableJsPlumbUIComponent.applyType(this,t)},isEnabled:function(){return this._jsPlumb.enabled},setEnabled:function(t){this._jsPlumb.enabled=t},cleanup:function(){var t=this._jsPlumb.instance.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"-"+this._jsPlumb.currentAnchorClass:"");C.removeClass(this.element,t),this.anchor=null,this.endpoint.cleanup(!0),this.endpoint.destroy(),this.endpoint=null,this._jsPlumb.instance.destroyDraggable(this.canvas,"internal"),this._jsPlumb.instance.destroyDroppable(this.canvas,"internal")},setHover:function(t){this.endpoint&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&this.endpoint.setHover(t)},isFull:function(){return 0===this._jsPlumb.maxConnections||!(this.isFloating()||this._jsPlumb.maxConnections<0||this.connections.length<this._jsPlumb.maxConnections)},isFloating:function(){return null!=this.anchor&&this.anchor.isFloating},isConnectedTo:function(t){var e=!1;if(t)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){e=!0;break}return e},getConnectionCost:function(){return this._jsPlumb.connectionCost},setConnectionCost:function(t){this._jsPlumb.connectionCost=t},areConnectionsDirected:function(){return this._jsPlumb.connectionsDirected},setConnectionsDirected:function(t){this._jsPlumb.connectionsDirected=t},setElementId:function(t){this.elementId=t,this.anchor.elementId=t},setReferenceElement:function(t){this.element=C.getElement(t)},setDragAllowedWhenFull:function(t){this.dragAllowedWhenFull=t},equals:function(t){return this.anchor.equals(t.anchor)},getUuid:function(){return this._jsPlumb.uuid},computeAnchor:function(t){return this.anchor.compute(t)}}),this.jsPlumbInstance.prototype.EndpointDropHandler=function(p){return function(t){var i=p.jsPlumb;p.removeClass(i.endpointDropAllowedClass),p.removeClass(i.endpointDropForbiddenClass);var r=i.getDropEvent(arguments),e=i.getDragObject(arguments),n=i.getAttribute(e,"dragId"),o=(i.getAttribute(e,"elId"),i.getAttribute(e,"originalScope")),s=i.getFloatingConnectionFor(n);if(null!=s){var a=null!=s.suspendedEndpoint;if(!a||null!=s.suspendedEndpoint._jsPlumb){var l=p.getEndpoint(s);if(null!=l){if(p.isRedrop(s,p))return s._forceReattach=!0,s.setHover(!1),void(p.maybeCleanup&&p.maybeCleanup(l));var u=i.getFloatingAnchorIndex(s);if(0===u&&!p.isSource||1===u&&!p.isTarget)p.maybeCleanup&&p.maybeCleanup(l);else{p.onDrop&&p.onDrop(s),o&&i.setDragScope(e,o);var d=p.isFull(t);if(d&&l.fire("maxConnections",{endpoint:this,connection:s,maxConnections:l._jsPlumb.maxConnections},r),!d&&p.enabled()){var c=!0;0===u?(s.floatingElement=s.source,s.floatingId=s.sourceId,s.floatingEndpoint=s.endpoints[0],s.floatingIndex=0,s.source=p.element,s.sourceId=i.getId(p.element)):(s.floatingElement=s.target,s.floatingId=s.targetId,s.floatingEndpoint=s.endpoints[1],s.floatingIndex=1,s.target=p.element,s.targetId=i.getId(p.element)),a&&s.suspendedEndpoint.id!==l.id&&(s.isDetachAllowed(s)&&s.endpoints[u].isDetachAllowed(s)&&s.suspendedEndpoint.isDetachAllowed(s)&&i.checkCondition("beforeDetach",s)||(c=!1));var h=function(t){s.endpoints[u].detachFromConnection(s),s.suspendedEndpoint&&s.suspendedEndpoint.detachFromConnection(s),(s.endpoints[u]=l).addConnection(s);var e=l.getParameters();for(var n in e)s.setParameter(n,e[n]);if(a){var o=s.suspendedEndpoint.elementId;i.fireMoveEvent({index:u,originalSourceId:0===u?o:s.sourceId,newSourceId:0===u?l.elementId:s.sourceId,originalTargetId:1===u?o:s.targetId,newTargetId:1===u?l.elementId:s.targetId,originalSourceEndpoint:0===u?s.suspendedEndpoint:s.endpoints[0],newSourceEndpoint:0===u?l:s.endpoints[0],originalTargetEndpoint:1===u?s.suspendedEndpoint:s.endpoints[1],newTargetEndpoint:1===u?l:s.endpoints[1],connection:s},r)}else e.draggable&&i.initDraggable(this.element,p.dragOptions,"internal",i);1===u?i.router.sourceOrTargetChanged(s.floatingId,s.targetId,s,s.target,1):i.router.sourceOrTargetChanged(s.floatingId,s.sourceId,s,s.source,0),s.endpoints[0].finalEndpoint&&(s.endpoints[0].detachFromConnection(s),s.endpoints[0]=s.endpoints[0].finalEndpoint,s.endpoints[0].addConnection(s));j.isObject(t)&&s.mergeData(t),i.finaliseConnection(s,null,r,!1),s.setHover(!1),i.revalidate(s.endpoints[0].element)}.bind(this);if(c=c&&p.isDropAllowed(s.sourceId,s.targetId,s.scope,s,l))return h(c),!0;s.suspendedEndpoint&&(s.endpoints[u]=s.suspendedEndpoint,s.setHover(!1),s._forceDetach=!0,0===u?(s.source=s.suspendedEndpoint.element,s.sourceId=s.suspendedEndpoint.elementId):(s.target=s.suspendedEndpoint.element,s.targetId=s.suspendedEndpoint.elementId),s.suspendedEndpoint.addConnection(s),1===u?i.router.sourceOrTargetChanged(s.floatingId,s.targetId,s,s.target,1):i.router.sourceOrTargetChanged(s.floatingId,s.sourceId,s,s.source,0),i.repaint(s.sourceId),s._forceDetach=!1)}p.maybeCleanup&&p.maybeCleanup(l),i.currentlyDragging=!1}}}}}}}.call("undefined"!=typeof window?window:this),function(){"use strict";function r(t,e,n,o,i){if(b.Connectors[e]=b.Connectors[e]||{},null==b.Connectors[e][n]){if(null==b.Connectors[n]){if(t.Defaults.DoNotThrowErrors)return null;throw new TypeError("jsPlumb: unknown connector type '"+n+"'")}b.Connectors[e][n]=function(){b.Connectors[n].apply(this,arguments),b.ConnectorRenderers[e].apply(this,arguments)},P.extend(b.Connectors[e][n],[b.Connectors[n],b.ConnectorRenderers[e]])}return new b.Connectors[e][n](o,i)}function f(t,e,n){return t?n.makeAnchor(t,e,n):null}function e(t,e,n,o){null!=e&&(e._jsPlumbConnections=e._jsPlumbConnections||{},o?delete e._jsPlumbConnections[t.id]:e._jsPlumbConnections[t.id]=!0,P.isEmpty(e._jsPlumbConnections)?n.removeClass(e,n.connectedClass):n.addClass(e,n.connectedClass))}var n=this,b=n.jsPlumb,P=n.jsPlumbUtil;b.Connection=function(r){var s=r.newEndpoint;this.id=r.id,this.connector=null,this.idPrefix="_jsplumb_c_",this.defaultLabelLocation=.5,this.defaultOverlayKeys=["Overlays","ConnectionOverlays"],this.previousConnection=r.previousConnection,this.source=b.getElement(r.source),this.target=b.getElement(r.target),b.OverlayCapableJsPlumbUIComponent.apply(this,arguments),r.sourceEndpoint?(this.source=r.sourceEndpoint.getElement(),this.sourceId=r.sourceEndpoint.elementId):this.sourceId=this._jsPlumb.instance.getId(this.source),r.targetEndpoint?(this.target=r.targetEndpoint.getElement(),this.targetId=r.targetEndpoint.elementId):this.targetId=this._jsPlumb.instance.getId(this.target),this.scope=r.scope,this.endpoints=[],this.endpointStyles=[];var a=this._jsPlumb.instance;a.manage(this.sourceId,this.source),a.manage(this.targetId,this.target),this._jsPlumb.visible=!0,this._jsPlumb.params={cssClass:r.cssClass,container:r.container,"pointer-events":r["pointer-events"],editorParams:r.editorParams,overlays:r.overlays},this._jsPlumb.lastPaintedAt=null,this.bind("mouseover",function(){this.setHover(!0)}.bind(this)),this.bind("mouseout",function(){this.setHover(!1)}.bind(this)),this.makeEndpoint=function(t,e,n,o,i){return n=n||this._jsPlumb.instance.getId(e),this.prepareEndpoint(a,s,this,o,t?0:1,r,e,n,i)},r.type&&(r.endpoints=r.endpoints||this._jsPlumb.instance.deriveEndpointAndAnchorSpec(r.type).endpoints);var t=this.makeEndpoint(!0,this.source,this.sourceId,r.sourceEndpoint),e=this.makeEndpoint(!1,this.target,this.targetId,r.targetEndpoint);t&&P.addToList(r.endpointsByElement,this.sourceId,t),e&&P.addToList(r.endpointsByElement,this.targetId,e),this.scope||(this.scope=this.endpoints[0].scope),null!=r.deleteEndpointsOnEmpty&&(this.endpoints[0].setDeleteOnEmpty(r.deleteEndpointsOnEmpty),this.endpoints[1].setDeleteOnEmpty(r.deleteEndpointsOnEmpty));var n=a.Defaults.ConnectionsDetachable;!1===r.detachable&&(n=!1),!1===this.endpoints[0].connectionsDetachable&&(n=!1),!1===this.endpoints[1].connectionsDetachable&&(n=!1);var o=r.reattach||this.endpoints[0].reattachConnections||this.endpoints[1].reattachConnections||a.Defaults.ReattachConnections;this.appendToDefaultType({detachable:n,reattach:o,paintStyle:this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||r.paintStyle||a.Defaults.PaintStyle||b.Defaults.PaintStyle,hoverPaintStyle:this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||r.hoverPaintStyle||a.Defaults.HoverPaintStyle||b.Defaults.HoverPaintStyle});var i=a.getSuspendedAt();if(!a.isSuspendDrawing()){var l=a.getCachedData(this.sourceId),u=l.o,d=l.s,c=a.getCachedData(this.targetId),h=c.o,p=c.s,f=i||jsPlumbUtil.uuid(),g=this.endpoints[0].anchor.compute({xy:[u.left,u.top],wh:d,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[h.left,h.top],twh:p,tElement:this.endpoints[1],timestamp:f,rotation:a.getRotation(this.endpoints[0].elementId)});this.endpoints[0].paint({anchorLoc:g,timestamp:f}),g=this.endpoints[1].anchor.compute({xy:[h.left,h.top],wh:p,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[u.left,u.top],twh:d,tElement:this.endpoints[0],timestamp:f,rotation:a.getRotation(this.endpoints[1].elementId)}),this.endpoints[1].paint({anchorLoc:g,timestamp:f})}this.getTypeDescriptor=function(){return"connection"},this.getAttachedElements=function(){return this.endpoints},this.isDetachable=function(t){return!1!==this._jsPlumb.detachable&&(null!=t?!0===t.connectionsDetachable:!0===this._jsPlumb.detachable)},this.setDetachable=function(t){this._jsPlumb.detachable=!0===t},this.isReattach=function(){return!0===this._jsPlumb.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections},this.setReattach=function(t){this._jsPlumb.reattach=!0===t},this._jsPlumb.cost=r.cost||this.endpoints[0].getConnectionCost(),this._jsPlumb.directed=r.directed,null==r.directed&&(this._jsPlumb.directed=this.endpoints[0].areConnectionsDirected());var m=b.extend({},this.endpoints[1].getParameters());b.extend(m,this.endpoints[0].getParameters()),b.extend(m,this.getParameters()),this.setParameters(m),this.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||r.connector||a.Defaults.Connector||b.Defaults.Connector,!0);var v=null!=r.data&&P.isObject(r.data)?r.data:{};this.getData=function(){return v},this.setData=function(t){v=t||{}},this.mergeData=function(t){v=b.extend(v,t)};var y=["default",this.endpoints[0].connectionType,this.endpoints[1].connectionType,r.type].join(" ");/[^\s]/.test(y)&&this.addType(y,r.data,!0),this.updateConnectedClass()},P.extend(b.Connection,b.OverlayCapableJsPlumbUIComponent,{applyType:function(t,e,n){var o=null;null!=t.connector&&(null==(o=this.getCachedTypeItem("connector",n.connector))&&(o=this.prepareConnector(t.connector,n.connector),this.cacheTypeItem("connector",o,n.connector)),this.setPreparedConnector(o)),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope),null!=t.cssClass&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,t.cssClass);var i=null;t.anchor?null==(i=this.getCachedTypeItem("anchors",n.anchor))&&(i=[this._jsPlumb.instance.makeAnchor(t.anchor),this._jsPlumb.instance.makeAnchor(t.anchor)],this.cacheTypeItem("anchors",i,n.anchor)):t.anchors&&null==(i=this.getCachedTypeItem("anchors",n.anchors))&&(i=[this._jsPlumb.instance.makeAnchor(t.anchors[0]),this._jsPlumb.instance.makeAnchor(t.anchors[1])],this.cacheTypeItem("anchors",i,n.anchors)),null!=i&&(this.endpoints[0].anchor=i[0],this.endpoints[1].anchor=i[1],this.endpoints[1].anchor.isDynamic&&this._jsPlumb.instance.repaint(this.endpoints[1].elementId)),b.OverlayCapableJsPlumbUIComponent.applyType(this,t)},addClass:function(t,e){e&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.connector.addClass(t)},removeClass:function(t,e){e&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.connector.removeClass(t)},isVisible:function(){return this._jsPlumb.visible},setVisible:function(t){this._jsPlumb.visible=t,this.connector&&this.connector.setVisible(t),this.repaint()},cleanup:function(){this.updateConnectedClass(!0),this.endpoints=null,this.source=null,(this.target=null)!=this.connector&&(this.connector.cleanup(!0),this.connector.destroy(!0)),this.connector=null},updateConnectedClass:function(t){this._jsPlumb&&(e(this,this.source,this._jsPlumb.instance,t),e(this,this.target,this._jsPlumb.instance,t))},setHover:function(t){this.connector&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&(this.connector.setHover(t),n.jsPlumb[t?"addClass":"removeClass"](this.source,this._jsPlumb.instance.hoverSourceClass),n.jsPlumb[t?"addClass":"removeClass"](this.target,this._jsPlumb.instance.hoverTargetClass))},getUuids:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]},getCost:function(){return this._jsPlumb?this._jsPlumb.cost:-1/0},setCost:function(t){this._jsPlumb.cost=t},isDirected:function(){return this._jsPlumb.directed},getConnector:function(){return this.connector},prepareConnector:function(t,e){var n,o={_jsPlumb:this._jsPlumb.instance,cssClass:this._jsPlumb.params.cssClass,container:this._jsPlumb.params.container,"pointer-events":this._jsPlumb.params["pointer-events"]},i=this._jsPlumb.instance.getRenderMode();return P.isString(t)?n=r(this._jsPlumb.instance,i,t,o,this):P.isArray(t)&&(n=1===t.length?r(this._jsPlumb.instance,i,t[0],o,this):r(this._jsPlumb.instance,i,t[0],P.merge(t[1],o),this)),null!=e&&(n.typeId=e),n},setPreparedConnector:function(t,e,n,o){if(this.connector!==t){var i,r="";if(null!=this.connector&&(r=(i=this.connector).getClass(),this.connector.cleanup(),this.connector.destroy()),this.connector=t,o&&this.cacheTypeItem("connector",t,o),this.canvas=this.connector.canvas,this.bgCanvas=this.connector.bgCanvas,this.connector.reattach(this._jsPlumb.instance),this.addClass(r),this.canvas&&(this.canvas._jsPlumb=this),this.bgCanvas&&(this.bgCanvas._jsPlumb=this),null!=i)for(var s=this.getOverlays(),a=0;a<s.length;a++)s[a].transfer&&s[a].transfer(this.connector);n||this.setListenerComponent(this.connector),e||this.repaint()}},setConnector:function(t,e,n,o){var i=this.prepareConnector(t,o);this.setPreparedConnector(i,e,n,o)},paint:function(t){if(!this._jsPlumb.instance.isSuspendDrawing()&&this._jsPlumb.visible){var e=(t=t||{}).timestamp,n=this.targetId,o=this.sourceId;if(null==e||e!==this._jsPlumb.lastPaintedAt){var i=this._jsPlumb.instance.updateOffset({elId:o}).o,r=this._jsPlumb.instance.updateOffset({elId:n}).o,s=this.endpoints[0],a=this.endpoints[1],l=s.anchor.getCurrentLocation({xy:[i.left,i.top],wh:[i.width,i.height],element:s,timestamp:e,rotation:this._jsPlumb.instance.getRotation(this.sourceId)}),u=a.anchor.getCurrentLocation({xy:[r.left,r.top],wh:[r.width,r.height],element:a,timestamp:e,rotation:this._jsPlumb.instance.getRotation(this.targetId)});this.connector.resetBounds(),this.connector.compute({sourcePos:l,targetPos:u,sourceOrientation:s.anchor.getOrientation(s),targetOrientation:a.anchor.getOrientation(a),sourceEndpoint:this.endpoints[0],targetEndpoint:this.endpoints[1],"stroke-width":this._jsPlumb.paintStyleInUse.strokeWidth,sourceInfo:i,targetInfo:r});var d={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};for(var c in this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(c)){var h=this._jsPlumb.overlays[c];h.isVisible()&&(this._jsPlumb.overlayPlacements[c]=h.draw(this.connector,this._jsPlumb.paintStyleInUse,this.getAbsoluteOverlayPosition(h)),d.minX=Math.min(d.minX,this._jsPlumb.overlayPlacements[c].minX),d.maxX=Math.max(d.maxX,this._jsPlumb.overlayPlacements[c].maxX),d.minY=Math.min(d.minY,this._jsPlumb.overlayPlacements[c].minY),d.maxY=Math.max(d.maxY,this._jsPlumb.overlayPlacements[c].maxY))}var p=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||1)/2,f=parseFloat(this._jsPlumb.paintStyleInUse.strokeWidth||0),g={xmin:Math.min(this.connector.bounds.minX-(p+f),d.minX),ymin:Math.min(this.connector.bounds.minY-(p+f),d.minY),xmax:Math.max(this.connector.bounds.maxX+(p+f),d.maxX),ymax:Math.max(this.connector.bounds.maxY+(p+f),d.maxY)};for(var m in this.connector.paintExtents=g,this.connector.paint(this._jsPlumb.paintStyleInUse,null,g),this._jsPlumb.overlays)if(this._jsPlumb.overlays.hasOwnProperty(m)){var v=this._jsPlumb.overlays[m];v.isVisible()&&v.paint(this._jsPlumb.overlayPlacements[m],g)}}this._jsPlumb.lastPaintedAt=e}},repaint:function(t){var e=jsPlumb.extend(t||{},{});e.elId=this.sourceId,this.paint(e)},prepareEndpoint:function(t,e,n,o,i,r,s,a,l){var u;if(o)(n.endpoints[i]=o).addConnection(n);else{r.endpoints||(r.endpoints=[null,null]);var d=l||r.endpoints[i]||r.endpoint||t.Defaults.Endpoints[i]||b.Defaults.Endpoints[i]||t.Defaults.Endpoint||b.Defaults.Endpoint;r.endpointStyles||(r.endpointStyles=[null,null]),r.endpointHoverStyles||(r.endpointHoverStyles=[null,null]);var c=r.endpointStyles[i]||r.endpointStyle||t.Defaults.EndpointStyles[i]||b.Defaults.EndpointStyles[i]||t.Defaults.EndpointStyle||b.Defaults.EndpointStyle;null==c.fill&&null!=r.paintStyle&&(c.fill=r.paintStyle.stroke),null==c.outlineStroke&&null!=r.paintStyle&&(c.outlineStroke=r.paintStyle.outlineStroke),null==c.outlineWidth&&null!=r.paintStyle&&(c.outlineWidth=r.paintStyle.outlineWidth);var h=r.endpointHoverStyles[i]||r.endpointHoverStyle||t.Defaults.EndpointHoverStyles[i]||b.Defaults.EndpointHoverStyles[i]||t.Defaults.EndpointHoverStyle||b.Defaults.EndpointHoverStyle;null!=r.hoverPaintStyle&&(null==h&&(h={}),null==h.fill&&(h.fill=r.hoverPaintStyle.stroke));var p=r.anchors?r.anchors[i]:r.anchor?r.anchor:f(t.Defaults.Anchors[i],a,t)||f(b.Defaults.Anchors[i],a,t)||f(t.Defaults.Anchor,a,t)||f(b.Defaults.Anchor,a,t);u=e({paintStyle:c,hoverPaintStyle:h,endpoint:d,connections:[n],uuid:r.uuids?r.uuids[i]:null,anchor:p,source:s,scope:r.scope,reattach:r.reattach||t.Defaults.ReattachConnections,detachable:r.detachable||t.Defaults.ConnectionsDetachable}),null==o&&u.setDeleteOnEmpty(!0),n.endpoints[i]=u,!1===r.drawEndpoints&&u.setVisible(!1,!0,!0)}return u},replaceEndpoint:function(t,e){var n=this.endpoints[t],o=n.elementId,i=this._jsPlumb.instance.getEndpoints(o),r=i.indexOf(n),s=this.makeEndpoint(0===t,n.element,o,null,e);this.endpoints[t]=s,i.splice(r,1,s),this._jsPlumb.instance.deleteObject({endpoint:n,deleteAttachedObjects:!1}),this._jsPlumb.instance.fire("endpointReplaced",{previous:n,current:s}),this._jsPlumb.instance.router.sourceOrTargetChanged(this.endpoints[1].elementId,this.endpoints[1].elementId,this,this.endpoints[1].element,1)}})}.call("undefined"!=typeof window?window:this),function(){"use strict";var L=this.jsPlumbUtil,R=this.jsPlumb;R.AnchorManager=function(C){function t(t,e){return e[0][0]-t[0][0]}function e(t,e){return(t[0][0]<0?-Math.PI-t[0][0]:Math.PI-t[0][0])-(e[0][0]<0?-Math.PI-e[0][0]:Math.PI-e[0][0])}function A(p,t){function e(t,e,n,o,i,r,s){if(0<o.length)for(var a=function(t,e,n,o,i,r,s,a){for(var l=[],u=e[i?0:1]/(o.length+1),d=0;d<o.length;d++){var c=(d+1)*u,h=r*e[i?1:0];s&&(c=e[i?0:1]-c);var p=i?c:h,f=n.left+p,g=p/e[0],m=i?h:c,v=n.top+m,y=m/e[1];if(0!==a){var b=jsPlumbUtil.rotatePoint([f,v],[n.centerx,n.centery],a);f=b[0],v=b[1]}l.push([f,v,g,y,o[d][1],o[d][2]])}return l}(0,e,n,function(t,e){return t.sort(e)}(o,f[t]),i,r,"right"===t||"top"===t,N.getRotation(p)),l=function(t,e){m[t.id]=[e[0],e[1],e[2],e[3]],v[t.id]=s},u=0;u<a.length;u++){var d=a[u][4],c=d.endpoints[0].elementId===p,h=d.endpoints[1].elementId===p;c&&l(d.endpoints[0],a[u]),h&&l(d.endpoints[1],a[u])}}var n=N.getCachedData(p),o=n.s,i=n.o;e("bottom",o,i,t.bottom,!0,1,[0,1]),e("top",o,i,t.top,!0,0,[0,-1]),e("left",o,i,t.left,!1,0,[-1,0]),e("right",o,i,t.right,!1,1,[1,0])}var T={},m={},v={},D={},l=this,M={},N=C.jsPlumbInstance,O={},f={top:e,right:t,bottom:t,left:e};this.reset=function(){T={},D={},M={}},this.addFloatingConnection=function(t,e){O[t]=e},this.newConnection=function(r){function t(t,e,n,o,i){s===a&&n.isContinuous&&(r._jsPlumb.instance.removeElement(l[1].canvas),u=!1),L.addToList(D,o,[i,e,n.constructor===R.DynamicAnchor])}var s=r.sourceId,a=r.targetId,l=r.endpoints,u=!0;t(0,l[0],l[0].anchor,a,r),u&&t(0,l[1],l[1].anchor,s,r)};function a(t){!function(t,e){if(t){var n=function(t){return t[4]===e};L.removeWithFunction(t.top,n),L.removeWithFunction(t.left,n),L.removeWithFunction(t.bottom,n),L.removeWithFunction(t.right,n)}}(M[t.elementId],t.id)}this.connectionDetached=function(t,e){function n(t,e,n,o,i){L.removeWithFunction(D[o],function(t){return t[0].id===i.id})}var o=t.connection||t,i=t.sourceId,r=t.targetId,s=o.endpoints;n(0,s[1],s[1].anchor,i,o),n(0,s[0],s[0].anchor,r,o),o.floatingId&&(n(o.floatingIndex,o.floatingEndpoint,o.floatingEndpoint.anchor,o.floatingId,o),a(o.floatingEndpoint)),a(o.endpoints[0]),a(o.endpoints[1]),e||(l.redraw(o.sourceId),o.targetId!==o.sourceId&&l.redraw(o.targetId))},this.addEndpoint=function(t,e){L.addToList(T,e,t)},this.changeId=function(t,e){D[e]=D[t],T[e]=T[t],delete D[t],delete T[t]},this.getConnectionsFor=function(t){return D[t]||[]},this.getEndpointsFor=function(t){return T[t]||[]},this.deleteEndpoint=function(e){L.removeWithFunction(T[e.elementId],function(t){return t.id===e.id}),a(e)},this.elementRemoved=function(t){delete O[t],delete T[t],T[t]=[]};function F(t,e,n,o,i,r,s,a,l,u,d,c){var h,p,f=-1,g=o.endpoints[s],m=g.id,v=[1,0][s],y=[[e,n],o,i,r,m],b=t[l],P=g._continuousAnchorEdge?t[g._continuousAnchorEdge]:null;if(P){var E=L.findWithFunction(P,function(t){return t[4]===m});if(-1!==E)for(P.splice(E,1),h=0;h<P.length;h++)p=P[h][1],L.addWithFunction(d,p,function(t){return t.id===p.id}),L.addWithFunction(c,P[h][1].endpoints[s],function(t){return t.id===p.endpoints[s].id}),L.addWithFunction(c,P[h][1].endpoints[v],function(t){return t.id===p.endpoints[v].id})}for(h=0;h<b.length;h++)p=b[h][1],1===C.idx&&b[h][3]===r&&-1===f&&(f=h),L.addWithFunction(d,p,function(t){return t.id===p.id}),L.addWithFunction(c,b[h][1].endpoints[s],function(t){return t.id===p.endpoints[s].id}),L.addWithFunction(c,b[h][1].endpoints[v],function(t){return t.id===p.endpoints[v].id});var x=a?-1!==f?f:0:b.length;b.splice(x,0,y),g._continuousAnchorEdge=l}this.sourceOrTargetChanged=function(t,e,n,o,i){if(0===i){if(t!==e){n.sourceId=e,n.source=o,L.removeWithFunction(D[t],function(t){return t[0].id===n.id});var r=L.findWithFunction(D[n.targetId],function(t){return t[0].id===n.id});-1<r&&(D[n.targetId][r][0]=n,D[n.targetId][r][1]=n.endpoints[0],D[n.targetId][r][2]=n.endpoints[0].anchor.constructor===R.DynamicAnchor),L.addToList(D,e,[n,n.endpoints[1],n.endpoints[1].anchor.constructor===R.DynamicAnchor]),n.endpoints[1].anchor.isContinuous&&(n.source===n.target?n._jsPlumb.instance.removeElement(n.endpoints[1].canvas):null==n.endpoints[1].canvas.parentNode&&n._jsPlumb.instance.appendElement(n.endpoints[1].canvas)),n.updateConnectedClass()}}else if(1===i){var s=n.endpoints[0].elementId;n.target=o,n.targetId=e;var a=L.findWithFunction(D[s],function(t){return t[0].id===n.id}),l=L.findWithFunction(D[t],function(t){return t[0].id===n.id});-1!==a&&(D[s][a][0]=n,D[s][a][1]=n.endpoints[1],D[s][a][2]=n.endpoints[1].anchor.constructor===R.DynamicAnchor),-1<l&&(D[t].splice(l,1),L.addToList(D,e,[n,n.endpoints[0],n.endpoints[0].anchor.constructor===R.DynamicAnchor])),n.updateConnectedClass()}},this.rehomeEndpoint=function(t,e,n){var o=T[e]||[],i=N.getId(n);if(i!==e){var r=o.indexOf(t);if(-1<r){var s=o.splice(r,1)[0];l.add(s,i)}}for(var a=0;a<t.connections.length;a++)t.connections[a].sourceId===e?l.sourceOrTargetChanged(e,t.elementId,t.connections[a],t.element,0):t.connections[a].targetId===e&&l.sourceOrTargetChanged(e,t.elementId,t.connections[a],t.element,1)},this.redraw=function(e,t,n,o,i,r){var s=[],a=[],l=[];if(!N.isSuspendDrawing()){var u=T[e]||[],d=D[e]||[];n=n||jsPlumbUtil.uuid(),o=o||{left:0,top:0},t=t&&{left:t.left+o.left,top:t.top+o.top};for(var c=N.updateOffset({elId:e,offset:t,recalc:!1,timestamp:n}),h={},p=0;p<d.length;p++){var f=d[p][0],g=f.sourceId,m=f.targetId,v=f.endpoints[0].anchor.isContinuous,y=f.endpoints[1].anchor.isContinuous;if(v||y){var b=g+"_"+m,P=h[b],E=f.sourceId===e?1:0,x=N.getRotation(m),C=N.getRotation(g);v&&!M[g]&&(M[g]={top:[],right:[],bottom:[],left:[]}),y&&!M[m]&&(M[m]={top:[],right:[],bottom:[],left:[]}),e!==m&&N.updateOffset({elId:m,timestamp:n}),e!==g&&N.updateOffset({elId:g,timestamp:n});var j=N.getCachedData(m),_=N.getCachedData(g);m===g&&(v||y)?(F(M[g],-Math.PI/2,0,f,!1,m,0,!1,"top",0,s,a),F(M[m],-Math.PI/2,0,f,!1,g,1,!1,"top",0,s,a)):(P||(P=this.calculateOrientation(g,m,_.o,j.o,f.endpoints[0].anchor,f.endpoints[1].anchor,f,C,x),h[b]=P),v&&F(M[g],P.theta,0,f,!1,m,0,!1,P.a[0],0,s,a),y&&F(M[m],P.theta2,-1,f,!0,g,1,!0,P.a[1],0,s,a)),v&&L.addWithFunction(l,g,function(t){return t===g}),y&&L.addWithFunction(l,m,function(t){return t===m}),L.addWithFunction(s,f,function(t){return t.id===f.id}),(v&&0==E||y&&1==E)&&L.addWithFunction(a,f.endpoints[E],function(t){return t.id===f.endpoints[E].id})}}for(p=0;p<u.length;p++)0===u[p].connections.length&&u[p].anchor.isContinuous&&(M[e]||(M[e]={top:[],right:[],bottom:[],left:[]}),F(M[e],-Math.PI/2,0,{endpoints:[u[p],u[p]],paint:function(){}},!1,e,0,!1,u[p].anchor.getDefaultFace(),0,s,a),L.addWithFunction(l,e,function(t){return t===e}));for(p=0;p<l.length;p++)A(l[p],M[l[p]]);for(p=0;p<u.length;p++)u[p].paint({timestamp:n,offset:c,dimensions:c.s,recalc:!0!==r});for(p=0;p<a.length;p++){var w=N.getCachedData(a[p].elementId);a[p].paint({timestamp:null,offset:w,dimensions:w.s})}for(p=0;p<d.length;p++){var S=d[p][1];if(S.anchor.constructor===R.DynamicAnchor){S.paint({elementWithPrecedence:e,timestamp:n}),L.addWithFunction(s,d[p][0],function(t){return t.id===d[p][0].id});for(var I=0;I<S.connections.length;I++)S.connections[I]!==d[p][0]&&L.addWithFunction(s,S.connections[I],function(t){return t.id===S.connections[I].id})}else L.addWithFunction(s,d[p][0],function(t){return t.id===d[p][0].id})}var k=O[e];for(k&&k.paint({timestamp:n,recalc:!1,elId:e}),p=0;p<s.length;p++)s[p].paint({elId:e,timestamp:null,recalc:!1,clearEdits:i})}return{c:s,e:a}};function n(t){L.EventGenerator.apply(this),this.type="Continuous",this.isDynamic=!0,this.isContinuous=!0;for(var e=t.faces||["top","right","bottom","left"],n=!(!1===t.clockwise),o={},i={top:"bottom",right:"left",left:"right",bottom:"top"},r={top:"right",right:"bottom",left:"top",bottom:"left"},s={top:"left",right:"top",left:"bottom",bottom:"right"},a=n?r:s,l=n?s:r,u=t.cssClass||"",d=null,c=null,h=["left","right"],p=["top","bottom"],f=null,g=0;g<e.length;g++)o[e[g]]=!0;this.getDefaultFace=function(){return 0===e.length?"top":e[0]},this.isRelocatable=function(){return!0},this.isSnapOnRelocate=function(){return!0},this.verifyEdge=function(t){return o[t]?t:o[i[t]]?i[t]:o[a[t]]?a[t]:o[l[t]]?l[t]:t},this.isEdgeSupported=function(t){return null==f?null==c?!0===o[t]:c===t:-1!==f.indexOf(t)},this.setCurrentFace=function(t,e){d=t,e&&null!=c&&(c=d)},this.getCurrentFace=function(){return d},this.getSupportedFaces=function(){var t=[];for(var e in o)o[e]&&t.push(e);return t},this.lock=function(){c=d},this.unlock=function(){c=null},this.isLocked=function(){return null!=c},this.lockCurrentAxis=function(){null!=d&&(f="left"===d||"right"===d?h:p)},this.unlockCurrentAxis=function(){f=null},this.compute=function(t){return m[t.element.id]||[0,0]},this.getCurrentLocation=function(t){return m[t.element.id]||[0,0]},this.getOrientation=function(t){return v[t.id]||[0,0]},this.getCssClass=function(){return u}}N.continuousAnchorFactory={get:function(t){return new n(t)},clear:function(t){delete m[t]}}},R.AnchorManager.prototype.calculateOrientation=function(t,e,n,o,i,r,s,a,l){var u=["left","top","right","bottom"];if(t===e)return{orientation:"identity",a:["top","top"]};var d=Math.atan2(o.centery-n.centery,o.centerx-n.centerx),c=Math.atan2(n.centery-o.centery,n.centerx-o.centerx),h=[],p={};!function(t,e){for(var n=0;n<t.length;n++)if(p[t[n]]={left:[e[n][0].left,e[n][0].centery],right:[e[n][0].right,e[n][0].centery],top:[e[n][0].centerx,e[n][0].top],bottom:[e[n][0].centerx,e[n][0].bottom]},0!==e[n][1])for(var o in p[t[n]])p[t[n]][o]=jsPlumbUtil.rotatePoint(p[t[n]][o],[e[n][0].centerx,e[n][0].centery],e[n][1])}(["source","target"],[[n,a],[o,l]]);for(var f=0;f<u.length;f++)for(var g=0;g<u.length;g++)h.push({source:u[f],target:u[g],dist:Biltong.lineLength(p.source[u[f]],p.target[u[g]])});h.sort(function(t,e){return t.dist<e.dist?-1:t.dist>e.dist?1:0});for(var m=h[0].source,v=h[0].target,y=0;y<h.length&&(m=i.isContinuous&&i.locked?i.getCurrentFace():!i.isContinuous||i.isEdgeSupported(h[y].source)?h[y].source:null,v=r.isContinuous&&r.locked?r.getCurrentFace():!r.isContinuous||r.isEdgeSupported(h[y].target)?h[y].target:null,null==m||null==v);y++);return i.isContinuous&&i.setCurrentFace(m),r.isContinuous&&r.setCurrentFace(v),{a:[m,v],theta:d,theta2:c}},R.Anchor=function(t){this.x=t.x||0,this.y=t.y||0,this.elementId=t.elementId,this.cssClass=t.cssClass||"",this.orientation=t.orientation||[0,0],this.lastReturnValue=null,this.offsets=t.offsets||[0,0],this.timestamp=null,this._unrotatedOrientation=[this.orientation[0],this.orientation[1]],this.relocatable=!1!==t.relocatable,this.snapOnRelocate=!1!==t.snapOnRelocate,this.locked=!1,L.EventGenerator.apply(this),this.compute=function(t){var e=t.xy,n=t.wh,o=t.timestamp;if(o&&o===this.timestamp)return this.lastReturnValue;var i=[e[0]+this.x*n[0]+this.offsets[0],e[1]+this.y*n[1]+this.offsets[1],this.x,this.y],r=t.rotation;if(null!=r&&0!==r){var s=jsPlumbUtil.rotatePoint(i,[e[0]+n[0]/2,e[1]+n[1]/2],r);this.orientation[0]=Math.round(this._unrotatedOrientation[0]*s[2]-this._unrotatedOrientation[1]*s[3]),this.orientation[1]=Math.round(this._unrotatedOrientation[1]*s[2]+this._unrotatedOrientation[0]*s[3]),this.lastReturnValue=[s[0],s[1],this.x,this.y]}else this.orientation[0]=this._unrotatedOrientation[0],this.orientation[1]=this._unrotatedOrientation[1],this.lastReturnValue=i;return this.timestamp=o,this.lastReturnValue},this.getCurrentLocation=function(t){return t=t||{},null==this.lastReturnValue||null!=t.timestamp&&this.timestamp!==t.timestamp?this.compute(t):this.lastReturnValue},this.setPosition=function(t,e,n,o,i){this.locked&&!i||(this.x=t,this.y=e,this.orientation=[n,o],this.lastReturnValue=null)}},L.extend(R.Anchor,L.EventGenerator,{equals:function(t){if(!t)return!1;var e=t.getOrientation(),n=this.getOrientation();return this.x===t.x&&this.y===t.y&&this.offsets[0]===t.offsets[0]&&this.offsets[1]===t.offsets[1]&&n[0]===e[0]&&n[1]===e[1]},getOrientation:function(){return this.orientation},getCssClass:function(){return this.cssClass}}),R.FloatingAnchor=function(t){R.Anchor.apply(this,arguments);var n=t.reference,e=t.referenceCanvas,o=R.getSize(e),i=null,r=null;this.orientation=null,this.x=0,this.y=0,this.isFloating=!0,this.compute=function(t){var e=t.xy,n=[e[0]+o[0]/2,e[1]+o[1]/2];return r=n},this.getOrientation=function(t){if(i)return i;var e=n.getOrientation(t);return[0*Math.abs(e[0])*-1,0*Math.abs(e[1])*-1]},this.over=function(t,e){i=t.getOrientation(e)},this.out=function(){i=null},this.getCurrentLocation=function(t){return null==r?this.compute(t):r}},L.extend(R.FloatingAnchor,R.Anchor);R.DynamicAnchor=function(t){R.Anchor.apply(this,arguments),this.isDynamic=!0,this.anchors=[],this.elementId=t.elementId,this.jsPlumbInstance=t.jsPlumbInstance;for(var e=0;e<t.anchors.length;e++)this.anchors[e]=(n=t.anchors[e],o=this.jsPlumbInstance,i=this.elementId,n.constructor===R.Anchor?n:o.makeAnchor(n,i,o));var n,o,i;this.getAnchors=function(){return this.anchors};function p(t,e,n,o,i,r,s){var a=o[0]+t.x*i[0],l=o[1]+t.y*i[1],u=o[0]+i[0]/2,d=o[1]+i[1]/2;if(null!=r&&0!==r){var c=jsPlumbUtil.rotatePoint([a,l],[u,d],r);a=c[0],l=c[1]}return Math.sqrt(Math.pow(e-a,2)+Math.pow(n-l,2))+Math.sqrt(Math.pow(u-a,2)+Math.pow(d-l,2))}var a=0<this.anchors.length?this.anchors[0]:null,l=a,u=t.selector||function(t,e,n,o,i,r,s){for(var a=n[0]+o[0]/2,l=n[1]+o[1]/2,u=-1,d=1/0,c=0;c<s.length;c++){var h=p(s[c],a,l,t,e,i);h<d&&(u=c+0,d=h)}return s[u]};this.compute=function(t){var e=t.xy,n=t.wh,o=t.txy,i=t.twh,r=t.rotation,s=t.tRotation;return this.timestamp=t.timestamp,this.locked||null==o||null==i||(t.timestamp=null,a=u(e,n,o,i,r,s,this.anchors),this.x=a.x,this.y=a.y,a!==l&&this.fire("anchorChanged",a),l=a),this.lastReturnValue=a.compute(t),this.lastReturnValue},this.getCurrentLocation=function(t){return null!=a?a.getCurrentLocation(t):null},this.getOrientation=function(t){return null!=a?a.getOrientation(t):[0,0]},this.over=function(t,e){null!=a&&a.over(t,e)},this.out=function(){null!=a&&a.out()},this.setAnchor=function(t){a=t},this.getCssClass=function(){return a&&a.getCssClass()||""},this.setAnchorCoordinates=function(e){var t=jsPlumbUtil.findWithFunction(this.anchors,function(t){return t.x===e[0]&&t.y===e[1]});return-1!==t&&(this.setAnchor(this.anchors[t]),!0)}},L.extend(R.DynamicAnchor,R.Anchor);function t(n,o,i,r,s,a){R.Anchors[s]=function(t){var e=t.jsPlumbInstance.makeAnchor([n,o,i,r,0,0],t.elementId,t.jsPlumbInstance);return e.type=s,a&&a(e,t),e}}t(.5,0,0,-1,"TopCenter"),t(.5,1,0,1,"BottomCenter"),t(0,.5,-1,0,"LeftMiddle"),t(1,.5,1,0,"RightMiddle"),t(.5,0,0,-1,"Top"),t(.5,1,0,1,"Bottom"),t(0,.5,-1,0,"Left"),t(1,.5,1,0,"Right"),t(.5,.5,0,0,"Center"),t(1,0,0,-1,"TopRight"),t(1,1,0,1,"BottomRight"),t(0,0,0,-1,"TopLeft"),t(0,1,0,1,"BottomLeft"),R.Defaults.DynamicAnchors=function(t){return t.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],t.elementId,t.jsPlumbInstance)},R.Anchors.AutoDefault=function(t){var e=t.jsPlumbInstance.makeDynamicAnchor(R.Defaults.DynamicAnchors(t));return e.type="AutoDefault",e};function e(n,o){R.Anchors[n]=function(t){var e=t.jsPlumbInstance.makeAnchor(["Continuous",{faces:o}],t.elementId,t.jsPlumbInstance);return e.type=n,e}}R.Anchors.Continuous=function(t){return t.jsPlumbInstance.continuousAnchorFactory.get(t)},e("ContinuousLeft",["left"]),e("ContinuousTop",["top"]),e("ContinuousBottom",["bottom"]),e("ContinuousRight",["right"]),t(0,0,0,0,"Assign",function(t,e){var n=e.position||"Fixed";t.positionFinder=n.constructor===String?e.jsPlumbInstance.AnchorPositionFinders[n]:n,t.constructorParams=e}),this.jsPlumbInstance.prototype.AnchorPositionFinders={Fixed:function(t,e,n){return[(t.left-e.left)/n[0],(t.top-e.top)/n[1]]},Grid:function(t,e,n,o){var i=t.left-e.left,r=t.top-e.top,s=n[0]/o.grid[0],a=n[1]/o.grid[1],l=Math.floor(i/s),u=Math.floor(r/a);return[(l*s+s/2)/n[0],(u*a+a/2)/n[1]]}},R.Anchors.Perimeter=function(t){var h=(t=t||{}).anchorCount||60,e=t.shape;if(!e)throw new Error("no shape supplied to Perimeter Anchor type");function n(){for(var t=2*Math.PI/h,e=0,n=[],o=0;o<h;o++){var i=.5+.5*Math.sin(e),r=.5+.5*Math.cos(e);n.push([i,r,0,0]),e+=t}return n}function a(t){for(var d=h/t.length,c=[],e=function(t,e,n,o,i,r,s){for(var a=(n-t)/(d=h*i),l=(o-e)/d,u=0;u<d;u++)c.push([t+a*u,e+l*u,null==r?0:r,null==s?0:s])},n=0;n<t.length;n++)e.apply(null,t[n]);return c}function o(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n][0],t[n][1],t[n][2],t[n][3],1/t.length,t[n][4],t[n][5]]);return a(e)}function i(){return o([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]])}var r={Circle:n,Ellipse:n,Diamond:function(){return o([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},Rectangle:i,Square:i,Triangle:function(){return o([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},Path:function(t){for(var e=t.points,n=[],o=0,i=0;i<e.length-1;i++){var r=Math.sqrt(Math.pow(e[i][2]-e[i][0])+Math.pow(e[i][3]-e[i][1]));o+=r,n.push([e[i][0],e[i][1],e[i+1][0],e[i+1][1],r])}for(var s=0;s<n.length;s++)n[s][4]=n[s][4]/o;return a(n)}};if(!r[e])throw new Error("Shape ["+e+"] is unknown by Perimeter Anchor type");var s=r[e](t);t.rotation&&(s=function(t,e){for(var n=[],o=e/180*Math.PI,i=0;i<t.length;i++){var r=t[i][0]-.5,s=t[i][1]-.5;n.push([r*Math.cos(o)-s*Math.sin(o)+.5,r*Math.sin(o)+s*Math.cos(o)+.5,t[i][2],t[i][3]])}return n}(s,t.rotation));var l=t.jsPlumbInstance.makeDynamicAnchor(s);return l.type="Perimeter",l}}.call("undefined"!=typeof window?window:this),function(){"use strict";this.jsPlumbUtil;var e=this.jsPlumb;e.DefaultRouter=function(t){this.jsPlumbInstance=t,this.anchorManager=new e.AnchorManager({jsPlumbInstance:t}),this.sourceOrTargetChanged=function(t,e,n,o,i){this.anchorManager.sourceOrTargetChanged(t,e,n,o,i)},this.reset=function(){this.anchorManager.reset()},this.changeId=function(t,e){this.anchorManager.changeId(t,e)},this.elementRemoved=function(t){this.anchorManager.elementRemoved(t)},this.newConnection=function(t){this.anchorManager.newConnection(t)},this.connectionDetached=function(t,e){this.anchorManager.connectionDetached(t,e)},this.redraw=function(t,e,n,o,i,r){return this.anchorManager.redraw(t,e,n,o,i,r)},this.deleteEndpoint=function(t){this.anchorManager.deleteEndpoint(t)},this.rehomeEndpoint=function(t,e,n){this.anchorManager.rehomeEndpoint(t,e,n)},this.addEndpoint=function(t,e){this.anchorManager.addEndpoint(t,e)}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var i=this,v=i.jsPlumb,g=i.jsPlumbUtil,C=i.Biltong;v.Segments={AbstractSegment:function(t){this.params=t,this.findClosestPointOnPath=function(t,e){return{d:1/0,x:null,y:null,l:null}},this.getBounds=function(){return{minX:Math.min(t.x1,t.x2),minY:Math.min(t.y1,t.y2),maxX:Math.max(t.x1,t.x2),maxY:Math.max(t.y1,t.y2)}},this.lineIntersection=function(t,e,n,o){return[]},this.boxIntersection=function(t,e,n,o){var i=[];return i.push.apply(i,this.lineIntersection(t,e,t+n,e)),i.push.apply(i,this.lineIntersection(t+n,e,t+n,e+o)),i.push.apply(i,this.lineIntersection(t+n,e+o,t,e+o)),i.push.apply(i,this.lineIntersection(t,e+o,t,e)),i},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.y)}},Straight:function(t){var a,c,l,h,p,f,g;v.Segments.AbstractSegment.apply(this,arguments);this.type="Straight",this.getLength=function(){return a},this.getGradient=function(){return c},this.getCoordinates=function(){return{x1:h,y1:f,x2:p,y2:g}},this.setCoordinates=function(t){h=t.x1,f=t.y1,p=t.x2,g=t.y2,a=Math.sqrt(Math.pow(p-h,2)+Math.pow(g-f,2)),c=C.gradient({x:h,y:f},{x:p,y:g}),l=-1/c},this.setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),this.getBounds=function(){return{minX:Math.min(h,p),minY:Math.min(f,g),maxX:Math.max(h,p),maxY:Math.max(f,g)}},this.pointOnPath=function(t,e){if(0!==t||e){if(1!==t||e){var n=e?0<t?t:a+t:t*a;return C.pointOnLine({x:h,y:f},{x:p,y:g},n)}return{x:p,y:g}}return{x:h,y:f}},this.gradientAtPoint=function(t){return c},this.pointAlongPathFrom=function(t,e,n){var o=this.pointOnPath(t,n),i=e<=0?{x:h,y:f}:{x:p,y:g};return e<=0&&1<Math.abs(e)&&(e*=-1),C.pointOnLine(o,i,e)};function u(t,e,n){return n>=Math.min(t,e)&&n<=Math.max(t,e)}function d(t,e,n){return Math.abs(n-t)<Math.abs(n-e)?t:e}this.findClosestPointOnPath=function(t,e){var n={d:1/0,x:null,y:null,l:null,x1:h,x2:p,y1:f,y2:g};if(0===c)n.y=f,n.x=u(h,p,t)?t:d(h,p,t);else if(c===1/0||c===-1/0)n.x=h,n.y=u(f,g,e)?e:d(f,g,e);else{var o=f-c*h,i=(e-l*t-o)/(c-l),r=c*i+o;n.x=u(h,p,i)?i:d(h,p,i),n.y=u(f,g,r)?r:d(f,g,r)}var s=C.lineLength([n.x,n.y],[h,f]);return n.d=C.lineLength([t,e],[n.x,n.y]),n.l=s/a,n};var m=function(t,e,n){return e<n?e<=t&&t<=n:t<=e&&n<=t};this.lineIntersection=function(t,e,n,o){var i=Math.abs(C.gradient({x:t,y:e},{x:n,y:o})),r=Math.abs(c),s=r===1/0?h:f-r*h,a=[],l=i===1/0?t:e-i*t;if(i!==r)if(i===1/0&&0===r)m(t,h,p)&&m(f,e,o)&&(a=[t,f]);else if(0===i&&r===1/0)m(e,f,g)&&m(h,t,n)&&(a=[h,e]);else{var u,d;i===1/0?m(u=t,h,p)&&m(d=r*t+s,e,o)&&(a=[u,d]):0===i?m(d=e,f,g)&&m(u=(e-s)/r,t,n)&&(a=[u,d]):(d=r*(u=(l-s)/(r-i))+s,m(u,h,p)&&m(d,f,g)&&(a=[u,d]))}return a},this.boxIntersection=function(t,e,n,o){var i=[];return i.push.apply(i,this.lineIntersection(t,e,t+n,e)),i.push.apply(i,this.lineIntersection(t+n,e,t+n,e+o)),i.push.apply(i,this.lineIntersection(t+n,e+o,t,e+o)),i.push.apply(i,this.lineIntersection(t,e+o,t,e)),i},this.boundingBoxIntersection=function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}},Arc:function(a){function t(t,e){return C.theta([a.cx,a.cy],[t,e])}v.Segments.AbstractSegment.apply(this,arguments);var r=2*Math.PI;this.radius=a.r,this.anticlockwise=a.ac,this.type="Arc",a.startAngle&&a.endAngle?(this.startAngle=a.startAngle,this.endAngle=a.endAngle,this.x1=a.cx+this.radius*Math.cos(a.startAngle),this.y1=a.cy+this.radius*Math.sin(a.startAngle),this.x2=a.cx+this.radius*Math.cos(a.endAngle),this.y2=a.cy+this.radius*Math.sin(a.endAngle)):(this.startAngle=t(a.x1,a.y1),this.endAngle=t(a.x2,a.y2),this.x1=a.x1,this.y1=a.y1,this.x2=a.x2,this.y2=a.y2),this.endAngle<0&&(this.endAngle+=r),this.startAngle<0&&(this.startAngle+=r);var e=this.endAngle<this.startAngle?this.endAngle+r:this.endAngle;this.sweep=Math.abs(e-this.startAngle),this.anticlockwise&&(this.sweep=r-this.sweep);var l=2*Math.PI*this.radius,n=this.sweep/r,s=l*n;this.getLength=function(){return s},this.getBounds=function(){return{minX:a.cx-a.r,maxX:a.cx+a.r,minY:a.cy-a.r,maxY:a.cy+a.r}};function u(t){var e=Math.floor(t),n=Math.ceil(t);return t-e<1e-10?e:n-t<1e-10?n:t}this.pointOnPath=function(t,e){if(0===t)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===t)return{x:this.x2,y:this.y2,theta:this.endAngle};e&&(t/=s);var n=function(t,e){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+r:t.startAngle;return n-Math.abs(n-t.endAngle)*e}var o=t.endAngle<t.startAngle?t.endAngle+r:t.endAngle,i=Math.abs(o-t.startAngle);return t.startAngle+i*e}(this,t),o=a.cx+a.r*Math.cos(n),i=a.cy+a.r*Math.sin(n);return{x:u(o),y:u(i),theta:n}},this.gradientAtPoint=function(t,e){var n=this.pointOnPath(t,e),o=C.normal([a.cx,a.cy],[n.x,n.y]);return this.anticlockwise||o!==1/0&&o!==-1/0||(o*=-1),o},this.pointAlongPathFrom=function(t,e,n){var o=this.pointOnPath(t,n),i=e/l*2*Math.PI,r=this.anticlockwise?-1:1,s=o.theta+r*i;return{x:a.cx+this.radius*Math.cos(s),y:a.cy+this.radius*Math.sin(s)}}},Bezier:function(t){this.curve=[{x:t.x1,y:t.y1},{x:t.cp1x,y:t.cp1y},{x:t.cp2x,y:t.cp2y},{x:t.x2,y:t.y2}];var s=function(t){var e={x:0,y:0};if(0===t)return this.curve[0];var n=this.curve.length-1;if(1===t)return this.curve[n];var o=this.curve,i=1-t;if(0==n)return this.curve[0];if(1==n)return{x:i*o[0].x+t*o[1].x,y:i*o[0].y+t*o[1].y};if(n<4){var r,s,a,l=i*i,u=t*t,d=0;return 2==n?(o=[o[0],o[1],o[2],e],r=l,s=i*t*2,a=u):3==n&&(r=l*i,s=l*t*3,a=i*u*3,d=t*u),{x:r*o[0].x+s*o[1].x+a*o[2].x+d*o[3].x,y:r*o[0].y+s*o[1].y+a*o[2].y+d*o[3].y}}return e}.bind(this),e=function(){!function(t){return t[0].x===t[1].x&&t[0].y===t[1].y}(this.curve)||(this.length=0);for(var t,e,n=function(t){var e=[];t--;for(var n=0;n<=t;n++)e.push(s(n/t));return e}(16),o=this.length=0;o<15;o++){var i=n[o],r=n[o+1];this.length+=(t=i,e=r,Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)))}}.bind(this);v.Segments.AbstractSegment.apply(this,arguments);this.bounds={minX:Math.min(t.x1,t.x2,t.cp1x,t.cp2x),minY:Math.min(t.y1,t.y2,t.cp1y,t.cp2y),maxX:Math.max(t.x1,t.x2,t.cp1x,t.cp2x),maxY:Math.max(t.y1,t.y2,t.cp1y,t.cp2y)},this.type="Bezier",e();function o(t,e,n){return n&&(e=i.jsBezier.locationAlongCurveFrom(t,0<e?0:1,e)),e}this.pointOnPath=function(t,e){return t=o(this.curve,t,e),i.jsBezier.pointOnCurve(this.curve,t)},this.gradientAtPoint=function(t,e){return t=o(this.curve,t,e),i.jsBezier.gradientAtPoint(this.curve,t)},this.pointAlongPathFrom=function(t,e,n){return t=o(this.curve,t,n),i.jsBezier.pointAlongCurveFrom(this.curve,t,e)},this.getLength=function(){return this.length},this.getBounds=function(){return this.bounds},this.findClosestPointOnPath=function(t,e){var n=i.jsBezier.nearestPointOnCurve({x:t,y:e},this.curve);return{d:Math.sqrt(Math.pow(n.point.x-t,2)+Math.pow(n.point.y-e,2)),x:n.point.x,y:n.point.y,l:1-n.location,s:this}},this.lineIntersection=function(t,e,n,o){return i.jsBezier.lineIntersection(t,e,n,o,this.curve)}}},v.SegmentRenderer={getPath:function(i,t){return{Straight:function(t){var e=i.getCoordinates();return(t?"M "+e.x1+" "+e.y1+" ":"")+"L "+e.x2+" "+e.y2},Bezier:function(t){var e=i.params;return(t?"M "+e.x2+" "+e.y2+" ":"")+"C "+e.cp2x+" "+e.cp2y+" "+e.cp1x+" "+e.cp1y+" "+e.x1+" "+e.y1},Arc:function(t){var e=i.params,n=i.sweep>Math.PI?1:0,o=i.anticlockwise?0:1;return(t?"M"+i.x1+" "+i.y1+" ":"")+"A "+i.radius+" "+e.r+" 0 "+n+","+o+" "+i.x2+" "+i.y2}}[i.type](t)}};function c(){this.resetBounds=function(){this.bounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}},this.resetBounds()}v.Connectors.AbstractConnector=function(t){c.apply(this,arguments);var s=[],r=0,a=[],l=[],e=t.stub||0,b=g.isArray(e)?e[0]:e,P=g.isArray(e)?e[1]:e,n=t.gap||0,E=g.isArray(n)?n[0]:n,x=g.isArray(n)?n[1]:n,o=null,i=null;this.getPathData=function(){for(var t="",e=0;e<s.length;e++)t+=v.SegmentRenderer.getPath(s[e],0===e),t+=" ";return t},this.findSegmentForPoint=function(t,e){for(var n={d:1/0,s:null,x:null,y:null,l:null},o=0;o<s.length;o++){var i=s[o].findClosestPointOnPath(t,e);i.d<n.d&&(n.d=i.d,n.l=i.l,n.x=i.x,n.y=i.y,n.s=s[o],n.x1=i.x1,n.x2=i.x2,n.y1=i.y1,n.y2=i.y2,n.index=o,n.connectorLocation=a[o][0]+i.l*(a[o][1]-a[o][0]))}return n},this.lineIntersection=function(t,e,n,o){for(var i=[],r=0;r<s.length;r++)i.push.apply(i,s[r].lineIntersection(t,e,n,o));return i},this.boxIntersection=function(t,e,n,o){for(var i=[],r=0;r<s.length;r++)i.push.apply(i,s[r].boxIntersection(t,e,n,o));return i},this.boundingBoxIntersection=function(t){for(var e=[],n=0;n<s.length;n++)e.push.apply(e,s[n].boundingBoxIntersection(t));return e};function u(t,e){var n,o,i;if(e&&(t=0<t?t/r:(r+t)/r),1===t)n=s.length-1,i=1;else if(0===t)n=i=0;else if(.5<=t){for(i=n=0,o=a.length-1;-1<o;o--)if(a[o][1]>=t&&a[o][0]<=t){i=(t-a[n=o][0])/l[o];break}}else for(n=a.length-1,i=1,o=0;o<a.length;o++)if(a[o][1]>=t){i=(t-a[n=o][0])/l[o];break}return{segment:s[n],proportion:i,index:n}}this.setSegments=function(t){o=[];for(var e=r=0;e<t.length;e++)o.push(t[e]),r+=t[e].getLength()},this.getLength=function(){return r};function d(t){this.strokeWidth=t.strokeWidth;var e=C.quadrant(t.sourcePos,t.targetPos),n=t.targetPos[0]<t.sourcePos[0],o=t.targetPos[1]<t.sourcePos[1],i=t.strokeWidth||1,r=t.sourceEndpoint.anchor.getOrientation(t.sourceEndpoint),s=t.targetEndpoint.anchor.getOrientation(t.targetEndpoint),a=n?t.targetPos[0]:t.sourcePos[0],l=o?t.targetPos[1]:t.sourcePos[1],u=Math.abs(t.targetPos[0]-t.sourcePos[0]),d=Math.abs(t.targetPos[1]-t.sourcePos[1]);if(0===r[0]&&0===r[1]||0===s[0]&&0===s[1]){var c=d<u?0:1,h=[1,0][c];s=[],(r=[])[c]=t.sourcePos[c]>t.targetPos[c]?-1:1,s[c]=t.sourcePos[c]>t.targetPos[c]?1:-1,r[h]=0,s[h]=0}var p=n?u+E*r[0]:E*r[0],f=o?d+E*r[1]:E*r[1],g=n?x*s[0]:u+x*s[0],m=o?x*s[1]:d+x*s[1],v=r[0]*s[0]+r[1]*s[1],y={sx:p,sy:f,tx:g,ty:m,lw:i,xSpan:Math.abs(g-p),ySpan:Math.abs(m-f),mx:(p+g)/2,my:(f+m)/2,so:r,to:s,x:a,y:l,w:u,h:d,segment:e,startStubX:p+r[0]*b,startStubY:f+r[1]*b,endStubX:g+s[0]*P,endStubY:m+s[1]*P,isXGreaterThanStubTimes2:Math.abs(p-g)>b+P,isYGreaterThanStubTimes2:Math.abs(f-m)>b+P,opposite:-1==v,perpendicular:0==v,orthogonal:1==v,sourceAxis:0===r[0]?"y":"x",points:[a,l,u,d,p,f,g,m],stubs:[b,P]};return y.anchorOrientation=y.opposite?"opposite":y.orthogonal?"orthogonal":"perpendicular",y}this.getSegments=function(){return s},this.updateBounds=function(t){var e=t.getBounds();this.bounds.minX=Math.min(this.bounds.minX,e.minX),this.bounds.maxX=Math.max(this.bounds.maxX,e.maxX),this.bounds.minY=Math.min(this.bounds.minY,e.minY),this.bounds.maxY=Math.max(this.bounds.maxY,e.maxY)};return this.pointOnPath=function(t,e){var n=u(t,e);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||[0,0]},this.gradientAtPoint=function(t,e){var n=u(t,e);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0},this.pointAlongPathFrom=function(t,e,n){var o=u(t,n);return o.segment&&o.segment.pointAlongPathFrom(o.proportion,e,!1)||[0,0]},this.compute=function(t){i=d.call(this,t),r=s.length=a.length=l.length=0,this._compute(i,t),this.x=i.points[0],this.y=i.points[1],this.w=i.points[2],this.h=i.points[3],this.segment=i.segment,function(){for(var t=0,e=0;e<s.length;e++){var n=s[e].getLength();l[e]=n/r,a[e]=[t,t+=n/r]}}()},{addSegment:function(t,e,n){if(n.x1!==n.x2||n.y1!==n.y2){var o=new v.Segments[e](n);s.push(o),r+=o.getLength(),t.updateBounds(o)}},prepareCompute:d,sourceStub:b,targetStub:P,maxStub:Math.max(b,P),sourceGap:E,targetGap:x,maxGap:Math.max(E,x)}},g.extend(v.Connectors.AbstractConnector,c),v.Endpoints.AbstractEndpoint=function(t){return c.apply(this,arguments),{compute:this.compute=function(t,e,n,o){var i=this._compute.apply(this,arguments);return this.x=i[0],this.y=i[1],this.w=i[2],this.h=i[3],this.bounds.minX=this.x,this.bounds.minY=this.y,this.bounds.maxX=this.x+this.w,this.bounds.maxY=this.y+this.h,i},cssClass:t.cssClass}},g.extend(v.Endpoints.AbstractEndpoint,c),v.Endpoints.Dot=function(t){this.type="Dot";v.Endpoints.AbstractEndpoint.apply(this,arguments);t=t||{},this.radius=t.radius||10,this.defaultOffset=.5*this.radius,this.defaultInnerRadius=this.radius/3,this._compute=function(t,e,n,o){this.radius=n.radius||this.radius;var i=t[0]-this.radius,r=t[1]-this.radius,s=2*this.radius,a=2*this.radius;if(n.stroke){var l=n.strokeWidth||1;i-=l,r-=l,s+=2*l,a+=2*l}return[i,r,s,a,this.radius]}},g.extend(v.Endpoints.Dot,v.Endpoints.AbstractEndpoint),v.Endpoints.Rectangle=function(t){this.type="Rectangle";v.Endpoints.AbstractEndpoint.apply(this,arguments);t=t||{},this.width=t.width||20,this.height=t.height||20,this._compute=function(t,e,n,o){var i=n.width||this.width,r=n.height||this.height;return[t[0]-i/2,t[1]-r/2,i,r]}},g.extend(v.Endpoints.Rectangle,v.Endpoints.AbstractEndpoint);function r(t){v.jsPlumbUIComponent.apply(this,arguments),this._jsPlumb.displayElements=[]}g.extend(r,v.jsPlumbUIComponent,{getDisplayElements:function(){return this._jsPlumb.displayElements},appendDisplayElement:function(t){this._jsPlumb.displayElements.push(t)}}),v.Endpoints.Image=function(t){this.type="Image",r.apply(this,arguments),v.Endpoints.AbstractEndpoint.apply(this,arguments);var o=t.onload,e=t.src||t.url,n=t.cssClass?" "+t.cssClass:"";this._jsPlumb.img=new Image,this._jsPlumb.ready=!1,this._jsPlumb.initialized=!1,this._jsPlumb.deleted=!1,this._jsPlumb.widthToUse=t.width,this._jsPlumb.heightToUse=t.height,this._jsPlumb.endpoint=t.endpoint,this._jsPlumb.img.onload=function(){null!=this._jsPlumb&&(this._jsPlumb.ready=!0,this._jsPlumb.widthToUse=this._jsPlumb.widthToUse||this._jsPlumb.img.width,this._jsPlumb.heightToUse=this._jsPlumb.heightToUse||this._jsPlumb.img.height,o&&o(this))}.bind(this),this._jsPlumb.endpoint.setImage=function(t,e){var n=t.constructor===String?t:t.src;o=e,this._jsPlumb.img.src=n,null!=this.canvas&&this.canvas.setAttribute("src",this._jsPlumb.img.src)}.bind(this),this._jsPlumb.endpoint.setImage(e,o),this._compute=function(t,e,n,o){return this.anchorPoint=t,this._jsPlumb.ready?[t[0]-this._jsPlumb.widthToUse/2,t[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse]:[0,0,0,0]},this.canvas=v.createElement("img",{position:"absolute",margin:0,padding:0,outline:0},this._jsPlumb.instance.endpointClass+n),this._jsPlumb.widthToUse&&this.canvas.setAttribute("width",this._jsPlumb.widthToUse),this._jsPlumb.heightToUse&&this.canvas.setAttribute("height",this._jsPlumb.heightToUse),this._jsPlumb.instance.appendElement(this.canvas),this.actuallyPaint=function(t,e,n){if(!this._jsPlumb.deleted){this._jsPlumb.initialized||(this.canvas.setAttribute("src",this._jsPlumb.img.src),this.appendDisplayElement(this.canvas),this._jsPlumb.initialized=!0);var o=this.anchorPoint[0]-this._jsPlumb.widthToUse/2,i=this.anchorPoint[1]-this._jsPlumb.heightToUse/2;g.sizeElement(this.canvas,o,i,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse)}},this.paint=function(t,e){null!=this._jsPlumb&&(this._jsPlumb.ready?this.actuallyPaint(t,e):i.setTimeout(function(){this.paint(t,e)}.bind(this),200))}},g.extend(v.Endpoints.Image,[r,v.Endpoints.AbstractEndpoint],{cleanup:function(t){t&&(this._jsPlumb.deleted=!0,this.canvas&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=null)}}),v.Endpoints.Blank=function(t){v.Endpoints.AbstractEndpoint.apply(this,arguments);this.type="Blank",r.apply(this,arguments),this._compute=function(t,e,n,o){return[t[0],t[1],10,0]};var e=t.cssClass?" "+t.cssClass:"";this.canvas=v.createElement("div",{display:"block",width:"1px",height:"1px",background:"transparent",position:"absolute"},this._jsPlumb.instance.endpointClass+e),this._jsPlumb.instance.appendElement(this.canvas),this.paint=function(t,e){g.sizeElement(this.canvas,this.x,this.y,this.w,this.h)}},g.extend(v.Endpoints.Blank,[v.Endpoints.AbstractEndpoint,r],{cleanup:function(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}),v.Endpoints.Triangle=function(t){this.type="Triangle",v.Endpoints.AbstractEndpoint.apply(this,arguments);var s=this;(t=t||{}).width=t.width||55,t.height=t.height||55,this.width=t.width,this.height=t.height,this._compute=function(t,e,n,o){var i=n.width||s.width,r=n.height||s.height;return[t[0]-i/2,t[1]-r/2,i,r]}};var e=v.Overlays.AbstractOverlay=function(t){this.visible=!0,this.isAppendedAtTopLevel=!0,this.component=t.component,this.loc=null==t.location?.5:t.location,this.endpointLoc=null==t.endpointLocation?[.5,.5]:t.endpointLocation,this.visible=!1!==t.visible};e.prototype={cleanup:function(t){t&&(this.component=null,this.canvas=null,this.endpointLoc=null)},reattach:function(t,e){},setVisible:function(t){this.visible=t,this.component.repaint()},isVisible:function(){return this.visible},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},incrementLocation:function(t){this.loc+=t,this.component.repaint()},setLocation:function(t){this.loc=t,this.component.repaint()},getLocation:function(){return this.loc},updateFrom:function(){}},v.Overlays.Arrow=function(o){this.type="Arrow",e.apply(this,arguments),this.isAppendedAtTopLevel=!1,o=o||{};var t=this;this.length=o.length||20,this.width=o.width||20,this.id=o.id,this.direction=(o.direction||1)<0?-1:1;var p=o.paintStyle||{"stroke-width":1},f=o.foldback||.623;this.computeMaxSize=function(){return 1.5*t.width},this.elementCreated=function(t,e){if(this.path=t,o.events)for(var n in o.events)v.on(t,n,o.events[n])},this.draw=function(t,e){var n,o,i,r;if(t.pointAlongPathFrom){if(g.isString(this.loc)||1<this.loc||this.loc<0){var s=parseInt(this.loc,10),a=this.loc<0?1:0;n=t.pointAlongPathFrom(a,s,!1),o=t.pointAlongPathFrom(a,s-this.direction*this.length/2,!1),i=C.pointOnLine(n,o,this.length)}else if(1===this.loc){if(n=t.pointOnPath(this.loc),o=t.pointAlongPathFrom(this.loc,-this.length),i=C.pointOnLine(n,o,this.length),-1===this.direction){var l=i;i=n,n=l}}else if(0===this.loc){if(i=t.pointOnPath(this.loc),o=t.pointAlongPathFrom(this.loc,this.length),n=C.pointOnLine(i,o,this.length),-1===this.direction){var u=i;i=n,n=u}}else n=t.pointAlongPathFrom(this.loc,this.direction*this.length/2),o=t.pointOnPath(this.loc),i=C.pointOnLine(n,o,this.length);var d={hxy:n,tail:r=C.perpendicularLineTo(n,i,this.width),cxy:C.pointOnLine(n,i,f*this.length)},c=p.stroke||e.stroke,h=p.fill||e.stroke;return{component:t,d:d,"stroke-width":p.strokeWidth||e.strokeWidth,stroke:c,fill:h,minX:Math.min(n.x,r[0].x,r[1].x),maxX:Math.max(n.x,r[0].x,r[1].x),minY:Math.min(n.y,r[0].y,r[1].y),maxY:Math.max(n.y,r[0].y,r[1].y)}}return{component:t,minX:0,maxX:0,minY:0,maxY:0}}},g.extend(v.Overlays.Arrow,e,{updateFrom:function(t){this.length=t.length||this.length,this.width=t.width||this.width,this.direction=null!=t.direction?t.direction:this.direction,this.foldback=t.foldback||this.foldback},cleanup:function(){this.path&&this.path.parentNode&&this.path.parentNode.removeChild(this.path)}}),v.Overlays.PlainArrow=function(t){t=t||{};var e=v.extend(t,{foldback:1});v.Overlays.Arrow.call(this,e),this.type="PlainArrow"},g.extend(v.Overlays.PlainArrow,v.Overlays.Arrow),v.Overlays.Diamond=function(t){var e=(t=t||{}).length||40,n=v.extend(t,{length:e/2,foldback:2});v.Overlays.Arrow.call(this,n),this.type="Diamond"},g.extend(v.Overlays.Diamond,v.Overlays.Arrow);function d(t,e){return null!=t._jsPlumb.cachedDimensions&&!e||(t._jsPlumb.cachedDimensions=t.getDimensions()),t._jsPlumb.cachedDimensions}function n(n){v.jsPlumbUIComponent.apply(this,arguments),e.apply(this,arguments);var t=this.fire;this.fire=function(){t.apply(this,arguments),this.component&&this.component.fire.apply(this.component,arguments)},this.detached=!1,this.id=n.id,this._jsPlumb.div=null,this._jsPlumb.initialised=!1,this._jsPlumb.component=n.component,this._jsPlumb.cachedDimensions=null,this._jsPlumb.create=n.create,this._jsPlumb.initiallyInvisible=!1===n.visible,this.getElement=function(){if(null==this._jsPlumb.div){var t=this._jsPlumb.div=v.getElement(this._jsPlumb.create(this._jsPlumb.component));t.style.position="absolute",jsPlumb.addClass(t,this._jsPlumb.instance.overlayClass+" "+(this.cssClass?this.cssClass:n.cssClass?n.cssClass:"")),this._jsPlumb.instance.appendElement(t),this._jsPlumb.instance.getId(t);var e="translate(-50%, -50%)";(this.canvas=t).style.webkitTransform=e,t.style.mozTransform=e,t.style.msTransform=e,t.style.oTransform=e,t.style.transform=e,t._jsPlumb=this,!1===n.visible&&(t.style.display="none")}return this._jsPlumb.div},this.draw=function(t,e,n){var o=d(this);if(null==o||2!==o.length)return{minX:0,maxX:0,minY:0,maxY:0};var i={x:0,y:0};if(n)i={x:n[0],y:n[1]};else if(t.pointOnPath){var r=this.loc,s=!1;(g.isString(this.loc)||this.loc<0||1<this.loc)&&(r=parseInt(this.loc,10),s=!0),i=t.pointOnPath(r,s)}else{var a=this.loc.constructor===Array?this.loc:this.endpointLoc;i={x:a[0]*t.w,y:a[1]*t.h}}var l=i.x-o[0]/2,u=i.y-o[1]/2;return{component:t,d:{minx:l,miny:u,td:o,cxy:i},minX:l,maxX:l+o[0],minY:u,maxY:u+o[1]}}}g.extend(n,[v.jsPlumbUIComponent,e],{getDimensions:function(){return[1,1]},setVisible:function(t){this._jsPlumb.div&&(this._jsPlumb.div.style.display=t?"block":"none",t&&this._jsPlumb.initiallyInvisible&&(d(this,!0),this.component.repaint(),this._jsPlumb.initiallyInvisible=!1))},clearCachedDimensions:function(){this._jsPlumb.cachedDimensions=null},cleanup:function(t){t?null!=this._jsPlumb.div&&(this._jsPlumb.div._jsPlumb=null,this._jsPlumb.instance.removeElement(this._jsPlumb.div)):(this._jsPlumb&&this._jsPlumb.div&&this._jsPlumb.div.parentNode&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div),this.detached=!0)},reattach:function(t,e){null!=this._jsPlumb.div&&t.getContainer().appendChild(this._jsPlumb.div),this.detached=!1},computeMaxSize:function(){var t=d(this);return Math.max(t[0],t[1])},paint:function(t,e){this._jsPlumb.initialised||(this.getElement(),t.component.appendDisplayElement(this._jsPlumb.div),this._jsPlumb.initialised=!0,this.detached&&this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div)),this._jsPlumb.div.style.left=t.component.x+t.d.minx+"px",this._jsPlumb.div.style.top=t.component.y+t.d.miny+"px"}}),v.Overlays.Custom=function(t){this.type="Custom",n.apply(this,arguments)},g.extend(v.Overlays.Custom,n),v.Overlays.GuideLines=function(){var a=this;a.length=50,a.strokeWidth=5,this.type="GuideLines",e.apply(this,arguments),v.jsPlumbUIComponent.apply(this,arguments),this.draw=function(t,e){var n=t.pointAlongPathFrom(a.loc,a.length/2),o=t.pointOnPath(a.loc),i=C.pointOnLine(n,o,a.length),r=C.perpendicularLineTo(n,i,40),s=C.perpendicularLineTo(i,n,20);return{connector:t,head:n,tail:i,headLine:s,tailLine:r,minX:Math.min(n.x,i.x,s[0].x,s[1].x),minY:Math.min(n.y,i.y,s[0].y,s[1].y),maxX:Math.max(n.x,i.x,s[0].x,s[1].x),maxY:Math.max(n.y,i.y,s[0].y,s[1].y)}}},v.Overlays.Label=function(t){this.labelStyle=t.labelStyle;this.cssClass=null!=this.labelStyle?this.labelStyle.cssClass:null;var e=v.extend({create:function(){return v.createElement("div")}},t);if(v.Overlays.Custom.call(this,e),this.type="Label",this.label=t.label||"",this.labelText=null,this.labelStyle){var n=this.getElement();if(this.labelStyle.font=this.labelStyle.font||"12px sans-serif",n.style.font=this.labelStyle.font,n.style.color=this.labelStyle.color||"black",this.labelStyle.fill&&(n.style.background=this.labelStyle.fill),0<this.labelStyle.borderWidth){var o=this.labelStyle.borderStyle?this.labelStyle.borderStyle:"black";n.style.border=this.labelStyle.borderWidth+"px solid "+o}this.labelStyle.padding&&(n.style.padding=this.labelStyle.padding)}},g.extend(v.Overlays.Label,v.Overlays.Custom,{cleanup:function(t){t&&(this.div=null,this.label=null,this.labelText=null,this.cssClass=null,this.labelStyle=null)},getLabel:function(){return this.label},setLabel:function(t){this.label=t,this.labelText=null,this.clearCachedDimensions(),this.update(),this.component.repaint()},getDimensions:function(){return this.update(),n.prototype.getDimensions.apply(this,arguments)},update:function(){if("function"==typeof this.label){var t=this.label(this);this.getElement().innerHTML=t.replace(/\r\n/g,"<br/>")}else null==this.labelText&&(this.labelText=this.label,this.getElement().innerHTML=this.labelText.replace(/\r\n/g,"<br/>"))},updateFrom:function(t){null!=t.label&&this.setLabel(t.label)}})}.call("undefined"!=typeof window?window:this),function(){"use strict";var e=this.jsPlumb,t=this.jsPlumbUtil;e.Connectors.AbstractBezierConnector=function(t){var h,p=!1!==(t=t||{}).showLoopback,f=(t.curviness,t.margin||5),g=(t.proximityLimit,t.orientation&&"clockwise"===t.orientation),m=t.loopbackRadius||25;return this._compute=function(t,e){var n=e.sourcePos,o=e.targetPos,i=Math.abs(n[0]-o[0]),r=Math.abs(n[1]-o[1]);if(p&&e.sourceEndpoint.elementId===e.targetEndpoint.elementId){!0;var s=e.sourcePos[0],a=e.sourcePos[1]-f,l=s,u=a-m,d=l-m,c=u-m;r=i=2*m,t.points[0]=d,t.points[1]=c,t.points[2]=i,t.points[3]=r,h.addSegment(this,"Arc",{loopback:!0,x1:s-d+4,y1:a-c,startAngle:0,endAngle:2*Math.PI,r:m,ac:!g,x2:s-d-4,y2:a-c,cx:l-d,cy:u-c})}else!1,this._computeBezier(t,e,n,o,i,r)},h=e.Connectors.AbstractConnector.apply(this,arguments)},t.extend(e.Connectors.AbstractBezierConnector,e.Connectors.AbstractConnector);function n(t){t=t||{},this.type="Bezier";var h=e.Connectors.AbstractBezierConnector.apply(this,arguments),l=t.curviness||150;this.getCurviness=function(){return l},this._findControlPoint=function(t,e,n,o,i,r,s){var a=[];return r[0]!==s[0]||r[1]===s[1]?(0===s[0]?a.push(n[0]<e[0]?t[0]+10:t[0]-10):a.push(t[0]+l*s[0]),0===s[1]?a.push(n[1]<e[1]?t[1]+10:t[1]-10):a.push(t[1]+l*r[1])):(0===r[0]?a.push(e[0]<n[0]?t[0]+10:t[0]-10):a.push(t[0]-l*r[0]),0===r[1]?a.push(e[1]<n[1]?t[1]+10:t[1]-10):a.push(t[1]+l*s[1])),a},this._computeBezier=function(t,e,n,o,i,r){var s,a,l=n[0]<o[0]?i:0,u=n[1]<o[1]?r:0,d=n[0]<o[0]?0:i,c=n[1]<o[1]?0:r;s=this._findControlPoint([l,u],n,o,e.sourceEndpoint,e.targetEndpoint,t.so,t.to),a=this._findControlPoint([d,c],o,n,e.targetEndpoint,e.sourceEndpoint,t.to,t.so),h.addSegment(this,"Bezier",{x1:l,y1:u,x2:d,y2:c,cp1x:s[0],cp1y:s[1],cp2x:a[0],cp2y:a[1]})}}e.Connectors.Bezier=n,t.extend(n,e.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";function t(t){t=t||{},this.type="StateMachine";var y,b=e.Connectors.AbstractBezierConnector.apply(this,arguments),P=t.curviness||10,E=t.margin||5,x=t.proximityLimit||80;t.orientation&&t.orientation,this._computeBezier=function(t,e,n,o,i,r){var s=e.sourcePos[0]<e.targetPos[0]?0:i,a=e.sourcePos[1]<e.targetPos[1]?0:r,l=e.sourcePos[0]<e.targetPos[0]?i:0,u=e.sourcePos[1]<e.targetPos[1]?r:0;0===e.sourcePos[2]&&(s-=E),1===e.sourcePos[2]&&(s+=E),0===e.sourcePos[3]&&(a-=E),1===e.sourcePos[3]&&(a+=E),0===e.targetPos[2]&&(l-=E),1===e.targetPos[2]&&(l+=E),0===e.targetPos[3]&&(u-=E),1===e.targetPos[3]&&(u+=E);var d,c,h,p,f=(s+l)/2,g=(a+u)/2,m=function(t,e,n,o){return t<=n&&o<=e?1:t<=n&&e<=o?2:n<=t&&e<=o?3:4}(s,a,l,u),v=Math.sqrt(Math.pow(l-s,2)+Math.pow(u-a,2));d=(y=function(t,e,n,o,i,r,s,a,l){return a<=l?[t,e]:1===n?o[3]<=0&&1<=i[3]?[t+(o[2]<.5?-1*r:r),e]:1<=o[2]&&i[2]<=0?[t,e+(o[3]<.5?-1*s:s)]:[t+-1*r,e+-1*s]:2===n?1<=o[3]&&i[3]<=0?[t+(o[2]<.5?-1*r:r),e]:1<=o[2]&&i[2]<=0?[t,e+(o[3]<.5?-1*s:s)]:[t+r,e+-1*s]:3===n?1<=o[3]&&i[3]<=0?[t+(o[2]<.5?-1*r:r),e]:o[2]<=0&&1<=i[2]?[t,e+(o[3]<.5?-1*s:s)]:[t+-1*r,e+-1*s]:4===n?o[3]<=0&&1<=i[3]?[t+(o[2]<.5?-1*r:r),e]:o[2]<=0&&1<=i[2]?[t,e+(o[3]<.5?-1*s:s)]:[t+r,e+-1*s]:void 0}(f,g,m,e.sourcePos,e.targetPos,P,P,v,x))[0],c=y[0],h=y[1],p=y[1],b.addSegment(this,"Bezier",{x1:l,y1:u,x2:s,y2:a,cp1x:d,cp1y:h,cp2x:c,cp2y:p})}}var e=this.jsPlumb,n=this.jsPlumbUtil;e.Connectors.StateMachine=t,n.extend(t,e.Connectors.AbstractBezierConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";var n=this.jsPlumb,t=this.jsPlumbUtil,w="Straight";n.Connectors.Flowchart=function(t){this.type="Flowchart",(t=t||{}).stub=null==t.stub?30:t.stub;function e(t){return t<0?-1:0===t?0:1}function P(t){return[e(t[2]-t[0]),e(t[3]-t[1])]}function c(t,e,n,o){if(g!==e||j!==n){var i=null==g?o.sx:g,r=null==j?o.sy:j,s=i===e?"v":"h";g=e,j=n,t.push([i,r,e,n,s])}}function E(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))}function x(t){var e=[];return e.push.apply(e,t),e}var h,C=n.Connectors.AbstractConnector.apply(this,arguments),p=null==t.midpoint?.5:t.midpoint,f=!0===t.alwaysRespectStubs,g=null,j=null,_=null!=t.cornerRadius?t.cornerRadius:0;t.loopbackRadius;this._compute=function(m,u){h=[],j=g=null;function t(){return[m.startStubX,m.startStubY,m.endStubX,m.endStubY]}var e={perpendicular:t,orthogonal:t,opposite:function(t){var e=m,n="x"===t?0:1;return!f&&{x:function(){return 1===e.so[n]&&(e.startStubX>e.endStubX&&e.tx>e.startStubX||e.sx>e.endStubX&&e.tx>e.sx)||-1===e.so[n]&&(e.startStubX<e.endStubX&&e.tx<e.startStubX||e.sx<e.endStubX&&e.tx<e.sx)},y:function(){return 1===e.so[n]&&(e.startStubY>e.endStubY&&e.ty>e.startStubY||e.sy>e.endStubY&&e.ty>e.sy)||-1===e.so[n]&&(e.startStubY<e.endStubY&&e.ty<e.startStubY||e.sy<e.endStubY&&e.ty<e.sy)}}[t]()?{x:[(m.sx+m.tx)/2,m.startStubY,(m.sx+m.tx)/2,m.endStubY],y:[m.startStubX,(m.sy+m.ty)/2,m.endStubX,(m.sy+m.ty)/2]}[t]:[m.startStubX,m.startStubY,m.endStubX,m.endStubY]}}[m.anchorOrientation](m.sourceAxis),d="x"===m.sourceAxis?0:1,n="x"===m.sourceAxis?1:0,o=e[d],i=e[n],r=e[2+d],s=e[2+n];c(h,e[0],e[1],m);var v=m.startStubX+(m.endStubX-m.startStubX)*p,y=m.startStubY+(m.endStubY-m.startStubY)*p,b={x:[0,1],y:[1,0]},a={perpendicular:function(t){var e=m,n={x:[[e.startStubX,e.endStubX],null,[e.endStubX,e.startStubX]],y:[[e.startStubY,e.endStubY],null,[e.endStubY,e.startStubY]]},o={x:[[v,e.startStubY],[v,e.endStubY]],y:[[e.startStubX,y],[e.endStubX,y]]},i={x:[[e.endStubX,e.startStubY]],y:[[e.startStubX,e.endStubY]]},r={x:[[e.startStubX,e.endStubY],[e.endStubX,e.endStubY]],y:[[e.endStubX,e.startStubY],[e.endStubX,e.endStubY]]},s={x:[[e.startStubX,y],[e.endStubX,y],[e.endStubX,e.endStubY]],y:[[v,e.startStubY],[v,e.endStubY],[e.endStubX,e.endStubY]]},a={x:[e.startStubY,e.endStubY],y:[e.startStubX,e.endStubX]},l=b[t][0],u=b[t][1],d=e.so[l]+1,c=e.to[u]+1,h=-1===e.to[u]&&a[t][1]<a[t][0]||1===e.to[u]&&a[t][1]>a[t][0],p=n[t][d][0],f=n[t][d][1],g={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[t][d][c];return e.segment===g[3]||e.segment===g[2]&&h?o[t]:e.segment===g[2]&&f<p?i[t]:e.segment===g[2]&&p<=f||e.segment===g[1]&&!h?s[t]:e.segment===g[0]||e.segment===g[1]&&h?r[t]:void 0},orthogonal:function(t,e,n,o,i){var r=m,s={x:-1===r.so[0]?Math.min(e,o):Math.max(e,o),y:-1===r.so[1]?Math.min(e,o):Math.max(e,o)}[t];return{x:[[s,n],[s,i],[o,i]],y:[[n,s],[i,s],[i,o]]}[t]},opposite:function(t,e,n,o){var i=m,r={x:"y",y:"x"}[t],s={x:"height",y:"width"}[t],a=i["is"+t.toUpperCase()+"GreaterThanStubTimes2"];if(u.sourceEndpoint.elementId!==u.targetEndpoint.elementId)return!a||1===i.so[d]&&o<e||-1===i.so[d]&&e<o?{x:[[e,y],[o,y]],y:[[v,e],[v,o]]}[t]:1===i.so[d]&&e<o||-1===i.so[d]&&o<e?{x:[[v,i.sy],[v,i.ty]],y:[[i.sx,y],[i.tx,y]]}[t]:void 0;var l=n+(1-u.sourceEndpoint.anchor[r])*u.sourceInfo[s]+C.maxStub;return{x:[[e,l],[o,l]],y:[[l,e],[l,o]]}[t]}}[m.anchorOrientation](m.sourceAxis,o,i,r,s);if(a)for(var l=0;l<a.length;l++)c(h,a[l][0],a[l][1],m);c(h,e[2],e[3],m),c(h,m.tx,m.ty,m),function(t,e,n){for(var o,i,r,s=null,a=0;a<e.length-1;a++){if(s=s||x(e[a]),o=x(e[a+1]),i=P(s),r=P(o),0<_&&s[4]!==o[4]){var l=Math.min(E(s),E(o)),u=Math.min(_,l/2);s[2]-=i[0]*u,s[3]-=i[1]*u,o[0]+=r[0]*u,o[1]+=r[1]*u;var d=i[1]===r[0]&&1===r[0]||i[1]===r[0]&&0===r[0]&&i[0]!==r[1]||i[1]===r[0]&&-1===r[0],c=(o[1]>s[3]?1:-1)==(o[0]>s[2]?1:-1),h=c&&d||!c&&!d?o[0]:s[2],p=c&&d||!c&&!d?s[3]:o[1];C.addSegment(t,w,{x1:s[0],y1:s[1],x2:s[2],y2:s[3]}),C.addSegment(t,"Arc",{r:u,x1:s[2],y1:s[3],x2:o[0],y2:o[1],cx:h,cy:p,ac:d})}else{var f=s[2]===s[0]?0:s[2]>s[0]?n.lw/2:-n.lw/2,g=s[3]===s[1]?0:s[3]>s[1]?n.lw/2:-n.lw/2;C.addSegment(t,w,{x1:s[0]-f,y1:s[1]-g,x2:s[2]+f,y2:s[3]+g})}s=o}null!=o&&C.addSegment(t,w,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]})}(this,h,m)}},t.extend(n.Connectors.Flowchart,n.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";function t(t){this.type=o;var n=e.Connectors.AbstractConnector.apply(this,arguments);this._compute=function(t,e){n.addSegment(this,o,{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),n.addSegment(this,o,{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),n.addSegment(this,o,{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty})}}var e=this.jsPlumb,n=this.jsPlumbUtil,o="Straight";e.Connectors.Straight=t,n.extend(t,e.Connectors.AbstractConnector)}.call("undefined"!=typeof window?window:this),function(){"use strict";function c(t,e){for(var n in e)t.setAttribute(n,""+e[n])}function p(t,e){return(e=e||{}).version="1.1",e.xmlns=n,m.createElementNS(n,t,null,null,e)}function l(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"}function f(t){for(var e=t.querySelectorAll(" defs,linearGradient,radialGradient"),n=0;n<e.length;n++)e[n].parentNode.removeChild(e[n])}function h(t,e,n,o,i){if(e.setAttribute("fill",n.fill?n.fill:"none"),e.setAttribute("stroke",n.stroke?n.stroke:"none"),n.gradient?function(t,e,n,o,i){var r,s="jsplumb_gradient_"+i._jsPlumb.instance.idstamp();f(t),r=n.gradient.offset?p("radialGradient",{id:s}):p("linearGradient",{id:s,gradientUnits:"userSpaceOnUse"});var a=p("defs");t.appendChild(a),a.appendChild(r);for(var l=0;l<n.gradient.stops.length;l++){var u=1===i.segment||2===i.segment?l:n.gradient.stops.length-1-l,d=n.gradient.stops[u][1],c=p("stop",{offset:Math.floor(100*n.gradient.stops[l][0])+"%","stop-color":d});r.appendChild(c)}var h=n.stroke?"stroke":"fill";e.setAttribute(h,"url(#"+s+")")}(t,e,n,0,i):(f(t),e.setAttribute("style","")),n.strokeWidth&&e.setAttribute("stroke-width",n.strokeWidth),n[y]&&n.strokeWidth&&!n[v]){var r=-1===n[y].indexOf(",")?" ":",",s=n[y].split(r),a="";s.forEach(function(t){a+=Math.floor(t*n.strokeWidth)+r}),e.setAttribute(v,a)}else n[v]&&e.setAttribute(v,n[v]);for(var l in d)n[l]&&e.setAttribute(d[l],n[l])}function g(t,e,n){t.childNodes.length>n?t.insertBefore(e,t.childNodes[n]):t.appendChild(e)}var m=this.jsPlumb,u=this.jsPlumbUtil,d={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},v="stroke-dasharray",y="dashstyle",n="http://www.w3.org/2000/svg";u.svg={node:p,attr:c,pos:l};function e(s){var t=s.pointerEventsSpec||"all",a={};m.jsPlumbUIComponent.apply(this,s.originalArgs),this.canvas=null,this.path=null,this.svg=null,this.bgCanvas=null;var e=s.cssClass+" "+(s.originalArgs[0].cssClass||""),n={style:"",width:0,height:0,"pointer-events":t,position:"absolute"};this.svg=p("svg",n),s.useDivWrapper?(this.canvas=m.createElement("div",{position:"absolute"}),u.sizeElement(this.canvas,0,0,1,1),this.canvas.className=e):(c(this.svg,{class:e}),this.canvas=this.svg),s._jsPlumb.appendElement(this.canvas,s.originalArgs[0].parent),s.useDivWrapper&&this.canvas.appendChild(this.svg);var o=[this.canvas];return this.getDisplayElements=function(){return o},this.appendDisplayElement=function(t){o.push(t)},this.paint=function(t,e,n){if(null!=t){var o,i=[this.x,this.y],r=[this.w,this.h];null!=n&&(n.xmin<0&&(i[0]+=n.xmin),n.ymin<0&&(i[1]+=n.ymin),r[0]=n.xmax+(n.xmin<0?-n.xmin:0),r[1]=n.ymax+(n.ymin<0?-n.ymin:0)),o=s.useDivWrapper?(u.sizeElement(this.canvas,i[0],i[1],0<r[0]?r[0]:1,0<r[1]?r[1]:1),i[0]=0,i[1]=0,l([0,0])):l([i[0],i[1]]),a.paint.apply(this,arguments),c(this.svg,{style:o,width:r[0]||1,height:r[1]||1})}},{renderer:a}}u.extend(e,m.jsPlumbUIComponent,{cleanup:function(t){t||null==this.typeId?(this.canvas&&(this.canvas._jsPlumb=null),this.svg&&(this.svg._jsPlumb=null),this.bgCanvas&&(this.bgCanvas._jsPlumb=null),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.svg=null,this.canvas=null,this.path=null,this.group=null,this._jsPlumb=null):(this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.bgCanvas&&this.bgCanvas.parentNode&&this.bgCanvas.parentNode.removeChild(this.bgCanvas))},reattach:function(t){var e=t.getContainer();this.canvas&&null==this.canvas.parentNode&&e.appendChild(this.canvas),this.bgCanvas&&null==this.bgCanvas.parentNode&&e.appendChild(this.bgCanvas)},setVisible:function(t){this.canvas&&(this.canvas.style.display=t?"block":"none")}}),m.ConnectorRenderers.svg=function(u){var d=this;e.apply(this,[{cssClass:u._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",_jsPlumb:u._jsPlumb}]).renderer.paint=function(t,e,n){var o=d.getSegments(),i=[0,0];if(n.xmin<0&&(i[0]=-n.xmin),n.ymin<0&&(i[1]=-n.ymin),0<o.length){var r={d:d.getPathData(),transform:"translate("+i[0]+","+i[1]+")","pointer-events":u["pointer-events"]||"visibleStroke"},s=null;d.x,d.y,d.w,d.h;if(t.outlineStroke){var a=t.outlineWidth||1,l=t.strokeWidth+2*a;delete(s=m.extend({},t)).gradient,s.stroke=t.outlineStroke,s.strokeWidth=l,null==d.bgPath?(d.bgPath=p("path",r),m.addClass(d.bgPath,m.connectorOutlineClass),g(d.svg,d.bgPath,0)):c(d.bgPath,r),h(d.svg,d.bgPath,s,0,d)}null==d.path?(d.path=p("path",r),g(d.svg,d.path,t.outlineStroke?1:0)):c(d.path,r),h(d.svg,d.path,t,0,d)}}},u.extend(m.ConnectorRenderers.svg,e);var t=m.SvgEndpoint=function(t){e.apply(this,[{cssClass:t._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:!0,_jsPlumb:t._jsPlumb}]).renderer.paint=function(t){var e=m.extend({},t);e.outlineStroke&&(e.stroke=e.outlineStroke),null==this.node?(this.node=this.makeNode(e),this.svg.appendChild(this.node)):null!=this.updateNode&&this.updateNode(this.node),h(this.svg,this.node,e,(this.x,this.y,this.w,this.h),this),l(this.node,(this.x,this.y))}.bind(this)};u.extend(t,e),m.Endpoints.svg.Dot=function(){m.Endpoints.Dot.apply(this,arguments),t.apply(this,arguments),this.makeNode=function(t){return p("circle",{cx:this.w/2,cy:this.h/2,r:this.radius})},this.updateNode=function(t){c(t,{cx:this.w/2,cy:this.h/2,r:this.radius})}},u.extend(m.Endpoints.svg.Dot,[m.Endpoints.Dot,t]),m.Endpoints.svg.Rectangle=function(){m.Endpoints.Rectangle.apply(this,arguments),t.apply(this,arguments),this.makeNode=function(t){return p("rect",{width:this.w,height:this.h})},this.updateNode=function(t){c(t,{width:this.w,height:this.h})}},u.extend(m.Endpoints.svg.Rectangle,[m.Endpoints.Rectangle,t]),m.Endpoints.svg.Image=m.Endpoints.Image,m.Endpoints.svg.Blank=m.Endpoints.Blank,m.Overlays.svg.Label=m.Overlays.Label,m.Overlays.svg.Custom=m.Overlays.Custom;function o(t,i){t.apply(this,i),m.jsPlumbUIComponent.apply(this,i),this.isAppendedAtTopLevel=!1,this.path=null,this.paint=function(t,e){if(t.component.svg&&e){null==this.path&&(this.path=p("path",{"pointer-events":"all"}),t.component.svg.appendChild(this.path),this.elementCreated&&this.elementCreated(this.path,t.component),this.canvas=t.component.svg);var n=i&&1===i.length&&i[0].cssClass||"",o=[0,0];e.xmin<0&&(o[0]=-e.xmin),e.ymin<0&&(o[1]=-e.ymin),c(this.path,{d:r(t.d),class:n,stroke:t.stroke?t.stroke:null,fill:t.fill?t.fill:null,transform:"translate("+o[0]+","+o[1]+")"})}};var r=function(t){return isNaN(t.cxy.x)||isNaN(t.cxy.y)?"":"M"+t.hxy.x+","+t.hxy.y+" L"+t.tail[0].x+","+t.tail[0].y+" L"+t.cxy.x+","+t.cxy.y+" L"+t.tail[1].x+","+t.tail[1].y+" L"+t.hxy.x+","+t.hxy.y};this.transfer=function(t){t.canvas&&this.path&&this.path.parentNode&&(this.path.parentNode.removeChild(this.path),t.canvas.appendChild(this.path))}}var i={cleanup:function(t){null!=this.path&&(t?this._jsPlumb.instance.removeElement(this.path):this.path.parentNode&&this.path.parentNode.removeChild(this.path))},reattach:function(t,e){this.path&&e.canvas&&e.canvas.appendChild(this.path)},setVisible:function(t){null!=this.path&&(this.path.style.display=t?"block":"none")}};u.extend(o,[m.jsPlumbUIComponent,m.Overlays.AbstractOverlay]),m.Overlays.svg.Arrow=function(){o.apply(this,[m.Overlays.Arrow,arguments])},u.extend(m.Overlays.svg.Arrow,[m.Overlays.Arrow,o],i),m.Overlays.svg.PlainArrow=function(){o.apply(this,[m.Overlays.PlainArrow,arguments])},u.extend(m.Overlays.svg.PlainArrow,[m.Overlays.PlainArrow,o],i),m.Overlays.svg.Diamond=function(){o.apply(this,[m.Overlays.Diamond,arguments])},u.extend(m.Overlays.svg.Diamond,[m.Overlays.Diamond,o],i),m.Overlays.svg.GuideLines=function(){var o,i,r=null,s=this;m.Overlays.GuideLines.apply(this,arguments),this.paint=function(t,e){null==r&&(r=p("path"),t.connector.svg.appendChild(r),s.attachListeners(r,t.connector),s.attachListeners(r,s),o=p("path"),t.connector.svg.appendChild(o),s.attachListeners(o,t.connector),s.attachListeners(o,s),i=p("path"),t.connector.svg.appendChild(i),s.attachListeners(i,t.connector),s.attachListeners(i,s));var n=[0,0];e.xmin<0&&(n[0]=-e.xmin),e.ymin<0&&(n[1]=-e.ymin),c(r,{d:a(t.head,t.tail),stroke:"red",fill:null,transform:"translate("+n[0]+","+n[1]+")"}),c(o,{d:a(t.tailLine[0],t.tailLine[1]),stroke:"blue",fill:null,transform:"translate("+n[0]+","+n[1]+")"}),c(i,{d:a(t.headLine[0],t.headLine[1]),stroke:"green",fill:null,transform:"translate("+n[0]+","+n[1]+")"})};var a=function(t,e){return"M "+t.x+","+t.y+" L"+e.x+","+e.y}},u.extend(m.Overlays.svg.GuideLines,m.Overlays.GuideLines)}.call("undefined"!=typeof window?window:this),function(){"use strict";function i(o,t){var e="_katavorio_"+(t=t||"main"),n=o[e],i=o.getEventManager();return n||((n=new a({bind:i.on,unbind:i.off,getSize:f.getSize,getConstrainingRectangle:function(t){return[t.parentNode.scrollWidth,t.parentNode.scrollHeight]},getPosition:function(t,e){var n=o.getOffset(t,e,t._katavorioDrag?t.offsetParent:null);return[n.left,n.top]},setPosition:function(t,e){t.style.left=e[0]+"px",t.style.top=e[1]+"px"},addClass:f.addClass,removeClass:f.removeClass,intersects:l.intersects,indexOf:function(t,e){return t.indexOf(e)},scope:o.getDefaultScope(),css:{noSelect:o.dragSelectClass,droppable:"jtk-droppable",draggable:"jtk-draggable",drag:"jtk-drag",selected:"jtk-drag-selected",active:"jtk-drag-active",hover:"jtk-drag-hover",ghostProxy:"jtk-ghost-proxy"}})).setZoom(o.getZoom()),o[e]=n,o.bind("zoom",n.setZoom)),n}function p(o,i){function t(t){if(null==i[t])return o[t];if(c.isString(i[t])){var e=i[t].match(/-=/)?-1:1,n=i[t].substring(2);return o[t]+e*n}return i[t]}return[t("left"),t("top")]}function t(t,e){if(null==e)return[0,0];var n=m(e),o=g(n,0);return[o[t+"X"],o[t+"Y"]]}function e(u){var d={},t=[],c={},h={},p={};this.register=function(r){var s,a=u.getId(r);d[a]||(d[a]=r,t.push(r),c[a]={});var l=function(t){if(t)for(var e=0;e<t.childNodes.length;e++)if(3!==t.childNodes[e].nodeType&&8!==t.childNodes[e].nodeType){var n=jsPlumb.getElement(t.childNodes[e]),o=u.getId(t.childNodes[e],null,!0);if(o&&h[o]&&0<h[o]){s=s||u.getOffset(r);var i=u.getOffset(n);c[a][o]={id:o,offset:{left:i.left-s.left,top:i.top-s.top}},p[o]=a}l(t.childNodes[e])}};l(r)},this.updateOffsets=function(t,e){if(null!=t){e=e||{};var n,o=jsPlumb.getElement(t),i=u.getId(o),r=c[i];if(r)for(var s in r)if(r.hasOwnProperty(s)){var a=jsPlumb.getElement(s),l=e[s]||u.getOffset(a);if(null==a.offsetParent&&null!=c[i][s])continue;n=n||u.getOffset(o),c[i][s]={id:s,offset:{left:l.left-n.left,top:l.top-n.top}},p[s]=i}}},this.endpointAdded=function(t,e){e=e||u.getId(t);var n=document.body,o=t.parentNode;for(h[e]=h[e]?h[e]+1:1;null!=o&&o!==n;){var i=u.getId(o,null,!0);if(i&&d[i]){var r=u.getOffset(o);if(null==c[i][e]){var s=u.getOffset(t);c[i][e]={id:e,offset:{left:s.left-r.left,top:s.top-r.top}},p[e]=i}break}o=o.parentNode}},this.endpointDeleted=function(t){if(h[t.elementId]&&(h[t.elementId]--,h[t.elementId]<=0))for(var e in c)c.hasOwnProperty(e)&&c[e]&&(delete c[e][t.elementId],delete p[t.elementId])},this.changeId=function(t,e){c[e]=c[t],c[t]={},p[e]=p[t],p[t]=null},this.getElementsForDraggable=function(t){return c[t]},this.elementRemoved=function(t){var e=p[t];e&&(c[e]&&delete c[e][t],delete p[t])},this.reset=function(){d={},t=[],c={},h={}},this.dragEnded=function(t){if(null!=t.offsetParent){var e=u.getId(t),n=p[e];n&&this.updateOffsets(n)}},this.setParent=function(t,e,n,o,i){var r=p[e];c[o]||(c[o]={});var s=u.getOffset(n),a=i||u.getOffset(t);r&&c[r]&&delete c[r][e],c[o][e]={id:e,offset:{left:a.left-s.left,top:a.top-s.top}},p[e]=o},this.clearParent=function(t,e){var n=p[e];n&&(delete c[n][e],delete p[e])},this.revalidateParent=function(t,e,n){var o=p[e];if(o){var i={};i[e]=n,this.updateOffsets(o,i),u.revalidate(o)}},this.getDragAncestor=function(t){var e=jsPlumb.getElement(t),n=u.getId(e),o=p[n];return o?jsPlumb.getElement(o):null}}function r(t,e,n){e=c.fastTrim(e),void 0!==t.className.baseVal?t.className.baseVal=e:t.className=e;try{var o=t.classList;if(null!=o){for(;0<o.length;)o.remove(o.item(0));for(var i=0;i<n.length;i++)n[i]&&o.add(n[i])}}catch(t){c.log("JSPLUMB: cannot set class list",t)}}function s(t){return void 0===t.className.baseVal?t.className:t.className.baseVal}function o(t,e,n){function o(t,e){for(var n=0;n<e.length;n++)if(t)-1===i.indexOf(e[n])&&i.push(e[n]);else{var o=i.indexOf(e[n]);-1!==o&&i.splice(o,1)}}e=null==e?[]:c.isArray(e)?e:e.split(/\s+/),n=null==n?[]:c.isArray(n)?n:n.split(/\s+/);var i=s(t).split(/\s+/);o(!0,e),o(!1,n),r(t,i.join(" "),i)}var n=this,f=n.jsPlumb,c=n.jsPlumbUtil,a=n.Katavorio,l=n.Biltong,u=t.bind(this,"page"),d=t.bind(this,"screen"),h=t.bind(this,"client"),g=function(t,e){return t.item?t.item(e):t[e]},m=function(t){return t.touches&&0<t.touches.length?t.touches:t.changedTouches&&0<t.changedTouches.length?t.changedTouches:t.targetTouches&&0<t.targetTouches.length?t.targetTouches:[t]};n.jsPlumb.extend(n.jsPlumbInstance.prototype,{headless:!1,pageLocation:u,screenLocation:d,clientLocation:h,getDragManager:function(){return null==this.dragManager&&(this.dragManager=new e(this)),this.dragManager},recalculateOffsets:function(t){this.getDragManager().updateOffsets(t)},createElement:function(t,e,n,o){return this.createElementNS(null,t,e,n,o)},createElementNS:function(t,e,n,o,i){var r,s=null==t?document.createElement(e):document.createElementNS(t,e);for(r in n=n||{})s.style[r]=n[r];for(r in o&&(s.className=o),i=i||{})s.setAttribute(r,""+i[r]);return s},getAttribute:function(t,e){return null!=t.getAttribute?t.getAttribute(e):null},setAttribute:function(t,e,n){null!=t.setAttribute&&t.setAttribute(e,n)},setAttributes:function(t,e){for(var n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])},appendToRoot:function(t){document.body.appendChild(t)},getRenderModes:function(){return["svg"]},getClass:s,addClass:function(t,e){jsPlumb.each(t,function(t){o(t,e)})},hasClass:function(t,e){return(t=jsPlumb.getElement(t)).classList?t.classList.contains(e):-1!==s(t).indexOf(e)},removeClass:function(t,e){jsPlumb.each(t,function(t){o(t,null,e)})},toggleClass:function(t,e){jsPlumb.hasClass(t,e)?jsPlumb.removeClass(t,e):jsPlumb.addClass(t,e)},updateClasses:function(t,e,n){jsPlumb.each(t,function(t){o(t,e,n)})},setClass:function(t,e){null!=e&&jsPlumb.each(t,function(t){r(t,e,e.split(/\s+/))})},setPosition:function(t,e){t.style.left=e.left+"px",t.style.top=e.top+"px"},getPosition:function(n){function t(t){var e=n.style[t];return e?e.substring(0,e.length-2):0}return{left:t("left"),top:t("top")}},getStyle:function(t,e){return void 0!==window.getComputedStyle?getComputedStyle(t,null).getPropertyValue(e):t.currentStyle[e]},getSelector:function(t,e){return 1===arguments.length?null!=t.nodeType?t:document.querySelectorAll(t):t.querySelectorAll(e)},getOffset:function(t,e,n){t=jsPlumb.getElement(t),n=n||this.getContainer();for(var o={left:t.offsetLeft,top:t.offsetTop},i=e||null!=n&&t!==n&&t.offsetParent!==n?t.offsetParent:null,r=function(t){null!=t&&t!==document.body&&(0<t.scrollTop||0<t.scrollLeft)&&(o.left-=t.scrollLeft,o.top-=t.scrollTop)}.bind(this);null!=i;)o.left+=i.offsetLeft,o.top+=i.offsetTop,r(i),i=e?i.offsetParent:i.offsetParent===n?null:i.offsetParent;if(null!=n&&!e&&(0<n.scrollTop||0<n.scrollLeft)){var s=null!=t.offsetParent?this.getStyle(t.offsetParent,"position"):"static",a=this.getStyle(t,"position");"absolute"!==a&&"fixed"!==a&&"absolute"!==s&&"fixed"!==s&&(o.left-=n.scrollLeft,o.top-=n.scrollTop)}return o},getPositionOnElement:function(t,e,n){var o=void 0!==e.getBoundingClientRect?e.getBoundingClientRect():{left:0,top:0,width:0,height:0},i=document.body,r=document.documentElement,s=window.pageYOffset||r.scrollTop||i.scrollTop,a=window.pageXOffset||r.scrollLeft||i.scrollLeft,l=r.clientTop||i.clientTop||0,u=r.clientLeft||i.clientLeft||0,d=o.top+s-l+0*n,c=o.left+a-u+0*n,h=jsPlumb.pageLocation(t),p=o.width||e.offsetWidth*n,f=o.height||e.offsetHeight*n;return[(h[0]-c)/p,(h[1]-d)/f]},getAbsolutePosition:function(n){function t(t){var e=n.style[t];if(e)return parseFloat(e.substring(0,e.length-2))}return[t("left"),t("top")]},setAbsolutePosition:function(t,e,n,o){n?this.animate(t,{left:"+="+(e[0]-n[0]),top:"+="+(e[1]-n[1])},o):(t.style.left=e[0]+"px",t.style.top=e[1]+"px")},getSize:function(t){return[t.offsetWidth,t.offsetHeight]},getWidth:function(t){return t.offsetWidth},getHeight:function(t){return t.offsetHeight},getRenderMode:function(){return"svg"},draggable:function(t,e){var n;return t=c.isArray(t)||null!=t.length&&!c.isString(t)?t:[t],Array.prototype.slice.call(t).forEach(function(t){(n=this.info(t)).el&&this._initDraggableIfNecessary(n.el,!0,e,n.id,!0)}.bind(this)),this},snapToGrid:function(t,o,i){var r=[],e=function(t){var e=this.info(t);if(null!=e.el&&e.el._katavorioDrag){var n=e.el._katavorioDrag.snap(o,i);this.revalidate(e.el),r.push([e.el,n])}}.bind(this);if(1===arguments.length||3===arguments.length)e(t,o,i);else{var n=this.getManagedElements();for(var s in n)e(s,t,o)}return r},initDraggable:function(t,e,n){i(this,n).draggable(t,e),t._jsPlumbDragOptions=e},destroyDraggable:function(t,e){i(this,e).destroyDraggable(t),t._jsPlumbDragOptions=null,t._jsPlumbRelatedElement=null},unbindDraggable:function(t,e,n,o){i(this,o).destroyDraggable(t,e,n)},setDraggable:function(t,e){return jsPlumb.each(t,function(t){this.isDragSupported(t)&&(this._draggableStates[this.getAttribute(t,"id")]=e,this.setElementDraggable(t,e))}.bind(this))},_draggableStates:{},toggleDraggable:function(t){var n;return jsPlumb.each(t,function(t){var e=this.getAttribute(t,"id");return n=!(n=null!=this._draggableStates[e]&&this._draggableStates[e]),this._draggableStates[e]=n,this.setDraggable(t,n),n}.bind(this)),n},_initDraggableIfNecessary:function(t,e,n,o,i){if(!jsPlumb.headless&&(null!=e&&e&&jsPlumb.isDragSupported(t,this))){var r=n||this.Defaults.DragOptions;if(r=jsPlumb.extend({},r),jsPlumb.isAlreadyDraggable(t,this))n.force&&this.initDraggable(t,r);else{var s=jsPlumb.dragEvents.drag,a=jsPlumb.dragEvents.stop,l=jsPlumb.dragEvents.start;this.manage(o,t),r[l]=c.wrap(r[l],function(t){var e=t.el._jsPlumbDragOptions,n=!0;return e.canDrag&&(n=e.canDrag()),n&&(this.setHoverSuspended(!0),this.select({source:t.el}).addClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:t.el}).addClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),this.setConnectionBeingDragged(!0)),n}.bind(this)),r[s]=c.wrap(r[s],function(t){var e=this.getUIPosition(arguments,this.getZoom());if(null!=e){var n=t.el._jsPlumbDragOptions;this.draw(t.el,e,null,!0),n._dragging&&this.addClass(t.el,"jtk-dragged"),n._dragging=!0}}.bind(this)),r[a]=c.wrap(r[a],function(n){for(var o,t=n.selection,e=function(t){var e;null!=t[1]&&(o=this.getUIPosition([{el:t[2].el,pos:[t[1].left,t[1].top]}]),e=this.draw(t[2].el,o)),null!=t[0]._jsPlumbDragOptions&&delete t[0]._jsPlumbDragOptions._dragging,this.removeClass(t[0],"jtk-dragged"),this.select({source:t[2].el}).removeClass(this.elementDraggingClass+" "+this.sourceElementDraggingClass,!0),this.select({target:t[2].el}).removeClass(this.elementDraggingClass+" "+this.targetElementDraggingClass,!0),n.e._drawResult=n.e._drawResult||{c:[],e:[],a:[]},Array.prototype.push.apply(n.e._drawResult.c,e.c),Array.prototype.push.apply(n.e._drawResult.e,e.e),Array.prototype.push.apply(n.e._drawResult.a,e.a),this.getDragManager().dragEnded(t[2].el)}.bind(this),i=0;i<t.length;i++)e(t[i]);this.setHoverSuspended(!1),this.setConnectionBeingDragged(!1)}.bind(this));var u=this.getId(t);this._draggableStates[u]=!0;var d=this._draggableStates[u];r.disabled=null!=d&&!d,this.initDraggable(t,r),this.getDragManager().register(t),i&&this.fire("elementDraggable",{el:t,options:r})}}},animationSupported:!0,getElement:function(t){return null==t?null:"string"==typeof(t="string"==typeof t?t:null==t.tagName&&null!=t.length&&null==t.enctype?t[0]:t)?document.getElementById(t):t},removeElement:function(t){i(this).elementRemoved(t),this.getEventManager().remove(t)},doAnimate:function(t,e,n){n=n||{};var o=this.getOffset(t),i=p(o,e),r=i[0]-o.left,s=i[1]-o.top,a=n.duration||250,l=a/15,u=15/a*r,d=15/a*s,c=0,h=setInterval(function(){f.setPosition(t,{left:o.left+u*(c+1),top:o.top+d*(c+1)}),null!=n.step&&n.step(c,Math.ceil(l)),l<=++c&&(window.clearInterval(h),null!=n.complete&&n.complete())},15)},destroyDroppable:function(t,e){i(this,e).destroyDroppable(t)},unbindDroppable:function(t,e,n,o){i(this,o).destroyDroppable(t,e,n)},droppable:function(t,e){var n;return t=c.isArray(t)||null!=t.length&&!c.isString(t)?t:[t],(e=e||{}).allowLoopback=!1,Array.prototype.slice.call(t).forEach(function(t){(n=this.info(t)).el&&this.initDroppable(n.el,e)}.bind(this)),this},initDroppable:function(t,e,n){i(this,n).droppable(t,e)},isAlreadyDraggable:function(t){return null!=t._katavorioDrag},isDragSupported:function(t,e){return!0},isDropSupported:function(t,e){return!0},isElementDraggable:function(t){return(t=f.getElement(t))._katavorioDrag&&t._katavorioDrag.isEnabled()},getDragObject:function(t){return t[0].drag.getDragElement()},getDragScope:function(t){return t._katavorioDrag&&t._katavorioDrag.scopes.join(" ")||""},getDropEvent:function(t){return t[0].e},getUIPosition:function(t,e){var n=t[0].el;if(null==n.offsetParent)return null;var o=t[0].finalPos||t[0].pos,i={left:o[0],top:o[1]};if(n._katavorioDrag&&n.offsetParent!==this.getContainer()){var r=this.getOffset(n.offsetParent);i.left+=r.left,i.top+=r.top}return i},setDragFilter:function(t,e,n){t._katavorioDrag&&t._katavorioDrag.setFilter(e,n)},setElementDraggable:function(t,e){(t=f.getElement(t))._katavorioDrag&&t._katavorioDrag.setEnabled(e)},setDragScope:function(t,e){t._katavorioDrag&&t._katavorioDrag.k.setDragScope(t,e)},setDropScope:function(t,e){t._katavorioDrop&&0<t._katavorioDrop.length&&t._katavorioDrop[0].k.setDropScope(t,e)},addToPosse:function(t,e){var n=Array.prototype.slice.call(arguments,1),o=i(this);f.each(t,function(t){(t=[f.getElement(t)]).push.apply(t,n),o.addToPosse.apply(o,t)})},setPosse:function(t,e){var n=Array.prototype.slice.call(arguments,1),o=i(this);f.each(t,function(t){(t=[f.getElement(t)]).push.apply(t,n),o.setPosse.apply(o,t)})},removeFromPosse:function(t,e){var n=Array.prototype.slice.call(arguments,1),o=i(this);f.each(t,function(t){(t=[f.getElement(t)]).push.apply(t,n),o.removeFromPosse.apply(o,t)})},removeFromAllPosses:function(t){var e=i(this);f.each(t,function(t){e.removeFromAllPosses(f.getElement(t))})},setPosseState:function(t,e,n){var o=i(this);f.each(t,function(t){o.setPosseState(f.getElement(t),e,n)})},dragEvents:{start:"start",stop:"stop",drag:"drag",step:"step",over:"over",out:"out",drop:"drop",complete:"complete",beforeStart:"beforeStart"},animEvents:{step:"step",complete:"complete"},stopDrag:function(t){t._katavorioDrag&&t._katavorioDrag.abort()},addToDragSelection:function(t){var e=this.getElement(t);null==e||!e._isJsPlumbGroup&&null!=e._jsPlumbGroup||i(this).select(t)},removeFromDragSelection:function(t){i(this).deselect(t)},getDragSelection:function(){return i(this).getSelection()},clearDragSelection:function(){i(this).deselectAll()},trigger:function(t,e,n,o){this.getEventManager().trigger(t,e,n,o)},doReset:function(){for(var t in this)0===t.indexOf("_katavorio_")&&this[t].reset()},getEventManager:function(){return function(t){var e=t._mottle;return e=e||(t._mottle=new n.Mottle)}(this)},on:function(t,e,n){return this.getEventManager().on.apply(this,arguments),this},off:function(t,e,n){return this.getEventManager().off.apply(this,arguments),this}});var v,y;v=f.init,(y=function(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?v():setTimeout(y,9)})()}.call("undefined"!=typeof window?window:this),function(){"use strict";function e(c){var r={},l={},u={},h=this;function d(t,e){for(var n=c.getContainer();;){if(null==t||t===n)return!1;if(t===e)return!0;t=t.parentNode}}function o(t,e){for(var n=t.getEl().querySelectorAll(".jtk-managed"),o=0;o<n.length;o++)c[e?"show":"hide"](n[o],!0)}c.bind("connection",function(t){var e=c.getGroupFor(t.source),n=c.getGroupFor(t.target);null!=e&&null!=n&&e===n?(l[t.connection.id]=e,u[t.connection.id]=e):(null!=e&&(x.suggest(e.connections.source,t.connection),l[t.connection.id]=e),null!=n&&(x.suggest(n.connections.target,t.connection),u[t.connection.id]=n))}),c.bind("internal.connectionDetached",function(t){!function(e){delete e.proxies;var t,n=l[e.id];null!=n&&(t=function(t){return t.id===e.id},x.removeWithFunction(n.connections.source,t),x.removeWithFunction(n.connections.target,t),delete l[e.id]),null!=(n=u[e.id])&&(t=function(t){return t.id===e.id},x.removeWithFunction(n.connections.source,t),x.removeWithFunction(n.connections.target,t),delete u[e.id])}(t.connection)}),c.bind("connectionMoved",function(t){var e=(0===t.index?l:u)[t.connection.id];if(e){var n=e.connections[0===t.index?"source":"target"],o=n.indexOf(t.connection);-1!==o&&n.splice(o,1)}}),this.addGroup=function(t){c.addClass(t.getEl(),a),(r[t.id]=t).manager=this,e(t),c.fire("group:add",{group:t})},this.addToGroup=function(o,t,e){if(o=this.getGroup(o)){var n=o.getEl();if(t._isJsPlumbGroup)return;var i=t._jsPlumbGroup;if(i!==o){c.removeFromDragSelection(t);var r=c.getOffset(t,!0),s=o.collapsed?c.getOffset(n,!0):c.getOffset(o.getDragArea(),!0);null!=i&&(i.remove(t,!1,e,!1,o),h.updateConnectionsForGroup(i)),o.add(t,e);var a=function(t,e){var n=0===e?1:0;t.each(function(t){t.setVisible(!1),t.endpoints[n].element._jsPlumbGroup===o?(t.endpoints[n].setVisible(!1),f(t,n,o)):(t.endpoints[e].setVisible(!1),p(t,e,o))})};o.collapsed&&(a(c.select({source:t}),0),a(c.select({target:t}),1));var l=c.getId(t);c.dragManager.setParent(t,l,n,c.getId(n),r);var u={left:r.left-s.left,top:r.top-s.top};if(c.setPosition(t,u),c.dragManager.revalidateParent(t,l,r),h.updateConnectionsForGroup(o),c.revalidate(l),!e){var d={group:o,el:t,pos:u};i&&(d.sourceGroup=i),c.fire("group:addMember",d)}}}},this.removeFromGroup=function(s,a,t){if(s=this.getGroup(s)){if(s.collapsed){var e=function(t,e){for(var n=0;n<t.length;n++){var o=t[n];if(o.proxies)for(var i=0;i<o.proxies.length;i++)if(null!=o.proxies[i]){var r=o.proxies[i].originalEp.element;r!==a&&!d(r,a)||f(o,e,s)}}};e(s.connections.source.slice(),0),e(s.connections.target.slice(),1)}s.remove(a,null,t)}},this.getGroup=function(t){var e=t;if(x.isString(t)&&null==(e=r[t]))throw new TypeError("No such group ["+t+"]");return e},this.getGroups=function(){var t=[];for(var e in r)t.push(r[e]);return t},this.removeGroup=function(t,e,n,o){t=this.getGroup(t),this.expandGroup(t,!0);var i=t[e?"removeAll":"orphanAll"](n,o);return c.remove(t.getEl()),delete r[t.id],delete c._groups[t.id],c.fire("group:remove",{group:t}),i},this.removeAllGroups=function(t,e,n){for(var o in r)this.removeGroup(r[o],t,e,n)};var p=function(t,e,n){var o=t.endpoints[0===e?1:0].element;if(!o[C]||o[C].shouldProxy()||!o[C].collapsed){var i=n.getEl(),r=c.getId(i);c.proxyConnection(t,e,i,r,function(t,e){return n.getEndpoint(t,e)},function(t,e){return n.getAnchor(t,e)})}};this.collapseGroup=function(i){if(null!=(i=this.getGroup(i))&&!i.collapsed){var t=i.getEl();if(o(i,!1),i.shouldProxy()){var e=function(t,e){for(var n=0;n<t.length;n++){var o=t[n];p(o,e,i)}};e(i.connections.source,0),e(i.connections.target,1)}i.collapsed=!0,c.removeClass(t,a),c.addClass(t,s),c.revalidate(t),c.fire("group:collapse",{group:i})}};var f=function(t,e,n){c.unproxyConnection(t,e,c.getId(n.getEl()))};function e(i){for(var t=i.getMembers().slice(),e=[],n=0;n<t.length;n++)Array.prototype.push.apply(e,t[n].querySelectorAll(".jtk-managed"));Array.prototype.push.apply(t,e);var o=c.getConnections({source:t,scope:"*"},!0),r=c.getConnections({target:t,scope:"*"},!0),s={};i.connections.source.length=0,i.connections.target.length=0;function a(t){for(var e=0;e<t.length;e++)if(!s[t[e].id]){s[t[e].id]=!0;var n=c.getGroupFor(t[e].source),o=c.getGroupFor(t[e].target);n===i?(o!==i&&i.connections.source.push(t[e]),l[t[e].id]=i):o===i&&(i.connections.target.push(t[e]),u[t[e].id]=i)}}a(o),a(r)}this.expandGroup=function(i,t){if(null!=(i=this.getGroup(i))&&i.collapsed){var e=i.getEl();if(o(i,!0),i.shouldProxy()){var n=function(t,e){for(var n=0;n<t.length;n++){var o=t[n];f(o,e,i)}};n(i.connections.source,0),n(i.connections.target,1)}i.collapsed=!1,c.addClass(e,a),c.removeClass(e,s),c.revalidate(e),this.repaintGroup(i),t||c.fire("group:expand",{group:i})}},this.repaintGroup=function(t){for(var e=(t=this.getGroup(t)).getMembers(),n=0;n<e.length;n++)c.revalidate(e[n])},this.updateConnectionsForGroup=e,this.refreshAllGroups=function(){for(var t in r)e(r[t]),c.dragManager.updateOffsets(c.getId(r[t].getEl()))}}function n(u,n){var r=this,e=n.el;this.getEl=function(){return e},this.id=n.id||x.uuid(),e._isJsPlumbGroup=!0;var o=this.getDragArea=function(){var t=u.getSelector(e,"[jtk-group-content]");return t&&0<t.length?t[0]:e},i=!0===n.ghost,s=i||!0===n.constrain,a=!1!==n.revert,l=!0===n.orphan,d=!0===n.prune,c=!0===n.dropOverride,t=!1!==n.proxied,h=[];if(this.connections={source:[],target:[],internal:[]},this.getAnchor=function(t,e){return n.anchor||"Continuous"},this.getEndpoint=function(t,e){return n.endpoint||["Dot",{radius:10}]},(this.collapsed=!1)!==n.draggable){var p={drag:function(){for(var t=0;t<h.length;t++)u.draw(h[t])},stop:function(t){u.fire("groupDragStop",jsPlumb.extend(t,{group:r}))},scope:"_jsPlumbGroupDrag"};n.dragOptions&&E.jsPlumb.extend(p,n.dragOptions),u.draggable(n.el,p)}function f(t,e){for(var n=null==t.nodeType?t:[t],o=0;o<n.length;o++)e(n[o])}function g(t,e){var n=function(t){return t.offsetParent}(t),o=u.getSize(n),i=u.getSize(t),r=e[0],s=r+i[0],a=e[1],l=a+i[1];return 0<s&&r<o[0]&&0<l&&a<o[1]}function m(t){var e=u.getId(t),n=u.getOffset(t);return t.parentNode.removeChild(t),u.getContainer().appendChild(t),u.setPosition(t,n),b(t),u.dragManager.clearParent(t,e),[e,n]}function v(t){var e=[];function n(t,e,n){var o=null;if(!g(t,[e,n])){var i=t._jsPlumbGroup;d?u.remove(t):o=m(t),i.remove(t)}return o}for(var o=0;o<t.selection.length;o++)e.push(n(t.selection[o][0],t.selection[o][1].left,t.selection[o][1].top));return 1===e.length?e[0]:e}function y(t){var e=u.getId(t);u.revalidate(t),u.dragManager.revalidateParent(t,e)}function b(t){t._katavorioDrag&&((d||l)&&t._katavorioDrag.off("stop",v),d||l||!a||(t._katavorioDrag.off("revert",y),t._katavorioDrag.setRevert(null)))}function P(t){t._katavorioDrag&&((d||l)&&t._katavorioDrag.on("stop",v),s&&t._katavorioDrag.setConstrain(!0),i&&t._katavorioDrag.setUseGhostProxy(!0),d||l||!a||(t._katavorioDrag.on("revert",y),t._katavorioDrag.setRevert(function(t,e){return!g(t,e)})))}!1!==n.droppable&&u.droppable(n.el,{drop:function(t){var e=t.drag.el;if(!e._isJsPlumbGroup){var n=e._jsPlumbGroup;if(n!==r){if(null!=n&&n.overrideDrop(e,r))return;u.getGroupManager().addToGroup(r,e,!1)}}}}),this.overrideDrop=function(t,e){return c&&(a||d||l)},this.add=function(t,e){var n=o();f(t,function(t){if(null!=t._jsPlumbGroup){if(t._jsPlumbGroup===r)return;t._jsPlumbGroup.remove(t,!0,e,!1)}t._jsPlumbGroup=r,h.push(t),u.isAlreadyDraggable(t)&&P(t),t.parentNode!==n&&n.appendChild(t)}),u.getGroupManager().updateConnectionsForGroup(r)},this.remove=function(t,n,o,e,i){f(t,function(e){if(e._jsPlumbGroup===r){if(delete e._jsPlumbGroup,x.removeWithFunction(h,function(t){return t===e}),n)try{r.getDragArea().removeChild(e)}catch(t){jsPlumbUtil.log("Could not remove element from Group "+t)}if(b(e),!o){var t={group:r,el:e};i&&(t.targetGroup=i),u.fire("group:removeMember",t)}}}),e||u.getGroupManager().updateConnectionsForGroup(r)},this.removeAll=function(t,e){for(var n=0,o=h.length;n<o;n++){var i=h[0];r.remove(i,t,e,!0),u.remove(i,!0)}h.length=0,u.getGroupManager().updateConnectionsForGroup(r)},this.orphanAll=function(){for(var t={},e=0;e<h.length;e++){var n=m(h[e]);t[n[0]]=n[1]}return h.length=0,t},this.getMembers=function(){return h},e[C]=this,u.bind("elementDraggable",function(t){t.el._jsPlumbGroup===this&&P(t.el)}.bind(this)),this.shouldProxy=function(){return t},u.getGroupManager().addGroup(this)}var E=this,x=E.jsPlumbUtil,t=E.jsPlumbInstance,s="jtk-group-collapsed",a="jtk-group-expanded",o="_groupManager",C="_jsPlumbGroup";t.prototype.addGroup=function(t){if(this._groups=this._groups||{},null!=this._groups[t.id])throw new TypeError("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=t.el[C])throw new TypeError("cannot create Group ["+t.id+"]; the given element is already a Group");var e=new n(this,t);return this._groups[e.id]=e,t.collapsed&&this.collapseGroup(e),e},t.prototype.addToGroup=function(n,t,o){var e=function(t){var e=this.getId(t);this.manage(e,t),this.getGroupManager().addToGroup(n,t,o)}.bind(this);if(Array.isArray(t))for(var i=0;i<t.length;i++)e(t[i]);else e(t)},t.prototype.removeFromGroup=function(t,e,n){this.getGroupManager().removeFromGroup(t,e,n),this.getContainer().appendChild(e)},t.prototype.removeGroup=function(t,e,n,o){return this.getGroupManager().removeGroup(t,e,n,o)},t.prototype.removeAllGroups=function(t,e,n){this.getGroupManager().removeAllGroups(t,e,n)},t.prototype.getGroup=function(t){return this.getGroupManager().getGroup(t)},t.prototype.getGroups=function(){return this.getGroupManager().getGroups()},t.prototype.expandGroup=function(t){this.getGroupManager().expandGroup(t)},t.prototype.collapseGroup=function(t){this.getGroupManager().collapseGroup(t)},t.prototype.repaintGroup=function(t){this.getGroupManager().repaintGroup(t)},t.prototype.toggleGroup=function(t){null!=(t=this.getGroupManager().getGroup(t))&&this.getGroupManager()[t.collapsed?"expandGroup":"collapseGroup"](t)},t.prototype.getGroupManager=function(){var t=this[o];return null==t&&(t=this[o]=new e(this)),t},t.prototype.removeGroupManager=function(){delete this[o]},t.prototype.getGroupFor=function(t){if(t=this.getElement(t)){for(var e=this.getContainer(),n=!1,o=null;!n;)null==t||t===e?n=!0:t[C]?(o=t[C],t,n=!0):t=t.parentNode;return o}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this.Farahey={};"undefined"!=typeof exports&&(exports.Farahey=t);function w(t,e,n){var o=function(t,e,n){for(var o=0,i=t.length,r=-1,s=0;o<i;)if((s=n(t[r=parseInt((o+i)/2)],e))<0)o=r+1;else{if(!(0<s))return r;i=r}return o}(t,e,n);t.splice(o,0,e)}function S(t,n){function i(t){if(!o[t[1]]){var e=n(t[2]);o[t[1]]={l:t[0][0],t:t[0][1],w:e[0],h:e[1],center:[t[0][0]+e[0]/2,t[0][1]+e[1]/2]}}return o[t[1]]}var r=t,o={};this.setOrigin=function(t){r=t,o={}},this.compare=function(t,e){var n=A.lineLength(r,i(t).center),o=A.lineLength(r,i(e).center);return n<o?-1:n===o?0:1}}function I(u,d,c,h,p,t,f,g,m,v,y,b,P){function E(t,e,n,o){i[t]=!0,e[0]+=n,e[1]+=o}v=v||function(){},y=y||2;var x,C,j=D(t=t||[0,0],[1,1],h),_=1,w=!0,i={},S=function(){for(var t=0;t<u.length;t++)if(!b(u[t][1],u[t][2])){var e=d[u[t][1]],n=u[t][1],o=(u[t][2],c[u[t][1]]),i=D(e,o,h);!P&&f(u[t][1],u[t][2])&&A.intersects(j,i)&&(x=T(j,i),C=p(u[t][1],e,x),E(n,e,C.left,C.top)),i=D(e,o,h);for(var r=0;r<u.length;r++)if(t!==r){if(b(u[r][1],u[r][2]))continue;if(f(u[r][1],u[r][2])){var s=d[u[r][1]],a=c[u[r][1]],l=D(s,a,h);A.intersects(i,l)&&(w=!0,x=T(i,l),C=p(u[r][1],s,x),E(u[r][1],s,C.left,C.top))}}}g&&v(),w&&_<y&&(w=!1,_++,g?window.setTimeout(S,m):S())};return S(),i}function k(t){if(null==t)return null;if("[object Array]"===Object.prototype.toString.call(t)){var e=[];return e.push.apply(e,t),e}var n=[];for(var o in t)n.push(t[o]);return n}function e(s){function n(){return E.setOrigin(v),p.length=0,f={},g={},function(t){var e,n,o,i,r;e=n=1/0,o=i=-1/0;for(var s=0;s<t.length;s++){var a=d(t[s]),l=c(t[s]),u=h(t[s]);f[u]=[a.left,a.top],r=[[a.left,a.top],u,t[s]],P&&0!==p.length?w(p,r,E.compare):p.push(r),g[u]=l,e=Math.min(e,a.left),n=Math.min(n,a.top),o=Math.max(o,a.left+l[0]),i=Math.max(i,a.top+l[1])}return[e,o,n,i]}(m)}function o(t){if(1<m.length){var e=(t=t||{}).filter||y,n=t.padding||l,o=t.iterations,i=t.exclude||b,r=t.excludeFocus;t.gather&&function(t,e,n,o,i,r,s,a,l,u,d,c){for(var h=D(r=r||[0,0],[1,1],o),p=0;p<t.length;p++)if(!c(t[p][1],t[p][2])){var f=e[t[p][1]],g=n[t[p][1]],m=D(f,g,o);if(s(t[p][1],t[p][2])){var v=T(h,m);f[0]+=v.left,f[1]+=v.top}}}(p,f,g,n,0,v,e,0,0,0,0,i);var s=I(p,f,g,n,u,v,e,x,C,_,o,i,r);return _(s),s}}function i(t){null!=t&&(v=t,E.setOrigin(t))}var a,t,d=s.getPosition,c=s.getSize,h=s.getId,r=s.setPosition,l=s.padding||[20,20],u=s.constrain||function(t,e,n){return n},p=[],f={},g={},m=k(s.elements||[]),v=s.origin||[0,0],e=s.executeNow,y=(this.getOrigin=function(){return v},s.filter||function(t){return!0}),b=s.exclude||function(t){return!1},P=s.orderByDistanceFromOrigin,E=new S(v,c),x=s.updateOnStep,C=s.stepInterval||350,j=s.debug,_=function(t){for(var e=0;e<m.length;e++){var n=h(m[e]);t[n]&&r(m[e],{left:f[n][0],top:f[n][1]})}};return this.execute=function(t,e){return i(t),n(),o(e)},this.executeAtCenter=function(t){var e=n();return i([(e[0]+e[1])/2,(e[2]+e[3])/2]),o(t)},this.executeAtEvent=function(t,e){var n=s.container,o=s.getContainerPosition(n),i=t.pageX-o.left+n.scrollLeft,r=t.pageY-o.top+n.scrollTop;return j&&(a.style.left=t.pageX+"px",a.style.top=t.pageY+"px"),this.execute([i,r],e)},this.setElements=function(t){return m=k(t),this},this.addElement=function(t,e){return null==t||!e&&-1!==m.indexOf(t)||m.push(t),this},this.addElements=function(t,e){if(e)Array.prototype.push.apply(m,t);else for(var n=0;n<t.length;n++)this.addElement(t[n]);return this},this.getElements=function(){return m},this.removeElement=function(t){for(var e=-1,n=0;n<m.length;n++)if(m[n]===t){e=n;break}return-1!==e&&m.splice(e,1),this},this.setPadding=function(t){l=t},this.setConstrain=function(t){u=t},this.setFilter=function(t){y=t},this.reset=function(){m.length=0},j&&((t=document.createElement("div")).style.position="absolute",t.style.width="10px",t.style.height="10px",t.style.backgroundColor="red",document.body.appendChild(t),a=t),e&&this.execute(),this}var A=this.Biltong,n=[function(t,e){return t.x+t.w-e.x},function(t,e){return t.x-(e.x+e.w)}],o=[function(t,e){return t.y+t.h-e.y},function(t,e){return t.y-(e.y+e.h)}],d=[null,[n[0],o[1]],[n[0],o[0]],[n[1],o[0]],[n[1],o[1]]],T=t.calculateSpacingAdjustment=function(t,e){var n=t.center||[t.x+t.w/2,t.y+t.h/2],o=e.center||[e.x+e.w/2,e.y+e.h/2],i=A.gradient(n,o),r=A.quadrant(n,o);return function(t,e,n,o,i){isNaN(n)&&(n=0);var r,s,a=e.y+e.h,l=n==1/0||n==-1/0?e.x+e.w/2:(a-o)/n,u=Math.atan(n);return function(t,e,n,o){return t[e]<=o&&o<=t[e]+t[n]}(e,"x","w",l)?{left:s=(r=d[i][1](t,e))/Math.sin(u)*Math.cos(u),top:r}:{left:s=d[i][0](t,e),top:r=s/Math.cos(u)*Math.sin(u)}}(t,e,i,i==1/0||i==-1/0||isNaN(i)?0:n[1]-i*n[0],r)},D=t.paddedRectangle=function(t,e,n){return{x:t[0]-n[0],y:t[1]-n[1],w:e[0]+2*n[0],h:e[1]+2*n[1]}};t.getInstance=function(t){return new e(t)}}.call("undefined"!=typeof window?window:this),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).knockle={})}(this,function(t){"use strict";function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?f(t):e}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var n=[],o=!0,i=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(t){i=!0,r=t}finally{try{o||null==a.return||a.return()}finally{if(i)throw r}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function v(t){if(null==t)return null;for(var e=t.replace(/^\s\s*/,""),n=/\s/,o=e.length;n.test(e.charAt(--o)););return e.slice(0,o+1)}function s(t,e,n){for(var o in e)t[o]=e[o],n&&n(o,t[o]);return t}function l(t,e,u){if(null==t)return null;if("$data"===e||null==e)return t;var n=e.match(/^\{(.*)\}$/);if(n){for(var o={},i=n[1].split(","),r=0;r<i.length;r++){var s=i[r].split(":"),a=l(t,s[1]);o[v(s[0])]=a||s[1].replace(/'/g,"")}return o}e=e.replace(/\['([^']*)'\]/g,".$1");var d=t,c=null;return e.replace(/([^\.])+/g,function(t,e,n,o){if(null==c){var i=t.match(/([^\[0-9]+){1}(\[)([0-9+])/),r=function(){return d[i[1]]||(d[i[1]]=[],d[i[1]])};if(n+t.length>=o.length)if(i){var s=r(),a=i[3];null==u?c=s[a]:s[a]=u}else null==u?c=d[t]:d[t]=u;else if(i){var l=r();d=l[i[3]]||(l[i[3]]={},l[i[3]])}else d=d[t]||(d[t]={},d[t])}}),c}function u(t){return t.filter(function(t){return null!=t&&0<v(t).length})}function y(t,e){for(var n=0;n<t.length;n++){var o=t[n];null!=o&&0!==o.length&&e(n,o)}}function d(t){var e=document.getElementById(t);return null!=e?e.innerHTML:null}function b(t,e){return null==t?t:u(t.replace("/>",">").split(/^<|>$/)[1].split(e))}function P(t){return 0<t.length?t[t.length-1]:null}function E(t){if(null==t||0===t.length)return!1;for(var e=t.length-1;-1<e;e--)if("each"===t[e].type)return!0;return!1}function x(t,e,n,o,i){var r=a(),s={w:e,e:[],u:r};return(i.bindings[r]=s).reapply=new Function("$data",(null!=o?"var out='';try { with($data) { if ("+o+") out = this.w; else return null; }}catch(_){return null;}":"var out = this.w;")+"for (var k = 0; k < this.e.length; k++) { with($data) { "+(null!=o?"try {  if("+o+") { out = out.replace(this.e[k][0], eval(this.e[k][1])); } else out=''; } catch(__) { out='';}":"try { out = out.replace(this.e[k][0], eval(this.e[k][1])); } catch(__) { out=out.replace(this.e[k][0], '');}")+" }} return out;"),n.bindings[t]=s,e.replace(/\$\{([^\}]*)\}/g,function(t,e,n,o){return s.e.push([t,e]),""}),r}function C(t,e,n,o,i){x(t,n.atts[t]=e,n,o,i)}function j(t,o){for(var e=b(t,o.attributesRe),i={el:v(e[0]),atts:{},bindings:{}},n=function(t,e){var n=t.match(/([^=]+)=['"](.*)['"]/);return null==n&&null==e?i.atts[t]="":null==n?C(t,"",i,e,o):C(n[1],n[2],i,e,o),n},r=1;r<e.length;r++){var s=v(e[r]);if(null!=s&&0<s.length){var a=s.match(o.inlineIfRe);if(a)for(var l=a[2].split(o.attributesRe),u=0;u<l.length;u++){var d=v(l[u]);null!=d&&0<d.length&&n(d,a[1])}else n(s)}}return i}function _(t){c(this,_),this.instance=t,h(this,"type",void 0),h(this,"tag",void 0),h(this,"remove",void 0),h(this,"uuid",void 0),h(this,"children",[]),h(this,"elements",[]),h(this,"bindings",void 0),h(this,"context",void 0),h(this,"functionBody",void 0),h(this,"precompile",void 0),h(this,"postcompile",void 0),this.uuid=a(),t.entries[this.uuid]=this}var w=function(){function o(t,e){var n;return c(this,o),h(f(n=g(this,p(o).call(this,e))),"type","text"),h(f(n),"value",void 0),h(f(n),"bindings",void 0),n.value=t.value,n.bindings={},n}return e(o,_),i(o,[{key:"_getBoundValue",value:function(){return"_rotors.bind(__knockleData[0], '"+this.bindings.__element.u+"', typeof $key !== 'undefined' ? $key : null, typeof $value !== 'undefined' ? $value : null)"}},{key:"compile",value:function(){return this.instance.getExecutionContent(this._getBoundValue(),this.uuid,!0)+";_rotors.pet(_eid, '"+this.uuid+"');"}},{key:"updateFrom",value:function(t,e){return t.el.nodeValue=e.el.nodeValue,{added:[],removed:[],elements:[]}}}]),o}();function S(t,e){for(var n=0;n<e.children.length;n++){var o=!0;for(var i in t)if(t[i]!==e.children[n][i]){o=!1;break}if(o)return e.children[n]}}function I(t,e,n,o,i){function r(t){for(var e="",n=0;n<o.length;n++)e+=t[o[n]];return e}var s,a,l,u={},d=[],c=[],h={added:[],removed:[],elements:[]};if(0<n.children.length)for(var p=0;p<e.children.length;p++){a=e.children[p];for(var f={},g=0;g<o.length;g++)f[o[g]]=a[o[g]];null==(s=S(f,n))?d.push(a):(u[r(a)]=!0,l=t.updateFrom(a,s,null),Array.prototype.push.apply(h.added,l.added),Array.prototype.push.apply(h.removed,l.removed))}else Array.prototype.push.apply(d,e.children);for(var m={},v=0;v<d.length;v++)d[v].el.parentNode&&d[v].el.parentNode.removeChild(d[v].el),m[d[v].index]=!0;var y=e.children.filter(function(t){return!0!==m[t.index]});e.children=y;for(var b=0<e.children.length?e.children[e.children.length-1].el:null,P=0;P<n.children.length;P++)u[r(a=n.children[P])]||(e.children.push(a),c.push(a));if(0<c.length)for(var E=0;E<c.length;E++)null!=b?b.parentNode.insertBefore(c[E].el,b.nextSibling):null!=i?i.el.appendChild(c[E].el):console.log("Knockle: couldnt insert child, nothing to insert after"),b=c[E].el;return Array.prototype.push.apply(h.added,c),Array.prototype.push.apply(h.removed,d),h}function k(t,e,n){var r=this;c(this,k),this.instance=t,this.tagName=e,this.options=n,h(this,"template",void 0),h(this,"getFunctionBody",void 0),h(this,"getFunctionEnd",void 0),h(this,"rendered",void 0),h(this,"updated",void 0),this.template=n.template,this.getFunctionBody=function(t,e){var n=function(e,o){for(var i=[],t=function(t){var n=s({},e[t]);n.compile=e[t].compile,i.push(n),s(n.atts,o.atts,function(t,e){C(t,e,n,null,r.instance)})},n=0;n<e.length;n++)t(n);return i}(t.parse(r.template,null,{originalCustomTag:e.tag,context:e.context,customParent:e}),e);return t.compile(n,!1,!0,!0)},this.getFunctionEnd=function(){return";_els.pop();"},this.rendered=n.rendered||function(t,e,n){},this.updated=n.updated||function(t,e,n){}}var A=function(){function o(t,e){var n;return c(this,o),h(f(n=g(this,p(o).call(this,e))),"type","comment"),h(f(n),"comment",void 0),n.comment=t,n}return e(o,_),i(o,[{key:"compile",value:function(){return""}},{key:"updateFrom",value:function(){return{added:[],removed:[],elements:[]}}}]),o}(),T=function(){function a(t,e,n,o,i){var r;c(this,a),(r=g(this,p(a).call(this,e))).templateResolver=n,r.stack=o,r.parseIdStack=i,h(f(r),"type","element"),h(f(r),"namespace",void 0),h(f(r),"atts",void 0),h(f(r),"custom",void 0);var s=t.el.split(":");return r.tag=t.el,2===s.length&&(r.namespace=s[0]),r.atts=t.atts,r.bindings=t.bindings,r.remove=!1,r}return e(a,_),i(a,[{key:"compile",value:function(t){var e=this.instance.getCustomTag(this.tag);if(e){for(var n=e.getFunctionBody(this.instance,this),o="_rotors.customTagRendered('"+this.tag+"', _le, __knockleData[0]);",i=0;i<this.children.length;i++)this.children[i].precompile&&(n+=this.children[i].precompile(this.instance)),n+=this.children[i].compile(),this.children[i].postcompile&&(n+=this.children[i].postcompile(this.instance));return n+="_le=_els.pop();"+o+"_rotors.pet(_eid,'"+this.uuid+"');"}var r,s,a="/* element entry "+this.uuid+" */;";if(!0!==this.remove)for(var l in a+=this.instance.getExecutionContent(this.tag,this.uuid,!1,this.namespace),this.atts)if(this.atts.hasOwnProperty(l)){var u=void 0;if(null!=this.bindings[l]){if(u="_rotors.bind(__knockleData[0], '"+this.bindings[l].u+"');",r=l.match(/\(([^)]+)\)/))s=';if(__a!=null){_rotors.addCommand(_eid,e,"'+r[1]+'","'+this.atts[l]+'");}'}else u="'"+this.atts[l]+"'";a+="__a="+u+(r?s:";if(__a!=null) {_rotors.setAttribute(e,'"+l+"',__a || '');}")}for(var d=0;d<this.children.length;d++){this.children[d].precompile&&(a+=this.children[d].precompile());var c=this.children[d].compile();a+=c,this.children[d].functionBody=c,this.children[d].postcompile&&(a+=this.children[d].postcompile())}return!0===this.remove||t||(a+="_le=_els.pop();",a+="_rotors.pet(_eid, '"+this.uuid+"');"),a}},{key:"_applyStyles",value:function(o,t){t.split(";").forEach(function(t){var e=t.indexOf(":"),n=t.substring(0,e);o.style[n]=t.substring(e+1)})}},{key:"updateFrom",value:function(t,e){var n,o,i,r={added:[],removed:[],elements:[]};for(n in this.atts)this.atts.hasOwnProperty(n)&&"class"!==n&&((o=e.el.getAttribute(n))?"style"===n&&null!=t.el.style?this._applyStyles(t.el,o):t.el.setAttribute(n,o):t.el.removeAttribute(n));if(this.originalCustomTag){var s=this.instance.getCustomTag(this.originalCustomTag);s&&r.elements.push([t.el,s])}for(var a=0;a<t.children.length;a++)i=this.instance.updateFrom(t.children[a],e.children[a],t),Array.prototype.push.apply(r.removed,i.removed),Array.prototype.push.apply(r.added,i.added),Array.prototype.push.apply(r.elements,i.elements);if(t.el._RotorsUpdate)for(var l=this.instance.updaters[t.el._RotorsUpdate],u=0;u<l.length;u++)l[u](t.el);return r}}]),a}(),D={},M={construct:function(t,e,n,o,i,r){var s=D[t];if(s)return new s(e,n,o,i,r);throw{message:"Knockle: unknown element '"+t+"'"}},register:function(t,e){D[t]=e},exists:function(t){return null!=D[t]}},N=function(){function t(){c(this,t),h(this,"childNodes",void 0),this.childNodes=[]}return i(t,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"toString",value:function(){for(var t="",e=0;e<this.childNodes.length;e++)t+=this.childNodes[e].toString();return t}}]),t}(),O=function(){function n(t){var e;return c(this,n),h(f(e=g(this,p(n).call(this))),"tag",void 0),h(f(e),"atts",void 0),e.tag=t,e.atts={},e}return e(n,N),i(n,[{key:"getAttribute",value:function(t){return this.atts[t]}},{key:"setAttributeNS",value:function(t,e,n){this.atts[t+":"+e]=n}},{key:"setAttribute",value:function(t,e){this.atts[t]=e}},{key:"toString",value:function(){var t="<"+this.tag,e="";for(var n in this.atts)e+=" "+n+'="'+this.atts[n]+'"';t=t+e+">";for(var o=0;o<this.childNodes.length;o++)t+=this.childNodes[o].toString();return t+"</"+this.tag+">"}},{key:"insertAdjacentElement",value:function(){throw"FakeElement insertAdjacentElement - not implemented. Update failed."}}]),n}(),F=function(){function e(t){c(this,e),h(this,"nodeValue",void 0),this.nodeValue=t}return i(e,[{key:"toString",value:function(){return this.nodeValue}}]),e}();var L=function(){function o(e,t,n){c(this,o),this.registerGlobalTag=t,this.getGlobalTag=n,h(this,"templateResolver",void 0),h(this,"defaultTemplate",void 0),h(this,"entries",void 0),h(this,"bindings",void 0),h(this,"customTags",{}),h(this,"cache",new Map),h(this,"templateCache",new Map),h(this,"openRe",new RegExp("<([^/>]*?)>$|<([^/].*[^/])>$")),h(this,"closeRe",new RegExp("^</([^>]+)>")),h(this,"openCloseRe",new RegExp("<(.*)(/>$)")),h(this,"tokenizerRe",/(<[^\^>]+\/>)|(<!--[\s\S]*?-->)|(<[\/a-zA-Z0-9\-:]+(?:\s*[\(a-zA-Z\-\)]+=\"[^\"]*\"|\s*[a-zA-Z\-]+='[^']+'|\s*[\(a-zA-Z\-\)]|\s*\{\{.*\}\})*>)/),h(this,"commentRe",/<!--[\s\S]*?-->/),h(this,"attributesRe",/([\(a-zA-Z0-9\-_:\)]+="[^"]*")|(\{\{if [^(?:\}\})]+\}\}.*\{\{\/if\}\})/),h(this,"inlineIfRe",/\{\{if ([^\}]+)\}\}(.*)\{\{\/if\}\}/),h(this,"singleExpressionRe",/^[\s]*\$\{([^\}]*)\}[\s]*$/),h(this,"_fnPreamble","__knockleData=[__knockleData||{}];var frag=_rotors.cf(),_els=[],e,_le,__a,$value,$key,_eid = _rotors.nec();_els.push(frag);"),h(this,"_fnSuffix",";_rotors.pushCommands(_eid,frag);return frag;"),h(this,"isBrowser",!0),h(this,"executions",void 0),h(this,"updaters",{}),h(this,"namespaceHandlers",{svg:function(t){return"e = document.createElementNS('http://www.w3.org/2000/svg', '"+t.split(":")[1]+"');e.setAttribute('version', '1.1');e.setAttribute('xmlns', 'http://www.w3.org/1999/xhtml');"}}),h(this,"namespaces",{xlink:"http://www.w3.org/1999/xlink"}),e=e||{},this.entries={},this.bindings={},this.executions={},this.defaultTemplate=e.defaultTemplate,this.templateResolver=e.templateResolver?e.templateResolver:e.templates?function(t){return e.templates[t]}:function(t){return t.isBrowser?d:null}(this)}return i(o,[{key:"bind",value:function(t,e){var n=this.bindings[e];return null==n?"":n.reapply(t)}},{key:"addCommand",value:function(t,e,n,o){this.executions[t].commands=this.executions[t].commands||{},this.executions[t].commands[n]=this.executions[t].commands[n]||[],this.executions[t].commands[n].push({element:e,command:n,action:o})}},{key:"pushCommands",value:function(t,e){e.commands=this.executions[t].commands}},{key:"setAttribute",value:function(t,e,n){var o=e.split(":");1===o.length||null==this.namespaces[o[0]]?t.setAttribute(o[0],n):t.setAttributeNS(this.namespaces[o[0]],o[1],n)}},{key:"clearCache",value:function(){this.cache.clear(),this.templateCache.clear()}},{key:"cf",value:function(){return this.isBrowser?document.createDocumentFragment():new N}},{key:"ctn",value:function(t){return this.isBrowser?document.createTextNode(t):new F(t)}},{key:"ce",value:function(t){return this.isBrowser?document.createElement(t):new O(t)}},{key:"nec",value:function(){var t=a();return this.executions[t]={current:[{children:[]}]},t}},{key:"te",value:function(t,e,n,o){var i={el:t,children:[],id:n,index:o};this.executions[e].current[0].children.push(i);var r=n+(null!=o?"-"+o:"");this.executions[e][r]=i,this.executions[e].current.unshift(i)}},{key:"pet",value:function(t){this.executions[t].current=this.executions[t].current.splice(1)}},{key:"parseAttributes",value:function(t){return b(t,this.attributesRe)}},{key:"getExecutionContent",value:function(t,e,n,o){return(null!=o?this.namespaceHandlers[o](t):n?"e=_rotors.ctn("+t+");":"e=_rotors.ce('"+t+"');")+"_rotors.peek(_els).appendChild(e);"+(n?"":"_els.push(e);")+"e._rotors=_rotors.entries['"+e+"'];e._rotorsEid=_eid;if(typeof _rotorsLoopId !== 'undefined') {e._rotorsLoopId=_rotorsLoopId;e._rotorsLoopContext=_rotorsLoopContext;e._rotorsKey=$key;}_rotors.te(e, _eid, '"+e+"', typeof $key != 'undefined' ? $key  : null);"}},{key:"_wrapCache",value:function(n,o){var i=this;return function(t){var e=o?null:i.cache.get(t);return null==e&&(e=n(t)),null==e&&(e=i.defaultTemplate),null!=e&&i.cache.set(t,e),e}}},{key:"constructElement",value:function(t,e,n,o,i){return M.construct(t,e,this,n,o,i)}},{key:"isCustomElement",value:function(t){return M.exists(t)}},{key:"parse",value:function(t,l,e,u){var d=this;u=u||[],l=this._wrapCache(l||this.templateResolver,null);function n(){return 0<s.length?s[s.length-1]:null}function i(t,e){0<s.length&&n().children.push(t),e?0===s.length&&a.push(t):s.push(t)}function o(){var t=s.pop();if(0!==s.length||t.remove){if(t.remove){var e=n();e&&e.children.pop()}}else a.push(t);return t}function r(t,e,n){var o=j(t,d);return d.isCustomElement(o.el)?d.constructElement(o.el,o,n,s,u):new T(o,d,n,s,u)}var s=[],a=[],c=[{re:this.commentRe,handler:function(t,e,n,o){i(new A(t,o),!0)}},{re:this.openRe,handler:function(t,e,n){var o=r(t,0,n);i(o,o.remove)}},{re:this.closeRe,handler:function(t,e){if("r-tmpl"!==e[1]){if(!function(t){var e=n();return null!=e&&e.tag===t}(e[1]))throw new TypeError("Unbalanced closing tag '"+e[1]+"'; opening tag was '"+o().tag+"'");o()}}},{re:this.openCloseRe,handler:function(t,e,n){var o=r(t,0,n);i(o,!0)}},{re:/.*/,handler:function(t){var e=new w({value:t},d);!function(t){i(t,!0)}(e),x("__element",t,e,null,d)}}];if(y(v(t).split(this.tokenizerRe),function(t,e){for(var n,o,i,r=v(e),s=0;s<c.length;s++){var a=(n=r,o=c[s].re,void 0,null==(i=n.match(o))?null:i);if(a){c[s].handler(e,a,l,d,u);break}}}),0<a.length&&e)for(var h in e)a[0][h]=e[h];return a}},{key:"compile",value:function(t,e,n,o){for(var i,r=[],s=0;s<t.length;s++){var a="";t[s].precompile&&(a+=t[s].precompile(this)),a+=i=t[s].compile(o),t[s].functionBody=i,t[s].postcompile&&(a+=t[s].postcompile(this)),r.push(a)}var l=r.join("");if(n)return l;var u=this._compileSingle(l),d=this;if(e)return u;function c(t){return u.apply(this,[t,d])}return c.functionBody=l,c}},{key:"_compileSingle",value:function(t){return new Function("__knockleData,_rotors",this._fnPreamble+t+this._fnSuffix)}},{key:"_executeSingle",value:function(t,e){return this._compileSingle(t)(e,this)}},{key:"updateFrom",value:function(t,e,n){return this.entries[t.id].updateFrom(t,e,n)}},{key:"getTemplate",value:function(t){return this.templateCache.get(t)}},{key:"template",value:function(t,e,n,o){var i=o?null:this.templateCache.get(t);if(null!=i)return i(e);var r=(n=this._wrapCache(n||this.templateResolver,o))(t);if(null==r)return this.cf();var s=this.parse(r,n,null,[t]),a=this.compile(s);return this.templateCache.set(t,a),a(e)}},{key:"peek",value:function(t){return P(t)}},{key:"data",value:function(t,e,n){return l(t,e,n)}},{key:"each",value:function(t,e,n,o,i){var r;if(Array.isArray(t))for(r=0;r<t.length;r++)e(t[r],n,r,o,i);else for(r in t)t.hasOwnProperty(r)&&e({$key:r,$value:t[r]},n,r,o,i)}},{key:"update",value:function(t,o){var e,n,i,r,s=this,a=t._rotorsEid;if(null!=a&&null!=t._rotors){e=(i=t._rotors.instance).executions[a];var l=t._rotorsKey;n=e[t._rotors.uuid+(null!=l?"-"+l:"")],r=i.entries[n.id];var u=i._executeSingle(r.customParent?r.customParent.functionBody:r.functionBody,o).childNodes[0],d=u._rotorsEid,c=i.executions[d][u._rotors.uuid],h=this.updateFrom(n,c,null);return h.elements.forEach(function(t){var e=m(t,2),n=e[0];e[1].updated(n,o,s)}),h}}},{key:"onUpdate",value:function(t,e){if(null!=t._rotors){var n=t._rotors.instance;t._RotorsUpdate=t._RotorsUpdate||a(),n.updaters[t._RotorsUpdate]=n.updaters[t._RotorsUpdate]||[],n.updaters[t._RotorsUpdate].push(e)}}},{key:"copyChildNodes",value:function(t,e){for(var n=t.childNodes.length,o=0;o<n;o++)e.appendChild(t.childNodes[0])}},{key:"remove",value:function(t){t._RotorsUpdate&&this.updaters[t._RotorsUpdate]&&delete this.updaters[t._RotorsUpdate],t._rotorsEid&&this.executions[t._rotorsEid]&&delete this.executions[t._rotorsEid]}},{key:"registerTag",value:function(t,e,n){var o=new k(this,t,e);n?this.registerGlobalTag(t,o):this.customTags[t]=o}},{key:"getCustomTag",value:function(t){return this.customTags[t]||this.getGlobalTag(t)}},{key:"customTagRendered",value:function(t,e,n,o){var i=this.getCustomTag(t);i&&i.rendered(e,n,o)}},{key:"destroy",value:function(){this.executions=null,this.updaters=null}}]),o}(),R=function(){function s(t,e,n,o,i){var r;return c(this,s),h(f(r=g(this,p(s).call(this,t,e,n,o,i))),"context",void 0),h(f(r),"key",void 0),h(f(r),"type","each"),r.context=t.atts.in,r.key=t.atts.key,r.tag="r-each",r}return e(s,T),i(s,[{key:"compile",value:function(){var o=this;return";_rotors.te(null, _eid, '"+this.uuid+"');"+(this.context?';__knockleData.unshift(_rotors.data(__knockleData[0], "'+this.context+'"));':"")+("_rotors.each(__knockleData[0], "+function(){var t="function(item, _rotorsLoopId, _rotorsLoopIndex, _rotorsLoopContext, _key) { ";t+="__knockleData.unshift(item);$value=item;",t+="$key=_key ? _rotors.data($value, _key) : _rotorsLoopIndex;";for(var e=0;e<o.children.length;e++){var n=o.children[e].compile();t+=o.children[e].functionBody=n}return t+="__knockleData.splice(0,1);",t+="}"}()+",'"+this.uuid+"', '"+this.context.replace(/'/g,"\\'")+"',"+(void 0===this.key?"null);":"'"+this.key+"');"))+(this.context?";__knockleData.splice(0, 1);":"")+(";_rotors.pet(_eid, '"+this.uuid+"');")}},{key:"updateFrom",value:function(t,e,n){for(var o,i=I(this.instance,t,e,["id","index"],n),r=null,s=0;s<e.children.length;s++)(o=S({index:e.children[s].index,id:e.children[s].id},t))&&o.el&&(null!=r&&r.parentNode.insertBefore(o.el,r.nextSibling),r=o.el);return i}}]),s}();M.register("r-each",R);var G=function(){function s(t,e,n,o,i){var r;return c(this,s),h(f(r=g(this,p(s).call(this,t,e,n,o,i))),"type","if"),h(f(r),"test",void 0),h(f(r),"happyFlowChildren",void 0),r.test=t.atts.test,r.tag="r-if",r}return e(s,T),i(s,[{key:"compile",value:function(){var t,e="",n="",o=this.happyFlowChildren||this.children;for(t=0;t<o.length;t++)e+=o[t].compile()+";";if(null!=this.happyFlowChildren){for(n="else {",t=0;t<this.children.length;t++)n+=this.children[t].compile()+";";n+="}"}return";_rotors.te(null, _eid, '"+this.uuid+"');"+"with (__knockleData[0]) { if("+this.test+") { "+e+" }"+n+"}_rotors.pet(_eid);"}},{key:"updateFrom",value:function(t,e,n){return I(this.instance,t,this.flatMap(e),["id"],n)}},{key:"flatMap",value:function(t){var e=[];return t.children.forEach(function(t){null==t.el?e.push.apply(e,r(t.children)):e.push(t)}),{el:t.el,index:t.index,id:t.id,children:e}}}]),s}();M.register("r-if",G);var z=function(){function a(t,e,n,o,i){var r;c(this,a),r=g(this,p(a).call(this,t,e,n,o,i));var s=P(o);return null!=s&&s instanceof G&&(s.happyFlowChildren=s.children,s.children=[]),r.remove=!0,r.tag="r-else",r}return e(a,T),i(a,[{key:"compile",value:function(){return""}},{key:"updateFrom",value:function(){return{added:[],removed:[],elements:[]}}}]),a}();M.register("r-else",z);var U=function(){function d(t,e,n,o,i){var r;if(c(this,d),h(f(r=g(this,p(d).call(this,t,e,n,o,i))),"templateId",void 0),h(f(r),"lookup",void 0),h(f(r),"default",void 0),r.context=t.atts.context,r.type="template",r.remove=!0,t.atts.lookup)r.lookup=t.atts.lookup,r.default=t.atts.default||"",r.compile=function(){return';with(__knockleData[0]){var tlid=eval("'+r.lookup.replace(/[\$\{\}]/g,"")+'");}if (_rotors.templateCache[tlid] == null){var ___t = _rotors.templateResolver(tlid) || _rotors.templateResolver("'+r.default+'");_rotors.templateCache[tlid]=_rotors.compile(_rotors.parse(___t));} eval(_rotors.templateCache[tlid].functionBody);'};else{r.templateId=t.atts.id;var s=E(o);if(-1!==i.indexOf(r.templateId)){if(!s)throw new TypeError("recursive template call ["+r.templateId+"]");r.compile=function(){return";eval(_rotors.getTemplate('"+r.templateId+"').functionBody);"}}else{var a=n(r.templateId);i.push(r.templateId);var l=r.instance.parse(a,n,null,i);null==r.instance.templateCache.get(r.templateId)&&r.instance.templateCache.set(r.templateId,r.instance.compile(l));for(var u=0;u<l.length;u++)l[u].context=r.context;r.children=l,i.pop()}}return r.precompile=function(){return r.context?';__knockleData.unshift(_rotors.data(__knockleData[0], "'+r.context+'"));':""},r.postcompile=function(){return r.context?";__knockleData.splice(0, 1);":""},r}return e(d,T),i(d,[{key:"updateFrom",value:function(){return{added:[],removed:[],elements:[]}}}]),d}();M.register("r-tmpl",U);var B=function(){function r(t,e,n,o,i){return c(this,r),g(this,p(r).call(this,t,e,n,o,i))}return e(r,T),i(r,[{key:"compile",value:function(){try{return";var __hp=_rotors.parse(__knockleData[0]."+this.children[0].bindings.__element.e[0][1]+"),__hc=_rotors.compile(__hp,true);var __f=__hc(__knockleData[0], _rotors);_rotors.copyChildNodes(__f, _rotors.peek(_els));"}catch(t){return""}}},{key:"updateFrom",value:function(){return{added:[],removed:[],elements:[]}}}]),r}();if(M.register("r-html",B),"undefined"!=typeof window){var V={},H=function(t,e){if(null!=V[t])throw new Error("Tag '"+t+"' already registered");V[t]=e},W=function(t){return V[t]};window.Knockle={newInstance:function(t){return new L(t||{},H,W)},data:function(t,e,n){return l(t,e,n)},filterEmpty:function(t){return u(t)}}}t.AbstractEntry=_,t.CommentEntry=A,t.CustomTag=k,t.EachEntry=R,t.ElementEntry=T,t.Elements=M,t.ElseEntry=z,t.HtmlEntry=B,t.IfEntry=G,t.InBrowserTemplateResolver=d,t.Knockle=L,t.TextEntry=w,t.TmplEntry=U,t._addBinding=x,t._bindOneAtt=C,t.data=l,t.eachNotEmpty=y,t.extend=s,t.fastTrim=v,t.filterEmpty=u,t.isLoopPresent=E,t.parseAttributes=b,t.parseAtts=j,t.peek=P,t.uuid=a,Object.defineProperty(t,"__esModule",{value:!0})}),function(){this.jsPlumbUtil=this.jsPlumbUtil||{};var t,r=this.jsPlumbUtil;"undefined"!=typeof exports&&(exports.jsPlumbUtil=r),(t=r.xml||(r.xml={})).setNodeText=function(t,e){t.text=e;try{t.textContent=e}catch(t){}},t.getNodeText=function(t){return null!=t?t.text||t.textContent:""},t.getChild=function(t,e){for(var n=null,o=0;o<t.childNodes.length;o++)if(1===t.childNodes[o].nodeType&&t.childNodes[o].nodeName===e){n=t.childNodes[o];break}return n},t.getChildren=function(t,e){for(var n=[],o=0;o<t.childNodes.length;o++)1===t.childNodes[o].nodeType&&t.childNodes[o].nodeName===e&&n.push(t.childNodes[o]);return n},t.xmlToString=function(e){try{return(new XMLSerializer).serializeToString(e).replace(/\s*xmlns=\"http\:\/\/www.w3.org\/1999\/xhtml\"/g,"")}catch(t){try{return e.xml}catch(t){throw new Error("Cannot serialize XML "+t)}}},t.createElement=function(e,t,n){var o;try{o=new ActiveXObject("Microsoft.XMLDOM").createNode(1,e,"")}catch(t){o=document.createElement(e)}if(n&&r.xml.setNodeText(o,n),t)for(var i in t)o.setAttribute(i,t[i]);return o},r.debounce=function(t,e){e=e||150;var n=null;return function(){window.clearTimeout(n),n=window.setTimeout(t,e)}},r.ajax=function(t){var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n=t.type||"GET";if(e){var o="json"===t.dataType?function(t){return JSON.parse(t)}:function(t){return t};e.open(n,t.url,!0);var i=t.headers||{};for(var r in i)e.setRequestHeader(r,i[r]);e.onreadystatechange=function(){4===e.readyState&&("2"===(""+e.status)[0]?t.success(o(e.responseText)):t.error&&t.error(e.responseText,e.status))},e.send(t.data?JSON.stringify(t.data):null)}else t.error&&t.error("ajax not supported")}}.call("undefined"!=typeof window?window:this),function(){jsPlumbUtil.FilterableDataset=function(e){this.filter=function(r,s){var i="function"==typeof r?r:function(t){var e=t.data,n=!1;for(var o in r){var i=r[o]===e[o];if(!i&&!s)return!1;n=n||i}return n},a=function(t){return new jsPlumbUtil.Selection({toolkit:e,onClear:t||function(){}})}();return this.eachNode(function(t,e){i(e)&&a.append(e);for(var n=e.getPorts(),o=0;o<n.length;o++)i(n[o])&&a.append(n[o])}),this.eachEdge(function(t,e){i(e)&&a.append(e)}),this.eachGroup(function(t,e){i(e)&&a.append(e)}),a}}}.call("undefined"==typeof window?this:window),function(){var T=this.jsPlumb,D=this.jsPlumbUtil,M="jtk-animate-node-traversing",N="jtk-animate-edge-traversing",O="jtk-animate-edge-traversed",F="INITIALIZED",L="TRAVERSING_START",R="TRAVERSING_EDGE",G="TRAVERSING_END",z="CANCELLED",U="FINISHED";T.Connection.prototype.animateOverlay=function(t,e){var n=this,o=new D.EventGenerator,i=n.getConnector().getLength();e=e||{};var r=D.uuid(),s=e.events||{};for(var a in s)o.bind(a,s[a]);var l,u,d,c=null,h=!1!==e.forwards,p=e.rate||30,f=e.dwell||350,g=1/(i/(e.speed||100)*1e3/p)*(h?1:-1),m=!1!==e.isFinal,v=h?0:1,y=v,b=h?n.source:n.target,P=h?n.target:n.source,E=!0===e.paused,x=!1,C=!1,j=F;if("string"==typeof t)d=[t,{location:v,id:r}];else{var _=T.extend({},t[1]);_.location=v,_.id=r,d=[t[0],_]}function w(t){C=!1,n.removeOverlay(r),window.clearInterval(l),m?t?(j=z,T.removeClass(b,M),T.removeClass(P,M),n.removeClass(N)):(j=G,T.addClass(P,M),window.setTimeout(function(){A()},f)):(T.removeClass(b,M),T.removeClass(P,M),n.removeClass(N),t?j=z:(j=U,n.addClass(O),o.fire(jsPlumbToolkit.Events.endOverlayAnimation,{connection:n,harness:c})))}function S(){y+=g,(h?1<=y:y<=0)?w():(u.loc=y,n.repaint())}function I(){C||j===U||j===z||(T.removeClass(b,M),o.fire(jsPlumbToolkit.Events.nodeTraverseEnd,{connection:n,element:b,harness:c}),j=R,o.fire(jsPlumbToolkit.Events.startOverlayAnimation,{connection:n,harness:c}),u=n.addOverlay(d),l=window.setInterval(S,p))}function k(){C=!(x=!0),o.fire(jsPlumbToolkit.Events.nodeTraverseStart,{connection:n,element:b,harness:c}),T.addClass(b,M),n.addClass(N),j=L,window.setTimeout(function(){I()},f)}var A=function(){C||j===U||j===z||(j=U,T.removeClass(b,M),T.removeClass(P,M),n.removeClass(N),o.fire(jsPlumbToolkit.Events.endOverlayAnimation,{connection:n,harness:c}))};return c={eventGenerator:o,play:function(){x?C&&(C=!1,j===L?I():j===G?A():l=window.setInterval(S,p)):k()},pause:function(){C=!0,window.clearInterval(l)},cancel:function(){j!==U&&j!==z&&(window.clearInterval(l),w(!0))},connection:n},e.previous?e.previous.eventGenerator.bind(jsPlumbToolkit.Events.endOverlayAnimation,k):E||k(),c}}.call("undefined"==typeof window?this:window),function(){this.jsPlumbUtil=this.jsPlumbUtil||{};var t=this.jsPlumbUtil;"undefined"!=typeof exports&&(exports.jsPlumbUtil=t);function g(t,e,n,o){for(var i=0;i<e.length;i++)for(var r=0;r<n.length;r++)x(t,e[i]+n[r],o)}var m=["node","port","edge","group"],v=["Added","Removed","Updated","Moved"],y=["edge"],b=["Source","Target"],P=["group:"],E=["addMember","removeMember"],x=function(t,e,n){t.instance.bind(e,n),t.bindings.push([e,n])};t.AutoSaver=function(e,t,n,o,i,r,s,a,l){var u=null,d=[];function c(t){return function(){t&&t.apply(t,arguments),s&&s()}}function h(){if(!f){try{r&&r()}catch(t){}null!=l?l(e):e.save({url:t,success:c(o),error:c(i),headers:n})}}function p(){null==a?h():u=(null==u||clearTimeout(u),setTimeout(h,a))}this.bindings=d,this.instance=e;var f=!1;x(this,"dataLoadStart",function(){f=!0}),x(this,"dataLoadEnd",function(){f=!1}),x(this,"graphClearStart",function(){f=!0}),x(this,"graphCleared",function(){f=!1}),g(this,m,v,p),g(this,y,b,p),g(this,P,E,p),this.discard=function(){d.forEach(function(t){return e.unbind(t[0],t[1])}),d.length=0}},t.CatchAllEventHandler=function(t){function e(){t.fire("dataUpdated")}this.bindings=[],this.instance=t,g(this,m,v,e),g(this,y,b,e),g(this,P,E,e)}}.call("undefined"!=typeof window?window:this),function(){var j=this.jsPlumbUtil;j.Selection=function(t){t=t||{},j.EventGenerator.apply(this,arguments),j.FilterableDataset.apply(this,[t.toolkit]);function i(t){return"Edge"===t.objectType?l:"Node"===t.objectType?s:a}var r,u=t.toolkit,s=[],a=[],l=[],d=Math.Infinity,c=Math.Infinity,h=Math.Infinity,e=t.generator,n=t.onReload,o=t.onBeforeReload,p=!0===t.autoFill,f=!1,g={},m=this,v=t.onClear||function(){},y=function(t,e){var n=t.objectType.toLowerCase()+e,o={Group:{data:t.data,group:t},Node:{data:t.data,node:t},Port:{data:t.data,node:t.node,port:t},Edge:{data:t.data,edge:t}};m.fire(n,o[t.objectType])};this.getModel=u.getModel,this.setSuspendGraph=u.setSuspendGraph,this.getNodeId=u.getNodeId,this.getGroupId=u.getNodeId,this.getEdgeId=u.getEdgeId,this.getPortId=u.getPortId,this.getNodeType=u.getNodeType,this.getGroupType=u.getNodeType,this.getEdgeType=u.getEdgeType,this.getPortType=u.getPortType,this.getObjectInfo=u.getObjectInfo,this.isDebugEnabled=u.isDebugEnabled,this.beforeStartConnect=u.beforeStartConnect,this.beforeConnect=u.beforeConnect,this.getEdgeFactory=u.getEdgeFactory,this.addPort=u.addPort,this.addEdge=u.addEdge,this.edgeMoved=u.edgeMoved,this.removeEdge=u.removeEdge,this.setEdgeGeometry=u.setEdgeGeometry,this.removeFromGroup=u.removeFromGroup,this.batch=u.batch,this.getGraph=u.getGraph;function b(t,e){if(g[t.getFullId()])return[[],[]];var n=function(t){var e=[],n=i(t),o="Edge"===t.objectType?c:"Node"===t.objectType?d:h;if(n.length>=o){if(r===j.Selection.DISCARD_NEW)return!1;e=n.splice(0,1),y(e[0],"Removed"),delete g[e[0].getFullId()]}return n.push(t),y(t,"Added"),e}(t);return!1===n?[[],[]]:(g[t.getFullId()]=t,e&&e(t,!0),[[t],n])}function P(e,t){return j.removeWithFunction(i(e),function(t){return t.id==e.id})&&y(e,"Removed"),delete g[e.getFullId()],t&&t(e,!1),[[],[]]}function E(t,e){return g[t.getFullId()]?P(t,e):b(t,e)}var x=function(t,o,i){var r,s=[],a=[];if(null==t)return s;var l=function(t){var e;if(j.isString(t))null!=(e=u.getNode(t)||u.getEdge(t)||u.getGroup(t))&&(r=o(e,i),s.push.apply(s,r[0]),a.push.apply(a,r[1]));else if(t.eachNode&&t.eachEdge)t.eachNode(function(t,e){l(e)}),t.eachEdge(function(t,e){l(e)}),t.eachGroup&&t.eachGroup(function(t,e){l(e)});else if(t.each)t.each(function(t,e){l(e.vertex||e)});else if(null!=t.length)for(var n=0;n<t.length;n++)l(t[n],i);else r=o(t,i),s.push.apply(s,r[0]),a.push.apply(a,r[1])};return l(t),[s,a]}.bind(this);u.bind("nodeRemoved",function(t){P(t.node)}),u.bind("groupRemoved",function(t){P(t.group)}),u.bind("portRemoved",function(t){P(t.port)}),u.bind("edgeRemoved",function(t){P(t.edge)}),u.bind("edgeTarget",function(t){g[t.edge.getFullId()]&&m.fire("edgeTarget",t)}),u.bind("edgeSource",function(t){g[t.edge.getFullId()]&&m.fire("edgeSource",t)}),u.bind("nodeAdded",function(t){e&&p&&!f&&this.reload()}.bind(this)),u.bind("nodeUpdated",function(t){g[t.node.getFullId()]&&m.fire("nodeUpdated",t)}),u.bind("groupUpdated",function(t){g[t.group.getFullId()]&&m.fire("groupUpdated",t)}),u.bind("edgeUpdated",function(t){g[t.edge.getFullId()]&&m.fire("edgeUpdated",t)}),u.bind("portUpdated",function(t){g[t.port.getFullId()]&&m.fire("portUpdated",t)}),this.remove=function(t,e){return x(t,P,e)},this.append=function(t,e){return x(t,b,e)},this.toggle=function(t,e){return x(t,E,e)},this.setMaxNodes=function(t){d=t},this.setMaxEdges=function(t){c=t},this.setCapacityPolicy=function(t){r=t},this.clear=function(t){s.length=0,l.length=0,a.length=0,g={},m.fire("graphClearStart"),t||v(this)},u.bind("graphCleared",function(){this.clear()}.bind(this)),u.bind("dataLoadEnd",function(){this.reload()}.bind(this)),this.reload=function(){null!=e&&(o&&o(),this.clear(),f=!0,this.fire("dataLoadStart"),e(this,u),this.fire("dataLoadEnd"),n&&n(),f=!1)},this.each=function(t,e){for(var n="Edge"===e?l:"Group"===e?a:s,o=0;o<n.length;o++)try{t(o,n[o])}catch(t){j.log("Selection iterator function failed",t)}},this.eachNode=this.each,this.eachGroup=function(t){this.each(t,"Group")},this.eachNodeOrGroup=function(t){this.each(t,"Node"),this.each(t,"Group")},this.eachEdge=function(t){this.each(t,"Edge")},this.getNodeCount=function(){return s.length},this.getNodeAt=function(t){return s[t]},this.getNodes=function(){return s},this.getNode=u.getNode,this.getGroupAt=function(t){return a[t]},this.getGroups=function(){return a},this.getGroup=u.getGroup,this.getGroupCount=function(){return a.length},this.getAll=function(){var t=[];return Array.prototype.push.apply(t,s),Array.prototype.push.apply(t,l),Array.prototype.push.apply(t,a),t};function C(t){for(var e=[],n=0;n<t.length;n++)null!=g[t[n].getId()]&&e.push(t[n]);return e}this.getAllEdgesFor=function(t,e){return C(t.getAllEdges({filter:e}))},this.getSourceEdgesFor=function(t){return C(t.getSourceEdges())},this.getEdgeCount=function(){return l.length},this.get=this.getNodeAt=function(t){return s[t]},this.getEdge=this.getEdgeAt=function(t){return l[t]},this.getEdges=function(){return l},this.setCapacityPolicy(j.Selection.DISCARD_EXISTING),!0!==t.lazy&&this.reload()},j.Selection.DISCARD_EXISTING="discardExisting",j.Selection.DISCARD_NEW="discardNew"}.call("undefined"!=typeof window?window:this),function(){"use strict";var b=this.jsPlumbGraph={};b.version="0.1",b.name="jsPlumbGraph";function h(t,e){var n={};this.setAttribute=function(t,e){n[t]=e},this.getAttribute=function(t){return n[t]};var o=e.getType(t||{});this.getType=function(){return o},this.setType=function(t){o=t},this.graph=e}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}function P(t,e,n){return null==t?o():"string"==typeof t?t:(e||n.getIdFunction())(t)||o()}function T(t,e,n,o,i){for(var r=-1,s=null,a=1/0,l=0;l<t.length;l++)if(!e[l]){var u=i(t[l]);u<a?(a=u,s=t[r=l]):u===a&&t[l].getNode&&t[l].getNode()===s&&(s=t[r=l])}return{node:s,index:r}}function u(t,e){var n=e.getFullId(),o=t[n];return null==o&&(o=t[n=e.getNode?e.getNode().id:e.id]),null==o?null:{p:o,id:n}}function D(t,e,n,o,i,r){for(var s=[],a=o,l=u(e,a);null!=l;)s.splice(0,0,{vertex:a,cost:t[l.id],edge:n[l.id]}),a=l.p,l=u(e,a);return s.splice(0,0,{vertex:a,cost:0,edge:null}),s}var E=b.Vertex=b.Node=function(t,e,s){h.apply(this,[t,s]),this.objectType="Node",this.id=P(t,e,s),this.data=function(t){return"string"==typeof t?{id:t}:t}(t),this.getFullId=function(){return this.id};var o=[],i=0,r=0,a=[],n=[],l={};this.getEdges=function(t){if(null==t||null==t.filter)return o;for(var e=[],n=0;n<o.length;n++)t.filter(o[n])&&e.push(o[n]);return e},this.getSourceEdges=function(){return this.getEdges({filter:function(t){return t.source===this}.bind(this)})},this.getTargetEdges=function(){return this.getEdges({filter:function(t){return t.target===this}.bind(this)})},this.addEdge=function(t){o.push(t),t.source!==this&&t.isDirected()||r++,t.target!==this&&t.isDirected()||i++},this.deleteEdge=function(t){for(var e=-1,n=0;n<o.length;n++)if(o[n].getId()===t.getId()){e=n;break}return-1<e&&(o.splice(e,1),t.source!==this&&t.isDirected()||r--,t.target!==this&&t.isDirected()||i--,!0)},this.getAllEdges=function(t){for(var e=this.getEdges(t).slice(0),n=0;n<a.length;n++)e.push.apply(e,a[n].getEdges(t));return e},this.getAllSourceEdges=function(){for(var t=this.getSourceEdges().slice(0),e=0;e<a.length;e++)t.push.apply(t,a[e].getSourceEdges());return t},this.getAllTargetEdges=function(){for(var t=this.getTargetEdges().slice(0),e=0;e<a.length;e++)t.push.apply(t,a[e].getTargetEdges());return t},this.getDirectEdges=function(t){return this.getEdges(t)},this.getDirectSourceEdges=function(){return this.getSourceEdges()},this.getDirectTargetEdges=function(){return this.getTargetEdges()},this.getPortEdges=function(t){for(var e=[],n=0;n<a.length;n++)e.push.apply(e,a[n].getEdges(t));return e},this.getPortSourceEdges=function(){for(var t=[],e=0;e<a.length;e++)t.push.apply(t,a[e].getSourceEdges());return t},this.getPortTargetEdges=function(){for(var t=[],e=0;e<a.length;e++)t.push.apply(t,a[e].getTargetEdges());return t},this.addGraph=function(t){return t="string"==typeof t?new b.Graph({id:t}):t,n.push(t),t.id||(t.id=""+n.length),t},this.getGraph=function(t){for(var e=0;e<n.length;e++)if(n[e].id===t)return n[e]},this.getIndegreeCentrality=function(){for(var t=0,e=0;e<a.length;e++)t+=a[e].getIndegreeCentrality();return i+t},this.getOutdegreeCentrality=function(){for(var t=0,e=0;e<a.length;e++)t+=a[e].getOutdegreeCentrality();return r+t},this.getPorts=function(){return a},this.addPort=function(t,e){var n=P(t,e,s),o=this.getPort(n);return null==o&&(o=new p(t,e,this),a.push(o),l[o.id]=o),o},this.setPort=function(t,e){var n=this.getPort(t);return(n=n||this.addPort({id:t})).data=e,n.setType(this.graph.getType(e)),n},this.getPort=function(t){return l[t]};function u(t){return t.constructor==b.Port?t.id:t}this.renamePort=function(t,e){return!!l[t.id]&&(l[e]=l[t.id],delete l[t.id],!0)},this.removePort=function(t){if(t){for(var e=u(t),n=-1,o=!1,i=0;i<a.length;i++)if(a[i].id===e){n=i;break}if(-1!=n){var r=a[n];s.deleteVertex(r.getFullId()),a.splice(n,1),o=!0}delete l[e]}return o};var d=0,c={};this.setDefaultInternalCost=function(t){d=t},this.getInternalEdge=function(t,e){var n=u(t),o=u(e),i={source:l[n],target:l[o],cost:1/0};if(i.source&&i.target){var r=c[n+"-"+o]||{cost:d,directed:!1};for(var s in r)i[s]=r[s]}return i},this.setInternalEdge=function(t,e,n,o){var i=u(t),r=u(e);return c[i+"-"+r]={cost:n||d,directed:o},this.getInternalEdge(t,e)},this.inspect=function(){for(var t="{ id:"+this.id+", edges:[\n",e=0;e<o.length;e++)t+=o[e].inspect()+"\n";return t+="]}"}},p=b.Port=function(t,e,n){E.apply(this,[t,e,n.graph]),this.objectType="Port",this.getNode=function(){return n},this.getFullId=function(){return n.id+this.graph.getPortSeparator()+this.id},this.isChildOf=function(t){return n==t},this.getPorts=this.addPort=this.deletePort=this.getPort=null},x=b.Edge=function(t){h.call(this,t.data,t.graph),this.source=t.source,this.target=t.target,this.objectType="Edge";var e=t.cost||1,n=!(!1===t.directed),o=t.id;this.data=t.data||{},this.getCost=function(){return e},this.setCost=function(t){e=t},this.getId=this.getFullId=function(){return null===o?this.source.id+"_"+this.target.id:o},this.setId=function(t){o=t},this.isDirected=function(){return n},this.setDirected=function(t){n=t},this.inspect=function(){if(null!=o)return"{ id:"+o+", connectionId:null, cost:"+e+", directed:"+n+", source:"+this.source.id+", target:"+this.target.id+"}"}},r=b.Group=function(t,e,r){E.apply(this,arguments),this.objectType="Group";var s=[],n={};this.addVertex=this.addNode=function(t){return null==n[t.id]&&(s.push(t),(n[t.id]=t).group=this,!0)},this.getVertexCount=this.getNodeCount=function(){return s.length},this.getVertices=this.getNodes=function(){return s},this.deleteVertex=this.deleteNode=function(t){if(t="string"==typeof t?n[t]:t){var e=s.indexOf(t);-1!==e&&(s.splice(e,1),delete n[t.getFullId()]),delete t.group}},this.cleanup=function(t){var e,n=this.getAllDirectEdges(),o=n.length;for(e=0;e<o;e++)r.deleteEdge(n[0]);var i=s.length;for(e=0;e<i;e++)t?r.deleteVertex(s[0]):delete s[0].group;s.length=0},this.getAllDirectEdges=function(t){var e,n=[];n.push.apply(n,this.getEdges(t).slice(0));var o=this.getPorts();for(e=0;e<o.length;e++)n.push.apply(n,o[e].getEdges(t));return n},this.getAllEdges=function(t){for(var e=[],o={},n=0;n<s.length;n++)Array.prototype.push.apply(e,s[n].getAllEdges(t).filter(function(t){var e=t.getId(),n=null==o[e];return o[e]=!0,n}));return e.push.apply(e,this.getAllDirectEdges(t)),e}},C=b.Cluster=function(t){this.vertices=[t],this.addVertex=function(t){this.vertices.push(t)}},j=(b.Graph=function(t){t=t||{},this.vertices=[],this.edges=[],this.groups=[],this.id=t.id;function l(t){delete n[t.id]}function o(t){n[t.id]=t}var u={},d=0,c={},h=0,a={},i=0,p=!(!1===t.defaultDirected),f=t.defaultCost||1,g=t.idFunction||function(t){return t.id},e=t.typeFunction||function(t){return t.type||"default"},m=!0===t.enableSubgraphs,v=t.portSeparator||".",n={};this.setIdFunction=function(t){g=t},this.getIdFunction=function(){return g},this.setTypeFunction=function(t){e=t},this.getType=function(t){return e(t)},this.getTopLevelElements=function(){return n},this.setEnableSubgraphs=function(t){m=t},this.setPortSeparator=function(t){v=t},this.getPortSeparator=function(){return v},this.splitPortId=function(t){return null!=t?t.split(v):[]},this.getVertexByPortId=function(t){var e=this.splitPortId(t);if(2===e.length)return u[e[0]]};function y(t,r){if(null==t)return null;if("string"!=typeof t){if(t.constructor==b.Port||t.constructor==b.Node||t.constructor==b.Group)return t;var e=t;if("string"!=typeof(t=g(t)))return e}function n(t){if(u[t])return u[t];if(a[t])return a[t];var e=t.split(v),n=e[0],o=u[n]||a[n];if(2!==e.length||null==o)return o;var i=o.getPort(e[1]);return null==i&&r&&(i=o.addPort(e[1])),i}var o=m?t.split("/"):[t];if(1==o.length)return n(o[0]);if(1<o.length&&o%2==0)throw"Subgraph path format error.";for(var i=null,s=0;s<o.length-1;s+=2)i=n(o[s]).getGraph(o[s+1]);return i.getVertex(o[o.length-1])}this.clear=function(){this.vertices.length=0,this.groups.length=0,h=d=0,u={},c={},a={},n={}},this.getVertices=this.getNodes=function(){return this.vertices},this.getVertexCount=this.getNodeCount=function(){return this.vertices.length},this.getVertexAt=this.getNodeAt=function(t){return this.vertices[t]},this.getEdgeCount=function(){return h},this.addEdge=function(t,e,n){var o=null==t.directed?!0==p:!(!1===t.directed),i=t.cost||f,r=P(t.data,e,this),s=y(t.source,!0),a=y(t.target,!0),l=t.data||{};if(null==s||null==s.objectType)throw new TypeError("Unknown source node ["+t.source+"]");if(null==a||null==a.objectType)throw new TypeError("Unknown target node ["+t.target+"]");if(n&&!n(s,a))return null;var u=new x({source:s,target:a,cost:i,directed:o,data:l,id:r,graph:this});return u.source.addEdge(u),u.source!==u.target&&u.target.addEdge(u),c[r]=u,h++,null!=t.geometry&&(u.geometry=t.geometry),u},this.addVertex=this.addNode=function(t,e){var n=new E(t,e||g,this);return u[n.id]?null:(this.vertices.push(n),(u[n.id]=n)._id=d++,o(n),n)},this.addVertices=this.addNodes=function(t,e){for(var n=0;n<t.length;n++)this.addVertex(t[n],e||g)},this.addGroup=function(t,e){var n=new r(t,e||g,this);return a[n.id]?a[n.id]:(this.groups.push(n),(a[n.id]=n)._id=i++,o(n),n)},this.getGroupCount=function(){return this.groups.length},this.getGroupAt=function(t){return this.groups[t]},this.getGroups=function(){return this.groups},this.addVertexToGroup=function(t,e){e="string"==typeof e?a[e]:e,(t=y(t))&&e&&(e.addVertex(t),l(t))},this.addVerticesToGroup=function(t,e){for(var n=0;n<t.length;n++)this.addVertexToGroup(t[n],e)},this.deleteVertexFromGroup=function(t){(t=y(t))&&t.group&&(t.group.deleteVertex(t),o(t))},this.deleteVerticesFromGroup=function(t,e){for(var n=0;n<t.length;n++)this.deleteVertexFromGroup(t[n],e)},this.deleteGroup=function(t,e){if(t="string"==typeof t?a[t]:t){t.cleanup(e),delete a[t.id];for(var n=-1,o=0;o<this.groups.length;o++)if(this.groups[o].id===t.id){n=o;break}return-1<n&&this.groups.splice(n,1),l(t),t}},this.getGroup=function(t){return"string"==typeof t?a[t]:t},this.deleteVertex=this.deleteNode=function(t){var e=y(t);if(e){if("Port"!==e.objectType){for(var n=-1,o=0;o<this.vertices.length;o++)if(this.vertices[o].id===e.id){n=o;break}-1<n&&(this.vertices.splice(n,1),null!=e.group&&e.group.deleteVertex(e))}for(var i=e.getEdges(),r=0;r<i.length;r++)this.deleteEdge(i[r]);if(h-=i.length,e.getPorts)for(var s=e.getPorts(),a=0;a<s.length;a++)this.deleteVertex(s[a]);delete u[e.getFullId()],d--,l(e)}},this.deleteEdge=function(t){if(null!=(t=this.getEdge(t))){var e=y(t.source);e&&e.deleteEdge(t)&&h--;var n=y(t.target);n&&n.deleteEdge(t),delete c[t.getId()]}},this.getEdge=function(t){if(null!=t){if("string"!=typeof t){if(t.constructor===b.Edge)return t;var e=t;if("string"!=typeof(t=g(t)))return e}return c[t]}},this.getEdges=function(t){function e(t){r(t)&&function(t){return!(null!=o&&t.source===a!==o||null!=i&&t.target===a!==i)}(t)&&s.push(t)}var n,o=(t=t||{}).source,i=t.target,r=t.filter||function(){return!0},s=[];if(t.node){var a=y(t.node),l=a.getAllEdges();for(n=0;n<l.length;n++)e(l[n])}else for(n in c)e(c[n]);return s},this.getAllEdges=function(){var t=[];for(var e in c)t.push(c[e]);return t},this.renamePort=function(t,e){return!!t.getNode().renamePort(t,e)&&(t.id=e,!0)},this.findPath=function(t,e,n,o,i){return t=y(t),e=y(e),s.compute({graph:this,source:t,target:e,strict:!(!1===n),nodeFilter:o,edgeFilter:i})},this.getDistance=function(t,e,n){return this.findPath(t,e,n).pathDistance},this.getVertex=this.getNode=y,this.setTarget=function(t,e){if(null==(e=y(e)))return{success:!1};var n=t.target;return t.target.deleteEdge(t),(t.target=e).addEdge(t),{old:n,edge:t,new:e,success:!0}},this.setSource=function(t,e){if(null==(e=y(e)))return{success:!1};var n=t.source;return t.source.deleteEdge(t),(t.source=e).addEdge(t),{old:n,edge:t,new:e,success:!0}},this.printPath=function(t,e){t=y(t),e=y(e);for(var n=this.findPath(t,e).path,o="["+t.id+" - "+e.id+"] : ",i=0;i<n.length;i++)o=o+"{ vertex:"+n[i].vertex.id+", cost:"+n[i].cost+", edge: "+(n[i].edge&&n[i].edge.getId())+" } ";return o},this.getDiameter=function(t){for(var e=0,n=0;n<this.vertices.length;n++)for(var o=0;o<this.vertices.length;o++)if(o!=n){var i=s.compute({graph:this,source:this.vertices[n],target:this.vertices[o]});if(null==i.path||0==i.path.length){if(!t)return 1/0}else e=Math.max(e,i.pathDistance)}return e},this.diameter=this.getDiameter,this.getCentrality=function(t){return((t=y(t)).getIndegreeCentrality()+t.getOutdegreeCentrality())/(this.getVertexCount()-1)},this.getDegreeCentrality=this.getCentrality,this.getIndegreeCentrality=function(t){return(t=y(t)).getIndegreeCentrality()/(this.getVertexCount()-1)},this.getOutdegreeCentrality=function(t){return(t=y(t)).getOutdegreeCentrality()/(this.getVertexCount()-1)},this.getCloseness=function(t){return 1/this.getFarness(t)},this.getFarness=function(t){t=y(t);var e=s.compute({graph:this,source:t,target:t,processAll:!0}),n=0;for(var o in e.dist)n+=e.dist[o];return n/(this.getVertexCount()-1)},this.getBetweenness=function(t){var e=this.getVertexCount(),n=(e-1)*(e-2)/2,o=0,l=function(t,e,n,o,i){var r=n.parents[t][e];if(0==r.length)(a=o.slice()).unshift(t),i.push(a);else for(var s=0;s<r.length;s++){var a;if(-1==o.indexOf(r[s][0].id))(a=o.slice()).unshift(r[s][0].id),l(t,r[s][0].id,n,a,i)}};t=y(t);var i=j.compute({graph:this,focus:t});for(var r in i.paths)for(var s in i.paths[r])if(r!=s){var a=[],u=0;l(r,s,i,[s],a);for(var d=0;d<a.length;d++){var c=a[d].indexOf(t.id);0<c&&c<a[d].length-1&&u++}o+=u/a.length,u}return o/n},this.inspect=function(){for(var t="",e=0;e<this.vertices.length;e++)t+=this.vertices[e].inspect()+"\n";return t},this.serialize=function(){for(var t,e,n,o,i={nodes:[],edges:[],ports:[],groups:[]},r=0;r<this.vertices.length;r++){t=this.vertices[r],i.nodes.push(t.data),e=t.getAllEdges(),n=t.getPorts();for(var s=0;s<e.length;s++)if(e[s].source==t||"Port"===e[s].source.objectType&&e[s].source.getNode()==t){var a={source:e[s].source.getFullId(),target:e[s].target.getFullId()};e[s].data&&(a.data=e[s].data),e[s].geometry&&(a.geometry=e[s].geometry),i.edges.push(a)}for(var l=0;l<n.length;l++){var u={};for(var d in n[l].data)u[d]=n[l].data[d];u.id=n[l].getFullId(),i.ports.push(u)}}for(r=0;r<this.groups.length;r++){o=this.groups[r],i.groups.push(o.data),e=o.getEdges();for(s=0;s<e.length;s++)if(e[s].source===o){a={source:o.getFullId(),target:e[s].target.getFullId()};e[s].data&&(a.data=e[s].data),i.edges.push(a)}}return i},this.getClusters=function(){var t,r=[],s={},a=function(t,e){if(null!=t&&!s[t.id]){null==e?(e=new C(t),r.push(e)):e.addVertex(t),s[t.id]=!0;for(var n=t.getAllEdges(),o=0;o<n.length;o++){var i=n[o].source===t?n[o].target:n[o].source;a(i,e)}}};for(t=0;t<this.vertices.length;t++)a(this.vertices[t]);for(t=0;t<this.groups.length;t++)a(this.groups[t]);return r}},{getPath:function(t,e,n,o){if(t[n.id][o.id]===1/0)return null;var i=e[n.id][o.id];return null==i?" ":j.getPath(t,e,n,i)+" "+i.id+" "+j.getPath(t,e,i,o)},getPaths:function(t,e,n,o,i){if(t[n.id][o.id]===1/0)return null;var r=e[n.id][o.id];return 0===r.length?" ":j.getPaths(t,e,n,r[0])+" "+r[0].id+" "+j.getPaths(t,e,r[0],o)},compute:function(t){var e,n,o,i=t.graph,r=i.getVertexCount(),s={},a={};for(e=0;e<r;e++){var l=i.getVertexAt(e);for(s[l.id]||(s[l.id]={}),a[l.id]||(a[l.id]={}),n=s[l.id][l.id]=0;n<r;n++)if(e!==n){var u=i.getVertexAt(n);s[l.id][u.id]||(s[l.id][u.id]=1/0),a[l.id][u.id]||(a[l.id][u.id]=[])}var d=l.getEdges();for(o=0;o<d.length;o++)d[o].source===l?s[l.id][d[o].target.id]=d[o].getCost():(s[d[o].source.id]||(s[d[o].source.id]={},a[d[o].source.id]={}),s[l.id][d[o].source.id]=d[o].getCost())}for(o=0;o<r;o++)for(e=0;e<r;e++)for(n=0;n<r;n++)if(e!==n&&n!==o&&e!==o){var c=i.getVertexAt(e).id,h=i.getVertexAt(n).id,p=i.getVertexAt(o).id;s[c][p]+s[p][h]<=s[c][h]&&s[c][p]+s[p][h]!==1/0&&(s[c][h]=s[c][p]+s[p][h],a[c][h]||(a[c][h]=[]),a[c][h].unshift([i.getVertexAt(o),s[c][h]]))}return{paths:s,parents:a}}}),s={compute:function(t){function d(t){return t.getFullId?t.getFullId():t.id}function r(t){var e=y[t.getFullId()];return v[e.v.id]}function c(t,e){var n,o;if("Port"===t.objectType){for(a[t.getFullId()]=e,n=r(t),o=0;o<n.length;o++)n[o].p!==t&&(a[n[o].p.getFullId()]=e+t.getNode().getInternalEdge(t,n[o].p).cost);b||(a[t.getNode().id]=e)}else for(a[t.id]=e,n=v[t.id],o=0;o<n.length;o++)a[n[o].p.getFullId()]=e}function h(t){return i&&!i(t)?1/0:a[d(t)]}function p(t,e,n){if("Port"===t.objectType){for(var o=r(t),i=0;i<o.length;i++)l[o[i].p.getFullId()]=n.node;b||(l[t.getNode().id]=n.node)}l[e]=n.node}function f(t,e,n){if("Port"===t.objectType){for(var o=r(t),i=0;i<o.length;i++)u[o[i].p.getFullId()]=n;b||(u[t.getNode().id]=n)}u[e]=n}var e=t.graph,n=t.source,o=t.target,i=t.nodeFilter,s=t.edgeFilter,a={},l={},u={},g={dist:a,previous:l,edges:u,path:[]},m=t.processAll,v={},y={},b=!(!1===t.strict),P=[];if(null==n&&(n=e.getVertex(t.sourceId)),null==o&&(o=e.getVertex(t.targetId)),null==n||null==o)return g;for(var E=0;E<e.vertices.length;E++){var x=e.vertices[E],C=x.getPorts();P.push(x);var j={v:x,i:P.length-1};v[x.id]=[],c(x,1/0);for(var _=0;_<C.length;_++)P.push(C[_]),y[C[_].getFullId()]=j,v[x.id].push({p:C[_],i:P.length-1}),c(C[_],1/0)}c(n,0);for(var w=new Array(e.vertices.length),S=0,I=function(t,e,n,o){for(var i=0;i<e.length;i++){var r=e[i];if(n(r)){var s=o(r),a=s.tp||s.tn,l=d(a),u=h(t.node)+r.getCost();u<h(a)&&(c(a,u),p(a,l,t),f(a,l,r))}}};S<P.length;){var k=T(P,w,0,0,h),A=k.node?d(k.node):null;if(!k.node||h(k.node)===1/0)break;if(o&&(A===d(o)||!b&&k.node.isChildOf&&k.node.isChildOf(o))&&(g.path=D(a,l,u,o),g.pathDistance=g.path[g.path.length-1].cost,!m))break;w[k.index]=!0,S+=1,I(k,k.node.getAllEdges(),function(t){return!(s&&!s(t))&&(!t.isDirected()||k.node===t.source||!b&&t.source.isChildOf&&t.source.isChildOf(k.node))},function(t){var e=t.source.getNode?t.source.getNode():t.source,n=t.source.getNode?t.source:null,o=t.target.getNode?t.target.getNode():t.target,i=t.target.getNode?t.target:null;return t.source===k.node||!b&&t.source.isChildOf&&t.source.isChildOf(k.node)?{tn:o,tp:i}:{tn:e,tp:n}})}return g}}}.call("undefined"!=typeof window?window:this),function(){"use strict";function et(t){return t.id}var nt=this,ot=nt.jsPlumbUtil,it=nt.jsPlumb,rt=nt.jsPlumbGraph,st="default";nt.jsPlumbToolkitInstance=function(t){function e(t,e,n){e=null!=e&&ot.isObject(e)?e:{},(e=ot.clone(e)).id=e.id||ot.uuid(),e.type=e.type||(null==t?null:t.type||t),n(e)}var l=(t=t||{}).idFunction||et,r=t.typeProperty||"type",s=t.edgeTypeProperty||"type",a=t.portTypeProperty||"type",n=t.typeFunction||function(t){return t[r]||st},i=t.edgeIdFunction||l,u=t.edgeTypeFunction||function(t){return t[s]||st},h=t.portIdFunction||l,o=t.portTypeFunction||function(t){return t[a]||st},d=t.portExtractor,c=t.portUpdater,p=t.portDataProperty,f=t.portOrderProperty,g=this,m=!1,v=!1,y=t.model||{},b=t.nodeFactory||e,P=t.edgeFactory||e,E=t.portFactory||e,x=t.groupFactory||e,C=t.autoSave&&(t.saveUrl||t.autoSaveHandler),j=t.autoSaveDebounceTimeout,_=t.autoSaveHandler,w=t.saveUrl,S=t.saveHeaders,I=null!=_?null:t.onAutoSaveSuccess||function(){},k=null!=_?null:t.onAutoSaveError||function(){},A=!0===t.doNotUpdateOriginalData,T=null!=_?null:t.onBeforeAutoSave||function(){},D=null!=_?null:t.onAfterAutoSave||function(){},M={portSeparator:t.portSeparator,defaultCost:t.defaultCost,defaultDirected:t.defaultDirected,enableSubgraphs:t.enableSubgraphs},N=!0===t.createMissingGroups;null!=p&&null==d&&(d=function(t){var e=t[p]||[];return null!=f&&e.sort(function(t,e){var n=t[f],o=e[f];return(null==n?1/0:n)-(null==o?1/0:o)}),e}),null!=p&&null==c&&(c=function(t,e,n){var o={};return null!=f&&n.sort(function(t,e){var n=t.data[f],o=e.data[f];return(null==n?1/0:n)-(null==o?1/0:o)}),o[p]=jsPlumbUtil.map(n,function(t){return t.data}),jsPlumb.extend(t,o)}),ot.EventGenerator.apply(this,arguments),ot.FilterableDataset.apply(this,[this]);var O,F=new rt.Graph(M);C&&(O=new ot.AutoSaver(this,w,S,I,k,T,D,j,_)),new ot.CatchAllEventHandler(this),this.getNodeFactory=function(){return b},this.getGroupFactory=function(){return x},this.getEdgeFactory=function(){return P},this.getPortFactory=function(){return E},this.setNodeFactory=function(t){b=t},this.setGroupFactory=function(t){x=t},this.setEdgeFactory=function(t){P=t},this.setPortFactory=function(t){E=t},this.setDebugEnabled=function(t){v=t},this.isDebugEnabled=function(){return v},this.getModel=function(){return y||{}};var L,R=function(t,e){if(null==y)return!0;var n=this.getType(t),o=this.getType(e),i=(null==L&&(L=new nt.jsPlumbToolkit.Model(y||{})),L),r=t.getNode?t.getNode():t,s=e.getNode?e.getNode():e,a="Node"===t.objectType?i.getNodeDefinition(n):i.getPortDefinition(n),l="Node"===e.objectType?i.getNodeDefinition(o):i.getPortDefinition(o),u=this.getNodeType(r),d=this.getNodeType(s),c=i.getNodeDefinition(u),h=i.getNodeDefinition(d);return!(null!=a.maxConnections&&t.getEdges().length>=a.maxConnections)&&(!(null!=l.maxConnections&&e.getEdges().length>=l.maxConnections)&&(t==e?!(!1===c.allowLoopback||!1===a.allowLoopback||!1===l.allowLoopback||!1===h.allowLoopback):r!=s||!(!1===c.allowNodeLoopback||!1===a.allowNodeLoopback||!1===l.allowNodeLoopback||!1===h.allowNodeLoopback)))}.bind(this);this.beforeConnect=t.beforeConnect||R,this.beforeMoveConnection=t.beforeMoveConnection||R,this.beforeStartConnect=t.beforeStartConnect||function(t,e){return{}},this.beforeDetach=t.beforeDetach||function(t,e,n){return!0},this.beforeStartDetach=t.beforeStartDetach||function(t,e){return!0},this.setSuspendGraph=function(t){m=t},this.setAutoSave=function(t){null!=O&&O.discard(),O=new ot.AutoSaver(this,t.saveUrl,t.saveHeaders,t.onAutoSaveSuccess,t.onAutoSaveError,t.onBeforeAutoSave,t.onAfterAutoSave,t.autoSaveDebounceTimeout,t.autoSaveHandler)},this.setDoNotUpdateOriginalData=function(t){A=t},this.getTypeFunction=function(){return n},this.connect=function(t){var e;if(t=t||{},!m){var n=F.getVertex(t.source),o=F.getVertex(t.target),i=t.cost,r=t.directed;if(!n){if(t.doNotCreateMissingNodes)return;n=F.addVertex(t.source),g.fire("nodeAdded",{data:{},node:n})}if(!o){if(t.doNotCreateMissingNodes)return;o=F.addVertex(t.target),g.fire("nodeAdded",{data:{},node:o})}var s=t.data||{},a=this.beforeStartConnect(n,u(s));if(a)"object"==typeof a&&(s=it.extend(a,s)),!1!==this.beforeConnect(n,o,s)&&(e=F.addEdge({source:n,target:o,cost:i,directed:r,data:s,geometry:t.geometry}),g.fire("edgeAdded",{edge:e}))}return e},this.clear=function(){return this.fire("graphClearStart"),F.clear(),this.fire("graphCleared"),this},this.getGraph=function(){return F},this.getNodeCount=function(){return F.getVertexCount()},this.getNodeAt=function(t){return F.getVertexAt(t)},this.getNodes=function(){return F.getVertices()},this.eachNode=function(t){for(var e=0,n=F.getVertexCount();e<n;e++)t(e,F.getVertexAt(e))},this.eachGroup=function(t){for(var e=0,n=F.getGroupCount();e<n;e++)t(e,F.getGroupAt(e))},this.eachEdge=function(t){for(var e=F.getEdges(),n=0,o=e.length;n<o;n++)t(n,e[n])},this.getEdgeCount=function(){return F.getEdgeCount()},this.getGroupCount=function(){return F.getGroupCount()},this.getGroupAt=function(t){return F.getGroupAt(t)},this.getGroups=function(){return F.getGroups()},this.getClusters=function(){return F.getClusters()},this.getNodeId=function(t){return ot.isObject(t)?l(t):t},this.getNodeType=function(t){return n(t)||"default"},this.getEdgeId=function(t){return ot.isObject(t)?i(t):t},this.getEdgeType=function(t){return u(t)||"default"},this.getPortId=function(t){return ot.isObject(t)?h(t):t},this.getPortType=function(t){return o(t)||"default"},this.getType=function(t){return("Node"===t.objectType?n:"Port"===t.objectType?o:u)(t.data)||"default"},this.setType=function(t,e){var n=this.getType(t);if(n!==e){var o="Node"===t.objectType?r:"Port"===t.objectType?a:s,i=t.objectType.charAt(0).toLowerCase()+t.objectType.substring(1)+"TypeChanged";t.data[o]=e,this.fire(i,{obj:t,previousType:n,newType:e})}},this.addNode=function(t,e,n){var o=l(t),i=null;null==o&&"string"!=typeof t&&(t.id=ot.uuid());var r=F.addNode(t,l);if(null==r)return F.getNode(o);if(null!=d){var s=d(r.data,r);if(null!=s)for(var a=0;a<s.length;a++)r.addPort(s[a],h)}return"string"!=typeof t&&null!=t.group&&(null==(i=this.getGroup(t.group))&&N&&(i=F.addGroup(t.group)),null!=i&&i.addVertex(r)),n||g.fire("nodeAdded",{data:t,node:r,eventInfo:e}),null!=i&&g.fire("group:addMember",{node:r,group:i}),W||A||nt.jsPlumbToolkitIO.manage("addNode",V,H,r,l||F.getIdFunction(),g),r},this.addFactoryNode=function(t,e,n){arguments.length<3&&(2===arguments.length?(e="object"==typeof arguments[1]?arguments[1]:{},n="function"==typeof arguments[1]?arguments[1]:null):1===arguments.length&&(e={})),e.type=e.type||t,b(t,e,function(t){var e=this.addNode(t);n&&n(e)}.bind(this))},this.addNodes=function(t){for(var e=0;e<t.length;e++)g.addNode.apply(g,[t[e]]);return g},this.addFactoryGroup=function(t,e,n){arguments.length<3&&(2===arguments.length?(e="object"==typeof arguments[1]?arguments[1]:{},n="function"==typeof arguments[1]?arguments[1]:null):1===arguments.length&&(e={})),e.type=e.type||t,x(t,e,function(t){var e=this.addGroup(t);n&&n(e)}.bind(this))},this.addGroup=function(t,e,n){null==l(t)&&"string"!=typeof t&&(t.id=ot.uuid());var o=F.addGroup(t,l);return W||A||nt.jsPlumbToolkitIO.manage("addGroup",V,H,o,l||F.getIdFunction(),g),n||g.fire("groupAdded",{data:t,group:o,eventInfo:e}),o},this.addToGroup=function(t,e,n,o){var i=!1;if(t=g.getNode(t),e=g.getGroup(e),t&&e&&(i=e.addVertex(t))){t.data.group=e.id;var r={node:t,group:this.getGroup(e),pos:o};n&&(r.sourceGroup=n),g.fire("group:addMember",r),g.fire("dataUpdated")}return i},this.removeFromGroup=function(t,e,n){var o;if((t=g.getNode(t))&&t.group){if((o=t.group).deleteVertex(t),delete t.data.group,!e){var i={node:t,group:o};n&&(i.targetGroup=n),g.fire("group:removeMember",i)}g.fire("dataUpdated")}return o},this.removeGroup=function(t,e,n){var o=g.getObjectInfo(t);if(o&&o.obj){t=o.obj;var i=[];Array.prototype.push.apply(i,t.getNodes());var r=F.deleteGroup(t,e);return r&&(W||A||nt.jsPlumbToolkitIO.manage("removeGroup",V,H,r,l||F.getIdFunction(),g),n||g.fire("groupRemoved",{group:r,removeChildNodes:e,nodes:i})),g}},this.getNode=function(t){return F.getVertex(t)},this.getEdge=function(t){return F.getEdge(t)},this.getGroup=function(t){return F.getGroup(t)},this.getPort=function(t){var e=F.getVertexByPortId(t);if(e)return e.getPort(F.splitPortId(t)[1])},this.exists=function(t){for(var e=0;e<arguments.length;e++)if(null==F.getVertex(arguments[e]))return!1;return!0},this.removeNode=function(t,e){for(var n=(t=t.constructor===rt.Vertex||t.constructor===rt.Port?t:F.getVertex(t)).getAllEdges()||[],o=0;o<n.length;o++)g.removeEdge(n[o]);return F.deleteVertex(t.id),W||A||nt.jsPlumbToolkitIO.manage("removeNode",V,H,t,l||F.getIdFunction(),g),e||g.fire("nodeRemoved",{node:t,nodeId:t.id,edges:n}),g},this.addEdge=function(t,e,n){var o=F.addEdge(t,i,this.beforeConnect);return null!=o?(W||A||nt.jsPlumbToolkitIO.manage("addEdge",V,H,o,i||F.getIdFunction(),g),n||g.fire("edgeAdded",{edge:o,source:e,geometry:t.geometry,addedByMouse:t.addedByMouse},null)):this.isDebugEnabled()&&console.log("JSPLUMB: could not add edge",t,e),o},this.removeEdge=function(t,e){return null!=(t=F.getEdge(t))&&(F.deleteEdge(t),W||A||nt.jsPlumbToolkitIO.manage("removeEdge",V,H,t,i||F.getIdFunction(),g),g.fire("edgeRemoved",{edge:t,source:e},null)),g},this.edgeMoved=function(t,e,n){t[0===n?"source":"target"];return this[0===n?"setSource":"setTarget"](t,e)},this.setTarget=function(t,e,n){var o=F.setTarget.apply(F,arguments);return!1===o.success||n||g.fire("edgeTarget",o),o},this.setSource=function(t,e,n){var o=F.setSource.apply(F,arguments);return!1===o.success||n||g.fire("edgeSource",o),o},this.addNewPort=function(o,t,e,i){o=F.getVertex(o),E({node:o,type:t},e,function(t){var e=h(t),n=o.addPort(e);n.data=t,z(o,"addnewport"),W||A||nt.jsPlumbToolkitIO.manage("addPort",V,H,{node:o,port:n},h||F.getIdFunction(),g),i||g.fire("portAdded",{node:o,data:t,port:n},null)})},this.addPort=function(t,e,n){var o=t.addPort(e,h);return z(t,"addport"),W||A||nt.jsPlumbToolkitIO.manage("addPort",V,H,{node:t,port:o},h||F.getIdFunction(),g),n||g.fire("portAdded",{node:t,data:e,port:o},null),o},this.removePort=function(t,e,n){var o=!1,i=(t=t.constructor===rt.Vertex||t.constructor===rt.Port?t:F.getVertex(t)).getPort(e);if(i){var r=i.getAllEdges();if((o=t.removePort(i))&&!n){for(var s=0;s<r.length;s++)g.removeEdge(r[s]);z(t,"removeport"),g.fire("portRemoved",{node:t,port:i,edges:r},null)}}return o},this.remove=function(t){if(null!=t){var e=g.getObjectInfo(t);g.setSuspendRendering(!0);try{if(!e.obj||"Node"!==e.type&&"Edge"!==e.type&&"Group"!==e.type){for(;0<t.getNodeCount();)g.removeNode(t.getNodeAt(0));for(;0<t.getEdgeCount();)g.removeEdge(t.getEdgeAt(0));for(;0<t.getGroupCount();)g.removeGroup(t.getGroupAt(0))}else g["remove"+e.type](e.obj)}finally{g.setSuspendRendering(!1,!0)}}},this.setSuspendRendering=function(t,e){for(var n in Q)Q[n].setSuspendRendering(t,e)},this.batch=function(t){g.setSuspendRendering(!0);try{t()}catch(t){jsPlumbUtil.log("Error in transaction "+t)}finally{g.setSuspendRendering(!1,!0)}};var G=function(t,e,n,o,i){var r=F.getNode(t);if(r&&r.objectType){var s,a=it.extend({},r.data),l="Port"===r.objectType?r.getFullId():r.id,u="Port"===r.objectType?h(a):null;if(e){for(var d in e)ot.replace(r.data,d,e[d]);"Port"===r.objectType&&((s=h(r.data))!==r.id&&F.renamePort(r,s),z(r.getNode(),"updateport"))}var c=o(r,a);c.originalId=l,null!=u&&(c.originalPortId=u),g.fire(n,c,null)}}.bind(this),z=function(t,e){if(null!=c){var n=c(t.data,t,t.getPorts());null!=n&&(t.data=n,W||this.fire("nodeUpdated",{node:t,updates:{},originalData:t.data,reason:e}))}}.bind(this);this.updateGroup=function(t,n){G(t,n,"groupUpdated",function(t,e){return{group:t,updates:n||{},originalData:e}})},this.updateNode=function(t,n){G(t,n,"nodeUpdated",function(t,e){return{node:t,updates:n||{},originalData:e}})},this.updatePort=function(t,n){G(t,n,"portUpdated",function(t,e){return{port:t,node:t.getNode(),updates:n||{},originalData:e}})},this.updateEdge=function(t,e){var n=F.getEdge(t);if(n){var o=it.extend({},n.data);if(e)for(var i in e)null==n.data[i]?n.data[i]=e[i]:ot.replace(n.data,i,e[i]);g.fire("edgeUpdated",{edge:n,updates:e||{},originalData:o},null)}},this.update=function(t,e){return ot.isString(t)&&(t=this.getNode(t)),t&&t.objectType&&this["update"+t.objectType](t,e),t},this.setEdgeGeometry=function(t,e){var n=jsPlumbUtil.clone(t.geometry||{});t.geometry=e,g.fire("edgePathEdited",{edge:t,geometry:e,originalGeometry:n}),g.fire("dataUpdated")},this.getPath=function(t){return new nt.jsPlumbToolkit.Path(this,t)};function U(t){return null==t?null:"*"===t?F:t.constructor===rt.Vertex||t.constructor===rt.Port?t:ot.isString(t)||ot.isObject(t)?F.getVertex(t):null}this.findGraphObject=U;function B(u,d,c){function t(t,e,n,o){if(null!=t)for(var i=t[d]({filter:u.filter}),r=0;r<i.length;r++){var s=e&&t===F||i[r].source===t||c&&i[r].source.constructor===rt.Port&&i[r].source.getNode()===t,a=n&&t===F||i[r].target===t||c&&i[r].target.constructor===rt.Port&&i[r].target.getNode()===t;(e&&s||n&&a||o&&(s||a))&&(l=i[r],p[l.getId()]||(h.push(l),p[l.getId()]=!0))}var l}var h=[],p={};return t(U((u=u||{}).source),!0,!1,!1),t(U(u.target),!1,!0,!1),t(U(u.element),!1,!1,!0),h}var V,H,W;this.getEdges=function(t){return B(t,"getEdges",!1)},this.getAllEdges=function(){return F.getAllEdges()},this.getAllEdgesFor=function(t,e){return t.getAllEdges({filter:e})},this.getSourceEdgesFor=function(t,e){return t.getSourceEdges({filter:e})},this.selectAllEdges=function(){return this.filter(function(t){return"Edge"===t.objectType})},this.addAllEdgesToSelection=function(){this.addToSelection(this.getAllEdges())};function X(t,e,n){var o=(t=t||{}).type||"json",i=t.data,r=t.url,s=t.jsonp,a=t.onload,l=t.parameters||{},u=t.error||function(){};if(null==i&&null==r)throw new TypeError("You must supply either data or url to load.");function d(t){V=t,H=o,W=!0,g.fire(e),nt.jsPlumbToolkitIO.parse(o,t,g,l),$(n),a&&a(g,t),g.fire("graphChanged")}if(i)d(i);else if(r){if(s){var c=-1===r.indexOf("?")?"?":"&";r=r+c+"callback=?"}var h="json"===o?o:t.dataType,p=t.headers||{Accept:"application/json"};ot.ajax({url:r,success:d,dataType:h,error:u,headers:p})}return g}this.load=function(t){return X(t,"dataLoadStart","dataLoadEnd")},this.append=function(t){return X(t,"dataAppendStart","dataAppendEnd")},this.save=function(t){t=t||{};var e=this.exportData(t),n={"Content-Type":"application/json"};return it.extend(n,t.headers||{}),ot.ajax({url:t.url,type:"POST",data:e,success:t.success||function(){},error:t.error||function(){},headers:n}),g},this.exportData=function(t){return t=t||{},nt.jsPlumbToolkitIO.exportData(t.type||"json",g,t.parameters)};function Y(t){return new ot.Selection({toolkit:g,onClear:t||function(){}})}var Z=Y(function(t){g.fire("selectionCleared",{selection:t})});t.maxSelectedNodes&&Z.setMaxNodes(t.maxSelectedNodes),t.maxSelectedEdges&&Z.setMaxEdges(t.maxSelectedEdges),t.selectionCapacityPolicy&&Z.setCapacityPolicy(t.selectionCapacityPolicy);function q(t,e,n,o){return e||n.clear(!0),n.append(t,function(t){o&&g.fire("select",{append:e,obj:t,selection:n})})}this.setSelection=function(t){q(t,!1,Z,!0)},this.select=function(t,e){var n=Y(),o=q(t,!0,n);if(e)for(var i=0;i<o[0].length;i++){var r=o[0][i];if("Node"===r.objectType||"Port"===r.objectType)for(var s=r.getAllEdges(),a=0;a<s.length;a++)n.append(s[a])}return n};var J=function(t,e,n,o){for(var i=t.getAllEdges(),r=0,s=i.length;r<s;r++)if(i[r].source===t||i[r].getNode&&i[r].getNode()===t){var a=i[r].target,l=a.getFullId();o[l]||(e.append(a),n&&e.append(i[r]),o[l]=!0,J(a,e,n,o))}};this.selectDescendants=function(t,e,n){var o=g.getObjectInfo(t),i=Y();if(o.obj&&"Node"===o.obj.objectType){e&&q(o.obj,!0,i);var r={};r[o.obj.getFullId()]=!0,J(o.obj,i,n,r)}return i},this.addToSelection=function(t){var e=this.getObjectInfo(t);if(e){var n=q(e.obj,!0,Z,!0);K("deselect",n[1]),K("select",n[0])}};var K=function(t,e){for(var n=0;n<e.length;n++)g.fire(t,{obj:e[n],selection:Z})};this.toggleSelection=function(t){var e=this.getObjectInfo(t);if(e){var n=[],o=Z.toggle(e.obj,function(t,e){e||n.push(t)});K("deselect",o[1]),K("deselect",n),K("select",o[0])}},this.removeFromSelection=function(t){var e=this.getObjectInfo(t);e&&Z.remove(e.obj,function(t){g.fire("deselect",{obj:t,selection:Z})})},this.addPathToSelection=function(t){this.addToSelection(this.getPath(t))},this.selectAll=function(){throw new TypeError("not implemented")},this.clearSelection=Z.clear,this.getSelection=function(){return Z},this.setMaxSelectedNodes=function(t){Z.setMaxNodes(t)},this.setMaxSelectedEdges=function(t){Z.setMaxEdges(t)},this.setSelectionCapacityPolicy=function(t){Z.setCapacityPolicy(t)};var $=function(t){g.setSuspendGraph(!0),g.fire(t),g.setSuspendGraph(!1),W=!1},Q={};if(this.render=function(t,e){var n=it.extend({},e||{});if(it.extend(n,t),n.toolkit=g,null==n.container)throw new Error("jsPlumbToolkit: You must specify a `container` into which to render");null!=t.selection&&(t.selection.constructor===ot.Selection?n.toolkit=t.selection:n.toolkit=new ot.Selection({generator:t.selection,toolkit:g})),n.toolkitInstance=g;var o=n.type||nt.jsPlumbToolkit.DefaultRendererType,i=new nt.jsPlumbToolkit.Renderers[o](n),r=n.id||ot.uuid();return(Q[r]=i).id=r,null!=t.selection&&(i.reload=n.toolkit.reload.bind(n.toolkit)),i._onDestroy=function(t){delete Q[t.id]},i},this.getRenderer=function(t){return Q[t]},this.getRenderers=function(){return Q},this.getObjectInfo=function(t,e){var n={els:{},obj:null,type:null,id:null,el:null},o=function(t){if(null!=t)return t.jtk?t:o(t.parentNode)};if(null!=t){if(t.eachNode&&t.eachEdge)return{obj:t};if(ot.isArray(t))return{obj:t};var i=it.getElement(t);if(null!=i&&i.jtk)n.el=i,n.obj=i.jtk.port||i.jtk.node||i.jtk.group;else if(null!=t.tagName){var r=o(i);null!=r&&(n.el=r,n.obj=r.jtk.port||r.jtk.node||r.jtk.group)}else{if("string"==typeof t)t=this.getNode(t)||this.getGroup(t)||this.getPort(t);else"object"==typeof t&&void 0===t.objectType&&(t=this.getNode(l(t)));if(null==t)return n;n.obj=t,null!=e&&(n.el=e(t))}null==e&&(n.els=function(t){var e={};for(var n in Q)e[n]=[Q[n],Q[n].getRenderedElement(t)];return e}(n.obj)),null!=n.obj&&(n.id=n.obj.id,n.type=n.obj.objectType)}return n},this.getVersion=function(){return"2.3.2"},t.data){var tt=t.dataType||"json";g.load({data:t.data,type:tt})}},ot.extend(nt.jsPlumbToolkitInstance,[ot.FilterableDataset,ot.EventGenerator]),nt.jsPlumbToolkit=new nt.jsPlumbToolkitInstance({}),nt.jsPlumbToolkit.DefaultRendererType=null,nt.jsPlumbToolkit.ready=it.ready,nt.jsPlumbToolkit.Renderers={},nt.jsPlumbToolkit.Widgets={};function t(t){return new nt.jsPlumbToolkitInstance(t)}nt.jsPlumbToolkit.newInstance=t,"undefined"!=typeof exports&&(exports.jsPlumbToolkit=nt.jsPlumbToolkit,exports.newInstance=t)}.call("undefined"!=typeof window?window:this),function(){var c=this.jsPlumbToolkit,h=this.jsPlumbUtil;c.Model=function(o,t){(o=o||{}).nodes=o.nodes||{},o.edges=o.edges||{},o.ports=o.ports||{},o.groups=o.groups||{};function e(t){if(a.edges[t])return a.edges[t];var e=h.mergeWithParents([t,"default"],o.edges);if(null!=e.label){e.overlays=e.overlays||[];var n=["Label",{id:"label",label:e.label}];e.labelClass&&(n[1].labelStyle={cssClass:e.labelClass}),e.labelLocation&&(n[1].location=e.labelLocation),e.labelLocationAttribute&&(n[1].labelLocationAttribute=e.labelLocationAttribute),e.overlays.push(n)}return delete e.parent,a.edges[t]=e}function n(t,e){if(a.ports[t])return a.ports[t];var n=e&&e.ports?h.mergeWithParents([t,"default"],e.ports):h.mergeWithParents([t,"default"],o.ports);return delete n.parent,a.ports[t]=n}var i,r,s={},a={nodes:{},edges:{},groups:{},ports:{}};if(void 0!==t){for(var l in o.edges){if((i=e(l)).overlays)for(r=0;r<i.overlays.length;r++)if(h.isArray(i.overlays[r])&&i.overlays[r][1].events)for(var u in i.overlays[r][1].events)i.overlays[r][1].events[u]=function(n,o){return function(t,e){n.call(o,{overlay:t,e:e,component:t.component,edge:t.component.edge})}}(i.overlays[r][1].events[u],i.overlays[r]);t.registerConnectionType(l,i)}for(r in o.ports)i=n(r),t.registerEndpointType(r,i);if(o.states)for(var d in o.states)s[d]=new c.UIState(d,o.states[d],t)}return{getNodeDefinition:function(t){if(a.nodes[t])return a.nodes[t];var e=h.mergeWithParents([t,"default"],o.nodes);return delete e.parent,a.nodes[t]=e},getEdgeDefinition:e,getPortDefinition:n,getGroupDefinition:function(t){if(a.groups[t])return a.groups[t];var e=h.mergeWithParents([t,"default"],o.groups);return delete e.parent,a.groups[t]=e},getState:function(t){return s[t]}}}}.call("undefined"!=typeof window?window:this),function(){function s(n){function o(){--e<=0&&a()}var e=0;this.add=function(t){e++,jsPlumbUtil.ajax({url:t,success:function(t){var e=n.innerHTML;e+=t,n.innerHTML=e,o()},error:function(t){o()}})},this.ensureNotEmpty=function(){e<=0&&a()}}var e=jsPlumbToolkit.ready,n=[],o=!1,a=function(){o=!0;for(var t=0;t<n.length;t++)e.call(e,n[t])};jsPlumbToolkit.ready=function(t){o?e.call(e,t):n.push(t)},jsPlumb.ready(function(){var t=document.getElementById("jsPlumbToolkitTemplates");if(t)a();else{(t=document.createElement("div")).style.display="none",t.id="jsPlumbToolkitTemplates",document.body.appendChild(t);for(var e=new s(t),n=document.getElementsByTagName("script"),o=0;o<n.length;o++){var i=n[o].getAttribute("type"),r=n[o].getAttribute("src");"text/x-jtk-templates"==i&&e.add(r)}e.ensureNotEmpty()}})}.call("undefined"!=typeof window?window:this),function(){"use strict";this.jsPlumbToolkit.Classes={LASSO:"jtk-lasso",LASSO_SELECT_DEFEAT:"jtk-lasso-select-defeat",MINIVIEW:"jtk-miniview",MINIVIEW_CANVAS:"jtk-miniview-canvas",MINIVIEW_PANNER:"jtk-miniview-panner",MINIVIEW_ELEMENT:"jtk-miniview-element",MINIVIEW_GROUP_ELEMENT:"jtk-miniview-group-element",MINIVIEW_PANNING:"jtk-miniview-panning",MINIVIEW_COLLAPSE:"jtk-miniview-collapse",MINIVIEW_COLLAPSED:"jtk-miniview-collapsed",MOST_RECENTLY_DRAGGED:"jtk-most-recently-dragged",NODE:"jtk-node",PORT:"jtk-port",GROUP:"jtk-group",SELECT_DEFEAT:"jtk-drag-select-defeat",SURFACE:"jtk-surface",SURFACE_DIRECT:"jtk-surface-direct-render",SURFACE_NO_PAN:"jtk-surface-nopan",SURFACE_CANVAS:"jtk-surface-canvas",SURFACE_PAN:"jtk-surface-pan",SURFACE_PAN_LEFT:"jtk-surface-pan-left",SURFACE_PAN_TOP:"jtk-surface-pan-top",SURFACE_PAN_RIGHT:"jtk-surface-pan-right",SURFACE_PAN_BOTTOM:"jtk-surface-pan-bottom",SURFACE_PAN_ACTIVE:"jtk-surface-pan-active",SURFACE_SELECTED_ELEMENT:"jtk-surface-selected-element",SURFACE_SELECTED_CONNECTION:"jtk-surface-selected-connection",SURFACE_PANNING:"jtk-surface-panning",SURFACE_ELEMENT_DRAGGING:"jtk-surface-element-dragging",SURFACE_DROPPABLE_NODE:"jtk-surface-droppable-node",TOOLBAR:"jtk-toolbar",TOOLBAR_TOOL:"jtk-tool",TOOLBAR_TOOL_SELECTED:"jtk-tool-selected",TOOLBAR_TOOL_ICON:"jtk-tool-icon"},this.jsPlumbToolkit.Constants={click:"click",start:"start",stop:"stop",drop:"drop",disabled:"disabled",pan:"pan",select:"select",drag:"drag",left:"left",right:"right",top:"top",bottom:"bottom",width:"width",height:"height",leftmin:"leftmin",leftmax:"leftmax",topmin:"topmin",topmax:"topmax",min:"min",max:"max",nominalSize:"50px",px:"px",onepx:"1px",nopx:"0px",em:"em",absolute:"absolute",relative:"relative",none:"none",block:"block",hidden:"hidden",div:"div",id:"id",plusEquals:"+=",minusEquals:"-=",dot:".",transform:"transform",transformOrigin:"transform-origin",nodeType:"Node",portType:"Port",edgeType:"Edge",groupType:"Group",surfaceNodeDragScope:"surfaceNodeDrag",mistletoeLayoutType:"Mistletoe",surfaceType:"Surface",jtkStatePrefix:"jtk-state-",msgCannotSaveState:"Cannot save state",msgCannotRestoreState:"Cannot restore state",nodeUpdatedPortRemoved:"removeport"},this.jsPlumbToolkit.Attributes={jtkNodeId:"jtk-node-id",relatedNodeId:"related-node-id"},this.jsPlumbToolkit.Methods={addClass:"addClass",removeClass:"removeClass"},this.jsPlumbToolkit.Events={afterLayoutRefresh:"afterLayoutRefresh",beforeDrop:"beforeDrop",beforeDetach:"beforeDetach",click:"click",canvasClick:"canvasClick",canvasDblClick:"canvasDblClick",connection:"connection",connectionAborted:"connectionAborted",connectionDetached:"connectionDetached",connectionMoved:"connectionMoved",connectionDragStop:"connectionDragStop",connectionEdit:"connectionEdit",contentDimensions:"contentDimensions",contextmenu:"contextmenu",dataLoadStart:"dataLoadStart",dataAppendStart:"dataAppendStart",dataLoadEnd:"dataLoadEnd",dataAppendEnd:"dataAppendEnd",dblclick:"dblclick",drag:"drag",drop:"drop",dragover:"dragover",dragend:"dragend",edgeAdded:"edgeAdded",edgePathEdited:"edgePathEdited",edgeRemoved:"edgeRemoved",edgeTypeChanged:"edgeTypeChanged",elementDragged:"elementDragged",elementAdded:"elementAdded",elementRemoved:"elementRemoved",endOverlayAnimation:"endOverlayAnimation",graphClearStart:"graphClearStart",graphCleared:"graphCleared",groupAdded:"groupAdded",groupDragStop:"groupDragStop",groupExpand:"group:expand",groupCollapse:"group:collapse",groupRelayout:"group:relayout",groupRemoved:"groupRemoved",groupMemberAdded:"group:addMember",groupMemberRemoved:"group:removeMember",groupMoveEnd:"groupMoveEnd",groupUpdated:"groupUpdated",lassoEnd:"lasso:end",modeChanged:"modeChanged",mousedown:"mousedown",mousemove:"mousemove",mouseout:"mouseout",mouseup:"mouseup",mouseenter:"mouseenter",mouseleave:"mouseleave",mouseover:"mouseover",nodeAdded:"nodeAdded",nodeDropped:"nodeDropped",nodeMoveStart:"nodeMoveStart",nodeMove:"nodeMove",nodeMoveEnd:"nodeMoveEnd",nodeRemoved:"nodeRemoved",nodeVisibility:"nodeVisibility",edgeTarget:"edgeTarget",nodeTypeChanged:"nodeTypeChanged",nodeTraverseEnd:"endNodeTraversal",nodeTraverseStart:"startNodeTraversal",edgeSource:"edgeSource",objectRepainted:"objectRepainted",pan:"pan",portAdded:"portAdded",portRemoved:"portRemoved",portTypeChanged:"portTypeChanged",redraw:"redraw",rotate:"rotate",start:"start",startOverlayAnimation:"startOverlayAnimation",stateRestored:"stateRestored",stop:"stop",tap:"tap",touchend:"touchend",touchmove:"touchmove",touchstart:"touchstart",unload:"unload",nodeRendered:"nodeRendered",nodeUpdated:"nodeUpdated",portUpdated:"portUpdated",edgeUpdated:"edgeUpdated",portRenamed:"portRenamed",zoom:"zoom",relayout:"relayout",deselect:"deselect",selectionCleared:"selectionCleared",resize:"resize",anchorChanged:"anchorChanged"}}.call("undefined"!=typeof window?window:this),function(){this.jsPlumbUtil=this.jsPlumbUtil||{};var n=this.jsPlumbUtil;"undefined"!=typeof exports&&(exports.jsPlumbUtil=n),n.Storage={set:function(t,e){localStorage.setItem(t,e)},get:function(t){return localStorage.getItem(t)},clear:function(t){localStorage.removeItem(t)},clearAll:function(){for(;0<localStorage.length;){var t=localStorage.key(0);localStorage.removeItem(t)}},setJSON:function(t,e){if("undefined"==typeof JSON)throw new TypeError("JSON undefined. Cannot store value.");n.Storage.set(t,JSON.stringify(e))},getJSON:function(t){if("undefined"==typeof JSON)throw new TypeError("JSON undefined. Cannot retrieve value.");return JSON.parse(n.Storage.get(t))}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this.jsPlumbToolkit,u=this.jsPlumbUtil;t.Path=function(r,t){this.bind=r.bind,this.getModel=r.getModel,this.setSuspendGraph=r.setSuspendGraph,this.getNodeId=r.getNodeId,this.getEdgeId=r.getEdgeId,this.getPortId=r.getPortId,this.getNodeType=r.getNodeType,this.getEdgeType=r.getEdgeType,this.getPortType=r.getPortType;for(var s=r.getGraph().findPath(t.source,t.target,t.strict,t.nodeFilter,t.edgeFilter),e=function(){for(var t=0;t<s.path.length;t++)s.path[t].edge&&r.removeEdge(s.path[t].edge);return this}.bind(this),n=function(){for(var t=0;t<s.path.length;t++)r.removeNode(s.path[t].vertex);return this}.bind(this),o=[],i={},a=0;a<s.path.length;a++)o.push(s.path[a].vertex),i[s.path[a].vertex.getFullId()]=[s.path[a].vertex,a];this.getNodes=function(){return o},this.getNode=function(t){return i["string"==typeof t?t:t.id][0]},this.getAllEdgesFor=function(t){var e=i[t.id][1];return e<s.path.length-1?[s.path[e+1].edge]:[]};function l(t,e){for(var n=e||0;n<s.path.length;n++)try{t(n,s.path[n])}catch(t){u.log("Path iterator function failed",t)}}this.each=function(n){l(function(t,e){n(t,e)})},this.eachNode=function(n){l(function(t,e){n(t,e.vertex)})},this.eachEdge=function(n){l(function(t,e){n(t,e.edge)},1)},this.getNodeCount=function(){return s.path.length},this.getNodeAt=function(t){return s.path[t].vertex},this.getEdgeCount=function(){return 0===s.path.length?0:s.path.length-1},this.getEdgeAt=function(t){return t<0&&(t=s.path.length-1+t),s.path.length>t+1?s.path[t+1].edge:null},this.path=s,this.deleteEdges=e,this.deleteNodes=n,this.deleteAll=n,this.isEmpty=function(){return 0===s.path.length},this.getCost=function(){return s.pathDistance},this.contains=function(t,e){var n=r.findGraphObject(t),o=!1;if(n)for(var i=0;i<s.path.length;i++)if(s.path[i].vertex===n||s.path[i].edge===n||!e&&"Port"===s.path[i].vertex.objectType&&s.path[i].vertex.isChildOf(n)){o=!0;break}return o},this.exists=function(){return null!=s.pathDistance},this.selectEdges=function(t){return _selectEdges(t,"getEdges",!1)},this.selectAllEdges=function(t){return _selectEdges(t,"getAllEdges",!0)}}}.call("undefined"!=typeof window?window:this),function(){var t=(e.parse=function(t,e,n,o){var i=this.parsers[t];if(null==i)throw new Error("jsPlumb Toolkit - parse - ["+t+"] is an unsupported type");return i(e,n,o)},e.exportData=function(t,e,n){var o=this.exporters[t];if(null===o)throw new Error("jsPlumb Toolkit - exportData - ["+t+"]  is an unsupported type");return o(e,n)},e.manage=function(t,e,n,o,i,r){this.managers[n]&&this.managers[n][t]&&this.managers[n][t](e,o,i)},e.JSONGraphParser=function(t,e,n){for(var o=t.nodes||[],i=t.edges||[],r=t.ports||[],s=t.groups||[],a=0;a<s.length;a++)e.addGroup(s[a]);for(var l=0;l<o.length;l++)e.addNode(o[l]);for(var u=0;u<r.length;u++)if(r[u].nodeId){var d=e.getNode(r[u].nodeId);if(null==d)throw new Error("Unknown node ["+r[u].nodeId+"]");d.addPort(r[u])}else if(r[u].id){var c=e.getGraph().getVertexByPortId(r[u].id);if(c){var h=jsPlumb.extend(r[u],{});h.id=e.getGraph().splitPortId(r[u].id)[1],c.addPort(h)}}else console.log("could not add port with definition "+r[u]+"; no nodeId or id found");for(var p=0;p<i.length;p++){var f={source:i[p].source,target:i[p].target,cost:i[p].cost||1,directed:i[p].directed,data:i[p].data};i[p].geometry&&(f.geometry=i[p].geometry),e.addEdge(f)}},e.JSONGraphExporter=function(t,e){return t.getGraph().serialize()},e.hierarchicalJsonParser=function(t,i,e){var r=function(t){var e=i.addNode(t);if(t.children)for(var n=0;n<t.children.length;n++){var o=i.addNode(t.children[n]);i.addEdge({source:e,target:o}),r(t.children[n])}};r(t)},e.exporters={json:e.JSONGraphExporter},e.parsers={json:e.JSONGraphParser,"hierarchical-json":e.hierarchicalJsonParser},e.managers={json:{removeNode:function(t,e,n){var o=n(e.data);jsPlumbUtil.removeWithFunction(t.nodes,function(t){return t.id===o})},removeEdge:function(t,e,n){var o=n(e.data);jsPlumbUtil.removeWithFunction(t.edges,function(t){return t.data&&t.data.id===o})},addNode:function(t,e,n){t.nodes=t.nodes||[],t.nodes.push(e.data)},addEdge:function(t,e,n){var o={source:e.source.getFullId(),target:e.target.getFullId(),data:e.data||{}};t.edges=t.edges||[],t.edges.push(o)},addPort:function(t,e,n){t.ports=t.ports||[];var o=jsPlumb.extend({},e.port.data||{});o.id=e.port.getFullId(),t.ports.push(o)},removePort:function(t,e,n){var o=e.port.getFullId();jsPlumbUtil.removeWithFunction(t.ports,function(t){return t.id===o})}}},e);function e(){}this.jsPlumbToolkitIO=t,"undefined"!=typeof exports&&(exports.jsPlumbToolkitIO=t)}.call("undefined"!=typeof window?window:this),function(){var b=this,P=b.jsPlumbToolkit;P.Support={ingest:function(t){var d=t.jsPlumb||b.jsPlumb;if(!d.getContainer())throw new TypeError("No Container set on jsPlumb instance. Cannot continue.");function e(){return"default"}function i(t,e){var n=p(t),o=f(t),i=d.getId(t),r=[];if(e=e||{},null==h[i]){var s=d.getOffset(t);h[i]=c.addNode(jsPlumb.extend({id:n,type:o,left:s.left,top:s.top},e),null,!0),t.jtk={node:h[i]};var a=d.getEndpoints(t);if(0<a.length)for(var l=0;l<a.length;l++){var u=c.addPort(h[i],{id:""+l},!0);r.push([u,a[l]]),a[l].setParameter("portId",""+l),a[l].setParameter("nodeId",i)}}return r}var c=P.newInstance(),n=d.select(),h={},p=t.idFunction||function(t){return d.getId(t)},f=t.typeFunction||e,a=t.idFunction||function(t){return t.id},l=t.edgeTypeFunction||e,o=!1!==t.render,r=[];if(t.nodeSelector)for(var s=d.getContainer().querySelectorAll(t.nodeSelector),u=0;u<s.length;u++){var g=d.getId(s[u]);r.push.apply(r,i(s[u],g)),d.manage(g,s[u])}var m=d.getManagedElements();for(var g in m)r.push.apply(r,i(m[g].el,g));if(n.each(function(t){!function(t){var e=h[t.sourceId],n=h[t.targetId],o=a(t),i=l(t),r=t.endpoints[0].getParameter("portId"),s=t.endpoints[1].getParameter("portId");null!=r&&(e=e.getPort(r)),null!=s&&(n=n.getPort(s)),t.edge=c.addEdge({source:e,target:n,data:{id:o,type:i}},null,!0)}(t)}),o){var v=b.jsPlumb.extend({},t.renderParams||{});v.jsPlumbInstance=d,v.container=d.getContainer(),v.layout=v.layout||{type:"Absolute"};var y=c.render(v);for(u=0;u<r.length;u++)y.ingestEndpoint.apply(y,r[u]);return y.ingest=function(t,e){d.getContainer().appendChild(t);var n=i(t,e);y.importNode(t,p(t));for(var o=0;o<n.length;o++)y.ingestEndpoint.apply(y,n[o])},y}return c}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var Y=this,Z=Y.jsPlumbToolkit.Layouts={Decorators:{}},q=Y.jsPlumbUtil;Z.AbstractLayout=function(t){this.viewport=t.viewport;var i=this,e=t.adapter,f=t.renderer,n=t.parameters||{},r=t.getElementForNode,s=Y.Farahey.getInstance({viewport:this.viewport,getPosition:function(t){var e=f.getViewportPosition(t);return{left:e.x,top:e.y}},getSize:function(t){var e=f.getViewportPosition(t);return[e.w,e.h]},getId:function(t){return t.id},setPosition:function(t,e){var n=f.getViewportPosition(t);if(0!==n.r){var o=[e.left,e.top],i=[e.left+n.w,e.top],r=[e.left+n.w,e.top+n.h],s=[e.left,e.top+n.h],a=[(o[0]+i[0])/2,(o[1]+s[1])/2],l=jsPlumbUtil.rotatePoint(o,a,-n.r),u=jsPlumbUtil.rotatePoint(i,a,-n.r),d=jsPlumbUtil.rotatePoint(s,a,-n.r),c=jsPlumbUtil.rotatePoint(r,a,-n.r),h=Math.min(l[0],u[0],d[0],c[0]),p=Math.min(l[1],u[1],d[1],c[1]);G(t.id,h,p)}else G(t.id,e.left,e.top)},padding:n.padding,filter:function(t){return(!b[t]||!b[t].group)&&(!i.canMagnetize||i.canMagnetize(t))}}),o=!1!==t.magnetized&&(i.defaultMagnetized||!0===t.magnetize),a=n.magnetizer&&n.magnetizer.iterations||10,l=!1!==t.negativeValuesAllowed;this.decorators=function(t,e,n){if(null==t)return[];for(var o,i,r,s,a=[],l=0;l<t.length;l++){var u=(o=t[l],r=void 0,i="string"==typeof o?o:o[0],r=Z.Decorators[i],s="string"==typeof o?{}:o[1],r?new r(s,e,n):(q.log("Decorator ["+i+"] nor registered on jsPlumbToolkit.Layouts.Decorators. Not fatal."),null));u&&a.push(u)}return a}(t.decorators,t.adapter,t.container),this.adapter=t.adapter;function u(){T=!1,m=g=1/0,y=v=-1/0;for(var t=0;t<i.decorators.length;t++)i.decorators[t].reset({remove:d.remove});h={},p.splice(0),x={},_.length=0,w.length=0,C.length=0,j.length=0,E={},s.reset(),i.reset&&i.reset()}var d=t.jsPlumb||Y.jsPlumb,c=t.jsPlumbToolkit,h={},p=[],g=1/0,m=1/0,v=-1/0,y=-1/0,b={},P={},E={},x={},C=[],j=[],_=[],w=[],S=t.container,I=d.getSize(S),k=t.width||I[0],A=t.height||I[1],T=!1;function D(t,e){if(!x[t]){var n=e||[0,0];x[t]={id:t,size:F(t),position:n,xmax:n[0],ymax:n[1],xmin:n[0],ymin:n[1]}}return x[t]}function M(t){delete x[t]}function N(){for(var t in C.length=0,_.length=0,j.length=0,w.length=0,x)L(C,x[t],"xmax"),L(j,x[t],"ymax"),L(_,x[t],"xmin"),L(w,x[t],"ymin");if(g=0<_.length?_[0].xmin:0,v=0<C.length?C[C.length-1].xmax:0,m=0<w.length?w[0].ymin:0,y=0<j.length?j[j.length-1].ymax:0,!l&&(g<0||m<0)){var e=g<0?g:0,n=m<0?m:0;if(e<0||n<0){for(var o in h)h[o][0]-=e,h[o][1]-=n;for(var i in x)x[i].position[0]-=e,x[i].xmin-=e,x[i].xmax-=e,x[i].position[1]-=n,x[i].ymin-=n,x[i].ymax-=n;g-=e,m-=n,v-=e,y-=n}}}this.getMagnetizedElements=function(){return s.getElements()},this.magnetize=function(t){(t=t||{}).options=t.options||{},t.options.iterations=t.options.iterations||a;var e=t.event?"executeAtEvent":t.origin?"execute":"executeAtCenter",n=t.event?[t.event,t.options]:t.origin?[t.origin,t.options]:[t.options];t.force&&this.forceMagnetize&&this.forceMagnetize();var o=s[e].apply(s,n);U(d.repaintEverything,o)},this.nodeAdded=function(t,e){if(i.adapter.filter(t.node)){var n=e&&e.position?e.position:t.node.data&&t.node.data.left&&t.node.data.top?t.node.data:i.adapter.getOffset(t.el);if(this._nodeAdded){var o=this._nodeAdded(t,e);o&&(n.left=o[0],n.top=o[1])}b[t.node.id]=t.node,G(t.node.id,n.left,n.top),F(t.node.id,t.el),s.addElement(t.node)}},this.nodeRemoved=function(t){delete h[t.node.id],delete E[t.node.id],delete b[t.node.id],M(t.node.id),this._nodeRemoved&&this._nodeRemoved(t.node),s.removeElement(t.node)},this.groupAdded=function(t,e){if(i.adapter.filter(t.group)){var n=e&&e.position?e.position:t.group.data&&t.group.data.left&&t.group.data.top?t.group.data:i.adapter.getOffset(t.el);if(this._groupAdded){var o=this._groupAdded(t,e);o&&(n.left=o[0],n.top=o[1])}P[t.group.id]=t.group,G(t.group.id,n.left,n.top),F(t.group.id,t.el),s.addElement(t.group)}},this.groupRemoved=function(t){delete h[t.group.id],delete E[t.group.id],delete P[t.group.id],M(t.group.id),this._groupRemoved&&this._groupRemoved(t.group),s.removeElement(t.group)};function O(t,e,n){b[t]&&i._nodeMoved?i._nodeMoved(t,e,n):P[t]&&i._groupMoved&&i._groupMoved(t,e,n)}var F=function(t,e){var n=E[t];return n||(null!=(e=e||r(t))?(n=d.getSize(e),E[t]=n):n=[0,0]),n},L=function(t,e,n){t.push(e);for(var o=t.length-1,i=t[o];0<o&&i[n]<t[o-1][n];)t[o]=t[o-1],o-=1;return t[o]=i,o},R=function(t,e,n){if(null!=t){e=parseFloat(e),n=parseFloat(n),isNaN(e)&&(e=0),isNaN(n)&&(n=0);var o=h[t];o||(o=h[t]=[0,0],p.push([o,t]));var i=D(t,[e,n]);i.position[0]=e,i.position[1]=n,H(i),h[t]=[e,n]}}.bind(this),G=(this.setMagnetizedPosition=function(e,t,n,o){R(e,t,n),this.magnetize({options:{filter:function(t){return t===e},padding:[5,5],exclude:function(t,e){return null!=e.group},excludeFocus:!0}});var i=this.getPosition(e);return o&&O(e,i[0],i[1]),i},function(t,e,n,o){R(t,e,n),o&&O(t,e,n)}),z=function(t){var e=r(t);if(null==e)return null;var n=F(t),o=D(t).position;return i.adapter.setElementPosition(e,o[0],o[1],n,!0),o.concat(n)}.bind(this),U=this.draw=function(t,e){for(var n in x)null!=e&&!e[n]||z(n);for(var o=0;o<i.decorators.length;o++)i.decorators[o].decorate({adapter:i.adapter,layout:i,append:function(t,e,n){i.adapter.append(t,e,n,!0)},setAbsolutePosition:i.adapter.setAbsolutePosition,toolkit:c,jsPlumb:d,bounds:[g,m,v,y],floatElement:i.adapter.floatElement,fixElement:i.adapter.fixElement});t&&t()};this.setPosition=function(t,e,n,o){G(t,e,n,!0),o||N()},this.bb=function(t){console.log(t);var e=function(t){var e=1/0,n=1/0,o=-1/0,i=-1/0;for(var r in t)e=Math.min(e,t[r][0]),o=Math.max(o,t[r][0]),n=Math.min(n,t[r][1]),i=Math.max(i,t[r][1]);return[[e,n],[o,i],Math.abs(e-o),Math.abs(n-i)]}(h);!function(){for(var t in h)console.log(t,h[t][0],h[t][1])}(),console.log(e[0],e[1],e[2],e[3])};var B=this.getPositions=function(){return h},V=(this.getPosition=function(t){return h[t]},this.getExtents=function(){return[g,m,v,y]});this.getSize=function(t){return E[t]};function H(t,e){t.xmax=t.position[0]+t.size[0],t.ymax=t.position[1]+t.size[1],t.xmin=t.position[0],t.ymin=t.position[1],e&&N()}this.getSizes=function(){return E};function W(t,e){E[t]=e;var n=D(t);n.size=e,H(n,!0)}this.setSize=W,this.begin=function(t,e){},this.end=function(t,e){};var X=function(t){if(null!=c){!function(){var t=Y.jsPlumb.extend({padding:[0,0]},i.defaultParameters||{});Y.jsPlumb.extend(t,n||{}),n=t}(),s.setElements(e.getElements()),this.begin&&this.begin(c,n);for(;!T;)this.step(c,n);N(),U(function(){o&&i.magnetize(),i.end&&i.end(c,n),t&&t()})}}.bind(this);return this.relayout=function(t,e){u(),null!=t&&(n=t),X(e)},this.layout=function(t){T=!1,X(t)},this.clear=function(){u()},this.destroy=function(){this.viewport=null,s=null},{adapter:t.adapter,jsPlumb:d,toolkit:c,getPosition:function(t,e,n,o){var i=h[t];if(!i){if(null!=e&&null!=n)i=[e,n];else{if(o)return null;i=[Math.floor(Math.random()*(k+1)),Math.floor(Math.random()*(A+1))]}G(t,i[0],i[1])}return i},setPosition:G,getRandomPosition:function(t,e,n,o){e=e||10,n=n||10;var i=Math.floor(Math.random()*e),r=Math.floor(Math.random()*n),s=D(t,[i,r]);return s.position=[i,r],H(s,!0!==o),h[t]=[i,r],[i,r]},getSize:F,setSize:W,getPositions:B,setPositions:function(t){h=t},getExtents:V,width:k,height:A,reset:u,draw:U,setDone:function(t){T=t}}},Z.EmptyLayout=function(o){var i={},n={};this.refresh=this.relayout=this.layout=function(){this.clear();var t,e,n=o.getElements();for(e=0;e<n.length;e++)t=n[e],i[t.id]=[0,0]},this.nodeRemoved=this.groupRemoved=function(t){delete i[t.id]},this.nodeAdded=this.groupAdded=function(t){i[t.id]=!1},this.getPositions=function(){return i},this.getPosition=function(t){return i[t]},this.setPosition=function(t,e,n){i[t]=[e,n]},this.getExtents=function(){return[0,0,0,0]},this.clear=function(){},this.getMagnetizedElements=function(){return[]},this.setSize=function(t,e){n[t]=e},this.getSize=function(t){return n[t]},this.getSizes=function(){return n},this.destroy=function(){n=i=null}},Z.Mistletoe=function(t){if(!t.parameters.layout)throw"No layout specified for MistletoeLayout";var n={},e=Y.jsPlumb.extend({},t);e.getElementForNode=function(t){return n[t]};var o,i,r,s=Z.AbstractLayout.apply(this,[e]),a=t.parameters.layout,l=function(){s.setPositions(a.getPositions()),s.draw(),this.fire("redraw")}.bind(this);q.EventGenerator.apply(this,arguments),this.map=function(t,e){n[t]=e};function u(){n={},o=a.layout,i=a.relayout,r=a.clear,a.layout=function(){o.apply(a,arguments),l()},a.relayout=function(){s.reset(),i.apply(a,arguments),l()},a.clear=function(){r.apply(a,arguments),s.reset()}}u(),this.setHostLayout=function(t){a=t,u()};var d=this.destroy;this.destroy=function(){d.apply(this),d=l=s=n=null}};function t(n){function u(t,e){return(n.locationFunction||function(t){return[t.data.left,t.data.top]})(t)}n=n||{};var d=Z.AbstractLayout.apply(this,arguments),o=function(t,e,n){for(var o=d.adapter[t](),i=o.length,r=0;r<i;r++){var s=o[r],a=s.getFullId(),l=d.getPosition(a,null,null,!0);null==l&&(l=u(s)),this.setPosition(a,l[0],l[1],!0)}}.bind(this);return this.begin=function(t,e){o("getElements",t,e)},this._nodeAdded=function(t,e){return u(t.node,n.parameters)},this._groupAdded=function(t,e){return u(t.group,n.parameters)},this.getAbsolutePosition=function(t,e){return u(t)},this.step=function(){d.setDone(!0)},d}q.extend(t,Z.AbstractLayout),Z.AbsoluteBackedLayout=t,Z.Absolute=function(t){Z.AbsoluteBackedLayout.apply(this,arguments)},q.extend(Z.Absolute,Z.AbsoluteBackedLayout);function e(o){var i=Z.AbsoluteBackedLayout.apply(this,arguments),r=o.adapter;return this.absoluteBacked=!0===o.absoluteBacked,this.begin=function(t,e){e.ignoreLoops=!(!1===o.ignoreLoops),e.getRootNode=e.getRootNode||function(t){if(!1!==o.multipleRoots)return t.filter(function(t){if("Node"!==t.objectType&&"Group"!==t.objectType)return!1;var e=t.getTargetEdges();return(0===e.length||function(t,e){for(var n=0;n<t.length;n++)if(t[n].target!==e||t[n].source!==e)return!1;return!0}(e,t))&&r.filter(t)}).getAll();var e=i.adapter.getElements();return 0<e.length?e[0]:null},e.getChildEdges=e.getChildEdges||function(n,t){return i.toolkit.getAllEdgesFor(n,function(t){var e=t.target.getNode?t.target.getNode():t.target;return(t.source===n||!0!==o.ignorePorts&&t.source.getNode&&t.source.getNode()===n)&&r.filter(e)})},e.rootNode=e.getRootNode(t),e.rootNode||i.setDone(!0)},i}q.extend(e,Z.AbstractLayout),Z.AbstractHierarchicalLayout=e}.call("undefined"!=typeof window?window:this),function(){"use strict";var e=this.jsPlumbToolkit.Layouts,C=this.Farahey;e.Circular=function(t){t=t||{};var E=e.AbstractLayout.apply(this,arguments),x=!!t.parameters&&!0===t.parameters.centerRootNode;t.group;this.defaultParameters={padding:30,locationFunction:t.locationFunction},this.step=function(t,e){var n,o,i=E.adapter.getElements(),r=10;if(x){var s=E.getSize(i[0].id);r=Math.max(s[0],s[1])+80,E.setPosition(i[0].id,0,0),i=i.slice(1)}if(0!==i.length){var a=2*Math.PI/i.length,l=-Math.PI/2;for(n=0;n<i.length;n++)if(o=i[n],E.setPosition(o.id,0+Math.sin(l)*r,0+Math.cos(l)*r,!0),l+=a,0<n){var u=i[n-1],d=E.getSize(u.id),c=E.getPosition(u.id),h={x:c[0]-e.padding,y:c[1]-e.padding,w:d[0]+2*e.padding,h:d[1]+2*e.padding},p=i[n],f=E.getSize(p.id),g=E.getPosition(p.id),m={x:g[0]-e.padding,y:g[1]-e.padding,w:f[0]+2*e.padding,h:f[1]+2*e.padding},v=C.calculateSpacingAdjustment(h,m),y=[c[0]+d[0]/2,c[1]+d[1]/2],b=[g[0]+v.left+f[0]/2,g[1]+v.top+ +f[1]/2],P=Math.sqrt(Math.pow(y[0]-b[0],2)+Math.pow(y[1]-b[1],2));r=Math.max(r,P/2/Math.sin(a/2))}for(n=0;n<i.length;n++)o=i[n],E.setPosition(o.id,0+Math.sin(l)*r,0+Math.cos(l)*r,!0),l+=a;E.setDone(!0)}else E.setDone(!0)}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var u=this.jsPlumbToolkit.Layouts,D=this.jsPlumbUtil,d="compress",c="auto";u.Hierarchical=function(t){function m(t){var e=I[t];return e||(e={entries:[],pointer:0},I[t]=e),e}function v(t,e,n,o,i){var r=m(n),s={node:t,parents:null==o?[]:[o],childGroup:i,loc:r.pointer,index:r.entries.length,dimensions:e,size:e[E],children:[]},a=e[0===E?1:0];return null==g[n]?g[n]=a:g[n]=Math.max(g[n],a),r.pointer+=e[E]+x[E],r.entries.push(s),o&&o.children.push(s),s}function y(t){return 0<t.parents.length?t.parents[0].loc:null}function b(t,e){if(0===t.parents.length)return null;for(var n=t.parents[0].size,o=1;o<t.parents.length;o++)n+=e+t.parents[o].size;return n}function a(t){return 0<t.parents.length?t.parents[0].childGroup:null}function P(t){if(0<t.size){var e=f[h](t),n=p[t.depth],o="end"===h?1/0:-1/0,i=0;if(null!=n&&0<n.length){var r=n[n.length-1],s=r.nodes[r.nodes.length-1];o="end"===h?s.loc-t.size:s.loc+s.size+x[E]}t.loc="end"!==h&&o<=e||"end"===h&&e<=o?e:(i=o-e,o);for(var a=t.loc,l="end"===h?t.nodes.length-1:0,u="end"===h?-1:t.nodes.length,d="end"===h?-1:1,c=l;c!==u;c+=d)t.nodes[c].loc=a,a+=t.nodes[c].size,a+=x[E];0!==i&&A(t),function(t,e){var n=p[e];n||(n=[],p[e]=n),t.index=n.length,n.push(t)}(t,t.depth)}}function n(t){var e=t.nodes[0].loc,n=t.nodes[t.nodes.length-1].loc+t.nodes[t.nodes.length-1].size,o=l[h](t,e,n),i=o-y(t);if(!function(t,e){if(0<t.parents.length){for(var n=e-t.parents[0].loc,o=0;o<t.parents.length;o++)t.parents[o].loc+=n;var i=t.parents[t.parents.length-1],r=m(t.depth-1);r.pointer=Math.max(r.pointer,i.loc+i.size+x[E])}}(t,o),!function(t){return 0<t.parents.length&&!0===t.parents[0].root}(t))for(var r=a(t),s=function(t){return 0<t.parents.length?t.parents[t.parents.length-1].childGroupIndex:null}(t)+1;s<r.nodes.length;s++)r.nodes[s].loc+=i}var o,i,E,x,C,j,_=u.AbstractHierarchicalLayout.apply(this,arguments),g=[],e=null!=t.parameters?t.parameters.spacing:c,w=null!=t.parameters&&null!=t.parameters.compress?!0===t.parameters.compress:e===d,S=null!=t.parameters&&!0===t.parameters.invert,h=null!=t.parameters&&t.parameters.align||"center",I=[],p=[],k=_.toolkit.getNodeId,f={center:function(t){return y(t)+b(t,x[E])/2-(t.size-x[E])/2},start:function(t){return y(t)},end:function(t){return y(t)+b(t,0)-(t.size-x[E])}},l={center:function(t,e,n){return(e+n)/2-b(t)/2},start:function(t,e,n){return e},end:function(t,e,n){return e}},A=function(t){for(var e=t;null!=e;)n(e),e=a(e)},T=function(t,e){if(!C[t.node.id]){C[t.node.id]=!0;var n,o,i,r=[],s={nodes:[],loc:0,size:0,parents:[t],depth:e+1,children:[]},a=[],l={},u=m(e+1);for(Array.prototype.push.apply(r,j(t.node,_.toolkit)),n=0;n<r.length;n++){var d=(o=t.node,(i=r[n]).source===o||i.source.getNode&&i.source.getNode()===o?r[n].target:r[n].source);if(d.getNode&&(d=d.getNode()),null!=(d=_.toolkit.getNode(d))&&d!==t.node&&!l[d.id]){var c=_.getSize(k(d)),h=u.entries.find(function(t){return k(t.node)===k(d)});if(null!=h){h.parents.push(t);var p=y(h)+b(h,x[E])/2-h.size/2-h.loc,f=function(t){for(var e=t.childGroupIndex;e<t.childGroup.nodes.length;e++)t.childGroup.nodes[e].loc+=p,t.children.forEach(f),t.childGroup.size+=p};f(h)}else{var g=v(d,c,e+1,t,s);g.childGroupIndex=s.nodes.length,s.nodes.push(g),s.size+=c[E]+x[E],a.push(g)}l[d.id]=!0}}for(P(s),n=0;n<a.length;n++)T(a[n],e+1);return r.length}};this.defaultParameters={padding:[60,60],orientation:"horizontal",border:0,locationFunction:t.locationFunction,align:"center"};var r=this.begin;this.begin=function(t,e){r.apply(this,arguments),o=e.orientation,E=(i="horizontal"===o)?0:1,i?"width":"height",x=e.padding,I.length=0,p.length=0,C={},j=e.getChildEdges,g.length=0},this.step=function(t,e){for(var n,o,i,r=D.isArray(e.rootNode)?e.rootNode:[e.rootNode],s=0;s<r.length;s++){n=r[s];var a,l,u=_.getSize(n.id),d=v(n,u,0,null,null),c=0,h=function(t,e){var n,o,i,r=0===E?1:0;return w&&t.parents&&0<t.parents.length?_.getPosition(k(t.parents[0].node))[r]+(n=t,o=r,i=jsPlumbUtil.map(n.parents,function(t){return t.dimensions[o]}),Math.max.apply(null,i))+x[r]:e},p=!(d.root=!0);if(0===T(d,0,null)&&!0===this.absoluteBacked){var f=this.getAbsolutePosition(n);isNaN(f[0])||isNaN(f[1])||(_.setPosition(n.id,f[0],f[1]),p=!0)}if(!p)for(o=0;o<I.length;o++){for(I[o].otherAxis=c,i=0;i<I[o].entries.length;i++)a=0===E?I[o].entries[i].loc:h(I[o].entries[i],c),l=1===E?I[o].entries[i].loc:h(I[o].entries[i],c),_.setPosition(k(I[o].entries[i].node),a,l,!0);S?o<I.length-1&&(I[o].otherAxisSize=g[o+1]+x[0===E?1:0],c-=I[o].otherAxisSize):(I[o].otherAxisSize=g[o]+x[0===E?1:0],c+=I[o].otherAxisSize)}}_.setDone(!0)},this.getHierarchy=function(){return I},this.getOrientation=function(){return o};var s=this.nodeRemoved;this.nodeRemoved=function(){I=[],s.apply(this,arguments)},this.getPadding=function(){return x}},D.extend(u.Hierarchical,u.AbstractHierarchicalLayout)}.call("undefined"!=typeof window?window:this),function(){this.jsPlumbToolkit.Layouts.Decorators.Hierarchy=function(t){var a,n=[];this.reset=function(t){for(var e=0;e<n.length;e++)t.remove(n[e]);n.length=0},this.decorate=function(t){if(t.bounds[0]!=1/0){var e=t.layout.getHierarchy();a=(t.layout.getPadding()||[60,60])["horizontal"===n?0:1];for(var n=t.layout.getOrientation(),o="horizontal"===n?["width","height",t.bounds[2]-t.bounds[0]]:["height","width",t.bounds[3]-t.bounds[1]],i=0;i<e.length;i++){var r=document.createElement("div");t.append(r),r.className="level "+(i%2?"odd":"even"),r.style[o[0]]=o[2]+2*a+"px",r.style[o[1]]=e[i].otherAxisSize+"px";var s="horizontal"===n?[t.bounds[0]-a,e[i].otherAxis-a/2]:[e[i].otherAxis-a/2,t.bounds[1]-a];t.setAbsolutePosition(r,s)}}}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var e=this.jsPlumbToolkit.Layouts,t=this.jsPlumbUtil;e.Spring=function(t){this.defaultMagnetized=!0;var g=e.AbsoluteBackedLayout.apply(this,arguments);t=t||{},this.defaultParameters={padding:[50,50],iterations:500,maxRepulsiveForceDistance:6,k:2,c:.01,maxVertexMovement:.5,locationFunction:t.locationFunction};function m(t){t.getNode&&(t=t.getNode());var e=x[t.id];if(!e){var n=g.getRandomPosition(t.id,.5,.5,!0);e=x[t.id]={id:t.id,n:t,sp:n,p:[n[0],n[1]],f:[0,0]}}return e}function v(t,e,n){_=Math.min(_,e),S=Math.min(S,n),w=Math.max(w,e),I=Math.max(I,n),t.p[0]=e,t.p[1]=n}function y(t,e){if(!t.locked||!e.locked){var n=e.p[0]-t.p[0],o=e.p[1]-t.p[1],i=n*n+o*o;i<.01&&(i=(n=.1*Math.random()+.1)*n+(o=.1*Math.random()+.1)*o);var r=Math.sqrt(i);if(r<E.maxRepulsiveForceDistance){T++;var s=E.k*E.k/r,a=s*n/r,l=s*o/r;e.f[0]+=e.locked?0:(t.locked?2:1)*a,e.f[1]+=e.locked?0:(t.locked?2:1)*l,t.f[0]-=t.locked?0:(e.locked?2:1)*a,t.f[1]-=t.locked?0:(e.locked?2:1)*l}}}function b(t,e){var n=m(e.target);if(!t.locked||!n.locked){T++;var o=n.p[0]-t.p[0],i=n.p[1]-t.p[1],r=o*o+i*i;r<.01&&(r=(o=.1*Math.random()+.1)*o+(i=.1*Math.random()+.1)*i);var s=Math.sqrt(r);s>E.maxRepulsiveForceDistance&&(r=(s=E.maxRepulsiveForceDistance)*s);var a=(r-E.k*E.k)/E.k;(null==e.weight||e.weight<1)&&(e.weight=1);var l=(a*=.5*Math.log(e.weight)+1)*o/s,u=a*i/s;n.f[0]-=n.locked?0:(t.locked?2:1)*l,n.f[1]-=n.locked?0:(t.locked?2:1)*u,t.f[0]+=t.locked?0:(n.locked?2:1)*l,t.f[1]+=t.locked?0:(n.locked?2:1)*u}}var P,E=jsPlumbUtil.merge(this.defaultParameters,t.parameters||{}),x={},C=!1!==t.absoluteBacked,j=0,_=1/0,w=-1/0,S=1/0,I=-1/0,k=1,A=1,T=0,D=function(t){return[.19*g.width+(t[0]-_)*k,.19*g.height+(t[1]-S)*A]};this._nodeMoved=this._groupMoved=function(t,e,n){var o=x[t];o&&(o.sp=[e,n],o.p=function(t){return[_+(t[0]-.19*g.width)/k,S+(t[1]-.19*g.height)/A]}(o.sp))},this.forceMagnetize=function(){for(var t in x)x[t].locked=!1},this.canMagnetize=function(t){return x[t]&&!0!==x[t].locked},this.reset=function(){x={},_=S=1/(j=0),w=I=-1/0},this._nodeRemoved=this._groupRemoved=function(t){delete x[t.id]},this._nodeAdded=this._groupAdded=function(t,e){if(e&&e.position){var n=m(t.node||t.group);n&&(n.locked=!0,g.setPosition(n.id,e.position.left,e.position.top,!0))}},this.begin=function(t,e){j=0,P=[],Array.prototype.push.apply(P,g.adapter.getElements())},this.step=function(t,e){function n(t){return i[t]||(i[t]=m(P[t])),i[t]}var o,i=[];for(o=T=0;o<P.length;o++){var r=n(o);if(C&&!r.locked){var s=this.getAbsolutePosition(r.n,e);if(null!=s&&2===s.length&&null!=s[0]&&null!=s[1]&&!isNaN(s[0])&&!isNaN(s[1])){v(r,s[0],s[1]),r.sp=r.p,g.setPosition(r.id,s[0],s[1],!0),r.locked=!0;continue}}for(var a=o+1;a<P.length;a++){var l=n(a);y(r,l)}for(var u=g.toolkit.getAllEdgesFor(r.n).filter(function(t){return g.adapter.filter(t.target)}),d=0;d<u.length;d++)b(r,u[d])}if(0!==T)for(o=0;o<P.length;o++){var c=n(o),h=E.c*c.f[0],p=E.c*c.f[1],f=E.maxVertexMovement;f<h&&(h=f),h<-f&&(h=-f),f<p&&(p=f),p<-f&&(p=-f),v(c,c.p[0]+h,c.p[1]+p),c.f[0]=0,c.f[1]=0}j++,(0===T||j>=E.iterations)&&(function(){for(var t in k=g.width/(w-_)*.62,A=g.height/(I-S)*.62,x){var e=x[t];e.locked||(e.sp=D(e.p),g.setPosition(e.id,e.sp[0],e.sp[1],!0))}}(),g.setDone(!0))},this.end=function(){for(var t in x)x[t].locked=!0}},t.extend(e.Spring,e.AbsoluteBackedLayout)}.call("undefined"!=typeof window?window:this),function(){"use strict";var e=this.jsPlumbToolkit.Layouts,W=this.Farahey;e.Balloon=function(t){t=t||{};var U,B=e.AbstractHierarchicalLayout.apply(this,arguments),V=[];this.defaultParameters={padding:50,locationFunction:t.locationFunction,groupPadding:100};var a=W.getInstance({padding:[100,100],getPosition:function(t){return{left:t.extents[0],top:t.extents[2]}},setPosition:function(t,e){for(var n=0;n<t.group.length;n++){var o=t.offsets[t.group[n].id];t.setPosition(t.group[n].id,e.left+o.left,e.top+o.top)}},getSize:function(t){return[t.extents[1]-t.extents[0],t.extents[3]-t.extents[2]]},getId:function(t){return t.focus.id},filter:function(t){return V[0].focus.id!==t}}),n=this.begin;this.begin=function(t,e){n.apply(this,arguments),V.length=0,U=e.getChildEdges};var H=function(t,e,i){function n(t,e,n,o){return{x:t-i.padding,y:e-i.padding,w:n+2*i.padding,h:o+2*i.padding}}function o(t){return g[t]||(g[t]=B.getSize(t),g[t])}var r,s,a,l,u,d,c={focus:t,childMap:{},children:[],positions:{},incidentAngles:[],setPosition:function(t,e,n){this.positions[t]=[e,n]},getPosition:function(t){return this.positions[t]},setIncidentAngle:function(t,e){this.incidentAngles[t]=e},group:[t]},h=e?e.position:[0,0],p=h[0],f=h[1],g={};c.setPosition(t.id,h[0],h[1]);var m=U(t);for(r=0;r<m.length;r++){var v=m[r].target.getNode?m[r].target.getNode():m[r].target;c.childMap[v.id]||(c.childMap[v.id]=!0,c.children.push(v))}if(l=o(c.focus.id),a=Math.max(l[0],l[1]),d=n(p-l[0]/2,f-l[1]/2,l[0],l[1]),B.setPosition(c.focus.id,-l[0]/2,-l[1]/2,!0),0<c.children.length){V.push(c);var y=2*Math.PI/(c.children.length+(e?1:0)),b=e?e.incidentAngle+Math.PI+y:Math.PI,P=b;for(r=0;r<c.children.length;r++){u=o((s=c.children[r]).id);var E=n(p+Math.sin(b)*u[0],f+Math.cos(b)*u[1],u[0],u[1]);if(A=W.calculateSpacingAdjustment(d,E),M=Math.sqrt(Math.pow(E.x+A.left-p,2)+Math.pow(E.y+A.top-f,2)),a=Math.max(a,M),c.setPosition(s.id,E.x+A.left,E.y+A.top),b+=y,0<r){var x=c.children[r-1],C=o(x.id),j=c.getPosition(x.id),_=n(j[0],j[1],C[0],C[1]),w=c.children[r],S=o(w.id),I=c.getPosition(w.id),k=n(I[0],I[1],S[0],S[1]),A=W.calculateSpacingAdjustment(_,k),T=[j[0]+C[0]/2,j[1]+C[1]/2],D=[I[0]+A.left+S[0]/2,I[1]+A.top+ +S[1]/2],M=Math.sqrt(Math.pow(T[0]-D[0],2)+Math.pow(T[1]-D[1],2));a=Math.max(a,M/2/Math.sin(y/2))}}for(b=P,r=0;r<c.children.length;r++)s=c.children[r],c.setIncidentAngle(s.id,b),c.setPosition(s.id,p+Math.sin(b)*a,f+Math.cos(b)*a,!0),b+=y;var N,O=c.positions[t.id][0],F=B.getSize(t.id),L=O+F[0],R=c.positions[t.id][1],G=R+F[1];for(r=0;r<c.children.length;r++){s=c.children[r],H(s,{parent:t,incidentAngle:c.incidentAngles[s.id],position:c.positions[s.id]},i)||(N=B.getSize(s.id),c.group.push(s),O=Math.min(O,c.positions[s.id][0]),L=Math.max(L,c.positions[s.id][0]+N[0]),R=Math.min(R,c.positions[s.id][1]),G=Math.max(G,c.positions[s.id][1]+N[1]))}for(c.extents=[O,L,R,G],c.offsets={},r=0;r<c.group.length;r++){var z=c.group[r];c.offsets[z.id]={left:c.positions[z.id][0]-c.extents[0],top:c.positions[z.id][1]-c.extents[2]}}}return c.children.length};this.step=function(t,e){if(e.rootNode&&0<e.rootNode.length){if(H(e.rootNode[0],null,e),0<V.length){var n=(V[0].extents[0]+V[0].extents[1])/2,o=(V[0].extents[2]+V[0].extents[3])/2;a.setElements(V),a.execute([n,o])}for(var i=0;i<V.length;i++){var r=V[i];for(var s in r.positions)B.setPosition(s,r.positions[s][0],r.positions[s][1],!0)}}B.setDone(!0)}}}.call("undefined"!=typeof window?window:this),function(){"use strict";this.jsPlumb;var t=this.jsPlumbToolkit;t.UI=t.UI||{},t.UI.ActiveDragFilter=function(p,t,f){var g={};t.bind("connectionDrag",function(t){var n,e,o,i,r,s=t.source.jtk.port,a=s?s.getNode():t.source.jtk.node,l=f.getNodeCount(),u=f.getGroupCount();function d(t,e){n=f.beforeConnect(t,e),r=e.getFullId(),!1===n&&null==g[r]&&(g[r]=p.setTargetEnabled(e,!1))}if(s)for(d(s,a),e=a.getPorts(),o=0;o<e.length;o++)d(s,e[o]);for(o=0;o<l;o++){var c=f.getNodeAt(o);for(d(s||a,c),e=c.getPorts(),i=0;i<e.length;i++)d(s||a,e[i])}for(o=0;o<u;o++){var h=f.getGroupAt(o);for(d(s||a,h),e=h.getPorts(),i=0;i<e.length;i++)d(s||a,e[i])}}),t.bind("connectionDragStop",function(){function t(t){!0===g[t.getFullId()]&&p.setTargetEnabled(t,!0)}var e,n,o,i=f.getNodeCount();for(e=0;e<i;e++){var r=f.getNodeAt(e);for(t(r),n=r.getPorts(),o=0;o<n.length;o++)t(n[o])}var s=f.getGroupCount();for(e=0;e<s;e++){var a=f.getGroupAt(e);for(t(a),n=a.getPorts(),o=0;o<n.length;o++)t(n[o])}g={}})}}.call("undefined"!=typeof window?window:this),function(){"use strict";var Nt=this,t=Nt.jsPlumbToolkit.Renderers,Ot=Nt.jsPlumbToolkit,Ft=Nt.jsPlumbUtil,Lt=Nt.jsPlumb,Rt=Nt.Knockle,Gt=t.atts={NODE:"data-jtk-node-id",PORT:"data-jtk-port-id",GROUP:"data-jtk-group-id"},zt=t.els={SOURCE:"JTK-SOURCE",PORT:"JTK-PORT",TARGET:"JTK-TARGET"},Ut=Ot.Classes,Bt=Ot.Events,Vt=Ot.Constants;Ot.UIState=function(l,a,u){for(var t in a)if(a.hasOwnProperty(t)){var e="*"===t?"e-state-"+l:"e-state-"+l+"-"+t,n="*"===t?"c-state-"+l:"c-state-"+l+"-"+t;u.registerEndpointType(e,a[t]),u.registerConnectionType(n,a[t])}this.activate=function(t,r,s){t.eachEdge(function(t,e){var n=r.getRenderedConnection(e.getId()),o=s.getEdgeType(e.data),i=o?"c-state-"+l+"-"+o:null;i&&n.addType(i,e.data),a["*"]&&n.addType("c-state-"+l,e.data),d(e,n,e.source,0,"addType",s),d(e,n,e.target,1,"addType",s)}),t.eachNode(function(t,e){var n=s.getNodeType(e.data),o=n?a[n]:null,i=r.getRenderedNode(e.id);o&&o.cssClass&&u.addClass(i,o.cssClass),a["*"]&&u.addClass(i,a["*"].cssClass)})};var d=function(t,e,n,o,i,r){var s=e.endpoints[o],a=r.getPortType(n.data);s[i]("e-state-"+l+"-"+a),s[i]("e-state-"+l)};this.deactivate=function(t,r,s){t.eachEdge(function(t,e){var n=r.getRenderedConnection(e.getId()),o=s.getEdgeType(e.data),i=o?"c-state-"+l+"-"+o:null;i&&n.removeType(i,e.data),a["*"]&&n.removeType("c-state-"+l),d(e,n,e.source,0,"removeType",s),d(e,n,e.target,1,"removeType",s)}),t.eachNode(function(t,e){var n=s.getNodeType(e.data),o=n?a[n]:null,i=r.getRenderedNode(e.id);o&&o.cssClass&&u.removeClass(i,o.cssClass),a["*"]&&u.removeClass(i,a["*"].cssClass)})}},t.mouseEvents=["click","dblclick","contextmenu","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover"],t.createElement=function(t,e){var n={width:t.width,height:t.height,position:t.position||Vt.absolute},o={};t.display&&(n.display=t.display),t.id&&(o.id=t.id),t.top&&(n.top=t.top+"px"),t.left&&(n.left=t.left+"px"),t.right&&(n.right=t.right+"px"),t.bottom&&(n.bottom=t.bottom+"px");var i=Lt.createElement(t.type||Vt.div,n,t.clazz,o);return null!=e&&Lt.appendElement(i,e),i};function e(t){this._jsPlumb=this.getJsPlumb(),this._el=this._jsPlumb.getElement(t.container),this.getWidth=function(){return this._jsPlumb.getSize(this._el)[0]},this.getHeight=function(){return this._jsPlumb.getSize(this._el)[1]},this.append=function(t){var e=_jsPlumb.getElement(t);this._jsPlumb.appendElement(e,this._el)},this.remove=function(t){var e=this._jsPlumb.getElement(t);this._jsPlumb.removeElement(e)},this.setAbsolutePosition=Lt.setAbsolutePosition,this.getOffset=function(t,e){return this._jsPlumb.getOffset(t,e)}}t.DOMElementAdapter=e;function n(t){this.getOffset=function(){return t.getOffset.apply(t,arguments)},this.append=function(){return t.append.apply(t,arguments)},this.setAbsolutePosition=function(){return t.setAbsolutePosition.apply(t,arguments)},this.floatElement=function(){return t.floatElement.apply(t,arguments)},this.fixElement=function(){return t.fixElement.apply(t,arguments)}}function Ht(e,o){n.apply(this,[o]),this.getElements=e.getNodes,this.filter=function(t){return"Node"===t.objectType&&t.group==e},this.setElementPosition=function(t,e,n){return o.setAbsolutePosition(t,[e,n])}}function Wt(r,e){n.apply(this,[r]),this.filter=function(t){return!!e||("Group"===t.objectType||"Node"===t.objectType&&null==t.group)},this.getElements=function(){var t=r.getNodes();return e||(t=t.filter(function(t,e){return null==t.group}),Array.prototype.push.apply(t,r.getGroups())),t},this.setElementPosition=function(t,e,n,o,i){return r.setPosition({el:t,x:e,y:n,doNotUpdateElement:!1,doNotUpdateLayout:!0,doRevalidate:!1,size:o,doNotFireEvent:i})}}function o(d){function t(t,e){var n=Lt.createElement("div",{border:"1px solid #456",position:"absolute"},Ut.NODE);return n.innerHTML=t.name||t.id,n}d=d||{},this._viewportManager=new Nt.jsPlumbToolkitViewport;var e='<div data-jtk-node-id="${id}" class="'+Ut.NODE+'"></div>',b={rotors:{render:function(t,e){var n=u.template(t,e);return 0<n.childNodes.length&&(n.childNodes[0]._jtkCommands=n.commands),n.childNodes[0]},cleanup:function(t,e){u.remove(e),e.parentNode&&e.parentNode.removeChild(e)}}},a=!0===d.debug,u=Rt.newInstance({defaultTemplate:e,templateResolver:d.templateResolver,templates:d.templates}),w=this,S=d.toolkit,l=d.toolkitInstance,s=new Ot.Layouts.EmptyLayout(new Wt(w)),c=Lt.getElement(d.container),h=!(!1===d.elementsDraggable),p=!0===d.elementsDroppable,i=!1,n=!1!==d.refreshAutomatically,P=d.templateRenderer?Ft.isString(d.templateRenderer)?b[d.templateRenderer]:d.templateRenderer:b.rotors,E=!1!==d.enhancedView,f=d.assignPosse||function(){return null},g=d.modelLeftAttribute||"left",m=d.modelTopAttribute||"top",v=!1!==d.storePositionsInModel,y=d.objectFilter||function(){return!0},x=!0===d.ignoreGroups,C=!0===d.renderPortsAsynchronously;this.getModelPositionAttributes=function(){return[g,m]},this.getLabelLocationAttribute=function(t){return tt.getEdgeDefinition(S.getEdgeType(t.data||{})).labelLocationAttribute||"labelLocation"};var o=Ft.merge(d.jsPlumb||{}),I=d.jsPlumbInstance||Lt.getInstance(o,d.overrideFns),r=I.getId(c);I.bind("beforeDrop",function(t){var e=t.connection,n=e.endpoints[0].graph||e.source.jtk,o=e.endpoints[1].graph||e.target.jtk,i=n.port||n.node||n.group,r=o.port||o.node||o.group,s=t.connection.edge;return null==s?S.beforeConnect(i,r,t.connection.getData()):S.beforeMoveConnection(i,r,s)}),I.bind("beforeDrag",function(t){var e=t.endpoint.graph||t.source.jtk,n=e.port||e.node,o=t.endpoint.connectionType,i=S.beforeStartConnect(n,o);if(a){var r=tt.getEdgeDefinition(o)||{};console.log("\n------------------------\nDrag started with edge type `"+o+"`, having definition :"),console.log(r),console.log("Edge source is a "+n.objectType+", having type ["+n.getType()+"], with definition :");var s=tt["get"+n.objectType+"Definition"](n.getType())||{};console.log(s),console.log("Toolkit response to drag start :"),console.log(i),console.log("---------------------------\n")}return!1===i&&t.endpoint.isTemporarySource&&t.endpoint._deleteOnDetach&&I.deleteEndpoint(t.endpoint),i}),I.bind("beforeDetach",function(t,e){var n=t.endpoints[0].graph||t.source.jtk,o=t.endpoints[1].graph||t.target.jtk,i=n.port||n.node,r=o.port||o.node,s=t.edge;return S.beforeDetach(i,r,s,e)}),I.bind("beforeStartDetach",function(t){var e=t.endpoint.graph||t.source.jtk,n=e.port||e.node,o=t.connection.edge;return S.beforeStartDetach(n,o)}),Ft.EventGenerator.apply(this,arguments),d.activeFiltering&&new Ot.UI.ActiveDragFilter(w,I,S),this.setDebug=function(t){a=t,console.log("-----------------------\nSurface debug switched "+(t?"on":"off")+" \n-------------------------\n")},this.getJsPlumb=function(){return I},this.getToolkit=function(){return l},this.getDataSource=function(){return S};var j=[Bt.canvasClick,Bt.canvasDblClick,Bt.nodeAdded,Bt.nodeDropped,Bt.nodeRemoved,Bt.nodeRendered,Bt.groupAdded,Bt.groupRemoved,Bt.groupMoveEnd,Bt.groupMemberAdded,Bt.groupMemberRemoved,Bt.groupCollapse,Bt.groupExpand,Bt.groupRelayout,Bt.nodeMoveStart,Bt.nodeMove,Bt.nodeMoveEnd,Bt.portAdded,Bt.portRemoved,Bt.edgeAdded,Bt.edgeRemoved,Bt.edgeTypeChanged,Bt.nodeTypeChanged,Bt.portTypeChanged,Bt.dataLoadEnd,Bt.anchorChanged,Bt.objectRepainted,Bt.modeChanged,Bt.lassoEnd,Bt.pan,Bt.zoom,Bt.relayout,Bt.click,Bt.tap,Bt.stateRestored,Bt.startOverlayAnimation,Bt.endOverlayAnimation,Bt.nodeVisibility,Bt.afterLayoutRefresh,Bt.rotate],_=w.bind,k=I.bind;if(this.setHoverSuspended=I.setHoverSuspended,this.isHoverSuspended=I.isHoverSuspended,this.setJsPlumbDefaults=function(t){delete t.Container,I.restoreDefaults(),I.importDefaults(t)},this.bind=function(t,e){-1==j.indexOf(t)?k(t,e):_(t,e)},d.events)for(var A in d.events)this.bind(A,d.events[A]);if(d.interceptors)for(var T in d.interceptors)this.bind(T,d.interceptors[T]);var D=!1;function M(t){D=!0;try{t()}catch(t){jsPlumbUtil.log("An error occurred while ignoring Toolkit events",t)}finally{D=!1}}k(Bt.connection,function(e){if(null==e.connection.edge){e.sourceEndpoint.getParameter("nodeId")||e.sourceEndpoint.setParameter("nodeId",O[e.sourceEndpoint.elementId].id),e.targetEndpoint.getParameter("nodeId")||e.targetEndpoint.setParameter("nodeId",O[e.targetEndpoint.elementId].id);var t=e.sourceEndpoint.getParameter("portType"),n=tt.getPortDefinition(t),o=null!=n&&n.edgeType?n.edgeType:e.sourceEndpoint.getParameter("edgeType")||"default",i=e.sourceEndpoint.getParameter("nodeId"),r=e.sourceEndpoint.getParameter("portId"),s=e.targetEndpoint.getParameter("nodeId"),a=e.targetEndpoint.getParameter("portId"),l=i+(r?"."+r:""),u=s+(a?"."+a:""),d=S.getNode(l)||S.getGroup(l),c=S.getNode(u)||S.getGroup(u),h={sourceNodeId:i,sourcePortId:r,targetNodeId:s,targetPortId:a,type:o,source:d,target:c,sourceId:l,targetId:u,sourceType:d.objectType,targetType:c.objectType};!1===S.getEdgeFactory()(o,e.connection.getData()||{},function(t){t=Ft.populate(t,d.data,null,!0),h.edge=S.addEdge({source:l,target:u,cost:e.connection.getCost(),directed:e.connection.isDirected(),data:t,addedByMouse:!0},w),B[h.edge.getId()]=e.connection,e.connection.edge=h.edge,H(o,h.edge,e.connection),h.addedByMouse=!0,h.connection=e.connection,w.fire(Bt.edgeAdded,h)},h)&&I.deleteConnection(e.connection)}}),k(Bt.connectionMoved,function(t){var e=0===t.index?t.newSourceEndpoint:t.newTargetEndpoint,n=e.graph||e.element.jtk;M(function(){S.edgeMoved(t.connection.edge,n.port||n.node||n.group,t.index)})}),k(Bt.connectionDetached,function(t){M(function(){S.removeEdge(t.connection.edge)});var e=t.sourceEndpoint.getParameters(),n=t.targetEndpoint.getParameters(),o=e.nodeId+(e.portId?"."+e.portId:""),i=n.nodeId+(n.portId?"."+n.portId:"");w.fire(Bt.edgeRemoved,{sourceNodeId:e.nodeId,targetNodeId:n.nodeId,sourcePortId:e.portId,targetPortId:n.portId,sourceId:o,targetId:i,source:S.getNode(o),target:S.getNode(i),edge:t.connection.edge})}),k(Bt.connectionEdit,function(t){S.setEdgeGeometry(t.connection.edge,t.geometry)}),k(Bt.groupDragStop,function(t){w.getLayout().setPosition(t.group.id,t.pos[0],t.pos[1],!0),t.uigroup=t.group,w.fire(Bt.groupMoveEnd,Lt.extend(t,{group:S.getGroup(t.uigroup.id)}))}),k(Bt.groupMemberAdded,function(t){if(!i&&t.el.jtk&&t.el.jtk.node){var e=null==t.sourceGroup?null:S.getGroup(t.sourceGroup.id),n=S.addToGroup(t.el.jtk.node,t.group.id,e,t.pos);n&&(t.el._droppedOnGroup=!0,w.fire(Bt.groupMemberAdded,{node:t.el.jtk.node,group:n,uigroup:t.group,sourceGroup:e}))}}),k(Bt.groupMemberRemoved,function(t){if(!i&&t.el.jtk&&t.el.jtk.node){var e=null==t.targetGroup?null:S.getGroup(t.targetGroup.id);S.removeFromGroup(t.el.jtk.node,!1,e)}}),k(Bt.groupCollapse,function(t){var e=S.getGroup(t.group.id);e&&w.fire(Bt.groupCollapse,{group:e,uigroup:t.group})}),k(Bt.groupExpand,function(t){var e=S.getGroup(t.group.id);e&&w.fire(Bt.groupExpand,{group:e,uigroup:t.group})});var N={},O={},F={},L={},R=[],G={},z=[];function U(t,n,o,i){i.bind(t,function(t,e){n.apply(n,[{edge:o,e:e,connection:i,toolkit:S,renderer:w}])})}this.getNodeCount=function(){return z.length},this.getNodeAt=function(t){return z[t]},this.getNodes=function(){return z},this.getNode=function(t){return N[t]},this.getGroupCount=function(){return R.length},this.getGroupAt=function(t){return R[t]},this.getGroups=function(){return R};var B={},V=function(t){return B[t.getId()]},H=function(t,e,n){if(!n.getParameter("edge")){var o=tt.getEdgeDefinition(t);if(o&&o.events)for(var i in o.events)U(i,o.events[i],e,n)}};function W(t,e){if(i)Y.push([t,e]);else{var n=f(e);if(null!=n){var o=Ft.isArray(n)?n:[n];o.unshift(t),I.addToPosse.apply(I,o)}}}function X(){for(var t=0;t<Y.length;t++)W.apply(this,Y[t])}this.setSuspendRendering=function(t,e){i=t,I.setSuspendDrawing(t),e&&this.refresh()},this.batch=function(t){this.setSuspendEvents(!0),S.batch(t),this.setSuspendEvents(!1)};var Y=[];function Z(t,e){var n=I.getGroup(t.id),o=n.getDragArea(),i=t.layout.getExtents(),r=e.maxSize||[i[2],i[3]];if(o.style.width=Math.min(r[0],i[2])+"px",o.style.height=Math.min(r[1],i[3])+"px",w.setSize){var s=I.getSize(n.getEl());w.setSize(t.id,s[0],s[1])}}this.expandGroup=function(t){I.expandGroup("string"==typeof t?t:t.id)},this.collapseGroup=function(t){I.collapseGroup("string"==typeof t?t:t.id)},this.toggleGroup=function(t){I.toggleGroup("string"==typeof t?t:t.id)},w.autoSizeGroups=function(t){for(var e in L){var n=S.getGroup(e);if(n){var o=tt.getGroupDefinition(S.getNodeType(n.data));(o.autoSize||t)&&Z(n,o)}}},w.sizeGroupToFit=function(t,e){if(t){var n=tt.getGroupDefinition(S.getNodeType(t.data));(n.autoSize||e)&&Z(t,n)}};var q=[],J={};function K(n,o,t){if(t)q.push({event:n,fn:o}),S.bind(n,o,!0);else{var e=function(){o.apply(w,arguments);for(var t=J[n]||[],e=0;e<t.length;e++)t[e].apply(w,arguments)};q.push({event:n,fn:e}),S.bind(n,e,!0)}}function $(t,e){var n=N[t.id];if(null==n){if(!0===tt.getNodeDefinition(S.getNodeType(t.data)).ignore)return!1;if(!(n=ht(t,t.data,t)))throw new Error("Cannot render node");var o=I.getId(n);N[t.id]=n,O[o]=t,z.push(t),n.jtk={node:t},null==t.group||x?w.append(n,o,e?e.position:null):function(t,e,n){var o=L[n.id];o&&((o.querySelector("[jtk-group-content]")||o).appendChild(t),I.addToGroup(n.id,t,!0),n.layout.nodeAdded({node:e,el:t}),w.nodeAppendedToGroup(t,o,n))}(n,t,t.group),W(n,t),wt(n,t);var i={node:t,el:n,id:t.id};null!=t.group&&!x||w.getLayout().nodeAdded(i,e),w.fire(Bt.nodeAdded,i)}return n}function Q(t,e){if(!x){var n=L[t.id];if(null==n){var o=tt.getGroupDefinition(S.getNodeType(t.data));if(!0===o.ignore)return!1;if(!0===o.ghost&&(o.ghostProxyParent=c),!(n=ft(t,t.data,t)))throw new Error("Cannot render Group");var i=I.getId(n);L[t.id]=n,R.push(t),G[i]=t,n.jtk={group:t},w.append(n,i,e?e.position:null),W(n,t),wt(n,t);var r={group:t,el:n},s={el:n,id:t.id};Lt.extend(s,{dragOptions:d.dragOptions||{}}),s.dragOptions[Lt.dragEvents[Vt.stop]]=Ft.wrap(s.dragOptions[Lt.dragEvents[Vt.stop]],function(t){t.el.jtk&&t.el.jtk.group&&(s.dragOptions.magnetize?t.pos=w.getLayout().setMagnetizedPosition(t.el.jtk.group.id,t.pos[0],t.pos[1],!0):w.getLayout().setPosition(t.el.jtk.group.id,t.pos[0],t.pos[1],!0),!1!==v&&(w.storePositionInModel({id:t.el.jtk.group.id,group:!0,leftAttribute:g,topAttribute:m}),S.fire(Bt.groupUpdated,{group:t.el.jtk.group},null)),w.fire(Bt.groupMoveEnd,{el:t.el,group:t.el.jtk.group,pos:t.pos,e:t.e,eventPosition:t.pos}))}),I.addGroup(Lt.extend(s,o));var a=o.layout||{type:"Absolute"};t.layout=gt(a,t),w.getLayout().groupAdded({group:t,el:n,id:t.id},e),w.fire(Bt.groupAdded,r)}return n}}var tt,et=function(){Y.length=0,I.setSuspendDrawing(!0),this.setSuspendRendering(!0)}.bind(this),nt={dataLoadStart:et,dataAppendStart:et,dataLoadEnd:function(){w.setSuspendRendering(!1),X(),I.getGroupManager().refreshAllGroups(),w.relayout(),I.setSuspendDrawing(!1,!0),s&&w.fire(Bt.dataLoadEnd)},dataAppendEnd:function(){w.setSuspendRendering(!1),X(),w.refresh(),I.setSuspendDrawing(!1,!0),s&&w.fire(Bt.dataAppendEnd)},nodeAdded:function(t){var e,n=t.node;if(y(n)){var o=$(n,t.eventInfo);if(null!=o){var i=I.getSelector(o,"[data-port-id]");for(e=0;e<i.length;e++){var r=i[e].getAttribute("data-port-id");F[n.id+"."+r]=i[e],i[e].jtk=i[e].jtk||{node:n,port:n.getPort(r)}}w.refresh(!0)}}},nodeRemoved:function(t){(t.node.group?t.node.group.layout:w.getLayout()).nodeRemoved({node:t.node});var e=N[t.nodeId];w.fire(Bt.nodeRemoved,{node:t.node,el:e});var n=I.getId(e);I.removeAllEndpoints(e,!0),P.cleanup(t.node,e),delete N[t.nodeId],delete vt[t.nodeId],delete yt[t.nodeId],delete O[n],function(t){var e=z.indexOf(t);-1!==e&&z.splice(e,1)}(t.node),delete e.jtk,w.refresh(!0)},"group:addMember":function(t){var e=N[t.node.id];e&&(t.pos&&(null!=t.node.data[g]&&(t.node.data[g]=t.pos.left),null!=t.node.data[m]&&(t.node.data[m]=t.pos.top)),w.fire(Bt.groupMemberAdded,Lt.extend(t,{el:e,groupEl:L[t.group.id]})),w.getJsPlumb().addToGroup(t.group.id,e,!0),s.nodeRemoved(t),t.sourceGroup&&t.sourceGroup.layout.nodeRemoved(t),t.group.layout.nodeAdded({node:t.node,el:e,pos:t.pos}),w.relayoutGroup(t.group))},"group:removeMember":function(t){var e=N[t.node.id];if(e){if(w.fire(Bt.groupMemberRemoved,Lt.extend(t,{el:e,groupEl:L[t.group.id]})),w.getJsPlumb().removeFromGroup(t.group.id,e,!0),t.group.layout.nodeRemoved(t),w.getJsPlumb().getContainer().appendChild(e),t.targetGroup)t.targetGroup.layout.nodeAdded({node:t.node});else{s.nodeAdded({node:t.node,el:e});var n=w.getJsPlumb().getOffset(e);w.getLayout().setPosition(t.node.id,n.left,n.top),v&&w.storePositionInModel(t.node.id)}w.relayoutGroup(t.group)}},groupAdded:function(t){var e=t.group;y(e)&&null!=Q(e,t.eventInfo)&&w.refresh(!0)},groupRemoved:function(e){var t=e.group;w.getLayout().groupRemoved({group:t});var n=L[t.id],o=I.getId(n),i=I.removeGroup(t.id,e.removeChildNodes,!0,!0),r=null;if(null!=i)for(var s in r={},i){var a=O[s];null!=a&&(St({node:a,x:i[s].left,y:i[s].top,doNotUpdateElement:!0}),r[a.id]=[i[s].left,i[s].top])}P.cleanup(e.group,n),w.fire(Bt.groupRemoved,{group:t,el:n,nodes:e.nodes,nodesRemoved:e.removeChildNodes,nodePositions:r}),R=R.filter(function(t){return t.id!==e.group.id}),delete L[t.id],delete G[o],delete n.jtk},edgeAdded:function(t){if(!D&&t.source!==w){var e=t.edge;if(y(e.source)&&y(e.target)&&(!x||e.source.objectType!==Vt.groupType&&e.target.objectType!==Vt.groupType)){var n=tt.getEdgeDefinition(S.getEdgeType(e.data||{}));if(n&&!0===n.ignore)return;var o=function(a){return function(){var t=st(a);t.doNotFireConnectionEvent=!0,S.isDebugEnabled()&&console.log("Renderer","adding edge with params",t);var e=I.connect(t);if(null!=e){var n=e.getConnector(),o=!1;t.geometry&&n.importGeometry&&n.importGeometry(t.geometry,e)&&(e.repaint(),o=!0),e.edge=a,B[a.getId()]=e,H(t.type,a,e),w.fire(Bt.edgeAdded,{source:a.source,target:a.target,connection:e,edge:a,geometry:o?a.geometry:null}),d.refreshLayoutOnEdgeConnect&&w.refresh(!0);var i=a.source.getNode?a.source.getNode():a.source,r=N[i.id]||L[i.id],s=a.target.getNode?a.target.getNode():a.target;!1!==(N[s.id]||L[s.id])._jtkVisible&&!1!==r._jtkVisible||kt(a,!1)}else console.log("jsPlumb: WARN : An edge could not be rendered "+a+" and is being removed from the dataset."),S.removeEdge(a);return e}}(e);if(d.connectionHandler)d.connectionHandler(e,o,w);else{var i=o();if(e.geometry){var r=i.getConnector();r.importGeometry&&r.importGeometry(e.geometry,i)}}}}},edgeRemoved:function(t){if(!D&&t.source!==w){var e=t.edge,n=B[e.getId()];n&&(S.isDebugEnabled()&&console.log("Renderer","removing edge",e),function(t){w.fire(Bt.edgeRemoved,{sourceNodeId:t.source.getNode?t.source.getNode().getId:t.source.getFullId(),targetNodeId:t.target.getNode?t.target.getNode().getId:t.target.getFullId(),sourcePortId:"Port"===t.source.objectType?t.source.id:null,targetPortId:"Port"===t.target.objectType?t.target.id:null,sourceId:t.source.getFullId(),targetId:t.target.getFullId(),source:t.source,target:t.target,edge:t})}(e),delete B[e.getId()],null!=n._jsPlumb&&I.deleteConnection(n,{fireEvent:!1}))}},edgeTypeChanged:function(t){if(!D&&t.source!==w){var e=t.obj,n=B[e.getId()];if(n){var o=tt.getEdgeDefinition(t.newType);if(o&&!0===o.ignore)return;(o.endpoint||o.endpoints)&&(n.replaceEndpoint(0,o.endpoints?o.endpoints[0]:o.endpoint),n.replaceEndpoint(1,o.endpoints?o.endpoints[1]:o.endpoint)),o.connector&&n.setConnector(o.connector),n.setType(t.newType,e.data)}}},edgeTarget:function(t){if(!D){var e=t.edge,n=B[e.getId()],o=e.target.getFullId(),i=N[o]||L[o]||F[o]||mt[o];n?I.silently(function(){null!=i&&(S.isDebugEnabled()&&console.log("target change",n),I.setTarget(n,i))}):null!=i&&S.isDebugEnabled()&&Ft.log("Target for Edge "+e.getId()+" changed to Node "+i.id+"; we have no valid connection.")}},edgeSource:function(t){if(!D){var e=t.edge,n=B[e.getId()],o=e.source.getFullId(),i=N[o]||L[o]||F[o]||mt[o];n?I.silently(function(){null!=i&&I.setSource(n,i)}):null!=i&&S.isDebugEnabled()&&Ft.log("Source for Edge "+e.getId()+" changed to Node "+i.id+"; we have no valid connection.")}},graphClearStart:function(){for(var t in I.reset(!0),L)P.cleanup(t,L[t]);for(var e in N)P.cleanup(e,N[e]);s&&s.clear(),z.length=0,R.length=0,B={},N={},L={},O={},G={},F={},mt={},w.getZoom&&I.setZoom(w.getZoom())},portAdded:function(t){var e=N[t.node.id]||L[t.node.id];if(tt.getPortDefinition(S.getPortType(t.data)).isEndpoint)xt(new Et(t.data,e,t.port),t.node);else{var n=F[t.port.getFullId()];if(n)dt(n,t.port,e,t.node);else{var o=pt(t.port,t.data,t.node);C||(null!=o?dt(o=I.getElement(o),t.port,e,t.node):jsPlumbUtil.log("no element rendered for port",t.port,t.data))}}I.recalculateOffsets(e),w.refresh(!0)},portRemoved:function(o){var t=N[o.node.id]||L[o.node.id],e=o.node.id+"."+o.port.id,n=F[e];if(null!=n){I.setSuspendEvents(!0),I.remove(n),I.setSuspendEvents(!1),delete F[e],delete mt[e];var i=function(t){if(I[t]){var e=I[t][o.port.id],n=o.port.getNode();null!=e&&(I[t][o.port.id]=e.filter(function(t){return t[1]!==n}))}};i("_sourceDefsByPortId"),i("_targetDefsByPortId"),w.fire(Bt.portRemoved,{node:o.node,port:o.port,portEl:n,nodeEl:t}),I.recalculateOffsets(t),w.refresh(!0)}},edgeUpdated:function(t){var e=B[t.edge.getId()];if(e){var n=st(t.edge);e.setType(["default",n.type].join(" "),n.data)}},portUpdated:function(s){var t=F[s.originalId];if(t){if(t._rotors&&t._rotors.instance===u)u.update(t,s.port.data);w.repaint(N[s.node.id]);var e=s.port.getFullId();if(e!==s.originalId&&(F[e]=F[s.originalId],delete F[s.originalId],s.originalPortId)){var a=s.port.getNode(),n=function(t,e){var n=I[t];if(n=n&&n[s.originalPortId])for(var o=0;o<n.length;o++)if(n[o][1]===a){var i=I[e][n[o][0]];if(i)for(var r in i)i[r].def.portId===s.originalPortId&&(i[r].def.portId=s.port.id,i[r].def.parameters.portId=s.port.id)}};n("_sourceDefsByPortId","sourceEndpointDefinitions"),n("_targetDefsByPortId","targetEndpointDefinitions")}}},nodeUpdated:function(t){var e=N[t.node.getFullId()];if(e){if(e._rotors&&e._rotors.instance===u)for(var n=u.update(e,t.node.data),o=0;o<n.removed.length;o++)I.remove(n.removed[o].el,!0);if(t.reason!==Vt.nodeUpdatedPortRemoved){wt(e,t.node);var i=f(t.node);if(null!=i){var r=Ft.isArray(i)?i:[i];r.unshift(e),I.setPosse.apply(I,r)}else I.removeFromAllPosses(e)}w.repaint(e)}},groupUpdated:function(t){var e=L[t.group.getFullId()];if(e){if(e._rotors&&e._rotors.instance===u)for(var n=u.update(e,t.group.data),o=0;o<n.removed.length;o++)I.remove(n.removed[o].el,!0);if(t.reason!==Vt.nodeUpdatedPortRemoved){wt(e,t.group);var i=f(t.group);if(null!=i){var r=Ft.isArray(i)?i:[i];r.unshift(e),I.setPosse.apply(I,r)}else I.removeFromAllPosses(e)}w.repaint(e)}}};if(!1!==this.bindToolkitEvents)for(var ot in nt)K(ot,nt[ot]);function it(t){return null==t?S:"string"==typeof t?S.select(t,!0):t.jtk?S.select(t.jtk.port||t.jtk.node,!0):t}this.setView=function(t){var e=Ft.merge(S.getModel(),t||{});tt=new Ot.Model(e,I)},this.setView(d.view),this.getView=function(){return tt};var rt=[];this.activateState=function(t,e){var n=tt.getState(t);n&&(e=it(e),n.activate(e,w,S),rt.push(n))},this.deactivateState=function(t,e){var n=tt.getState(t);n&&(e=it(e),n.deactivate(e,w,S),Ft.removeWithFunction(rt,function(t){return t===n}))},this.resetState=function(){for(var t=0;t<rt.length;t++)rt[t].deactivate(S,w,S);rt.length=0};var st=function(a){var t=S.getEdgeType(a.data),l={type:t,connectionType:t,data:a.data,cost:a.getCost(),directed:a.isDirected(),geometry:a.geometry},n=tt.getEdgeDefinition(t);!function(t){if(n)for(var e=0;e<t.length;e++)n[t[e]]&&(l[t[e]]=n[t[e]])}(["connector","endpoints","endpoint","endpointStyles","endpointStyle"]),l.anchor&&!l.anchors&&(l.anchors=[l.anchor,l.anchor],delete l.anchor),l.endpoint&&!l.endpoints&&(l.endpoints=[l.endpoint,l.endpoint],delete l.endpoint);function u(t,e,n,o,i){if(o&&o[n]){var r=t[e]||[o[n],o[n]];r[i]=o[n],t[e]=r}}function e(t,e){if(a[t].getNode){var n=a[t].getNode(),o=a[t].getFullId(),i=mt[o]||F[o];l[t]=null!=i?i:F[o],null==l[t]&&(l[t]=N[S.getNodeId(n.data)]);var r=tt.getPortDefinition(a[t].getType());u(l,"anchors","anchor",r,e),u(l,"endpoints","endpoint",r,e)}else{var s=S.getNodeId(a[t].data);i=0===e?vt[s]:yt[s];l[t]=null==i?N[s]||L[s]:i}}return e("source",0),e("target",1),l},at={};this.asynchronousPortRendered=function(t,e,n){var o=S.getPortId(n),i=at[o],r=e.getPort(o);if(!i)return r;try{return t=ut(i.object,t,o,i.objectType,i.def,i.node,i.jtkClass,i.jtkAttributeName,i.makeDraggable),dt(F[e.id+S.getGraph().getPortSeparator()+o]=t,r,L[e.id]||N[e.id],e),function(){for(var t=[],e=0;e<lt.length;e++){var n=w.getRenderedElement(lt[e][0].target),o=w.getRenderedElement(lt[e][0].source);n&&o?lt[e][1]():t.push(lt[e])}lt=t}(),r}catch(t){return jsPlumbUtil.log("Cannot finish asynchronous render of port",t),null}finally{delete at[o]}};var lt=[];function ut(t,o,e,n,i,r,s,a,l){o.setAttribute(a,e),Lt.addClass(o,s),o.jtk=o.jtk||{},o.jtk[n]=t,o.jtk.node=r;var u=I.getId(o);I.manage(u,o),null!=r.data.rotation&&I.rotate(u,r.data.rotation),l&&h&&Mt.makeDraggable&&Mt.makeDraggable(o,i.dragOptions),p&&Mt.makeDroppable&&Mt.makeDroppable(o,i.dropOptions);function d(n){I.on(o,n,function(t){var e={el:o,e:t,toolkit:S,renderer:w};e["Node"===r.objectType?"node":"group"]=r,i.events[n](e)})}if(i&&i.events)for(var c in i.events)d(c);return o}function dt(t,e,n,o){F[o.id+S.getGraph().getPortSeparator()+e.id]=t,wt(t,o),w.fire(Bt.portAdded,{node:o,nodeEl:n,port:e,portEl:t})}function ct(c,h,p,f,g,m,v,y){return function(t,e,n){var o,i=h(e),r=null,s=p(e),a=tt[f](s),l=e;if(E){l=Lt.extend({},a&&a.parameters||{}),Lt.extend(l,e);var u={};for(o in l)l.hasOwnProperty(o)&&null!=l[o]&&(l[o].constructor==Function?u[o]=l[o](e):u[o]=l[o]);l=u}if(!C||"port"!==c){if(a){var d=a.template||"jtk-template-"+s;if(null==(r=a.templateRenderer?a.templateRenderer(d,l,S,c,w,a,n):P.render(d,l,S,c,w,a,n))){try{r=b.rotors.render(d,l,S,c,w,a,n)}catch(t){}null==r&&(r=g(l,i))}}else r=g(l,i);return r=ut(t,r,i,c,a,n,v,y,m)}at[i]={id:i,data:l,objectType:c,def:a,jtkClass:v,jtkAttributeName:y,makeDraggable:m,node:n,object:t}}}this.addUnrenderedEdge=function(t,e){lt.push([t,e])};var ht=ct("node",S.getNodeId,S.getNodeType,"getNodeDefinition",t,!0,Ut.NODE,Gt.NODE),pt=ct("port",S.getPortId,S.getPortType,"getPortDefinition",t,!1,Ut.PORT,Gt.PORT),ft=ct("group",S.getNodeId,S.getNodeType,"getGroupDefinition",t,!0,Ut.GROUP,Gt.GROUP);this.initialize=function(){var t,e,n,o,s;if(S.setSuspendGraph(!0),I.setSuspendDrawing(!0),d.jsPlumbInstance){var i=d.jsPlumbInstance.select();for(var r in i.each(function(t){B[t.edge.getId()]=t}),e=d.jsPlumbInstance.getManagedElements()){var a=e[r].el;N[a.jtk.node.id]=a,O[d.jsPlumbInstance.getId(a)]=a.jtk.node,z.push(a.jtk.node);var l={node:a.jtk.node,el:a,id:a.jtk.node.id};null!=e.group&&!x||w.getLayout().nodeAdded(l),w.fire(Bt.nodeAdded,l)}Mt.doImport&&Mt.doImport(N,B)}else{for(t=0,n=S.getGroupCount();t<n;t++)o=S.getGroupAt(t),y(o)&&Q(o);for(t=0,n=S.getNodeCount();t<n;t++)e=S.getNodeAt(t),y(e)&&$(e);var u=function(t){var e=S.getAllEdgesFor(t);for(s=0;s<e.length;s++)if(e[s].source===t||e[s].source.getNode&&e[s].source.getNode()===t){var n=tt.getEdgeDefinition(S.getNodeType(e[s].data));if(n&&!0===n.ignore)continue;var o=st(e[s]);if(null!=o.source&&null!=o.target){o.doNotFireConnectionEvent=!0;var i=I.connect(o);if(null!=i){var r=i.getConnector();o.geometry&&r.importGeometry&&r.importGeometry(o.geometry,i),i.edge=e[s],B[e[s].getId()]=i,H(o.type,e[s],i)}}}};for(t=0,n=S.getNodeCount();t<n;t++)e=S.getNodeAt(t),N[e.id]&&u(e);for(t=0,n=S.getGroupCount();t<n;t++)e=S.getGroupAt(t),L[e.id]&&u(e)}this.relayout(),I.setSuspendDrawing(!1,!0),S.setSuspendGraph(!1)},this.getContainer=function(){return c},this.getContainerId=function(){return r},this.getRenderedElement=function(t){if(null==t)return null;var e=t.getFullId();return t.objectType===Vt.portType?F[e]:t.objectType===Vt.groupType?L[e]:N[e]},this.getRenderedNode=function(t){return N[t]},this.getRenderedGroup=function(t){return L[t]},this.getRenderedPort=function(t){return F[t]},this.getRenderedConnection=function(t){return B[t]},this.getRenderedEndpoint=function(t){var e=Tt(t),n=null;return e&&e.obj&&"Port"===e.obj.objectType&&(n=mt[e.obj.getFullId()]),n},this.getViewportPosition=function(t){var e=N[t.id]||L[t.id],n=I.getId(e);return w._viewportManager.getPosition(n)};var gt=function(t,e){var n=w._getGroupDragArea?w._getGroupDragArea(e):L[e.id],o=I.extend({container:n,getElementForNode:function(t){return N[t]},negativeValuesAllowed:!1},t);if(!Ot.Layouts[o.type])throw"no such layout ["+o.type+"]";return o.jsPlumbToolkit=S,o.adapter=new Ht(e,w),o.renderer=w,o.locationFunction||(o.locationFunction=function(t){return[Rt.data(t.data,g),Rt.data(t.data,m)]}),new Ot.Layouts[o.type](o)};this.adHocLayout=function(t){if(t){var e=s;this.setLayout(t),s=e}},this.setLayout=function(t,e){if(t){var n=Lt.extend({jsPlumb:this.getJsPlumb(),viewport:this._viewportManager},t);s=function(t){var e=I.extend({container:c,getElementForNode:function(t){return N[t]||L[t]}},t);if(e.jsPlumbToolkit=S,e.adapter=new Wt(w,x),e.renderer=w,!Ot.Layouts[e.type])throw"no such layout ["+e.type+"]";return e.locationFunction||(e.locationFunction=function(t){return[Rt.data(t.data,g),Rt.data(t.data,m)]}),new Ot.Layouts[e.type](e)}(n),e||w.refresh()}},this.getLayout=function(){return s},this.getMagnetizedElements=function(){return null!=s?s.getMagnetizedElements():[]},this.magnetize=function(t){null!=s&&s.magnetize(t)},this.rotate=function(t,e){var n=Tt(t);if(n.el){n.obj.data.rotation=e;for(var o=I.getId(n.el),i=I.rotate(o,e),r=0;r<i.c.length;r++){var s=i.c[r].edge,a=i.c[r].connector;a&&a.geometry&&a.exportGeometry&&l.setEdgeGeometry(s,a.exportGeometry())}this._viewportManager.rotateElement(o,e),this.fire("rotate",n.obj,e)}},this.refresh=function(t){i||t&&!n||(s?s.layout(function(){this.fire(Bt.afterLayoutRefresh,{bounds:this.getBoundsInfo(),positions:s.getPositions(),sizes:s.getSizes()}),"undefined"!=typeof window?window.setTimeout(I.repaintEverything,0):I.repaintEverything()}.bind(this)):I.repaintEverything())},this.setRefreshAutomatically=function(t){n=t},this.reload=function(){jsPlumbUtil.log("JSPLUMB: `reload` method not implement unless you're rendering a Selection")},this.relayout=function(t){i||(s?s.relayout(t,function(){w.relayoutGroups(),I.repaintEverything(),this.fire(Bt.relayout,{bounds:this.getBoundsInfo(),positions:s.getPositions(),sizes:s.getSizes()})}.bind(this)):I.repaintEverything())},this.relayoutGroups=function(){S.eachGroup(function(t,e){y(e)&&w.relayoutGroup(e)})},this.relayoutGroup=function(t){if(!t.layout){var e=Tt(t);if(!e.obj||!e.obj.layout)return;t=e.obj}t.layout.relayout(),w.sizeGroupToFit(t,!0),I.revalidate(L[t.id]),w.fire(Bt.groupRelayout,t,L[t.id])},this.getPath=function(t){var e=S.getPath(t);return e&&(e.setVisible=function(t){w.setVisible(e,t)},e.addNodeClass=function(n){e.eachNode(function(t,e){I.addClass(N[e.id],n)})},e.removeNodeClass=function(n){e.eachNode(function(t,e){I.removeClass(N[e.id],n)})},e.addEdgeClass=function(n){e.eachEdge(function(t,e){B[e.getId()].addClass(n)})},e.removeEdgeClass=function(n){e.eachEdge(function(t,e){B[e.getId()].removeClass(n)})},e.addClass=function(t){this.addNodeClass(t),this.addEdgeClass(t)},e.removeClass=function(t){this.removeNodeClass(t),this.removeEdgeClass(t)}),e},this.getPosition=function(t){var e=this.getLayout();if(e){var n=Tt(t).id;return e.getPosition(n)}},this.getSize=function(t){return I.getSize(Tt(t).el)},this.getCoordinates=function(t){var e=this.getLayout();if(e){var n=Tt(t);if(n.obj){var o=I.getSize(n.el),i=n.obj.group?n.obj.group.layout.getPosition(n.id):e.getPosition(n.id);return{x:i[0],y:i[1],w:o[0],h:o[1]}}return{x:0,y:0,w:0,h:0}}};var mt={},vt={},yt={};this.ingestEndpoint=function(t,e){(mt[t.getFullId()]=e).graph={node:t.getNode(),port:t}};var bt=function(t,i,e){function n(o){return function(t){var e=i.getPort(r),n=[{portId:r,nodeId:i.id,port:e,node:i,portType:s,endpoint:t.endpoint,anchor:t.anchor}];o.apply(o,n)}}function o(n){return function(t){var e=[{connection:t.connection||t,source:Tt(t.source),target:Tt(t.target),scope:t.scope}];return n.apply(n,e)}}var r=t.value("port-id"),s=t.value("port-type")||"default",a=t.value("scope")||I.getDefaultScope(),l=i.getPorts().find(function(t){return t.id===r}),u=S.getNodeType(i),d=tt.getNodeDefinition(u),c=tt.getPortDefinition(r,d),h=tt.getPortDefinition(s,d),p=Ft.merge(h,c),f=null==p?{}:null!=l?Ft.populate(p,l.data,null,!0):Ft.populate(p,i.data,null,!0),g=f.edgeType||t.value("edge-type")||"default",m={paintStyle:"connectorStyle",hoverPaintStyle:"connectorHoverStyle",overlays:"connectorOverlays",endpointStyle:"paintStyle"},v=tt.getEdgeDefinition(g);if(v)for(var y in v)if("label"!==y){var b=m[y]||y;null==f[b]&&(f[b]=v[y])}if(f.connectionType=g,f.portId=r,f.portType=s,f.scope=a,f.parameters=f.parameters||{},f.parameters.portId=r,f.parameters.portType=s,f.parameters.edgeType=g,f.parameters.scope=a,f.parameters.nodeId=i.id,f.events={},p.events)for(y in p.events)f.events[y]=n(p.events[y]);if(p.interceptors)for(y in p.interceptors)f[y]=o(p.interceptors[y]);var P=t.value("anchor-x"),E=t.value("anchor-y"),x=t.value("orientation-x"),C=t.value("orientation-y"),j=t.value("offset-x"),_=t.value("offset-y");return null!=P&&null!=E&&(f.anchor=[parseFloat(P),parseFloat(E),parseInt(x||"0",10),parseInt(C||"0",10),parseFloat(j||"0"),parseFloat(_||"0")]),Lt.extend(f,e||{}),f.events.anchorChanged=function(t){w.fire("anchorChanged",{portId:r,nodeId:i.id,portType:s,node:i,port:i.getPort(r),endpoint:t.endpoint,anchor:t.anchor})},f},Pt=function(o){this.element=o.parentNode,this.value=function(t,e){var n=o.getAttribute(t);return null==n?e:n},this.setValue=function(t,e){o.setAttribute(t,e)},this.findDataValues=function(t){for(var e=0;e<o.attributes.length;e++){var n=o.attributes[e];0===n.name.indexOf("data-")&&(t[n.value]=n.name.split("-")[1])}}},Et=function(o,n,t){this.element=n,this.port=t,this.value=function(t,e){var n=o[t.replace(/(\-\w)/g,function(t){return t[1].toUpperCase()})];return null==n?e:n},this.findDataValues=function(t){for(var e in o)0===e.indexOf("data-")&&(t[o[e]]=e.split("-")[1])},this.setValue=function(t,e){n.setAttribute(t,e)}};function xt(t,e,n){if(null==t.value("jtk-processed")){t.setValue("jtk-processed",!0);var o=bt(t,e,n);"true"===t.value("is-source")&&(o.isSource=!0),"true"===t.value("is-target")&&(o.isTarget=!0);var i=I.addEndpoint(t.element,o);mt[e.id+"."+o.portId]=i;var r=t.port||e.addPort({id:o.portId});i.graph={port:r},i.graph["Node"===e.objectType?"node":"group"]=e,u.onUpdate(t.element,function(){})}}function Ct(t,e){if(e.events)for(var n in e.events)I.on(t,n,e.events[n])}function jt(t,o,e){if(null==t.value("jtk-processed")){t.setValue("jtk-processed",!0);var n=bt(t,o,e);n.rank="Node"===o.objectType?10:0,null!=n.portId&&(F[o.id+"."+n.portId]=t.element,t.element.jtk=t.element.jtk||{},t.element.jtk.port=S.addPort(o,{id:n.portId,type:n.portType||"default"},!0),Ct(t.element,n));var i=t.value("filter");if(i){var r="true"===t.value("filter-exclude");n.filter=i,n.filterExclude=r}if("true"===t.value("is-source")&&(n.isSource=!0),delete n.uniqueEndpoint,delete n.createEndpoint,n.extract={},t.findDataValues(n.extract),"true"===t.value("endpoint")){null==n.maxConnections&&(n.maxConnections=-1),n.isSource=!0;var s=I.addEndpoint(t.element,n);s.graph={},s.graph["Node"===o.objectType?"node":"group"]=o,null==n.portId?vt[o.id]=s:mt[o.id+"."+n.portId]=s,u.onUpdate(t.element,function(){})}else{var a,l=t.element._katavorioDrop?t.element._katavorioDrop.length:0;I.makeSource(t.element,n),null!=n.portId&&(I._sourceDefsByPortId=I._sourceDefsByPortId||{},I._sourceDefsByPortId[n.portId]=I._sourceDefsByPortId[n.portId]||[],I._sourceDefsByPortId[n.portId].push([I.getId(t.element),o])),l<(t.element._katavorioDrop?t.element._katavorioDrop.length:0)&&(a=t.element._katavorioDrop[t.element._katavorioDrop.length-1]),u.onUpdate(t.element,function(t){var e=Lt.getSelector(t,"jtk-source");if(1===e.length){var n=bt(new Pt(e[0]),o,null);n.scope&&(I.setSourceScope(t,n.scope,n.edgeType),a&&a.k.setDropScope(a,n.scope))}})}}}function _t(t,o,e){if(null==t.value("jtk-processed")){t.setValue("jtk-processed",!0);var n=bt(t,o,e);if(n.rank="Node"===o.objectType?10:0,null!=n.portId&&(F[o.id+"."+n.portId]=t.element,t.element.jtk=t.element.jtk||{},t.element.jtk.port=S.addPort(o,{id:n.portId,type:n.portType||"default"},!0),Ct(t.element,n)),"true"===t.value("is-target")&&(n.isTarget=!0),delete n.uniqueEndpoint,delete n.createEndpoint,"true"===t.value("endpoint")){null==n.maxConnections&&(n.maxConnections=-1),n.isTarget=!0;var i=I.addEndpoint(t.element,n);i.graph={},i.graph["Node"===o.objectType?"node":"group"]=o,null==n.portId?yt[o.id]=i:mt[o.id+"."+n.portId]=i,u.onUpdate(t.element,function(){})}else{I.makeTarget(t.element,n),null!=n.portId&&(I._targetDefsByPortId=I._targetDefsByPortId||{},I._targetDefsByPortId[n.portId]=I._targetDefsByPortId[n.portId]||[],I._targetDefsByPortId[n.portId].push([I.getId(t.element),o]));var r=t.element._katavorioDrop[t.element._katavorioDrop.length-1];u.onUpdate(t.element,function(t){var e=Lt.getSelector(t,"jtk-target");if(1===e.length){var n=bt(new Pt(e[0]),o,null);n.scope&&(r.targetDef.def.scope=n.scope,r.k.setDropScope(r,n.scope))}})}}}var wt=function(t,e){var n,o=Lt.getSelector(t,zt.PORT),i=Lt.getSelector(t,zt.SOURCE),r=Lt.getSelector(t,zt.TARGET);for(n=0;n<i.length;n++)jt(new Pt(i[n]),e);for(n=0;n<r.length;n++)_t(new Pt(r[n]),e);for(n=0;n<o.length;n++)xt(new Pt(o[n]),e)};function St(t){var e=t.info||Tt(t.node);if(e&&e.obj){var n=null==t.x?0:t.x||0,o=null==t.y?0:t.y||0,i="Port"===e.obj.objectType?e.obj.getNode():e.obj,r=i.id;if(!1!==t.updateLayout)(i.group?i.group.layout:s)[t.magnetize?"setMagnetizedPosition":"setPosition"](r,n,o);!0===t.doNotUpdateElement||t.magnetize||I.setAbsolutePosition(e.el,[n,o],t.animateFrom,t.animateOptions),!0===t.revalidate&&I.revalidate(e.el),t.storeInModel&&v&&w.storePositionInModel(r)}return e}function It(t,e,n){if(1===e.connections.length)e.setVisible(n,!0);else if(n)e.setVisible(!0,!0);else{for(var o=0;o<e.connections.length;o++)if(e.connections[o]!==t&&e.connections[o].isVisible())return;e.setVisible(!1,!0)}}function kt(t,e,n){var o=V(t);o&&(e&&!function(t){return!1!==t.endpoints[0].element._jtkVisible&&!1!==t.endpoints[1].element._jtkVisible}(o)||(o.setVisible(e),n||(It(o,o.endpoints[0],e),It(o,o.endpoints[1],e))))}function At(t,n){var o;if(t.eachNode&&t.eachEdge)o={nodes:[],edges:[]},t.eachNode(function(t,e){o.nodes.push(n(Tt(e)))}),t.eachEdge(function(t,e){o.edges.push(n(Tt(e)))});else if(t.length&&"string"!=typeof t){o=[];for(var e=0;e<t.length;e++)o.push(n(Tt(t[e])))}else o=n(Tt(t));return o}function Tt(t){return t instanceof I.getDefaultConnectionType()&&(t=t.edge),S.getObjectInfo(t,function(t){return t.getNode?F[t.getFullId()]||N[t.getNode().id]:N[t.id]||L[t.id]})}if(this.setLayout(d.layout,!0),this.storePositionsInModel=function(t){var i=(t=t||{}).leftAttribute||"left",r=t.topAttribute||"top",e=s.getPositions();for(var n in e){var o=S.getNode(n)||S.getGroup(n);o&&(Rt.data(o.data,i,e[n][0]),Rt.data(o.data,r,e[n][1]))}S.eachGroup(function(t,e){var n=e.getNodes(),o=e.layout.getPositions();for(t=0;t<n.length;t++)Rt.data(n[t].data,i,o[n[t].id][0]),Rt.data(n[t].data,r,o[n[t].id][1])})},this.storePositionInModel=function(t){var e="string"==typeof t?t:t.id,n="string"==typeof t?"left":t.leftAttribute||"left",o="string"==typeof t?"top":t.topAttribute||"top",i=S[t.group?"getGroup":"getNode"](e),r=i.group?i.group.layout.getPosition(e):s.getPosition(e);return i&&(v||t.force)&&(Rt.data(i.data,n,r[0]),Rt.data(i.data,o,r[1])),r},this.setPosition=function(t){return St({info:null,node:t.node,x:t.x,y:t.y,doNotUpdateElement:t.doNotUpdateElement,animateFrom:null,animateOptions:null,updateLayout:!0!==t.doNotUpdateLayout,revalidate:!0===t.doRevalidate,storeInModel:!0,size:t.size})},this.setMagnetizedPosition=function(t,e,n,o){return St({info:null,node:t,x:e,y:n,doNotUpdateElement:o,animateFrom:null,animateOptions:null,updateLayout:!0,magnetize:!0,revalidate:!0})},this.animateToPosition=function(t,e,n,o){var i=Tt(t);if(i){var r=s.getPosition(i.id);St({info:i,node:t,x:e,y:n,animateFrom:[r[0],r[1]],animateOptions:o})}},this.isVisible=function(t){return At(t,function(t){switch(t.type){case"Edge":var e=V(t.obj);return!!e&&e.isVisible();case"Node":return!1!==t.el._jtkVisible}})},this.setVisible=function(t,a,l){if(null!=t){At(t,function(t){switch(t.type){case"Edge":kt(t.obj,a,l);break;case"Node":!function(t,e){if(e&&(e.style.display=a?"block":"none",e._jtkVisible=a,w.fire(Bt.nodeVisibility,{node:t,el:e,state:a}),!l))for(var n=S.getAllEdgesFor(t),o=0;o<n.length;o++)if(a){var i=n[o].source.getNode?n[o].source.getNode():n[o].source,r=n[o].target.getNode?n[o].target.getNode():n[o].target,s=i===t?r:i;w.isVisible(s)&&kt(n[o],a,l)}else kt(n[o],a,l)}(t.obj,t.el);break;case"Port":!function(t){var e=t.getFullId();mt[e].setVisible(a)}(t.obj)}})}},this.addToPosse=function(t,n,o){Ft.each(t,function(t){var e=Tt(t);e.el&&I.addToPosse(e.el,{id:n,active:!1!==o})})},this.setPosse=function(t,n){Ft.each(t,function(t){var e=Tt(t);e.el&&I.setPosse(e.el,n)})},this.removeFromPosse=function(t,n){Ft.each(t,function(t){var e=Tt(t);e.el&&I.removeFromPosse(e.el,n)})},this.removeFromAllPosses=function(t){Ft.each(t,function(t){var e=Tt(t);e.el&&I.removeFromAllPosses(e.el)})},this.setPosseState=function(t,n,o){Ft.each(t,function(t){var e=Tt(t);e.el&&I.setPosseState(e.el,n,o)})},this.destroy=function(){var e;s&&s.destroy(),u.destroy();for(var t=0;t<q.length;t++)try{e=q[t],S.unbind(e.event,e.fn)}catch(t){Ft.log("WARN: Could not unbind event "+e.event+" during destroy operation.")}this._destroy&&this._destroy(),this._onDestroy&&this._onDestroy(this),I.destroy(),P=nt=null,z.length=0,R.length=0,Y.length=0,B={},N={},L={},O={},G={},F={},mt={},d=S=Mt=c=w=null},this.registerTag=function(t,e,n){u.registerTag(t,e,n)},d.tags)for(var Dt in d.tags)this.registerTag(Dt,d.tags[Dt]);var Mt={viewportManager:this._viewportManager,jsPlumb:I,toolkit:S,container:c,containerId:r,getConnectionsForEdges:function(t){for(var e=[],n=0;n<t.length;n++)e.push(B[t[n].getId()]);return e},getConnectionForEdge:V,getElement:function(t){return N[t]||L[t]},getNodeForElementId:function(t){return O[t]},getGroupForElementId:function(t){return G[t]},getObjectInfo:Tt,nodeMap:function(){return N},portMap:function(){return F},groupMap:function(){return L},nodeList:function(){return z},isIgnoreGroups:function(){return x},reverseGroupMap:function(){return G},reverseNodeMap:function(){return O},bindToToolkit:function(t,e){null==nt[t]?K(t,e,!0):(J[t]=J[t]||[],J[t].push(e))}};return Mt}t.AbstractRenderer=o,t.DOM=function(t){o.apply(this,arguments),e.apply(this,arguments)}}.call("undefined"!=typeof window?window:this),function(){"use strict";function t(e,n,o){return function(t){return t[e]/n*(o?-1:1)}}function r(o,i,r){return function(t){if(!i||null==t.mozInputSource||1===t.mozInputSource){var e=function(t){return a(t||event)}(t),n=function(t){return l(t||event)}(t);t.normalizedWheelDelta=e,r&&!t.metaKey&&!t.ctrlKey||o(t,n,e,t.metaKey||t.ctrlKey)}}}var e={webkit:{mac:t("deltaY",120),win:t("deltaY",100)},safari:t("wheelDeltaY",120,!0),firefox:{mac:function(t){return t.deltaY*(1===t.deltaMode?25:1)*-1/120},win:function(t){return-1*t.deltaY/3}},ie:function(t){return t.wheelDelta/120},default:function(t){return t.deltaY||t.wheelDelta}},n={webkit:{mac:t("deltaX",120),win:t("deltaX",100)},safari:t("wheelDeltaX",120,!0),firefox:{mac:function(t){return t.deltaX*(1===t.deltaMode?25:1)*-1/120},win:function(t){return-1*t.deltaX/3}},ie:function(t){return t.wheelDelta/120},default:function(t){return t.deltaX||t.wheelDelta}},o="undefined"!=typeof navigator,i=o?/Mac/.test(navigator.userAgent)?"mac":"win":"mac",s=o?-1!==navigator.userAgent.indexOf("Firefox")?"firefox":/Chrome/.test(navigator.userAgent)?"webkit":/Safari/.test(navigator.userAgent)?"safari":/WebKit/.test(navigator.userAgent)?"webkit":/Trident/.test(navigator.userAgent)?"ie":"default":"default",a="function"==typeof e[s]?e[s]:e[s][i],l="function"==typeof n[s]?n[s]:n[s][i],u="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";this.addWheelListener=function(t,e,n,o){var i=r(e,n,o);t.addEventListener?t.addEventListener(u,i,!1):t.attachEvent&&t.attachEvent("onmousewheel",i)}}.call("undefined"!=typeof window?window:this),function(){this.PinchListener=function(e){function d(t){e[t](p,g,f,f/g)}function c(){e.onPinchEnd()}function h(t,e,n,o){return Math.sqrt(Math.pow(n-t,2)+Math.pow(o-e,2))}var t="onpointerdown"in document.documentElement,n="ontouchstart"in document.documentElement,p=[0,0],f=0,g=0,m="onPinchStart",o=function(n){function o(t){return t.touches||[]}function i(t,e){return t.item?t.item(e):t[e]}function r(t){var e=i(t,0),n=i(t,1);return h(e.pageX,e.pageY,n.pageX,n.pageY)}function s(t){var e=i(t,0),n=i(t,1);return[(e.pageX+n.pageX)/2,(e.pageY+n.pageY)/2]}var a=!1,l=function(t){a=!1,jsPlumbUtil.consume(t),n.unbind(document,"touchmove",u),n.unbind(document,"touchend",l),c()},u=function(t){if(a){var e=o(t);2===e.length&&(jsPlumbUtil.consume(t),f=r(e),p=s(e),d("onPinch"))}};n.bind(n.el,"touchstart",function(t){var e=o(t);2===e.length&&!1!==n.enableWheelZoom&&(p=s(e),f=g=r(e),a=!0,n.bind(document,"touchmove",u),n.bind(document,"touchend",l),jsPlumbUtil.consume(t),d(m))})};t?function(){function n(){2===r&&(p=[(i[1].p[0]+i[0].p[0])/2,(i[1].p[1]+i[0].p[1])/2],f=h(i[1].p[0],i[1].p[1],i[0].p[0],i[0].p[1]))}var o={},i=[],r=0,s=!1;e.bind(e.el,"pointerdown",function(t){2<=r||s||(i[r]={e:t,p:[t.pageX,t.pageY]},o[""+t.pointerId]=r,r++,n(),2===r&&(g=f,d(m)))}),e.bind(document,"pointerup",function(t){null!=o[""+t.pointerId]&&(delete o[""+t.pointerId],s=0!==--r,c())}),e.bind(document,"pointermove",function(t){if(!s&&2===r){var e=o[t.pointerId];null!=e&&(i[e].p=[t.pageX,t.pageY],n(),d("onPinch"))}})}(e):n&&o(e),this.destroy=function(){e=null}}}.call("undefined"!=typeof window?window:this),function(){"use strict";function n(t,e,n,o,i){function r(t,e){return[s[0]+Math.round((t-s[0])*a-(e-s[1])*l),s[1]+Math.round((e-s[1])*a-(t-s[0])*l)]}var s=[t+n/2,e+o/2],a=Math.cos(i/360*Math.PI*2),l=Math.sin(i/360*Math.PI*2),u=r(t,e),d=r(t+n,e),c=r(t+n,e+o),h=r(t,e+o),p=r(t+n/2,e+o/2),f=Math.min(u[0],d[0],c[0],h[0]),g=Math.max(u[0],d[0],c[0],h[0]),m=Math.min(u[1],d[1],c[1],h[1]);return{x:f,y:m,w:g-f,h:Math.max(u[1],d[1],c[1],h[1])-m,c:p,r:i}}function i(t,e,n){var o=0;return e[1]>t[1]?o=-1:e[1]<t[1]&&(o=1),n&&(o*=-1),o}this.jsPlumbToolkitViewport=function(){this._eventsSuspended=!1,jsPlumbUtil.EventGenerator.apply(this),this._sortedElements={xmin:[],xmax:[],ymin:[],ymax:[]},this._elementMap={},this._transformedElementMap={},this._bounds={minx:0,maxx:0,miny:0,maxy:0},this._clearElementIndex=function(e,t){var n=t.findIndex(function(t){return t[0]===e});-1<n&&t.splice(n,1)},this._updateElementIndex=function(t,e,n,o){!function(t,e,n,o){if(0===e.length)e.push(t);else{for(var i=0,r=e.length,s=Math.floor((i+r)/2);i<r;)n(t,e[s],o)<0?r=s:i=s+1,s=Math.floor((i+r)/2);e.splice(s,0,t)}}([t,e],n,i,o)},this._updateBounds=function(t,e){null!=e&&(this._clearElementIndex(t,this._sortedElements.xmin),this._clearElementIndex(t,this._sortedElements.xmax),this._clearElementIndex(t,this._sortedElements.ymin),this._clearElementIndex(t,this._sortedElements.ymax),this._updateElementIndex(t,e.t.x,this._sortedElements.xmin,!1),this._updateElementIndex(t,e.t.x+e.t.w,this._sortedElements.xmax,!0),this._updateElementIndex(t,e.t.y,this._sortedElements.ymin,!1),this._updateElementIndex(t,e.t.y+e.t.h,this._sortedElements.ymax,!0),this._recalculateBounds())},this._recalculateBounds=function(){this._bounds.minx=0<this._sortedElements.xmin.length?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=0<this._sortedElements.xmax.length?this._sortedElements.xmax[0][1]:0,this._bounds.miny=0<this._sortedElements.ymin.length?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=0<this._sortedElements.ymax.length?this._sortedElements.ymax[0][1]:0},this._finaliseUpdate=function(t,e){e.t=n(e.x,e.y,e.w,e.h,e.r),this._transformedElementMap[t]=e.t,this._updateBounds(t,e)},this._fireUpdate=function(t){this.fire("update",t||{})},this.shouldFireEvent=function(){return!this._eventsSuspended},this.startTransaction=function(){this._eventsSuspended=!0},this.endTransaction=function(t){this._eventsSuspended=!1,t||this._fireUpdate()},this.updateElements=function(t){this.startTransaction();for(var e=0;e<t.length;e++){var n=t[e];this.updateElement(n.id,n.x,n.y,n.width,n.height,n.rotation)}this.endTransaction()},this.updateElement=function(t,e,n,o,i,r){this._elementMap[t]=this._elementMap[t]||{x:0,y:0,w:0,h:0,r:0,c:[0,0],t:{x:0,y:0,c:[0,0],w:0,h:0}};var s=this._elementMap[t];null!=e&&(s.x=e),null!=n&&(s.y=n),null!=o&&(s.w=o),null!=i&&(s.h=i),null!=r&&(s.r=r||0),s.c[0]=s.x+s.w/2,s.c[1]=s.y+s.h/2,this._finaliseUpdate(t,s)},this.addElement=function(t,e,n,o,i,r){this.updateElement(t,e,n,o,i,r)},this.rotateElement=function(t,e){this._elementMap[t]=this._elementMap[t]||{x:0,y:0,w:0,h:0,r:0,c:[0,0],t:{x:0,y:0,c:[0,0],w:0,h:0}};var n=this._elementMap[t];n.r=e||0,this._finaliseUpdate(t,n),this._fireUpdate({type:"rotate",id:t,rotation:n.r})},this.getBoundsWidth=function(){return this._bounds.maxx-this._bounds.minx},this.getBoundsHeight=function(){return this._bounds.maxy-this._bounds.miny},this.getX=function(){return this._bounds.minx},this.getY=function(){return this._bounds.miny},this.setSize=function(t,e,n){null!=this._elementMap[t]&&this.updateElement(t,null,null,e,n,null)},this.reset=function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap={},this._transformedElementMap={},this._recalculateBounds()},this.remove=function(t){this._clearElementIndex(t,this._sortedElements.xmin),this._clearElementIndex(t,this._sortedElements.xmax),this._clearElementIndex(t,this._sortedElements.ymin),this._clearElementIndex(t,this._sortedElements.ymax),delete this._elementMap[t],delete this._transformedElementMap[t],this._recalculateBounds()},this.getPosition=function(t){return this._transformedElementMap[t]?this._transformedElementMap[t]:{x:0,y:0,w:0,h:0,r:0,c:[0,0],t:{x:0,y:0,c:[0,0],w:0,h:0}}},this.getElements=function(){return this._transformedElementMap},this.isEmpty=function(){for(var t in this._elementMap)return!1;return!0}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var Lt=this,Rt=Lt.jsPlumb;this.ZoomWidget=function(y){y.events=y.events||{},this.viewportManager=y.viewportManager||new Lt.jsPlumbToolkitViewport;function t(){}var b,s,a,l,u=this,d=y.canvas,f=y.domElement||function(t){return t},g=f(d),m=y.viewport,P=f(m),v=y.events.zoom||t,c=(y.events.maybeZoom,y.events.pan||t),o=y.events.mousedown||t,n=y.events.mouseup||t,h=y.events.mousemove||t,p=y.events.transformOrigin||t,E=!(!1===y.clamp),x=!1!==y.clampZoom,C=y.panDistance||50,j=!1!==y.enablePan,_=!0===y.directRender,e=!1!==y.enableWheelZoom,w=!1!==y.enableAnimation,i=y.wheelFilter||function(){return!0},r=!0===y.wheelZoomMetaKey,S=(!0===y.wheelReverse?-1:1)*(y.wheelSensitivity||10),I=!0===y.wheelPan,k=!1!==y.enablePanButtons,A=(y.padding,!1!==y.consumeRightClick),T=y.smartMinimumZoom,D="mouseup",M="mousemove",N=["webkit","Moz","ms"],O=y.bind,F=y.unbind,L=!(!1===y.enabled),R=y.clampToBackground,G=y.clampToBackgroundExtents,z=y.filter||function(t){return!1},U=y.width,B=y.height,V=y.zoom||1,H=[0,0],W=!1,X=!1,Y=!1,Z=!1,q=y.zoomRange||[.05,3],J={},K={},$=function(t,e,n,o){this.viewportManager.updateElement(t,e[0],e[1],n,o)}.bind(this);this.setBoundsFor=$,this.setSize=function(t,e,n){this.viewportManager.setSize(t,e,n)},this.setSuspendRendering=function(t){t};function Q(t,e,n,o,i){var r=document.createElement("div");for(var s in r.innerHTML=i||"",r.style.position="absolute",e)r.style[s]=e[s];return r.className="jtk-surface-pan jtk-surface-pan-"+t,P.appendChild(r),y.bind(r,"click",function(t,n){return function(e){Et(g,t*C,n*C,null,!0,function(t){c(t[0],t[1],V,V,e),b&&b.pan(),Ft.pan()})}}(n,o)),y.bind(r,"mousedown",function(t,e,n){return function(){ot=n,y.addClass(ot,"jtk-surface-pan-active"),y.bind(document,"mouseup",it),et=window.setTimeout(function(){y.bind(document,D,st),nt=window.setInterval(rt(t,e),60)},150)}}(n,o,r)),tt.push(r),r}var tt=[],et=null,nt=null,ot=null,it=function(){window.clearTimeout(et),ot&&y.removeClass(ot,"jtk-surface-pan-active"),ot=null},rt=function(n,o){return function(t){var e=Et(g,10*n,10*o,null);c(e[0],e[1],V,V,t),b&&b.pan(),Ft.pan()}},st=function(){window.clearTimeout(nt)};k&&(Q("top",{left:"0px",top:"0px"},0,-1,"&#8593;"),Q("bottom",{left:"0px",bottom:"0px"},0,1,"&#8595;"),Q("left",{left:"0px",top:"0px"},-1,0,"&#8592;"),Q("right",{right:"0px",top:"0px"},1,0,"&#8594;"));function at(t,e,n){n=n||g;for(var o=0;o<N.length;o++){var i=t.replace(/([a-z]){1}/,function(t){return N[o]+t.toUpperCase()});n.style[i]=e}n.style[t]=e}function lt(t){at("transformOrigin",H[0]+"% "+H[1]+"%",t)}function ut(t,e,n,o){var i,r,s=H[0]/100*e,a=H[1]/100*n;i=-s*(1-V),r=-a*(1-V),H=t,lt(),s=H[0]/100*e,a=H[1]/100*n;var l=Et(g,-s*(1-V)-i,-a*(1-V)-r,o);p&&p(H,l)}function dt(t,e,n){var o=function(t,e){var n=u.mapLocation(t,e),o=[n.left,n.top],i=y.width(d),r=y.height(d);return{w:i,h:r,xy:o,xScale:o[0]/i,yScale:o[1]/r,o:[o[0]/i*100,o[1]/r*100]}}(t,e);ut(o.o,o.w,o.h,n)}function ct(t){var e=pt(t);dt(e[0],e[1],t)}function ht(t,e){var n=y.width(d),o=y.height(d);ut([t/n*100,e/o*100],n,o)}var pt=function(t){var e,n=mt(t);if(n&&0<n.length){var o=gt(n,0);o&&(e=[o.pageX,o.pageY])}return e&&e[0]&&e[1]?e:null!=t.pageX?[t.pageX,t.pageY]:[0,0]};this.pageLocation=pt;function ft(t,e,n,o){e<-150&&(e=-150),150<e&&(e=150),yt(a,e,-150,150,n,o)}var gt=function(t,e){return t.item?t.item(e):t[e]},mt=function(t){return t.touches||[]},vt=function(t,e,n,o,i){if(!_&&!(null==t||isNaN(t)||t<0)){var r=q[0];if(T){r=.5;var s=this.getBoundsInfo().z;t/s<r&&(t=s*r)}else t<r&&(t=r);if(t>q[1]&&(t=q[1]),o){var a=V<t?.05:-.05,l=V,u=t<V,d=window.setInterval(function(){l=vt(l+a),u&&l<=t&&window.clearInterval(d),!u&&t<=l&&window.clearInterval(d)});return V}at("transform","scale("+t+")");var c=V;if(V=t,i||v(0,0,V,c,e,n),null!=b&&b.setZoom(t),Ft&&Ft.pan(),x){var h=Pt(g),p=bt(h[0],h[1]);p[0]==h[0]&&p[1]==h[1]||Pt(g,p[0],p[1],null,!o)}return V}}.bind(this),yt=function(t,e,n,o,i,r){var s=t+e/(0<=e?o:n)*(q[0<=e?1:0]-t);vt(s,i,r)},bt=function(t,e,n){if(E||R||G){var o=xt(),i=t,r=e,s=E?this.getBoundsInfo():{x:0,y:0,w:0,h:0,vw:y.width(P),vh:y.height(P),padding:n,z:1};if(n=(n||20)*V,(R||G)&&null!=b){var a=b.getWidth(),l=b.getHeight(),u=Math.max(s.x+s.w,a),d=Math.max(s.y+s.h,l);s.w=u-s.w,s.h=d-s.h;var c=s.vw/s.w,h=s.vh/s.h;s.z=Math.min(c,h),G&&(n=Math.max(s.vw,s.vh))}var p=[s.x+s.w,s.y+s.h];b&&(p[0]=Math.max(p[0],b.getWidth()),p[1]=Math.max(p[1],b.getHeight()));var f=t+o[0]+p[0]*V-n,g=e+o[1]+p[1]*V-n,m=t+o[0]+s.x*V+n,v=e+o[1]+s.y*V+n;return f<0&&(i-=f),m>s.vw&&(i-=m-s.vw),g<0&&(r-=g),v>s.vh&&(r-=v-s.vh),[i,r]}return[t,e]}.bind(this),Pt=function(t,e,n,o,i,r,s){if(1===arguments.length)return[parseInt(t.style.left,10)||0,parseInt(t.style.top,10)||0];var a=bt(e,n);return w&&!i&&y.animate?y.animate(t,{left:a[0],top:a[1]},{step:s,complete:function(){r&&r(a)}}):(t.style.left=a[0]+"px",t.style.top=a[1]+"px",r&&r(a)),a};g.style.left="0px",g.style.top="0px";var Et=function(t,e,n,o,i,r){var s=Pt(t);return Pt(t,s[0]+e,s[1]+n,o,!i,r)},xt=function(){var t=y.width(d),e=y.height(d),n=H[0]/100*t,o=H[1]/100*e;return[n*(1-V),o*(1-V)]},Ct={start:function(t,e){if(!X){var n=t.srcElement||t.target;L&&(n===g||n===P||n._jtkDecoration||b&&b.owns(n)||!0===z(n,t))&&(Z=!1,-1,3!==t.which||!1===y.enableWheelZoom||null!=t.mozInputSource&&1!==t.mozInputSource?e.length<=1&&(W=!0,s=pt(t),l=Pt(g),jsPlumbUtil.consume(t)):(Y=!0,s=pt(t),ct(t),l=Pt(g),a=V)),o(t,u)}},move:function(t,e){var n,o,i;if(Z=!1,!X){if(Y)n=(i=pt(t))[0]-s[0],o=i[1]-s[1],ft(0,o,t);else if(W&&j&&null!=s){jsPlumbUtil.consume(t),n=(i=pt(t))[0]-s[0],o=i[1]-s[1];var r=Pt(g,l[0]+n,l[1]+o,t,!0);c(r[0],r[1],V,V,t),b&&b.pan(),Ft&&Ft.pan(),jsPlumbUtil.consume(t)}h(t,u)}},end:function(t,e){X||(s=null,Z=W=Y=!1,F(document,M,_t),F(document,D,wt),O(document,M,St),n(t,u))},contextmenu:function(t){}},jt=function(t,e){"contextmenu"===t&&A&&e.preventDefault&&e.preventDefault();var n=mt(e);Ct[t](e,n)},_t=function(t){jt("move",t)},wt=function(t){jt("end",t)},St=function(t){Z=!1};O(document,M,St);function It(t){L&&null!=t&&(F(document,M,St),O(document,M,_t),O(document,D,wt),Ct.start(t,mt(t)))}if(this.start=It,O(m,"mousedown",It),O(m,"contextmenu",function(t){jt("contextmenu",t)}),e){addWheelListener(P,function(t,e,n,o){i(t)&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),!I||o?function(t){a=V,Z||(ct(t),Z=!0),ft(0,t.normalizedWheelDelta*S,t,!0)}(t):function(t,e,n,o){o||Tt(100*-e,100*-n)}(0,e,n,o))},!0,r)}var kt=new PinchListener({el:m,bind:O,unbind:F,enableWheelZoom:y.enableWheelZoom,onPinch:function(t,e,n,o){vt(o*a);var i=t[0]-s[0],r=t[1]-s[1];Pt(g,l[0]+i,l[1]+r,null,!0)},onPinchStart:function(t,e){X=!0,e,a=V,dt((s=t)[0],s[1]),l=Pt(g)},onPinchEnd:function(){X=!1,s=null}});this.getBoundsInfo=function(t,e){if(this.viewportManager.isEmpty())return{w:0,h:0,x:0,y:0,vw:y.width(P),vh:y.height(P),padding:t,z:1,zoom:1};t=t||0,e=e||.9;var n=this.viewportManager.getBoundsWidth(),o=this.viewportManager.getBoundsHeight(),i=y.width(P),r=y.height(P),s=i/((n+2*t)/e),a=r/((o+2*t)/e),l=Math.min(s,a);return{w:n,h:o,x:this.viewportManager.getX(),y:this.viewportManager.getY(),vw:i,vh:r,padding:t,z:l,zoom:V}},vt(V,null,!1,!1,!0),lt(),this.isPinchZooming=function(){return X},this.positionChanged=function(t,e,n,o){n=n||y.id(t);var i=e||Pt(t),r=o?o[0]:y.width(t),s=o?o[1]:y.height(t);J[n]=t,$(n,i,r,s)},this.add=function(t,e,n,o){this.positionChanged(t,n,e),o&&(O(t,"mousedown",It),t._jtkDecoration=!0)},this.suspend=function(t){var e="string"==typeof t?t:y.id(t);K[e]=!0,At(e)},this.isSuspended=function(t){var e="string"==typeof t?t:y.id(t);return!0===K[e]},this.restore=function(t){var e="string"==typeof t?t:y.id(t);delete K[e],this.positionChanged(t,null,e)},this.remove=function(t){t=f(t);var e=y.id(t);delete J[e],delete K[e],At(e)};var At=function(t){this.viewportManager.remove(t)}.bind(this);this.reset=function(){this.viewportManager.reset(),J={},K={},Pt(g,0,0,null,!0)},this.zoomToFit=function(t){t=t||{};var e=this.getBoundsInfo(t.padding,t.fill);t.doNotZoomIfVisible&&e.z>V||vt(e.z),u.centerContent({bounds:e,doNotAnimate:!1!==t.doNotAnimate,onComplete:t.onComplete,onStep:t.onStep,doNotFirePanEvent:t.doNotFirePanEvent})},this.zoomToFitIfNecessary=function(t){var e=Rt.extend(t||{});e.doNotZoomIfVisible=!0,this.zoomToFit(e)},this.zoomToElements=function(t){for(var e={x:1/0,y:1/0,xMax:-1/0,yMax:-1/0,z:1,vw:y.width(P),vh:y.height(P)},n=0;n<t.elements.length;n++){var o=t.elements[n],i=this.viewportManager.getPosition(y.id(o));i&&(e.x=Math.min(e.x,i.x),e.y=Math.min(e.y,i.y),e.xMax=Math.max(e.xMax,i.x+i.w),e.yMax=Math.max(e.yMax,i.y+i.h))}var r=t.fill||.9;e.w=e.xMax-e.x,e.h=e.yMax-e.y,e.z=r*Math.min(e.vw/e.w,e.vh/e.h),t.doNotZoomIfVisible&&e.z>V||vt(e.z),u.centerContent({bounds:e,doNotAnimate:!1!==t.doNotAnimate,onComplete:t.onComplete,onStep:t.onStep,doNotFirePanEvent:t.doNotFirePanEvent})},this.zoomToBackground=function(t){if(t=t||{},null!=b){var e=b.getWidth(),n=b.getHeight(),o=U(P),i=B(P),r=o/e,s=i/n,a={w:e,h:n,x:0,y:0,vw:o,vh:i,padding:0,z:Math.min(r,s)};vt(a.z),u.centerContent({bounds:a,doNotAnimate:t.doNotAnimate,onComplete:t.onComplete,onStep:t.onStep})}},this.setFilter=function(t){z=t||function(t){return!1}},this.centerBackground=function(){if(null!=b){var t=Rt.extend({},this.getBoundsInfo());t.x=b.getWidth()/2,t.y=b.getHeight()/2,t.w=1,t.h=1,u.centerContent({bounds:t,doNotAnimate:y.doNotAnimate,onComplete:y.onComplete,onStep:y.onStep,vertical:!0,horizontal:!0})}},this.alignBackground=function(t){if(null!=b){var e=t.split(" "),n=e[0]||"left",o=e[1]||"top",i=this.getBoundsInfo(),r="left"===n?0:i.vw-b.getWidth()*V,s="top"===o?0:i.vh-b.getHeight()*V,a=xt();Pt(g,r-a[0],s-a[1]),b.pan(),Ft&&Ft.pan()}},this.positionElementAt=function(t,e,n,o,i,r){o=o||0,i=i||0;var s=xt(),a=Pt(g),l=f(t),u=l.parentNode,d=y.offset(u),c=y.offset(m),h=c.left-d.left+(a[0]+s[0])+e*V+o,p=c.top-d.top+(a[1]+s[1])+n*V+i;r&&h<0&&(h=0),r&&p<0&&(p=0),l.style.left=h+"px",l.style.top=p+"px"},this.positionElementAtPageLocation=function(t,e,n,o,i){var r=this.mapLocation(e,n);this.positionElementAt(t,r.left,r.top,o,i)},this.positionElementAtEventLocation=function(t,e,n,o){var i=this.mapEventLocation(e);this.positionElementAt(t,i.left,i.top,n,o)},this.zoomToEvent=function(t,e){ct(t),vt(V+e,t)},this.relayout=function(t){if(!1===y.enablePan){var e=t[2]-t[0],n=t[3]-t[1],o=window.getComputedStyle(P),i=1,r=1,s=parseInt(o.getPropertyValue("max-width"),10),a=parseInt(o.getPropertyValue("max-height"),10);!isNaN(s)&&s<e&&(i=s/e,e=s),!isNaN(a)&&a<n&&(r=a/n,n=a);var l=Math.min(i,r);g.style.width=e+"px",g.style.height=n+"px",g.style.left="0",g.style.top="0";var u=t[0]<0?-t[0]:0,d=t[1]<0?-t[1]:0;g.style.transform="translateX("+u*l+"px) translateY("+d*l+"px) scale("+l+")",this.setTransformOrigin(0,0)}},this.nudgeZoom=function(t,e){var n=y.offset(P,!0),o=n.left+y.width(P)/2,i=n.top+y.height(P)/2;return dt(o,i),vt(V+t,e)},this.nudgeWheelZoom=function(t,e){a=V,ft(0,t,e,!0)},this.centerContent=function(t){if(!_){var e=(t=t||{}).bounds||this.getBoundsInfo(),n=xt(),o=e.x*V+e.w*V/2,i=e.y*V+e.h*V/2,r=e.vw/2-o,s=e.vh/2-i,a=Pt(g);Pt(g,!1!==t.horizontal?r-n[0]:a[0],!1!==t.vertical?s-n[1]:a[1],null,t.doNotAnimate,function(){t.doNotFirePanEvent||c(!1!==t.horizontal?r-a[0]:0,!1!==t.vertical?s-a[1]:0,V,V),b&&b.pan(),Ft&&Ft.pan(),t.onComplete&&t.onComplete()},t.onStep)}},this.centerContentHorizontally=function(t){this.centerContent(Rt.extend({horizontal:!0,vertical:!1},t))},this.centerContentVertically=function(t){this.centerContent(Rt.extend({vertical:!0,horizontal:!1},t))},this.centerOn=function(t,e){e=e||{};var n=Rt.extend({},this.getBoundsInfo()),o=Pt(t),i=U(t),r=B(t);n.x=o[0],n.y=o[1],n.w=i,n.h=r;this.centerContent({bounds:n,doNotAnimate:e.doNotAnimate,onComplete:function(){ht(o[0]+i/2,o[1]+r/2),e.onComplete&&e.onComplete()},onStep:e.onStep,vertical:!1!==e.vertical,horizontal:!1!==e.horizontal})},this.centerOnHorizontally=function(t){this.centerOn(t,{vertical:!1})},this.centerOnVertically=function(t){this.centerOn(t,{horizontal:!1})},this.centerOnAndZoom=function(t,e){e=e||.6;var n={w:U(t),h:B(t)},o=Pt(t),i=this.getBoundsInfo(),r=i.vw<i.vh?[i.vw,"w"]:[i.vh,"h"],s=e*r[0]/n[r[1]];s<q[0]&&(s=q[0]),s>q[1]&&(s=q[1]);var a=V,l=s-V;ht(o[0]+n.w/2,o[1]+n.h/2),this.centerOn(t,{onStep:function(t,e){vt(a+t/e*l)},onComplete:function(){vt(s)}})},this.getViewportCenter=function(){var t=Rt.extend({},this.getBoundsInfo()),e=xt(),n=Pt(g),o=[t.vw/2,t.vh/2];return[(o[0]-(n[0]+e[0]))/V,(o[1]-(n[1]+e[1]))/V]},this.setViewportCenter=function(t){var e=Rt.extend({},this.getBoundsInfo()),n=xt(),o=[e.vw/2,e.vh/2],i=[-(t[0]*V-o[0]+n[0]),-(t[1]*V-o[1]+n[1])];Pt(g,i[0],i[1])},this.setClamping=function(t){E=t},this.isClamping=function(){return E},this.setZoom=function(t,e,n){return vt(t,null,null,e,n)},this.setZoomRange=function(t,e){return null!=t&&2===t.length&&t[0]<t[1]&&null!=t[0]&&null!=t[1]&&0<t[0]&&0<t[1]&&(q=t,e||(V<q[0]||V>q[1])&&vt(V)),q},this.getZoomRange=function(){return q},this.getZoom=function(){return V},this.getPan=function(){return Pt(g)};var Tt=function(t,e,n){Et(g,t,e,null,n,function(t){c(t[0],t[1],V,V),b&&b.pan(),Ft&&Ft.pan()})};this.pan=Tt,this.setPan=function(t,e,n,o,i){return Pt(g,t,e,null,!n,o,i)},this.setTransformOrigin=function(t,e){H=[t,e],lt()};var Dt=this.calculateCumulativeScroll=function(t){for(var e=t,n=0,o=0;null!=e&&e!==document.body;)isNaN(e.scrollLeft)||(n+=e.scrollLeft),isNaN(e.scrollTop)||(o+=e.scrollTop),e=e.parentNode;return{left:n,top:o}},Mt=this.calculateOffset=function(t){for(var e=t,n=0,o=0;null!=e&&e!==document.body;)n+=e.offsetLeft,o+=e.offsetTop,e=e.offsetParent;return{left:n,top:o}};this.mapLocation=function(t,e,n){var o=xt(),i=Pt(g),r=Dt(P),s=n?{left:0,top:0}:Mt(P);return{left:(t-(i[0]+o[0])-s.left+r.left)/V,top:(e-(i[1]+o[1])-s.top+r.top)/V}},this.mapEventLocation=function(t,e){var n=pt(t);return this.mapLocation(n[0],n[1],e)},this.setEnabled=function(t){L=t},this.showElementAt=function(t,e,n){var o=f(t).parentNode,i=y.offset(o),r=y.offset(m),s=xt(),a=i.left-r.left+s[0]+e,l=i.top-r.top+s[1]+n;y.offset(t,{left:a,top:l})},this.getApparentCanvasLocation=function(){var t=xt(),e=Pt(g);return[e[0]+t[0],e[1]+t[1]]},this.setApparentCanvasLocation=function(t,e){var n=xt(),o=Pt(g,t-n[0],e-n[1],null,!0);return b&&b.pan(),Ft&&Ft.pan(),o},this.applyZoomToElement=function(t,e){at("transform","scale("+(e=e||V)+")",t)},this.setTransformOriginForElement=function(t,e){at("transformOrigin",e[0]+" "+e[1],t)},this.getTransformOrigin=function(){return H},this.floatElement=function(t,e){null!=t&&(t.style.position="absolute",t.style.left=e[0]+"px",t.style.top=e[1]+"px",P.appendChild(t))};function Nt(t){var n=u.getApparentCanvasLocation();for(var e in Ot)if(Ot.hasOwnProperty(e)){if(null!=t&&t!==e)continue;var o=Ot[e],i=function(t,e){o[t]&&(n[e]/V+o.pos[e]<0?o.el.style[t]=-n[e]/V+"px":o.el.style[t]=o.pos[e]+"px")};i("left",0),i("top",1)}}var Ot={},Ft={pan:Nt};this.fixElement=function(t,e,n){if(null!=t){e=e||{};var o=y.id(t);Ot[o]={el:t,left:e.left,top:e.top,pos:n},t.style.position="absolute",t.style.left=n[0]+"px",t.style.top=n[1]+"px",g.appendChild(t),Nt(o)}},this.findIntersectingNodes=function(t,e,n,o,i){var r,s=this.getApparentCanvasLocation(),a=y.offset(P),l=P.scrollLeft,u=P.scrollTop,d=[],c={x:t[0],y:t[1],w:e[0],h:e[1]},h=n?Biltong.encloses:Biltong.intersects,p=[a.left+s[0]-l,a.top+s[1]-u];if(i=i||this.viewportManager.getElements(),Array.isArray(i)){var f={};for(r=0;r<i.length;r++)f[jsPlumbUtil.isString(i[r])?i[r]:jsPlumb.getId(i[r])]=i[r];i=f}for(r in i)if(!K[r]){var g=this.viewportManager.getPosition(r);if(g){var m={x:p[0]+g.x*V,y:p[1]+g.y*V,w:g.w*V,h:g.h*V};h(c,m)&&(null==o||o(r,J[r],m))&&d.push({id:r,el:J[r],r:m})}}return d},this.findNearbyNodes=function(t,e,n,o){var i=[];if(!n||this.isInViewport(t[0],t[1])){i=this.findIntersectingNodes([t[0]-e,t[1]-e],[2*e,2*e],!1,o);var s=this.mapLocation(t[0],t[1]);i.sort(function(t,e){var n=[t.x+t.w/2,t.y+t.h/2],o=[e.x+e.w/2,e.y+e.h/2],i=Biltong.lineLength(s,n),r=Biltong.lineLength(s,o);return i<r?-1:r<i?1:0})}return i},this.isInViewport=function(t,e){var n=y.offset(P),o=y.width(P),i=y.height(P);return n.left<=t&&t<=n.left+o&&n.top<=e&&e<=n.top+i},this.getElementPositions=function(){return this.viewportManager.getElements()},this.setFilter=function(t){z=t||function(t){return!1}},this.setWheelFilter=function(t){i=t||function(t){return!0}},this.setBackground=function(t){var e=t.type||"simple",n={simple:Gt,tiled:"absolute"===t.tiling?Ut:zt};b=new n[e]({canvas:g,viewport:P,getWidth:U,getHeight:B,url:t.url,zoomWidget:u,onBackgroundReady:t.onBackgroundReady,options:t,img:t.img,resolver:t.resolver})},y.background&&this.setBackground(y.background),this.getBackground=function(){return b},this.destroy=function(){F(document,M,St),F(document,D,it);for(var t=0;t<tt.length;t++)tt[t].parentNode.removeChild(tt[t]);kt.destroy(),tt.length=0,St=wt=_t=jt=y=d=m=g=P=K=J=null}};function e(c){var h=this,e=c.canvas,u=c.viewport;if(null==c.options.maxZoom)throw new TypeError("Parameter `maxZoom` not set; cannot initialize TiledBackground");if(!c.options.tileSize)throw new TypeError("Parameter `tileSize not set; cannot initialize TiledBackground. It should be an array of [x,y] values.");if(!c.options.width||!c.options.height)throw new TypeError("Parameters `width` and `height` must be set");for(var d,t=function(i){var e=document.createElement("div");e.style.position="relative",e.style.height="100%",e.style.width="100%",e.style.display="none",c.canvas.appendChild(e),this.zoom=i;function r(t,e,n){return null==c.resolver?function(t,e,n){return c.url.replace("{z}",t).replace("{x}",e).replace("{y}",n)}(t,e,n):c.resolver(t,e,n)}var t=h.getTileSpecs(i),s=[];this.apparentZoom=Math.min(t[2],t[3]),this.setActive=function(t){e.style.display=t?"block":"none"},this.xTiles=t[0],this.yTiles=t[1];for(var n=0;n<this.xTiles;n++){s[n]=s[n]||[];for(var o=0;o<this.yTiles;o++){var a=document.createElement("img");a._tiledBg=!0,a.className="jtk-surface-tile",a.ondragstart=function(){return!1},e.appendChild(a),a.style.position="absolute",a.style.opacity=0,s[n][o]=[a,new Image,!1]}}var l=Math.pow(2,c.options.maxZoom-i)*c.options.tileSize[0],u=Math.pow(2,c.options.maxZoom-i)*c.options.tileSize[1];this.scaledImageSize=l,this.scaledImageSizeH=u;function d(t,e,n,o){t.style.left=n*l+"px",t.style.top=o*u+"px",t.style.width=l+"px",t.style.height=u+"px",e.onload=function(){t.setAttribute("src",e.src),t.style.opacity=1},e.src=r(i,n,o)}this.ensureLoaded=function(t,e,n,o){for(var i=t;i<=n;i++)for(var r=e;r<=o;r++)null!=s[i]&&null!=s[i][r]&&(s[i][r][2]||(d(s[i][r][0],s[i][r][1],i,r),s[i][r][2]=!0))}}.bind(this),n=[],p=null,o=0;o<=c.options.maxZoom;o++)n.push(new t(o));function i(){var t=c.zoomWidget.getApparentCanvasLocation(),e=c.getWidth(u),n=c.getHeight(u),o=p.scaledImageSize*d,i=p.scaledImageSizeH*d,r=t[0]<0?Math.floor(-t[0]/o):t[0]<e?0:null,s=t[1]<0?Math.floor(-t[1]/i):t[1]<n?0:null,a=Math.min(p.xTiles,Math.floor((e-t[0])/o)),l=Math.min(p.yTiles,Math.floor((n-t[1])/i));null!=r&&null!=s&&p.ensureLoaded(r,s,a,l)}function r(t,e){e=e||150;var n=null;return function(){window.clearTimeout(n),n=window.setTimeout(t,e)}}function s(){!function(t){var e=n[t];null!=p&&p!==e&&p.setActive(!1),e.setActive(!0),p=e}(function(){if(d<=n[0].apparentZoom)return 0;if(d>=n[n.length-1].apparentZoom)return n.length-1;for(var t=n.length-1;0<t;t--)if(n[t].apparentZoom>=d&&d>=n[t-1].apparentZoom)return t}()),i()}e.style.width=c.options.width+"px",e.style.height=c.options.height+"px",this.getCurrentLayer=function(){return p},this.getWidth=function(){return c.options.width},this.getHeight=function(){return c.options.height};var a=c.options.panDebounceTimeout||50,l=c.options.zoomDebounceTimeout||120,f=r(s,l),g=r(i,a);this.setZoom=function(t,e){d=t,e?s():f()},this.pan=g,this.owns=function(t){return t===e||!0===t._tiledBg},this.setZoom(c.zoomWidget.getZoom(),!0),null!=c.onBackgroundReady&&setTimeout(c.onBackgroundReady,0)}var Gt=function(t){var e=t.canvas,n=t.onBackgroundReady||function(){},o=new Image;o.onload=function(){e.style.backgroundImage="url('"+o.src+"')",e.style.backgroundRepeat="no-repeat",e.style.width=o.width+"px",e.style.height=o.height+"px",n(this)},o.src=t.img?t.img.src:t.url,this.owns=function(t){return t===e},this.getWidth=function(){return o.width||0},this.getHeight=function(){return o.height||0},this.setZoom=this.pan=function(t){}},zt=function(t){var r=t.options.width,s=t.options.height,a=t.options.tileSize;this.getTileSpecs=function(t){var e=s<r?1:r/s,n=r<s?1:s/r,o=Math.pow(2,t+1)*a[0]*e,i=Math.pow(2,t+1)*a[1]*n;return[Math.ceil(o/a[0]),Math.ceil(i/a[1]),o/r,i/s]},e.apply(this,arguments)},Ut=function(t){var i=t.options.maxZoom,r=t.options.width,s=t.options.height,a=t.options.tileSize;this.getTileSpecs=function(t){var e=Math.pow(2,i-t),n=Math.ceil(r/e/a[0]),o=Math.ceil(s/e/a[1]);return[n,o,n*a[0]/r,o*a[1]/s]},e.apply(this,arguments)}}.call("undefined"!=typeof window?window:this),function(){"use strict";var O=this.jsPlumbToolkit,F=O.Renderers,L=this.jsPlumb,R=this.jsPlumbUtil,G=L.getSelector,z=O.Classes,U=O.Constants,B=O.Events;F.Surface=function(i){var u=this;F.Surface.SELECT=U.select,F.Surface.PAN=U.pan,F.Surface.DISABLED=U.disabled;var v=F.AbstractRenderer.apply(this,arguments);F.DOMElementAdapter.apply(this,arguments),this.getObjectInfo=v.getObjectInfo,i=i||{};var a,d=L.getElement(i.container),r=F.createElement({position:U.relative,width:U.nominalSize,height:U.nominalSize,left:0,top:0,clazz:z.SURFACE_CANVAS},d),s=!0!==i.directRender&&!(!1===i.elementsDraggable),l=!0!==i.directRender&&!0===i.elementsDroppable,c=i.dragOptions||{},n=null!=c.grid,h=i.dropOptions||{},o=i.stateHandle,p=!1!==i.storePositionsInModel,f=i.modelLeftAttribute,g=i.modelTopAttribute,t=!0===i.directRender,m=!0===i.wheelReverse,y=new ZoomWidget({viewportManager:v.viewportManager,viewport:d,canvas:r,domElement:v.jsPlumb.getElement,addClass:v.jsPlumb.addClass,removeClass:v.jsPlumb.removeClass,offset:this.getOffset.bind(this),consumeRightClick:i.consumeRightClick,bind:function(){v.jsPlumb.on.apply(v.jsPlumb,arguments)},unbind:function(){v.jsPlumb.off.apply(v.jsPlumb,arguments)},width:function(t){return v.jsPlumb.getWidth(v.jsPlumb.getElement(t))},height:function(t){return v.jsPlumb.getHeight(v.jsPlumb.getElement(t))},id:v.jsPlumb.getId,animate:function(){v.jsPlumb.animate.apply(v.jsPlumb,arguments)},dragEvents:{stop:L.dragEvents[U.stop],start:L.dragEvents[U.start],drag:L.dragEvents[U.drag]},background:i.background,padding:i.padding,panDistance:i.panDistance,directRender:t,enablePan:!t&&!1!==i.enablePan,enableWheelZoom:!t&&!1!==i.enableWheelZoom,wheelSensitivity:i.wheelSensitivity,wheelReverse:m,wheelZoomMetaKey:i.wheelZoomMetaKey,wheelPan:i.wheelPan,enablePanButtons:!t&&!1!==i.enablePanButtons,enableAnimation:i.enableAnimation,clamp:i.clamp,clampToBackground:i.clampToBackground,clampToBackgroundExtents:i.clampToBackgroundExtents,zoom:i.zoom,zoomRange:i.zoomRange,extend:v.jsPlumb.extend,events:{pan:function(t,e,n,o,i){u.fire(B.pan,{x:t,y:e,zoom:n,oldZoom:o,event:i})},zoom:function(t,e,n,o,i){v.jsPlumb.setZoom(n),u.fire(B.zoom,{x:t,y:e,zoom:n,oldZoom:o,event:i})},mousedown:function(){L.addClass(d,z.SURFACE_PANNING),L.addClass(document.body,z.SELECT_DEFEAT)},mouseup:function(){L.removeClass(d,z.SURFACE_PANNING),L.removeClass(document.body,z.SELECT_DEFEAT)}}}),b=[],P=i.lassoSelectionFilter,E=!0===i.lassoEdges,e=!1!==i.autoExitSelectMode,x=new O.Widgets.Lasso({on:function(){v.jsPlumb.on.apply(v.jsPlumb,arguments)},off:function(){v.jsPlumb.off.apply(v.jsPlumb,arguments)},invert:i.lassoInvert,pageLocation:y.pageLocation,canvas:d,onStart:function(){u.setHoverSuspended(!0),b.length=0},onSelect:function(t,e,n,o){v.jsPlumb.clearDragSelection&&v.jsPlumb.clearDragSelection(),v.toolkit.clearSelection(),o&&0<b.length&&v.toolkit.removeFromSelection(b);var i,r,s=[],a=y.findIntersectingNodes(t,e,!n[0]),l=a.length,u={};for(i=0;i<l;i++){var d=(r=a[i]).el.jtk.node||r.el.jtk.group;null!=P&&!1===P(d)||(s.push(d),u[d.id]=!0,v.jsPlumb.addToDragSelection&&v.jsPlumb.addToDragSelection(a[i].el))}l=(b=s).length;if(E){var c={};for(i=0;i<l;i++){var h,p=[];Array.prototype.push.apply(p,s[i].getAllEdges());for(var f=0;f<p.length;f++)if(!c[h=p[f].getId()]){var g=p[f].source.getNode?p[f].source.getNode().id:p[f].source.id,m=p[f].target.getNode?p[f].target.getNode().id:p[f].target.id;u[g]&&u[m]&&s.push(p[f]),c[h]=!0}}}v.toolkit.addToSelection(s,o)},onEnd:function(){u.setHoverSuspended(!1),e&&u.setMode(U.pan),u.fire("lasso:end")},filter:i.lassoFilter}),C={pan:function(){x.setEnabled(!1),y.setEnabled(!0)},select:function(){v.jsPlumb.clearDragSelection&&v.jsPlumb.clearDragSelection(),x.setEnabled(!0),y.setEnabled(!1)},disabled:function(){v.jsPlumb.clearDragSelection&&v.jsPlumb.clearDragSelection(),x.setEnabled(!0),y.setEnabled(!1)}};i.mode||U.pan;u.bind(B.relayout,function(t){y.relayout(u.getLayout().getExtents(),!0)}),u.bind(B.nodeRemoved,function(t){y.remove(t.el)}),u.bind(B.groupRemoved,function(t){if(y.remove(t.el),!1===t.nodesRemoved)for(var e=0;e<t.nodes.length;e++){var n=v.nodeMap()[t.nodes[e].id];n&&y.restore(n)}}),v.bindToToolkit(B.graphClearStart,function(){y.reset()}),v.bindToToolkit(B.dataLoadStart,function(){y.setSuspendRendering(!0)}),v.bindToToolkit(B.dataAppendStart,function(){y.setSuspendRendering(!0)}),v.bindToToolkit(B.dataLoadEnd,function(){y.setSuspendRendering(!1),a&&a.setVisible(!0),i.zoomToFit&&u.zoomToFit()}),v.bindToToolkit(B.dataAppendEnd,function(){y.setSuspendRendering(!1)}),v.bindToToolkit(B.groupMemberAdded,function(t){var e=v.nodeMap()[t.node.id];e&&y.suspend(e)}),v.bindToToolkit(B.groupMemberRemoved,function(t){var e=v.nodeMap()[t.node.id];e&&y.restore(e)}),v.jsPlumb.setContainer(r),L.addClass(d,z.SURFACE),t&&L.addClass(d,z.SURFACE_DIRECT),!1===i.enablePan&&L.addClass(d,z.SURFACE_NO_PAN);function j(t,n){function e(t){var e=t.srcElement||t.target;e!=d&&e!=r||u.fire(n,t,u)}v.jsPlumb.on(r,t,e),v.jsPlumb.on(d,t,e)}j(B.tap,B.canvasClick),j(B.dblclick,B.canvasDblClick);v.makeDraggable=function(t,e){if(s){var n=L.getElement(t),o=v.jsPlumb.getId(n),l=v.jsPlumb.extend({},c),i=L.dragEvents[U.stop],r=L.dragEvents[U.start];null!=e&&v.jsPlumb.extend(l,e),l[r]=R.wrap(l[r],function(){if(y.isPinchZooming())return!1;y.getBoundsInfo();var t=function(t){var e=L.getDragObject(t);return{node:L.getElement(e).jtk.node,el:e}}(arguments);t.elementId=o,t.pos=L.getAbsolutePosition(n),t.domEl=n,L.addClass(d,z.SURFACE_ELEMENT_DRAGGING),L.removeClass(d.querySelectorAll("."+z.MOST_RECENTLY_DRAGGED),z.MOST_RECENTLY_DRAGGED),u.fire(B.nodeMoveStart,t)}),l.drag=R.wrap(l.drag,function(t){var e=t.drag.getDragElement(),n={el:e,node:e.jtk.node||e.jtk.group,pos:t.pos,e:t.e};u.fire(B.nodeMove,n)}),l[i]=R.wrap(l[i],function(a){for(var t=function(t){L.removeClass(d,z.SURFACE_ELEMENT_DRAGGING),L.removeClass(d.querySelectorAll("."+z.MOST_RECENTLY_DRAGGED),z.MOST_RECENTLY_DRAGGED),L.addClass(t[0],z.MOST_RECENTLY_DRAGGED);try{var e={el:t[0],node:t[0].jtk.node||t[0].jtk.group,pos:[t[1].left,t[1].top],e:a.e,eventPosition:a.pos};if(!t[0]._droppedOnGroup){var n=e.node.group?e.node.group.layout:u.getLayout();if(e.originalPosition=n.getPosition(e.node.id),l.magnetize&&!e.node.group){var o=v.jsPlumb.getId(t[0]);u._viewportManager.updateElement(o,e.pos[0],e.pos[1]),e.pos=n.setMagnetizedPosition(e.node.id,e.pos[0],e.pos[1],!0)}else n.setPosition(e.node.id,e.pos[0],e.pos[1],!0);y.positionChanged(t[0]),!1!=p&&(u.storePositionInModel({id:e.node.id,leftAttribute:f,topAttribute:g}),v.toolkit.fire(B.nodeUpdated,{node:e.node},null))}if(a.e._drawResult)for(var i=0;i<a.e._drawResult.c.length;i++){var r=a.e._drawResult.c[i].edge,s=a.e._drawResult.c[i].connector;s&&s.geometry&&s.exportGeometry&&v.toolkit.setEdgeGeometry(r,s.exportGeometry())}u.fire(B.nodeMoveEnd,e)}catch(t){jsPlumbUtil.log("could not process dragged node",t)}delete t[0]._droppedOnGroup},e=0;e<a.selection.length;e++)t(a.selection[e])}),l.canDrag=function(){return!x.isActive()},l.force=!0,v.jsPlumb.draggable(n,l,!1,v.jsPlumb)}},v.makeDroppable=function(t,e){if(l){var n=L.getElement(t),o=v.jsPlumb.extend({},h);null!=e&&v.jsPlumb.extend(o,e),o[U.drop]=R.wrap(o[U.drop],function(t){if(t.drag.el.jtk&&t.drag.el.jtk.node){var e={source:t.drag.el.jtk.node,sourceElement:t.drag.el,target:t.drop.el.jtk.node,targetElement:t.drop.el,e:t.e};u.fire(B.nodeDropped,e)}}),v.jsPlumb.droppable(n,o)}},this.snapToGrid=function(t,e,n){var o;1===arguments.length||3===arguments.length?(s=this.getObjectInfo(t)).el&&(o=this.getJsPlumb().snapToGrid(s.el,e,n)):o=this.getJsPlumb().snapToGrid(t,e);for(var i=this.getLayout(),r=0;r<o.length;r++){var s,a=(s=this.getObjectInfo(o[r][0])).id,l=o[r][1];i.setPosition(a,l[0],l[1]),y.positionChanged(s.el,l),p&&this.storePositionInModel(a)}return o},v.doImport=function(t){i.jsPlumbInstance.setContainer(r);var e=i.jsPlumbInstance.getManagedElements();for(var n in e){var o=e[n].el;_(o,n)}};var _=this.importNode=function(t,e){var n=i.jsPlumbInstance.getId(t);L.addClass(t,z.NODE),s&&!L.isAlreadyDraggable(t)&&v.makeDraggable(t),v.nodeMap()[e]=t,v.reverseNodeMap()[n]=t.jtk.node;var o={node:t.jtk.node,el:t,id:t.jtk.node.id};null!=t.jtk.node.group&&!v.isIgnoreGroups()||u.getLayout().nodeAdded(o),u.fire(B.nodeAdded,o)}.bind(this);this.zoomToSelection=function(t){var e=(t=t||{}).selection||(t.filter?v.toolkit.filter(t.filter):v.toolkit.getSelection()),n=[];e.eachNode(function(t,e){n.push(v.getElement(e.id))}),e.eachGroup(function(t,e){n.push(v.getElement(e.id))}),0<n.length&&y.zoomToElements({elements:n,fill:t.fill,doNotZoomIfVisible:t.doNotZoomIfVisible,doNotAnimate:t.doNotAnimate})},this.animateToSelection=function(t){this.zoomToSelection(jsPlumb.extend(t||{},{doNotAnimate:!1}))},this.zoomToBackground=y.zoomToBackground,this.zoomToVisible=function(t){(t=L.extend({},t||{})).selection=v.toolkit.filter(function(t){return"Node"===t.objectType&&this.isVisible(t)}.bind(this)),this.zoomToSelection(t)},this.zoomToVisibleIfNecessary=function(t){var e=L.extend(t||{});e.doNotZoomIfVisible=!0,this.zoomToVisible(e)},this.zoomToFit=y.zoomToFit,this.zoomToFitIfNecessary=y.zoomToFitIfNecessary,this.centerOn=function(t,e){var n=this.getObjectInfo(t);n&&n.el&&y.centerOn(n.el,e)},this.centerOnHorizontally=function(t){this.centerOn(t,{vertical:!1})},this.centerOnVertically=function(t){this.centerOn(t,{horizontal:!1})},this.centerOnAndZoom=function(t,e){var n=this.getObjectInfo(t);n&&n.el&&y.centerOnAndZoom(n.el,e)},this.centerContent=y.centerContent.bind(y),this.centerContentHorizontally=y.centerContentHorizontally.bind(y),this.centerContentVertically=y.centerContentVertically.bind(y),this.getViewportCenter=y.getViewportCenter.bind(y),this.setViewportCenter=y.setViewportCenter.bind(y),this.setClamping=y.setClamping.bind(y),this.isClamping=y.isClamping.bind(y),this.setSize=function(t,e,n){var o=u.getRenderedNode(t)||u.getRenderedGroup(t);if(null!=o){var i=o.jtk.group||o.jtk.node;if(i)(i.group?i.group.layout:u.getLayout()).setSize(i.getFullId(),[e,n]);y.setSize(v.jsPlumb.getId(o),e,n)}},this.setStateHandle=function(t){o=t},this.getStateHandle=function(){return o},this.setLassoSelectionFilter=function(t){P=t},this.getApparentCanvasLocation=y.getApparentCanvasLocation.bind(y),this.setApparentCanvasLocation=y.setApparentCanvasLocation.bind(y),this.getBoundsInfo=y.getBoundsInfo.bind(y),this.setZoom=y.setZoom.bind(y),this.setZoomRange=y.setZoomRange.bind(y),this.getZoomRange=y.getZoomRange.bind(y),this.getZoom=y.getZoom.bind(y),this.nudgeZoom=y.nudgeZoom.bind(y),this.nudgeWheelZoom=y.nudgeWheelZoom.bind(y),this.pageLocation=y.pageLocation.bind(y),this.getPan=y.getPan.bind(y),this.pan=y.pan.bind(y),this.setPan=y.setPan.bind(y),this.setPanAndZoom=function(t,e,n,o){this.setPan(t,e,!o),this.setZoom(n,!o)},this.setPanFilter=function(n){y.setFilter(n?function(t,e){return"function"==typeof n?n.apply(n,[e]):R.matchesSelector(t,n)}:null)},this.setWheelFilter=function(n){y.setWheelFilter(function(t){if(n){var e=t.srcElement||t.target;return!R.matchesSelector(e,n)}return!0})},this.setWheelFilter(i.wheelFilter),this.setPanFilter(i.panFilter),this.mapLocation=y.mapLocation.bind(y),this.mapEventLocation=y.mapEventLocation.bind(y),this.findNearbyNodes=y.findNearbyNodes.bind(y),this.findIntersectingNodes=y.findIntersectingNodes.bind(y),this.findIntersectingGroups=function(t,e,n,o){return y.findIntersectingNodes(t,e,n,o,v.reverseGroupMap())},this.isInViewport=y.isInViewport.bind(y),this.getViewportCenter=y.getViewportCenter.bind(y),this.positionElementAt=y.positionElementAt.bind(y),this.positionElementAtEventLocation=y.positionElementAtEventLocation.bind(y),this.positionElementAtPageLocation=y.positionElementAtPageLocation.bind(y),this.setFilter=y.setFilter.bind(y),this.floatElement=y.floatElement.bind(y),this.fixElement=y.fixElement.bind(y);function w(t,e,n,o,i){t&&(y.positionChanged(t.el,[e,n],null,o),i||u.fire(B.nodeMoveEnd,{el:t.el,id:t.id,pos:[e,n],node:t.obj||(t.el.jtk?t.el.jtk.node||t.el.jtk.group:{}),bounds:y.getBoundsInfo(),size:o}))}var S=this.setPosition,I=this.animateToPosition;this.setPosition=function(t){3===arguments.length&&(t={el:arguments[0],x:arguments[1],y:arguments[2]});var e=S({node:t.el,x:t.x,y:t.y,doNotUpdateElement:!0===t.doNotUpdateElement,doNotUpdateLayout:!0===t.doNotUpdateLayout,doRevalidate:!1!==t.doRevalidate,size:t.size});w(e,t.x,t.y,t.size,!0===t.doNotFireEvent),n&&this.snapToGrid(e.el)},this.animateToPosition=function(t,e,n,o){var i=I.apply(this,arguments);w(i,e,n)},this.tracePath=function(n){var t,e,o=n.path||(t=v.getObjectInfo(n.source),e=v.getObjectInfo(n.target),v.toolkit.getPath({source:t,target:e}));if(o.exists()){var i=function(t,e){this.fire(t,{edge:e.edge,connection:e,options:n.options})}.bind(this),r=[],s=null,a=null,l=null,u=o.path.path.length;o.eachEdge(function(t,e){v.getConnectionForEdge(e).addClass("jtk-animate-edge-traversable")});for(var d=1;d<u;d++){var c=o.path.path[d].vertex.id,h=o.path.previous[c],p=!0,f=o.path.path[d].edge;null!=h&&(p=h===f.source),a=(s=v.getConnectionForEdge(f)).animateOverlay(n.overlay,L.extend(n.options||{},{previous:a,isFinal:d===u-1,forwards:p,paused:null==a&&!0===n.paused,events:{startNodeTraversal:function(t){l=t.harness}}})),r.push({handler:a,connection:s})}var g=function(){o.eachEdge(function(t,e){var n=v.getConnectionForEdge(e);n.removeClass("jtk-animate-edge-traversable"),n.removeClass("jtk-animate-edge-traversed")}),i(jsPlumbToolkit.Events.endOverlayAnimation,r[r.length-1].connection),m.setState("stopped"),m&&m.setState("finished")};0<r.length&&(r[0].handler.eventGenerator.bind(jsPlumbToolkit.Events.startOverlayAnimation,function(){i(jsPlumbToolkit.Events.startOverlayAnimation,r[0].connection)}),r[r.length-1].handler.eventGenerator.bind(jsPlumbToolkit.Events.endOverlayAnimation,g));var m={pathExists:!0,setState:function(t){this.state=t,this.fire("state",t)},pause:function(){"paused"!==this.state&&(l?(l.pause(),this.setState("paused")):this.setState("stopped"))},play:function(){"playing"!==this.state&&(l?l.play():r[0].handler.play(),this.setState("playing"))},cancel:function(){"stopped"!==this.state&&(l&&l.cancel(),g(),this.setState("stopped"))},state:"true"===n.paused?"paused":"playing"};return jsPlumbUtil.EventGenerator.apply(m),n.listener&&(m.bind("state",n.listener),m.fire("state",m.state)),m}return v.toolkit.isDebugEnabled()&&jsPlumbUtil.log("Cannot trace non existent path"),{pathExists:!1}},this.getNodePositions=function(){var t={},e=y.getElementPositions();for(var n in e){var o=v.getNodeForElementId(n)||v.getGroupForElementId(n);o&&(t[o.id]=[e[n].x,e[n].y])}return t},this.append=function(t,e,n,o){r.appendChild(t),n=n&&[n.left,n.top],y.add(t,e,n,o)},this.nodeAppendedToGroup=function(t,e,n){y.suspend(t)},this.nodeRemovedFromGroup=function(t){y.restore(t)};var k=this.setLayout;this.setLayout=function(t,e){k.apply(this,[t,e]),a&&a.setHostLayout(this.getLayout())};for(var A=function(o){v.jsPlumb.on(r,o,".jtk-node, .jtk-node *",function(t){var e=t.srcElement||t.target;if(null==e&&(e=(t=L.getOriginalEvent(t)).srcElement||t.target),null!=e&&e.jtk){var n=L.extend({e:t,el:e},e.jtk);u.fire(o,n,t)}})},T=0;T<F.mouseEvents.length;T++)A(F.mouseEvents[T]);this.addClass=function(t,e){var n=v.getObjectInfo(t);n.el&&v.jsPlumb.addClass(n.el,e)},this.removeClass=function(t,e){var n=v.getObjectInfo(t);n.el&&v.jsPlumb.removeClass(n.el,e)},this.hasClass=function(t,e){var n=v.getObjectInfo(t);return!!n.el&&v.jsPlumb.hasClass(n.el,e)},v.bindToToolkit(U.select,function(t){if(t.obj.objectType==U.nodeType||t.obj.objectType==U.groupType){var e=v.getElement(t.obj.id);e&&(L.addClass(e,z.SURFACE_SELECTED_ELEMENT),v.jsPlumb.addToDragSelection&&v.jsPlumb.addToDragSelection(e))}else if(t.obj.objectType==U.edgeType){var n=v.getConnectionForEdge(t.obj);n&&n.addClass(z.SURFACE_SELECTED_CONNECTION)}}),v.bindToToolkit(B.selectionCleared,function(){v.jsPlumb.clearDragSelection&&v.jsPlumb.clearDragSelection(),L.removeClass(G("."+z.SURFACE_SELECTED_CONNECTION),z.SURFACE_SELECTED_CONNECTION),L.removeClass(G("."+z.SURFACE_SELECTED_ELEMENT),z.SURFACE_SELECTED_ELEMENT)}),v.bindToToolkit(B.deselect,function(t){if(t.obj.objectType==U.nodeType||t.obj.objectType==U.groupType){var e=v.getElement(t.obj.id);e&&(L.removeClass(e,z.SURFACE_SELECTED_ELEMENT),v.jsPlumb.removeFromDragSelection&&v.jsPlumb.removeFromDragSelection(e))}else if(t.obj.objectType==U.edgeType){var n=v.getConnectionForEdge(t.obj);n&&n.removeClass(z.SURFACE_SELECTED_CONNECTION)}});var D=this.setOffset;this.setOffset=function(t,e){D.apply(this,arguments),y.positionChanged(t,[e.left,e.top])},this.setMode=function(t,e,n){if(!C[t])throw new TypeError("Surface: unknown mode '"+t+"'");C[t](),t!==U.select||e||v.toolkit.clearSelection(),n&&t===U.select&&n.lassoSelectionFilter&&(P=n.lassoSelectionFilter),u.fire(B.modeChanged,t)};function M(t,e){var n=L.extend({},t);n.source=v.getObjectInfo(t.source).obj,n.target=v.getObjectInfo(t.target).obj,n.element=v.getObjectInfo(t.element).obj;var o=v.toolkit[e](n),i=v.getConnectionsForEdges(o);return v.jsPlumb.select({connections:i})}this.selectEdges=function(t){return M(t,"getEdges")},this.selectAllEdges=function(t){return M(t,"getAllEdges")},this.repaint=function(t){var e=v.getObjectInfo(t);if(e.el){v.jsPlumb.recalculateOffsets(e.el),v.jsPlumb.revalidate(v.jsPlumb.getId(e.el));var n=v.jsPlumb.getSize(e.el),o=e.obj.getFullId();u.setSize(o,n[0],n[1]),u.fire(B.objectRepainted,e)}},this.repaintEverything=v.jsPlumb.repaintEverything,this.setElementsDraggable=function(t){s=!1!==t},this.createMiniview=function(t){if(null!=a){var e=v.jsPlumb.getId(v.jsPlumb.getElement(t.container));if(a.getContainerId()===e)return!1}var n=L.extend({surface:u,toolkit:v.toolkit,surfaceContainerElement:d,bounds:y.getBoundsInfo(),visible:!1!==t.initiallyVisible||0<v.toolkit.getNodeCount(),layout:{type:U.mistletoeLayoutType,parameters:{layout:u.getLayout()}},typeFunction:t.typeFunction,bindToToolkit:v.bindToToolkit},t);null==n.wheelReverse&&(n.wheelReverse=m),a=new O.Renderers.Miniview(n);var o=v.nodeMap();for(var i in o){var r=o[i];a.registerNode({el:r,node:r.jtk.node,pos:L.getAbsolutePosition(r)})}var s=v.groupMap();for(var i in s){r=s[i];a.registerNode({el:r,node:r.jtk.group,pos:L.getAbsolutePosition(r)})}return a},i.miniview&&this.createMiniview(i.miniview),this.getMiniview=function(){return a};function N(t,e,n){var o=v.getObjectInfo(e),i=null;if(o.el&&("Port"===!o.obj.objectType||!function(){var t=u.getRenderedEndpoint(o.obj);if(t)return i=t.setEnabled(n),1}())){var r="set"+t+"Enabled";i=v.jsPlumb[r](o.el,n)}return i}this.setTargetEnabled=N.bind(this,"Target"),this.setSourceEnabled=N.bind(this,"Source"),this.setEnabled=function(t,e){this.setTargetEnabled(t,e),this.setSourceEnabled(t,e)},this._destroy=function(){y.destroy(),r.parentNode.removeChild(r),L.removeClass(d,z.SURFACE),L.removeClass(d,z.SURFACE_DIRECT),L.removeClass(d,z.SURFACE_NO_PAN),null!=a&&a.destroy(),a=_=u=v=i=d=r=null,this.fire("destroy")},this._getGroupDragArea=function(t){var e=u.getJsPlumb().getGroup(t.id);return e?e.getDragArea():null},this.State={save:function(e,t){if(t=2===arguments.length?arguments[1]:1===arguments.length&&"function"==typeof arguments[0]?arguments[0]:function(t,e){return e(t)},e=2===arguments.length?arguments[0]:1===arguments.length&&"string"==typeof arguments[0]?arguments[0]:o)try{t(u.State.serialize(),function(t){R.Storage.set(U.jtkStatePrefix+e,t)})}catch(t){R.log(z.msgCannotSaveState,t)}},serialize:function(){var t=y.getPan();t.push(y.getZoom()),t.push.apply(t,y.getTransformOrigin());var e=t.join(","),n=u.getLayout().getPositions(),o=[];for(var i in n)o.push(i+" "+n[i][0]+" "+n[i][1]);return e+=","+o.join("|")},restore:function(t,e){if(e=2===arguments.length?arguments[1]:1===arguments.length&&"function"==typeof arguments[0]?arguments[0]:function(t,e){return e(t)},t=2===arguments.length?arguments[0]:1===arguments.length&&"string"==typeof arguments[0]?arguments[0]:o)try{var n=R.Storage.get(U.jtkStatePrefix+t);n&&e(n,u.State.deserialize)}catch(t){R.log(z.msgCannotRestoreState,t)}},deserialize:function(t){var e=t.split(",");y.setPan(parseFloat(e[0]),parseFloat(e[1])),y.setZoom(parseFloat(e[2])),y.setTransformOrigin(parseFloat(e[3]),parseFloat(e[4]));for(var n=e[5].split("|"),o=u.getLayout(),i=0;i<n.length;i++){var r=n[i].split(" ");try{u.setPosition(r[0],parseFloat(r[1]),parseFloat(r[2]))}catch(t){}}o.draw()},clear:function(t){(t=t||o)&&R.Storage.clear(U.jtkStatePrefix+t)},clearAll:function(){R.Storage.clearAll()}},u.saveState=u.State.save,u.store=R.Storage.set,u.retrieve=R.Storage.get,u.storeJSON=R.Storage.setJSON,u.retrieveJSON=R.Storage.getJSON,u.restoreState=function(t){u.State.restore(t),u.getJsPlumb().repaintEverything(),u.fire(B.stateRestored)},u.clearState=function(t){u.state.clear(t)},u.initialize(),i.zoomToFitIfNecessary?u.zoomToFitIfNecessary():i.zoomToFit&&u.zoomToFit()},O.DefaultRendererType=U.surfaceType,"undefined"!=typeof exports&&(exports.Surface=F.Surface)}.call("undefined"!=typeof window?window:this),function(){"use strict";var t=this.jsPlumbToolkit,L=t.Renderers,R=this.jsPlumbUtil,G=this.jsPlumb,z=t.Classes,U=t.Constants,B=t.Events,V=t.Attributes,H=t.Methods;L.Miniview=function(n){this.bindToolkitEvents=!1;var l=L.AbstractRenderer.apply(this,arguments),u=this;L.DOMElementAdapter.apply(this,arguments);function o(t){b=!0,P=y.pageLocation(t),E=G.getAbsolutePosition(s),G.on(document,B.mouseup,j),G.on(document,B.mousemove,C),R.consume(t)}var r,d=n.surface,i=G.getElement(n.container),c=L.createElement({position:U.relative,width:U.nominalSize,height:U.nominalSize,left:0,top:0,clazz:z.MINIVIEW_CANVAS},i),s=L.createElement({position:U.absolute,width:U.nominalSize,height:U.nominalSize,left:0,top:0,clazz:z.MINIVIEW_PANNER},i),h=n.bounds,a=!0===n.suspended,p=!1!==n.collapsible,f=n.typeFunction,g=null,e=!1,m=n.wheelSensitivity||10,v=!0===n.wheelReverse,y=new ZoomWidget({viewport:i,canvas:c,domElement:G.getElement,offset:this.getOffset.bind(this),bind:function(){l.jsPlumb.on.apply(l.jsPlumb,arguments)},unbind:function(){l.jsPlumb.off.apply(l.jsPlumb,arguments)},enableWheelZoom:!1,enablePanButtons:!1,enablePan:!1,enableAnimation:!1,width:function(t){return l.jsPlumb.getWidth(l.jsPlumb.getElement(t))},height:function(t){return l.jsPlumb.getHeight(l.jsPlumb.getElement(t))},id:l.jsPlumb.getId,animate:l.jsPlumb.animate,dragEvents:{stop:G.dragEvents[U.stop],start:G.dragEvents[U.start],drag:G.dragEvents[U.drag]},extend:G.extend,events:{pan:function(){F()},mousedown:function(){G.addClass(s,z.MINIVIEW_PANNING)},mouseup:function(){G.removeClass(s,z.MINIVIEW_PANNING)}},zoomRange:[-1/0,1/0]}),b=!1,P=null,E=null,x=n.elementFilter||function(){return!0},C=function(t){if(!1,b){var e=y.pageLocation(t),n=e[0]-P[0],o=e[1]-P[1],i=[E[0]+n,E[1]+o];F(i);G.setAbsolutePosition(s,i)}},j=function(t){b=!1,P=null,G.off(document,B.mouseup,j),G.off(document,B.mousemove,C)};function _(t){G[(e=!e)?H.addClass:H.removeClass](i,z.MINIVIEW_COLLAPSED),w(!0)}G.on(window,B.resize,jsPlumbUtil.debounce(function(){O()},100)),!1!==n.enableWheelZoom&&addWheelListener(i,function(t){R.consume(t),d.nudgeWheelZoom(t.normalizedWheelDelta*m*(v?-1:1),t)}),y.setTransformOriginForElement(s,[0,0]),G.addClass(i,z.MINIVIEW),G.on(s,B.mousedown,o),p&&((g=G.createElement("div")).className=z.MINIVIEW_COLLAPSE,i.appendChild(g),G.on(g,U.click,_));var w=function(t){y.zoomToFit({onComplete:O,onStep:O,doNotFirePanEvent:t})};n.bindToToolkit(B.dataLoadEnd,w);function S(t,e){if(!(t.node&&!1===x(t.node)||t.group&&!1===x(t.group))){var n=t.node||t.group,o=n.id,i=l.nodeMap();if(null==i[o]){var r=G.getSize(t.el),s=L.createElement({position:U.absolute,width:r[0]+U.px,height:r[1]+U.px,left:0,top:0,clazz:z.MINIVIEW_ELEMENT+(e?" "+e:"")});if(f&&s.setAttribute("jtk-miniview-type",f(t.node||t.group)),s.relatedElement=t.el,s.jtk=t.node||t.group,h=d.getBoundsInfo(),s.setAttribute(V.jtkNodeId,o),s.setAttribute(V.relatedNodeId,t.el.getAttribute(U.id)),c.appendChild(s),y.add(s),i[o]=s,null!=n.data.rotation&&(s.style.transform="rotate("+n.data.rotation+"deg)",s.style.transformOrigin="50% 50%"),t.group)!function(t,e){for(var n=t.getNodes(),o=0;o<n.length;o++){var i=l.nodeMap()[n[o].id];i&&e.appendChild(i)}}(t.group,s);else if(t.node.group){var a=i[t.node.group.id];a&&(a.appendChild(s),y.suspend(t.el))}u.getLayout().map(o,s),O()}}}var I=function(t){var e=t.node||t.group;if(!e||!1!==x(e)){h=t.bounds;var n=l.nodeMap()[(t.node||t.group).id]||t.el;y.positionChanged(n,t.pos,null,t.size),G.setAbsolutePosition(n,t.pos),w(!0),this.fire(B.nodeMoveEnd,t)}}.bind(this),t=function(t,e){var n,o=t.getNodes(),i=l.nodeMap(),r=t.layout.getPositions(),s=i[t.id];o.forEach(function(t){n=r[t.id];var e=i[t.id];y.positionChanged(e,n),G.setAbsolutePosition(e,n)});var a=G.getSize(e);s.style.width=a[0]+U.px,s.style.height=a[1]+U.px,O()}.bind(this);this.registerNode=function(t){S(t,t.group?z.MINIVIEW_GROUP_ELEMENT:""),I(t)};var k=this.setOffset;this.setOffset=function(t,e){k.apply(this,arguments),y.positionChanged(t,[e.left,e.top])};var A=this.setAbsolutePosition;this.setAbsolutePosition=function(t,e){A.call(this,t,e),y.positionChanged(t,e)},this.setVisible=function(t){t,i.style.display=t?U.block:U.none},this.setVisible(!1!==n.visible),this.getPan=y.getPan;function T(t,e){for(var n=t.getNodes(),o=0;o<n.length;o++)l.nodeMap()[n[o].id].style.display=e?"block":"none"}function D(t,e){var n=l.nodeMap()[t.id];if(n){var o=G.getSize(n.relatedElement);n.style.width=o[0]+U.px,n.style.height=o[1]+U.px,e||O(),f&&n.setAttribute("jtk-miniview-type",f(t.obj))}}this.invalidate=function(t){if(t)D({id:t});else{var e=l.nodeMap();for(var n in e)D({id:n},!0);w(!0)}},this.setSuspended=function(t,e){a=t,e&&this.update()},this.update=O;function M(t){var e=(t.node||t.group).id,n=l.nodeMap()[e],o=l.nodeMap();if(n){var i,r,s;if(t.nodes&&t.group)if(!0!==t.nodesRemoved)for(var a=0;a<t.nodes.length;a++)(r=o[(i=t.nodes[a]).id])&&((s=t.nodePositions[i.id])&&(y.positionChanged(r,s),G.setAbsolutePosition(r,s)),c.appendChild(r));y.remove(n),delete o[e],l.jsPlumb.removeElement(n),w(!0)}t.dontUpdatePanner||O()}function N(t){for(var e in h=t.bounds,t.positions){var n=l.nodeMap()[e];n&&(y.positionChanged(n,t.positions[e],null,t.sizes[e]),G.setAbsolutePosition(n,t.positions[e]))}w(!0)}d.bind(B.pan,O),d.bind(B.zoom,O),d.bind(B.nodeMoveEnd,I),d.bind(B.nodeRemoved,M),d.bind(B.nodeAdded,S),d.bind(B.nodeRendered,S),d.bind(B.rotate,function(t,e){var n=l.nodeMap()[t.id]||l.groupMap()[t.id];null!=n&&(n.style.transform="rotate("+e+"deg)",n.style.transformOrigin="50% 50%")}),d.bind(B.groupRelayout,t),d.bind(B.relayout,N),d.bind(B.afterLayoutRefresh,N),d.bind(B.groupMoveEnd,I),d.bind(B.groupAdded,function(t){S(t,z.MINIVIEW_GROUP_ELEMENT)}),d.bind(B.groupMoveEnd,I),d.bind(B.groupRemoved,M),d.bind(B.groupMemberAdded,function(t){var e=l.nodeMap()[t.group.id],n=l.nodeMap()[t.node.id];e&&n&&e.appendChild(n)}),d.bind(B.groupMemberRemoved,function(t){var e=l.nodeMap()[t.node.id];e&&c.appendChild(e)}),d.bind(B.groupCollapse,function(t){T(t.group,!1),D({id:t.group.id})}),d.bind(B.groupExpand,function(t){T(t.group,!0),D({id:t.group.id})}),d.bind(B.relayout,O),d.bind(B.objectRepainted,D),d.bind(B.stateRestored,O),d.bind(B.nodeVisibility,function(t){var e=(t.node||t.group).id,n=l.nodeMap()[e];n&&(n.style.display=t.state?"block":"none")}),n.bindToToolkit(B.graphClearStart,function(){var t,e=l.nodeMap();for(var n in e)t=e[n],y.remove(t),l.jsPlumb.removeElement(t),delete e[n];O()});function O(t){if(d&&y&&!a){h=d.getBoundsInfo();var e=d.getApparentCanvasLocation(),n=y.getApparentCanvasLocation(),o=y.getZoom()/h.zoom;s.style.width=h.vw+U.px,s.style.height=h.vh+U.px,y.applyZoomToElement(s,o);var i=[e[0]*o,e[1]*o];r=[n[0]-i[0],n[1]-i[1]],G.setAbsolutePosition(s,r)}}function F(t){if(null!=y){h=d.getBoundsInfo(),t=t||G.getAbsolutePosition(s);var e=y.getApparentCanvasLocation(),n=y.getZoom()/h.zoom,o=(e[0]-t[0])/n,i=(e[1]-t[1])/n,r=d.setApparentCanvasLocation(o,i);return[e[0]-r[0]*n,e[1]-r[1]*n]}}u.getLayout().bind(B.redraw,function(){w(!0)}),this.setHostLayout=function(t){var e=u.getLayout();e&&e.setHostLayout(t)},this.setZoom=y.setZoom,this.getZoom=y.getZoom,this.getTransformOrigin=y.getTransformOrigin,this._destroy=function(){var t=[];Array.prototype.push.apply(t,c.querySelectorAll(".jtk-miniview-element"));for(var e=0;e<t.length;e++)delete t[e].relatedElement;y.destroy(),G.off(s,B.mousedown,o),c.parentNode.removeChild(c),s.parentNode.removeChild(s),G.removeClass(i,z.MINIVIEW),G.removeClass(i,z.MINIVIEW_COLLAPSED),p&&(G.off(g,U.click,_),g.parentNode.removeChild(g)),y=I=u=d=l=n=s=i=c=null}}}.call("undefined"!=typeof window?window:this),function(){"use strict";function P(){}var t=this.jsPlumbToolkit.Widgets,E=this.jsPlumbUtil,e="ontouchstart"in document.documentElement,x=e?"touchstart":"mousedown",C=e?"touchend":"mouseup",j=e?"touchmove":"mousemove",_="jtk-lasso-select-defeat",w="jtk-lasso",S="jtk-lasso-mask",I="jtk-lasso-mask-left",k="jtk-lasso-mask-top",A="jtk-lasso-mask-right",T="jtk-lasso-mask-bottom",D="onselectstart";t.Lasso=function(i){function r(t,e){if(f){var n=g?(window.innerWidth+document.body.clientWidth)/2:window.innerWidth,o=window.innerHeight,i=window.pageXOffset,r=window.pageYOffset,s=o-t[1]+r,a=o-s+e[1],l=n-t[0]+i,u=n-l+e[0];c.top.style.bottom=s+"px",c.bottom.style.top=a+"px",c.left.style.right=l+"px",c.right.style.left=u+"px",c.top.style.left=n-l+"px",c.top.style.right=n-u+"px",c.bottom.style.left=n-l+"px",c.bottom.style.right=n-u+"px"}else jsPlumb.setAbsolutePosition(d,t),function(t,e){t.style.width=e[0]+"px",t.style.height=e[1]+"px"}(d,e)}function s(t){var e=t?"block":"none";f?(c.top.style.display=e,c.left.style.display=e,c.right.style.display=e,c.bottom.style.display=e):d.style.display=e,jsPlumb[t?"addClass":"removeClass"](document.body,_)}function t(t){var e=document.createElement("div");return e.className=t.join(" "),document.body.appendChild(e),e}var d,e=i.canvas,n=!1,c={},a=[0,0],o=i.onStart||P,l=i.onEnd||P,u=i.onSelect||P,h=!1,p=!1,f=!0===i.invert,g=!!window.MSInputMethodContext&&!!document.documentMode,m=function(t){if(h){p||(s(!0),p=!0),E.consume(t);var e=i.pageLocation(t),n=[Math.abs(e[0]-a[0]),Math.abs(e[1]-a[1])],o=[Math.min(a[0],e[0]),Math.min(a[1],e[1])];r(o,n),u(o,n,[a[0]<e[0],a[1]<e[1]],t.shiftKey)}},v=function(t){h&&(p=h=!1,E.consume(t),i.off(document,C,v),i.off(document,j,m),i.off(document,D,y),s(!1),l())},y=function(){return!1},b=i.filter?function(t){var e=t.srcElement||t.target;return E.matchesSelector(e,i.filter)}:function(){return!1};f?(c.top=t([S,k]),c.bottom=t([S,T]),c.left=t([S,I]),c.right=t([S,A])):d=t([w]),i.on(e,x,function(t){n&&!b(t)&&(E.consume(t),h=!0,i.on(document,C,v),i.on(document,j,m),i.on(document,D,y),a=i.pageLocation(t),r(a,[1,1]),o(a,t.shiftKey))}),this.isActive=function(){return h},this.setEnabled=function(t){n=t}}}.call("undefined"!=typeof window?window:this),function(){"use strict";var h,p,f,g,m,v,y,b,P,E,x,C,j=this.jsPlumb,t=this.Knockle,_={},w={ok:"OK",cancel:"Cancel"},S=document.body,I=!1,k=t.newInstance({templateResolver:function(t){return s[t]||document.getElementById(t).innerHTML}}),A={},T=!0,s={};j.ready(function(){(h=document.createElement("div")).className="jtk-dialog-underlay",j.on(h,"click",function(){F(!0)}),(p=document.createElement("div")).className="jtk-dialog-overlay",(f=document.createElement("div")).className="jtk-dialog-title",p.appendChild(f),(g=document.createElement("div")).className="jtk-dialog-content",p.appendChild(g),(m=document.createElement("div")).className="jtk-dialog-buttons",p.appendChild(m)});function D(){if(I){var t=document.documentElement,e=j.getSize(p),n=S==document.body,o=p.getAttribute("data-axis");h.style.position=n?"fixed":"absolute",i[o](t,n,e)}}function M(t){27==t.keyCode&&F(!0)}function n(t){for(var e=t.querySelectorAll("[jtk-att]"),n={},o=0;o<e.length;o++){var i=e[o].tagName.toUpperCase(),r="INPUT"===i?(e[o].getAttribute("type")||"TEXT").toUpperCase():i,s=d[r](e[o]),a=e[o].getAttribute("jtk-att");if(null!=s){var l=k.data(n,a);null!=l?(jsPlumbUtil.isArray(l)||(l=[l],k.data(n,a,l)),l.push(s)):k.data(n,a,s)}}return n}function o(t,e){try{null!=t&&t.apply(t,Array.prototype.slice.apply(arguments,[1]))}catch(t){}}var i={x:function(t,e,n){var o=(S.clientWidth-n[0])/2,i=window.pageXOffset||t.scrollLeft||document.body.scrollLeft;o<0&&(o=10),i=e?i:S.scrollLeft,p.style.left=o+i+"px"},y:function(t,e,n){var o=.1*S.clientHeight,i=window.pageYOffset||t.scrollTop||document.body.scrollTop;o<0&&(o=10),i=e?i:S.scrollTop,p.style.top=o+i+"px"}},N=function(t,e,n){for(var o=n.querySelectorAll("[jtk-att]"),i=0;i<o.length;i++){var r=o[i].tagName.toUpperCase(),s="INPUT"===r?(o[i].getAttribute("type")||"TEXT").toUpperCase():r,a=o[i].getAttribute("jtk-att"),l=k.data(e,a);null!=l&&u[s](o[i],l),t&&o[i].getAttribute("jtk-commit")&&("INPUT"===r?j.on(o[i],"keyup",function(t){10!==t.keyCode&&13!==t.keyCode||F()}):"TEXTAREA"===r&&j.on(o[i],"keyup",function(t){!t.ctrlKey||10!==t.keyCode&&13!==t.keyCode||F()}))}},u={TEXT:function(t,e){t.value=e},RADIO:function(t,e){t.checked=t.value==e},CHECKBOX:function(t,e){t.checked=1==e},SELECT:function(t,e){for(var n=t.getAttribute("multiple"),o=0;o<t.options.length;o++)if(n)-1<e.indexOf(t.options[o].value)&&(t.options[o].selected=!0);else if(t.options[o].value===e)return void(t.selectedIndex=o)},TEXTAREA:function(t,e){t.value=e},COLOR:function(t,e){t.value=e},HIDDEN:function(t,e){t.value=e}},d={TEXT:function(t){return t.value},RADIO:function(t){if(t.checked)return t.value},CHECKBOX:function(t){if(t.checked)return!0},SELECT:function(t){var e=t.selectedOptions;if(t.getAttribute("multiple")){for(var n=[],o=0;o<e.length;o++)n.push(e[o].value);return n}return-1!==t.selectedIndex?t.options[t.selectedIndex].value:null},TEXTAREA:function(t){return t.value},COLOR:function(t){return t.value},HIDDEN:function(t){return t.value}},a={TEXT:function(t){t.value=""},RADIO:function(t){t.checked=!1},CHECKBOX:function(t){t.checked=!1},SELECT:function(t){t.selectedIndex=-1},TEXTAREA:function(t){t.value=""},COLOR:function(t){t.value=""},HIDDEN:function(t){t.value=""}},O=function(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e){var o=t[n].tagName.toUpperCase(),i="INPUT"===o?(t[n].getAttribute("type")||"TEXT").toUpperCase():o,r=a[i];r&&r(t[n])}},F=function(t){var e=t?null:n(g);!t&&null!=P&&!1===P(e)||(I=!1,h.style.display="none",p.style.display="none",j.off(document,"keyup",M),j.off(window,"resize",D),j.off(window,"scroll",D),j.removeClass(p,"jtk-dialog-overlay-visible"),j.removeClass(p,"jtk-dialog-overlay-top"),j.removeClass(p,"jtk-dialog-overlay-bottom"),j.removeClass(p,"jtk-dialog-overlay-left"),j.removeClass(p,"jtk-dialog-overlay-right"),j.removeClass(p,"jtk-dialog-overlay-x"),j.removeClass(p,"jtk-dialog-overlay-y"),p.setAttribute("data-position",""),p.setAttribute("data-axis",""),S.removeChild(h),S.removeChild(p),function(){for(var t=m.children,e=0;e<t.length;e++)t[e].parentNode.removeChild(t[e])}(),t?(o(A.onCancel,g),o(y,g)):(o(A.onOK,e,g),o(v,e,g)),o(A.onClose),o(E),v=y=b=E=P=null)};this.jsPlumbToolkit.Dialogs={initialize:function(t){if(_={},(t=t||{}).dialogs)for(var e in t.dialogs)s[e]=t.dialogs[e][0],_[e]={content:s[e],title:t.dialogs[e][1]||"",cancelable:!1!==t.dialogs[e][2]};else for(var n=t.selector||".jtk-dialog",o=j.getSelector(n),i=0;i<o.length;i++){var r=o[i].getAttribute("id");null!=r&&(_[r]={content:o[i].innerHTML,title:o[i].getAttribute("title")||"",el:o[i],cancelable:"false"!==o[i].getAttribute("cancel")})}t.labels&&j.extend(w,t.labels),t.globals&&j.extend(A,t.globals)},show:function(t){var e;if(t.id&&_[t.id]){T=!1!==t.reposition,v=t.onOK,y=t.onCancel,b=t.onOpen,P=t.onMaybeClose,E=t.onClose;var n=t.position||"top",o="jtk-dialog-overlay-"+n,i="top"===n||"bottom"===n?"x":"y",r="jtk-dialog-overlay-"+i;!function(t){if(m.innerHTML="",t.buttons)for(var e,n=0;n<t.buttons.length;n++)e=t.buttons[n],m.appendChild(e),"true"===e.getAttribute("jtk-commit")?j.on(e,"click",function(){F()}):"true"===e.getAttribute("jtk-cancel")&&j.on(e,"click",function(){F(!0)});else(x=document.createElement("button")).className="jtk-dialog-button jtk-dialog-button-ok",x.innerHTML=w.ok,m.appendChild(x),j.on(x,"click",function(){F()}),(C=document.createElement("button")).className="jtk-dialog-button jtk-dialog-button-cancel",C.innerHTML=w.cancel,C.setAttribute("jtk-cancel","true"),m.appendChild(C),j.on(C,"click",function(){F(!0)}),x.innerHTML=t.labels&&t.labels.ok||w.ok,C.innerHTML=t.labels&&t.labels.cancel||w.cancel}(t),S=function(t){return null==t?document.body:"string"==typeof t?document.getElementById(t):t}(t.container);var s=t.data||{},a=k.template(t.id,s);f.innerHTML=t.title||_[t.id].title||"",g.innerHTML="";var l=a.childNodes.length;for(e=0;e<l;e++)g.appendChild(a.childNodes[0]);S.appendChild(h),S.appendChild(p),j.addClass(p,o),j.addClass(p,r),h.style.display="block",p.style.display="block",p.setAttribute("data-position",n),p.setAttribute("data-axis",i);var u=_[t.id].cancelable?"visible":"hidden",d=m.querySelectorAll("[jtk-cancel='true']");for(e=0;e<d.length;e++)d[e].style.visibility=u;I=!0,D(),N(!0,s,g),j.on(document,"keyup",M),T&&(j.on(window,"resize",D),j.on(window,"scroll",D)),j.on(p,"click","[jtk-clear]",function(t){var e=this.getAttribute("jtk-att");e&&O(p.querySelectorAll("[jtk-att='"+e+"']:not([jtk-clear])"),this)}),j.on(p,"click","[jtk-clear-all]",function(t){O(p.querySelectorAll("[jtk-att]:not([jtk-clear])"),this)}),A.onOpen&&A.onOpen(p),b&&b(p),j.addClass(p,"jtk-dialog-overlay-visible");try{var c=g.querySelector("[jtk-focus]");c&&setTimeout(function(){c.focus()},0)}catch(t){}}},hide:function(){F(!0)},clear:O,apply:N.bind(null,!1),extract:n},"undefined"!=typeof exports&&(exports.Dialogs=this.jsPlumbToolkit.Dialogs)}.call("undefined"!=typeof window?window:this),function(){"use strict";this.jsPlumbToolkit.DrawingTools=function(t){function e(){for(var t in u){var e=u[t];e[0]&&e[0].parentNode&&e[0].parentNode.removeChild(e[0]),delete u[t]}}var r,s,a=t.renderer,l=a.getToolkit(),i=a.getJsPlumb(),u={},d=t.widthAttribute||"w",c=t.heightAttribute||"h",h=t.leftAttribute||"left",p=t.topAttribute||"top",n=t.onEdit||function(){},o=!0===t.onDemand;this.reset=e;function f(t,e,n,o){var i=document.createElement(t);if(e&&(i.className=e),n&&n.appendChild(i),o)for(var r in o)i.setAttribute(r,o[r]);return i}function g(t,e){var n=e.getRenderedNode(t.id)||e.getRenderedGroup(t.id);return function(t){var e=u[t];e&&e[0]&&e[0].parentNode&&e[0].parentNode.removeChild(e[0]),delete u[t]}(t.id),n}function m(t,e){var n=g(t,e);if(null!=n){var o=f("div","jtk-draw-skeleton",n),i=n.getAttribute("jtk-x-resize"),r=n.getAttribute("jtk-y-resize");f("div","jtk-draw-drag",o),f("div","jtk-draw-handle jtk-draw-handle-tl",o,{"data-dir":"tl","data-node-id":t.id}),f("div","jtk-draw-handle jtk-draw-handle-tr",o,{"data-dir":"tr","data-node-id":t.id}),f("div","jtk-draw-handle jtk-draw-handle-bl",o,{"data-dir":"bl","data-node-id":t.id}),f("div","jtk-draw-handle jtk-draw-handle-br",o,{"data-dir":"br","data-node-id":t.id}),u[t.id]=[o,"false"!==i,"false"!==r]}}function v(t,e,n,o){var i={};return i[d]=r?n:x-E,i[c]=s?o:j-C,i[h]=r?t:E,i[p]=s?e:C,i}var y,b,P,E,x,C,j,_={tl:function(t,e){var n=E+t,o=C+e,i=x-n,r=j-o;return x<=n&&(i=n-x,n=x),j<=o&&(r=o-j,o=j),v(n,o,i,r)},tr:function(t,e){var n=x-E+t,o=C+e,i=j-o,r=E;return n<=0&&(r=E+n,n*=-1),j<=o&&(i=o-j,o=j),v(r,o,n,i)},bl:function(t,e){var n=E+t,o=j-C+e,i=x-n,r=C;return x<=n&&(i=n-x,n=x),o<=0&&(r+=o,o*=-1),v(n,r,i,o)},br:function(t,e){var n=x-E+t,o=j-C+e,i=E,r=C;return n<=0&&(i=E+n,n*=-1),o<=0&&(r+=o,o*=-1),v(i,r,n,o)}};l.bind("selectionCleared",function(){e()}),l.bind("select",function(t){!0!=o&&m(t.obj,a)}),l.bind("deselect",function(t){!0!=o&&g(t.obj,a)});function w(t){var e=a.mapEventLocation(t),n=e.left-y.left,o=e.top-y.top,i=b(n,o,"");l.update(P,i),a.setPosition(P,i[h],i[p])}function S(t){var e=this.getAttribute("data-dir"),n=this.getAttribute("data-node-id");P=l.getNode(n)||l.getGroup(n),r=u[n][1],s=u[n][2],y=a.mapEventLocation(t);var o=a.getCoordinates(P);E=o.x,C=o.y,x=E+o.w,j=C+o.h,b=_[e],i.addClass(document.body,"jtk-drag-select-defeat"),i.on(document,"mousemove",w),i.on(document,"mouseup",I)}var I=function(t){a.storePositionInModel(P.id),i.removeClass(document.body,"jtk-drag-select-defeat"),i.off(document,"mousemove",w),i.off(document,"mouseup",I),jsPlumbUtil.consume(t),n(P)};i.on(document,"mousedown",".jtk-draw-handle",S),this.edit=function(t){m(t,a)},a.bind("destroy",function(){for(var t in i.off(document,"mousedown",S),u){var e=u[t][0];i.removeElement(e)}})},"undefined"!=typeof exports&&(exports.DrawingTools=this.jsPlumbToolkit.DrawingTools)}.call("undefined"!=typeof window?window:this);