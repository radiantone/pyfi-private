(function(){var s,t=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),h="jtk-connection-edit",l="jtk-bezier-guideline",y="jtk-anchor-placeholder",o="jtk-anchor-candidate",u="jtk-bezier-handle",c="jtk-bezier-handle-control-point",p="jtk-bezier-handle-control-point-1",d="jtk-bezier-handle-control-point-2",g="jtk-bezier-handle-secondary",m="jtk-bezier-handle-secondary-source",f="jtk-bezier-handle-secondary-target",b="jtk-anchor-face",v="none",_="block",P="left",x="top",j="right",S="bottom",C="px",r="absolute",E="dual",e=this,A=e.jsPlumb,k=(e.jsPlumbInstance,e.jsPlumbUtil),n=e.jsPlumbToolkit;function a(t){return"."+t}var w=a(y);function M(t,e,n){var s=document.createElement("div");return s.className=n||"",s.style.position=r,s.style.left=t+C,s.style.top=e+C,s}function i(t,e,n,s,i){var o=t.getSize(e),r=o[0]*n,a=o[1]*s,h=M(r,a,i);e.appendChild(h);var l=t.getSize(h);return h.style.left=r-l[0]/2+C,h.style.top=a-l[1]/2+C,h}var H=(O.prototype._attachOverlay=function(t,e,n){var s=[n[0],t.getJsPlumb().extend({},n[1])];s[1].id=jsPlumbUtil.uuid(),this.currentOverlays.push(e.addOverlay(s))},O.prototype._attachOverlays=function(e,n,t){var s=this;this._detachOverlays(),t.forEach(function(t){s._attachOverlay(e,n,t)})},O.prototype._detachOverlays=function(){var e=this;this.currentOverlays.forEach(function(t){e.current.removeOverlay(t.id)})},O.prototype._attachDeleteButton=function(e,t){function n(){return e.getToolkit().removeEdge(i.currentEdge)}function s(){t.onMaybeDelete?t.onMaybeDelete(i.currentEdge,i.current,n):n()}var i=this,o=t.deleteButtonClass||"jtk-edge-delete",r=t.deleteButtonLocation||.1;Array.isArray(r)||(r=[r]),r.forEach(function(t){i._attachOverlay(e,i.current,["Label",{location:t,cssClass:o,events:{click:s}}])})},O.prototype.repaintConnection=function(t){this.current&&this.current.repaint({args:t})},O.prototype.fireConnectionEditEvent=function(){this._jsPlumb.fire("connectionEdit",{connection:this.current,geometry:this.current.connector.exportGeometry()})},O.prototype.refresh=function(t){this.current&&(this._drawAnchors(),this._repaint&&this._repaint(t))},O.prototype._drawAnchors=function(){var t,e,m=this;if(this.current){function n(t,e){var n=m.current.endpoints[t],s=n.anchor;if(s.isDynamic||s.isContinuous){var i=s.getCurrentLocation({element:n}).slice(),o=m._jsPlumb.getOffset(n.element),r=m._jsPlumb.getRotation(n.elementId);if(0!==r){var a=m._jsPlumb.getSize(n.element),h=[o.left+a[0]/2,o.top+a[1]/2],l=jsPlumbUtil.rotatePoint(i,h,-r);i[0]=l[0],i[1]=l[1]}var c=[i[0]-o.left,i[1]-o.top],u=c[0],p=c[1],d=void 0;null!=e?d=e:(d=M(u,p,y),n.element.appendChild(d),m._setElementPosition(d,u,p),d._jsPlumbAnchor={anchor:s,endpoint:n,idx:t});var g=m._jsPlumb.getSize(d);return d.style.left=u-g[0]/2+C,d.style.top=p-g[1]/2+C,[o,d]}return[[0,0],null]}t=n(0,this.sourceAnchorPlaceholder),this.sourceDimensions=t[0],this.sourceAnchorPlaceholder=t[1],e=n(1,this.targetAnchorPlaceholder),this.targetDimensions=e[0],this.targetAnchorPlaceholder=e[1]}},O.prototype._cleanupAnchors=function(){this.current&&(this.sourceAnchorPlaceholder&&(this.sourceAnchorPlaceholder.parentNode.removeChild(this.sourceAnchorPlaceholder),delete this.sourceAnchorPlaceholder._jsPlumbAnchor),this.targetAnchorPlaceholder&&(this.targetAnchorPlaceholder.parentNode.removeChild(this.targetAnchorPlaceholder),delete this.targetAnchorPlaceholder._jsPlumbAnchor)),this.sourceAnchorPlaceholder=null,this.targetAnchorPlaceholder=null,this.sourceDimensions=null,this.targetDimensions=null},O.prototype._clearGeometry=function(){this.current&&(this.current.getConnector().setGeometry(null,!0),this.current.getConnector().setEditing(!1))},O.prototype.reset=function(){this.deactivate(),this._clearGeometry(),this._clearHandles(),this._jsPlumb.revalidate(this.current.source),this._jsPlumb.revalidate(this.current.target),this._jsPlumb.fire("clearConnectionEdits",this.current)},O.prototype.isActive=function(){return this.active},O.prototype._setElementPosition=function(t,e,n){var s=this._jsPlumb.getSize(t),i=e-s[0]/2,o=n-s[1]/2;t.style.left=i+C,t.style.top=o+C},O.prototype.activate=function(t,e,n){var s=this;if(this.deactivate(),this.current=e,this.currentEdge=this.current.edge,this._katavorio.setZoom(this._jsPlumb.getZoom()),null==this.current._jsPlumb)return this.current=null,void(this.currentEdge=null);this.current._paint=this.current.paint,this.current.paint=function(t){s.current._paint.apply(s.current,[t]),t=t||{},s.refresh(t.args)},n.overlays&&this._attachOverlays(t,e,n.overlays),!0===n.deleteButton&&this._attachDeleteButton(t,n),this._activate(t,e,n);var i=this.current.endpoints[0].anchor,o=this.current.endpoints[1].anchor;i.locked=!0,o.locked=!0,this._drawAnchors(),this.current.addClass(h),e.source._katavorioDrag&&e.source._katavorioDrag.addFilter(w),e.target._katavorioDrag&&e.target._katavorioDrag.addFilter(w),this.active=!0,this._jsPlumb.fire("startConnectionEdit",this.current)},O.prototype.deactivate=function(t){null!=this.current&&null!=this.current._jsPlumb&&(this._detachOverlays(),this.current.paint=this.current._paint,this.current._paint=null,this.current.source._katavorioDrag&&this.current.source._katavorioDrag.removeFilter(w),this.current.target._katavorioDrag&&this.current.target._katavorioDrag.removeFilter(w),this.current.endpoints[0].anchor,this.current.endpoints[1].anchor,this.current.removeClass(h),this._cleanupAnchors()),this._clearHandles(),null!=this.current&&this._jsPlumb.fire("stopConnectionEdit",this.current),this.active=!1,this.current=null,this.currentEdge=null},O.prototype._addDragHandler=function(t){this._katavorioDraggable.addSelector(t),this._dragHandlers[t.selector]=t},O);function O(t){var l=this;this.currentOverlays=[],this._dragHandlers={},this.active=!1,this._jsPlumb=t.jsPlumb,this._surface=t.surface,this._surface.getToolkit().bind("graphClearStart",function(){l.deactivate()}),this._jsPlumb.bind("internal.connectionDetached",function(t){t.connection===l.current&&l.deactivate()}),this.eventManager=new Mottle,this._katavorio=new Katavorio({bind:function(t,e,n){return l.eventManager.on(t,e,n)},unbind:function(t,e,n){return l.eventManager.off(t,e,n)},getSize:function(t){return[parseInt(t.offsetWidth,10),parseInt(t.offsetHeight,10)]},getPosition:function(t){return[parseInt(t.style.left,10),parseInt(t.style.top,10)]},setPosition:function(t,e){t.style.left=e[0]+C,t.style.top=e[1]+C},addClass:this._jsPlumb.addClass.bind(this._jsPlumb),removeClass:this._jsPlumb.removeClass.bind(this._jsPlumb),intersects:Biltong.intersects,indexOf:function(t,e){return t.indexOf(e)},scope:"connector-editor",css:{noSelect:this._jsPlumb.dragSelectClass,delegatedDraggable:"jtk-delegated-draggable",droppable:"jtk-droppable",draggable:"jtk-draggable",drag:"jtk-drag",selected:"jtk-drag-selected",active:"jtk-drag-active",hover:"jtk-drag-hover",ghostProxy:"jtk-ghost-proxy"},zoom:this._jsPlumb.getZoom()}),this._katavorioDraggable=this._katavorio.draggable(this._jsPlumb.getContainer(),{})[0],this._katavorioDraggable.addSelector({selector:w,constrain:function(t,e,n,s){var i=e._jsPlumbAnchor.anchor,o=e._jsPlumbAnchor.endpoint,r=e._jsPlumbAnchor.idx;t=i.isContinuous?function(t,e,n,s,i,o,r,a,h){var l=t.getSupportedFaces(),c=s.parentNode,u=[["left",n[0]],["right",i.w-n[0]],["top",n[1]],["bottom",i.h-n[1]]],p=new Map([["top",[0,-1]],["bottom",[0,1]],["left",[-1,0]],["right",[1,0]]]);u.sort(function(t,e){return t[1]<e[1]?-1:1});for(var d=null,g=0;g<u.length;g++)if(-1!=l.indexOf(u[g][0])){d=u[g][0];break}if(null!=d){c.setAttribute(b,d),t.setCurrentFace(d),t.lock();var m=p.get(d).slice(),y=h.getRotation(e.elementId);0!=y&&(m=jsPlumbUtil.rotateAnchorOrientation(m,y)),a.setAnchorOrientation(r,m)}return n}(i,o,t,e,n,0,r,l.current.getConnector(),l._jsPlumb):i.isDynamic?function(t,e,o,n,r,s,i,a){var h=t.getAnchors().map(function(t){return[t.x,t.y,t.orientation[0],t.orientation[1],t]}).map(function(t,e){var n=[r.w*t[0],r.h*t[1]],s=n[0],i=n[1];return[e,Math.sqrt(Math.pow(o[0]-s,2)+Math.pow(o[1]-i,2)),t]});h.sort(function(t,e){return t[1]<e[1]?-1:1});var l=h[0][2];t.setAnchor(l[4]);var c=l.slice(2);return a.setAnchorOrientation(i,c),o}(i,0,t,0,n,0,r,l.current.getConnector(),l._jsPlumb):function(t,e,o,n,r,s,i,a){var h=[[t.x,t.y,t.orientation[0],t.orientation[1]],[t.y,1-t.x,t.orientation[1],-1*t.orientation[0]],[1-t.x,1-t.y,-1*t.orientation[0],-1*t.orientation[1]],[1-t.y,t.x,-1*t.orientation[1],t.orientation[0]]].map(function(t,e){var n=[r.w*t[0],r.h*t[1]],s=n[0],i=n[1];return[e,Math.sqrt(Math.pow(o[0]-s,2)+Math.pow(o[1]-i,2)),t]});h.sort(function(t,e){return t[1]<e[1]?-1:1});var l=h[0][2];return t.x=l[0],t.y=l[1],t.orientation=l.slice(2),t.lastReturnValue=null,a.setAnchorOrientation(i,l.slice(2)),o}(i,0,t,0,n,0,r,l.current.getConnector(),l._jsPlumb),l._jsPlumb.revalidate(e.parentNode);var a=[e.offsetWidth,e.offsetHeight],h={xmin:-a[0]/2,xmax:n.w-a[0]/2,ymin:-a[1]/2,ymax:n.h-a[1]/2};return[t[0]<h.xmin?h.xmin:t[0]>h.xmax?h.xmax:t[0],t[1]<h.ymin?h.ymin:t[1]>h.ymax?h.ymax:t[1]]},start:function(t){var e=t.drag.getDragElement(),n=e._jsPlumbAnchor.anchor,s=e._jsPlumbAnchor.endpoint;if(n.isContinuous)e.parentNode.setAttribute(b,n.getCurrentFace());else if(n.isDynamic){n.getAnchors().map(function(t){return[t.x,t.y,t.orientation[0],t.orientation[1]]}).forEach(function(t){i(l._jsPlumb,s.element,t[0],t[1],o)})}else{[[n.x,n.y,n.orientation[0],n.orientation[1]],[n.y,1-n.x,n.orientation[1],-1*n.orientation[0]],[1-n.x,1-n.y,-1*n.orientation[0],-1*n.orientation[1]],[1-n.y,n.x,-1*n.orientation[1],n.orientation[0]]].forEach(function(t){i(l._jsPlumb,s.element,t[0],t[1],o)})}},stop:function(t){var e=t.el.parentNode,n=t.drag.getDragElement(),s=n._jsPlumbAnchor.anchor,i=(n._jsPlumbAnchor.idx,n._jsPlumbAnchor.endpoint);s.isContinuous?e.removeAttribute(b):s.isDynamic,i.element.querySelectorAll(a(o)).forEach(function(t){return t.parentNode.removeChild(t)}),l._drawAnchors(),l._update(),l.fireConnectionEditEvent()}}),this._surface.bind("nodeMoveEnd",function(t){l.active&&l.currentEdge&&(t.node===l.currentEdge.source||t.node===l.currentEdge.target)&&(l._elementDragged(t),l.fireConnectionEditEvent())}),this._surface.bind("nodeMove",function(t){l.active&&l.currentEdge&&(t.node===l.currentEdge.source||t.node===l.currentEdge.target)&&l._elementDragging(t)}),this._jsPlumb.bind("zoom",function(t){l._katavorio.setZoom(t)})}var D=(Y.prototype._setAnchorLocation=function(t,e,n){var s=e.endpoints[n].anchor;if(s.isContinuous){var i=x;0===t[2]?i=P:1===t[2]?i=j:1===t[3]&&(i=S),s.setCurrentFace(i),s.lock()}else s.isDynamic?s.setAnchorCoordinates(t.slice(2)):(s.x=t[2],s.y=t[3],s.orientation=t.slice(4)),s.lastReturnValue=null;s.locked=!0},Y.prototype.importGeometry=function(t,e){return!!this._importGeometry&&!!this._importGeometry(t)&&(this._setAnchorLocation(t.source,e,0),this._setAnchorLocation(t.target,e,1),!0)},Y.prototype.clearEdits=function(){this._clearEdits&&this._clearEdits()},Y);function Y(){}A.Connectors.AbstractEditableConnector=D,k.extend(D,A.Connectors.AbstractConnector),null!=n&&(n.Renderers.Surface.prototype._resolveConnection=function(t){return null==t?null:"string"==typeof t?this.getRenderedConnection(t):t.constructor==A.Connection?t:this.getRenderedConnection(t.getId())},n.Renderers.Surface.prototype._ensureCanEdit=function(){if(!this.startEditing)throw new Error("Connection editors not available.")},n.Renderers.Surface.prototype.startEditing=function(t,e){this._ensureCanEdit();var n=this._resolveConnection(t);if(null!=n){var s=this.getJsPlumb();n.getConnector();e=A.extend({},e||{});var i=n.getConnector().type;if(!A.ConnectorEditors)throw new Error("Connector editors not found. Have you imported jsPlumbToolkitEditableConnectors ?");if(!A.ConnectorEditors[i])throw new Error("No editor available for connector type ["+i+"]");if(null==s._connectorEditors&&(s._connectorEditors={}),null==s._connectorEditors[i]){var o=s.extend({},e);o.jsPlumb=s,o.surface=this,s._connectorEditors[i]=new A.ConnectorEditors[i](o)}s._connectorEditors[i].activate(this,n,e)}},n.Renderers.Surface.prototype.stopEditing=function(){this._ensureCanEdit();var t=this.getJsPlumb();for(var e in t._connectorEditors)t._connectorEditors[e].deactivate()},n.Renderers.Surface.prototype.clearEdits=function(t){this._ensureCanEdit();var e=this._resolveConnection(t);if(null!=e){var n=e.getConnector();return!!n.clearEdits&&(n.clearEdits(),e.repaint(),!0)}});var z="v",G="h",X=-1,R="EditableFlowchart",B="Straight";function I(t){return t<0?-1:0===t?0:1}function L(t){return Math.sqrt(Math.pow(t[7]-t[5],2)+Math.pow(t[8]-t[6],2))}function T(t){return[I(t[2]-t[0]),I(t[3]-t[1])]}function N(t){var e=[];return e.push.apply(e,t),e}function U(t,e){return t[0]===e[0]&&t[1]===e[1]}function F(t,e,n,s,i,o){if(t.lastx!==e||t.lasty!==n){var r=null==t.lastx?s.sx:t.lastx,a=null==t.lasty?s.sy:t.lasty,h=r===e?z:G;t.lastx=e,t.lasty=n,t.segments.push([r,a,e,n,h,r+i,a+o,e+i,n+o])}}function q(t,e){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}function W(t){var e=t[0][5],n=t[0][6],s=t[t.length-1][7],i=t[t.length-1][8],o=e<=s?e:s,r=n<=i?n:i;return t.forEach(function(t){t[0]=t[5]-o,t[1]=t[6]-r,t[2]=t[7]-o,t[3]=t[8]-r,null!=t[4]&&0!==t[4].length||(t[4]=t[5]===t[7]?z:G)}),t}function Q(t,e,n,s){var i,o=null;if(null!=s){if(-1===(i=t.indexOf(s)))return null;i+=e}else i=e===X?t.length-2:1;for(var r=i;0<r&&r<t.length-1;r+=e)if(t[r][4]===n){o=[t[r],r];break}return o}var Z=(J.prototype.setGeometry=function(t,e){this.geometry=t,this.edited=null!=t&&!e},J.prototype.setAndTransformGeometry=function(t){t.segments=W(t.segments),this.setGeometry(t,!1)},J.prototype.setAndTransformSegments=function(t){null!=this.geometry&&(this.geometry.segments=W(t))},J.prototype.exportGeometry=function(){if(null==this.geometry)return null;var t=this.geometry.segments.length,e=this.geometry.segments[t-1];return e[7],e[8],{segments:this.geometry.segments.slice(1).map(function(t){return[t[5],t[6]]}),source:this.geometry.source,target:this.geometry.target}},J.prototype._importGeometry=function(t){if(null!=t&&null!=t.segments&&null!=t.source&&null!=t.target){var e=t.segments;if(null!=e&&3<=e.length){for(var n=[],s=t.source[0],i=t.source[1],o=0;o<e.length;o++){if(e[o][0]-s!=0&&e[o][1]-i!=0)return void console.log("Invalid path segment",s,i,e[o][0],e[o][1],"not in X or Y axis");n.push([0,0,0,0,null,s,i,e[o][0],e[o][1]]),s=e[o][0],i=e[o][1]}return n.push([0,0,0,0,null,s,i,t.target[0],t.target[1]]),this.setAndTransformGeometry({segments:n,source:t.source,target:t.target}),!0}}return!1},J.prototype._clearEdits=function(){this.geometry=null,this.edited=!1},J.prototype.isEdited=function(){return this.edited},J.prototype.isEditable=function(){return!0},J.prototype.writeSegments=function(t,e,n){this.paintInfo=n;for(var s,i,o,r=null,a=0;a<e.length-1;a++){if(r=r||N(e[a]),s=N(e[a+1]),i=T(r),o=T(s),0<this.cornerRadius&&r[4]!==s[4]){var h=Math.min(L(r),L(s)),l=Math.min(this.cornerRadius,h/2);r[2]-=i[0]*l,r[3]-=i[1]*l,s[0]+=o[0]*l,s[1]+=o[1]*l;var c=i[1]===o[0]&&1===o[0]||i[1]===o[0]&&0===o[0]&&i[0]!==o[1]||i[1]===o[0]&&-1===o[0],u=(s[1]>r[3]?1:-1)==(s[0]>r[2]?1:-1),p=u&&c||!u&&!c?s[0]:r[2],d=u&&c||!u&&!c?r[3]:s[1];this._super.addSegment(t,B,{x1:r[0],y1:r[1],x2:r[2],y2:r[3]}),this._super.addSegment(t,"Arc",{r:l,x1:r[2],y1:r[3],x2:s[0],y2:s[1],cx:p,cy:d,ac:c})}else{var g=r[2]===r[0]?0:r[2]>r[0]?n.lw/2:-n.lw/2,m=r[3]===r[1]?0:r[3]>r[1]?n.lw/2:-n.lw/2;this._super.addSegment(t,B,{x1:r[0]-g,y1:r[1]-m,x2:r[2]+g,y2:r[3]+m})}r=s}null!=s&&this._super.addSegment(t,B,{x1:s[0],y1:s[1],x2:s[2],y2:s[3]})},J.prototype._compute=function(t,l){var c=this;this.segments=[],this.lastx=null,this.lasty=null,this.lastOrientation=null;var e=l.sourcePos,n=l.targetPos,s=this.geometry;if(this.isEdited()&&null!=s&&null!=s.segments&&0<s.segments.length){this.segments=s.segments;var i=!U(l.sourcePos,s.source);if(!U(l.targetPos,s.target)){var o=this.segments[this.segments.length-1],r=Q(this.segments,-1,z),a=Q(this.segments,-1,G);o[5]=l.targetPos[0]+t.stubs[1]*t.to[0],o[6]=l.targetPos[1]+t.stubs[1]*t.to[1],o[7]=l.targetPos[0],o[8]=l.targetPos[1],o[4]=0===l.targetOrientation[1]?"h":"v",null!=r&&null!=a&&(r[1]>a[1]?(r[0][5]=o[5],r[0][7]=o[5],r[0][8]=o[6],a[0][7]=o[5]):(a[0][6]=o[6],a[0][8]=o[6],a[0][7]=o[5],r[0][8]=o[6])),this.segments=W(this.segments)}if(i){var h=this.segments[0],u=Q(this.segments,1,z),p=Q(this.segments,1,G);h[5]=l.sourcePos[0],h[6]=l.sourcePos[1],h[7]=l.sourcePos[0]+t.stubs[0]*t.so[0],h[8]=l.sourcePos[1]+t.stubs[0]*t.so[1],h[4]=0===l.sourceOrientation[1]?"h":"v",null!=u&&null!=p&&(u[1]>p[1]?(p[0][6]=h[8],p[0][8]=h[8],p[0][5]=h[7],u[0][6]=h[8]):(u[0][5]=h[7],u[0][7]=h[7],u[0][6]=h[8],p[0][5]=h[7])),this.segments=W(this.segments)}this.setGeometry({segments:this.segments,source:l.sourcePos.concat(l.sourceOrientation),target:l.targetPos.concat(l.targetOrientation),quadrant:t.segment},!1)}else{var d=n[0]>=e[0]?e[0]:n[0],g=n[1]>=e[1]?e[1]:n[1],m=new Map([["perpendicular",q],["orthogonal",q],["opposite",function(t,e){var n=t,s="x"===n.sourceAxis?0:1;return!e&&{x:function(){return 1===n.so[s]&&(n.startStubX>n.endStubX&&n.tx>n.startStubX||n.sx>n.endStubX&&n.tx>n.sx)||-1===n.so[s]&&(n.startStubX<n.endStubX&&n.tx<n.startStubX||n.sx<n.endStubX&&n.tx<n.sx)},y:function(){return 1===n.so[s]&&(n.startStubY>n.endStubY&&n.ty>n.startStubY||n.sy>n.endStubY&&n.ty>n.sy)||-1===n.so[s]&&(n.startStubY<n.endStubY&&n.ty<n.startStubY||n.sy<n.endStubY&&n.ty<n.sy)}}[n.sourceAxis]()?{x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]}[n.sourceAxis]:[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}]]).get(t.anchorOrientation)(t,this.alwaysRespectStubs),y="x"===t.sourceAxis?0:1,f="x"===t.sourceAxis?1:0,b=m[y],v=m[f],_=m[2+y],P=m[2+f];F(this,m[0],m[1],t,d,g);var x=t.startStubX+(t.endStubX-t.startStubX)*this.midpoint,j=t.startStubY+(t.endStubY-t.startStubY)*this.midpoint,S={x:[0,1],y:[1,0]},C={perpendicular:function(t,e){var n={x:[[t.startStubX,t.endStubX],null,[t.endStubX,t.startStubX]],y:[[t.startStubY,t.endStubY],null,[t.endStubY,t.startStubY]]},s={x:[[x,t.startStubY],[x,t.endStubY]],y:[[t.startStubX,j],[t.endStubX,j]]},i={x:[[t.endStubX,t.startStubY]],y:[[t.startStubX,t.endStubY]]},o={x:[[t.startStubX,t.endStubY],[t.endStubX,t.endStubY]],y:[[t.endStubX,t.startStubY],[t.endStubX,t.endStubY]]},r={x:[[t.startStubX,j],[t.endStubX,j],[t.endStubX,t.endStubY]],y:[[x,t.startStubY],[x,t.endStubY],[t.endStubX,t.endStubY]]},a={x:[t.startStubY,t.endStubY],y:[t.startStubX,t.endStubX]},h=S[e][0],l=S[e][1],c=t.so[h]+1,u=t.to[l]+1,p=-1===t.to[l]&&a[e][1]<a[e][0]||1===t.to[l]&&a[e][1]>a[e][0],d=n[e][c][0],g=n[e][c][1],m={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[e][c][u];return t.segment===m[3]||t.segment===m[2]&&p?s[e]:t.segment===m[2]&&g<d?i[e]:t.segment===m[2]&&d<=g||t.segment===m[1]&&!p?r[e]:t.segment===m[0]||t.segment===m[1]&&p?o[e]:void 0},orthogonal:function(t,e,n,s,i,o){var r={x:-1===t.so[0]?Math.min(n,i):Math.max(n,i),y:-1===t.so[1]?Math.min(n,i):Math.max(n,i)}[e];return{x:[[r,s],[r,o],[i,o]],y:[[s,r],[o,r],[o,i]]}[e]},opposite:function(t,e,n,s,i){var o={x:"y",y:"x"}[e],r={x:"height",y:"width"}[e],a=t["is"+e.toUpperCase()+"GreaterThanStubTimes2"];if(l.sourceEndpoint.elementId!==l.targetEndpoint.elementId)return!a||1===t.so[y]&&i<n||-1===t.so[y]&&n<i?{x:[[n,j],[i,j]],y:[[x,n],[x,i]]}[e]:1===t.so[y]&&n<i||-1===t.so[y]&&i<n?{x:[[x,t.sy],[x,t.ty]],y:[[t.sx,j],[t.tx,j]]}[e]:void 0;var h=s+(1-l.sourceEndpoint.anchor[o])*l.sourceInfo[r]+c.maxStub;return{x:[[n,h],[i,h]],y:[[h,n],[h,i]]}[e]}}[t.anchorOrientation](t,t.sourceAxis,b,v,_,P);if(C)for(var E=0;E<C.length;E++)F(this,C[E][0],C[E][1],t,d,g);F(this,m[2],m[3],t,d,g),F(this,t.tx,t.ty,t,d,g),this.setGeometry({segments:this.segments,source:l.sourcePos.concat(l.sourceOrientation),target:l.targetPos.concat(l.targetOrientation),quadrant:t.segment},!0)}this.writeSegments(this,this.segments,t)},J.prototype._locateSegment=function(e,t){var n=this.segments.findIndex(function(t){return t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]});if(-1<n){var s=this.segments[n][4],i=this.segments[n];return{segment:i,index:n,orientation:s,prev:1<n?this.segments[n-1]:null,next:n<this.segments.length-2?this.segments[n+1]:null,left:t?Q(this.segments,-1,s,i):null,right:t?Q(this.segments,1,s,i):null}}return null},J.prototype.setSegmentPosition=function(t,e){var n=this._locateSegment(t);if(null==n)return null;n.orientation===z?n.segment[5]=n.segment[7]=e[0]:n.segment[6]=n.segment[8]=e[1];for(var s=n.orientation===z,i=n.index,o=n.index,r=1<i?this.segments[i-1]:null,a=n.segment;null!=r;)r[4]===a[4]?(r[s?5:6]=a[s?5:6],r[s?7:8]=a[s?7:8]):(r[7]=a[5],r[8]=a[6]),a=r,r=1<--i?this.segments[i-1]:null;if(a[5]!==this.segments[0][7]){var h=[null,null,null,null,G,this.segments[0][7],this.segments[0][8],a[5],a[6]];this.segments.splice(1,0,h),o++}else a[6]!==this.segments[0][8]&&(h=[null,null,null,null,z,this.segments[0][7],this.segments[0][8],a[5],a[6]],this.segments.splice(1,0,h),o++);a=n.segment;for(var l=(i=n.index)<this.segments.length-2?this.segments[i+1]:null;null!=l;)l[4]===a[4]?(l[s?5:6]=a[s?5:6],l[s?7:8]=a[s?7:8]):(l[5]=a[7],l[6]=a[8]),a=l,l=++i<this.segments.length-2?this.segments[i+1]:null;var c=this.segments[this.segments.length-1];return a[7]!==c[5]?(h=[null,null,null,null,G,a[7],a[8],c[5],c[6]],this.segments.splice(this.segments.length-1,0,h)):a[8]!==c[6]&&(h=[null,null,null,null,z,a[7],a[8],c[5],c[6]],this.segments.splice(this.segments.length-1,0,h)),this.segments=W(this.segments),this.edited=!0,{ctx:n,segments:this.segments,index:o}},J.prototype.trim=function(){for(var t=[jsPlumbUtil.clone(this.segments[0])],e=jsPlumbUtil.clone(this.segments[this.segments.length-1]),n=this.segments.slice(1,this.segments.length-1).filter(function(t){return 0<L(t)}).map(jsPlumbUtil.clone),s=null,i=null,o=0;o<n.length;o++)null==s||null==i?(s=n[o],i=n[o][4]):n[o][4]===i?(s[3]=n[o][3],s[2]=n[o][2],s[8]=n[o][8],s[7]=n[o][7]):(t.push(s),s=n[o],i=n[o][4]);if(t.push(s),t.push(e),3===t.length){var r=t[1],a=r[4],h=jsPlumbUtil.clone(r),l=jsPlumbUtil.clone(r),c=jsPlumbUtil.clone(r);l[4]="h"===a?"v":"h",l[0]=h[0],l[1]=h[1],l[2]=h[0],l[3]=h[1],l[5]=h[5],l[6]=h[6],l[7]=h[5],l[8]=h[6],c[4]="h"===a?"v":"h",c[0]=h[2],c[1]=h[3],c[2]=h[2],c[3]=h[3],c[5]=h[7],c[6]=h[8],c[7]=h[7],c[8]=h[8],t=[t[0],l,h,c,t[2]]}this.setAndTransformSegments(t)},J.prototype.setAnchorOrientation=function(t,e){if(2<=this.segments.length){var n=0===t?this.segments[0]:this.segments[this.segments.length-1],s=0===e[0]?z:G;n[4]=s}},J);function J(t){(t=t||{}).stub=null==t.stub?30:t.stub,this.type=R,this._super=A.Connectors.AbstractConnector.apply(this,arguments),this.midpoint=null==t.midpoint?.5:t.midpoint,this.alwaysRespectStubs=!0===t.alwaysRespectStubs,this.lastx=null,this.lasty=null,this.lastOrientation=null,this.cornerRadius=null!=t.cornerRadius?t.cornerRadius:0,this.trimThreshold=null==t.trimThreshold?5:t.trimThreshold,this.loopbackRadius=t.loopbackRadius||25,this.isLoopbackCurrently=!1}A.Connectors[R]=Z,k.extend(Z,A.Connectors.AbstractEditableConnector);var V="jtk-flowchart-handle",K="jtk-flowchart-segment-drag";function $(t,e,n,s){var i=document.createElement("div");return i.className=n,i.style.position=r,i.style.left=t+C,i.style.top=e+C,s||(i.style.display=v),i}function tt(t,e,n,s,i){var o=$(t,e,s,i);n.appendElement(o);var r=n.getSize(o);return o.style.left=t-r[0]/2+"px",o.style.top=e-r[1]/2+"px",o}function et(t,e,n,s,i){s+=t.offsetWidth/2,i+=t.offsetHeight/2;var o=Math.max(5,Math.abs(s-e.left)),r=Math.max(5,Math.abs(i-e.top));jsPlumbUtil.svg.attr(n,{width:o,height:r}),n.style.left=Math.min(e.left,s)+C,n.style.top=Math.min(e.top,i)+C;var a="M "+(s>e.left?o:"0")+" "+(i>e.top?r:"0")+" L "+(s>e.left?"0":o)+" "+(i>e.top?"0":r);jsPlumbUtil.svg.attr(n.childNodes[0],{d:a})}function nt(t,e,n,s){var i=Math.abs(n-e.left),o=Math.abs(s-e.top),r=k.svg.node("svg",{width:i,height:o}),a=k.svg.node("path",{d:"M 0 0 L "+i+" "+o});return r.appendChild(a),A.addClass(r,l),et(t,e,r,n,s),r}var st,it=(t(ot,st=H),ot.prototype._setHandlePosition=function(t,e){t.el.style.visibility="visible",this._setElementPosition(t.el,e[0],e[1])},ot.prototype._repaint=function(t){this._update(t);for(var e=0;e<this.segmentHandles.length;e++)if(this.segmentHandles[e].geometry=this.geometry.segments[e+1],0<L(this.segmentHandles[e].geometry)){var n=[(this.segmentHandles[e].geometry[5]+this.segmentHandles[e].geometry[7])/2,(this.segmentHandles[e].geometry[6]+this.segmentHandles[e].geometry[8])/2];this._setHandlePosition(this.segmentHandles[e],n)}else this.segmentHandles[e].el.style.visibility="hidden"},ot.prototype._clearHandles=function(t){for(var e=0;e<this.segmentHandles.length;e++)this.segmentHandles[e].el!==t&&this._jsPlumb.remove(this.segmentHandles[e].el,!0)},ot.prototype._activate=function(t,e){this._update()},ot.prototype._elementDragged=function(t){this._trimConnection()},ot.prototype._elementDragging=function(t){},ot.prototype._update=function(t){var e=(t=t||{}).segmentInfo,n=t.segmentIndex;if(this.geometry=this.current.getConnector().geometry,this.geometry&&this.geometry.segments){this._clearHandles(e?e.el:null),this.segmentHandles.length=0,this.segments.length=0,Array.prototype.push.apply(this.segments,this.geometry.segments);for(var s=1;s<this.segments.length-1;s++)if(null==e||s!==n){var i=[(this.segments[s][5]+this.segments[s][7])/2,(this.segments[s][6]+this.segments[s][8])/2],o=i[0],r=i[1],a=this.segments[s][4]===z,h=tt(o,r,this._jsPlumb,[V,K,a?"jtk-flowchart-segment-drag-ew":"jtk-flowchart-segment-drag-ns"].join(" "),!0),l={left:o,top:r,el:h,geometry:this.segments[s],vertical:a};h._jsPlumbDragHandle=l,this.segmentHandles.push(l),this._setHandlePosition(l,i)}else s===n&&this.segmentHandles.push(e)}},ot.prototype._trimConnection=function(){this.current&&(this.current.getConnector().trim(),this.repaintConnection())},ot);function ot(t){var o=st.call(this,t)||this;return o.segments=[],o.segmentHandles=[],o._addDragHandler({selector:a(K),drag:function(t){var e=t.drag.getDragElement()._jsPlumbDragHandle,n=o._jsPlumb.getSize(e.el),s=[Math.floor(t.pos[0]+n[0]/2),Math.floor(t.pos[1]+n[1]/2)],i=o.current.connector.setSegmentPosition(e.geometry,s);null!=i&&(o.segments.length=0,o.geometry.segments=i.segments,Array.prototype.push.apply(o.segments,o.geometry.segments),e.geometry=o.geometry.segments[i.index],o.repaintConnection({segmentInfo:e,segmentIndex:i.index}))},constrain:function(t,e,n,s){var i=e._jsPlumbDragHandle;return i.geometry[5]===i.geometry[7]?[t[0],(i.geometry[6]+i.geometry[8])/2-s[1]/2]:[(i.geometry[5]+i.geometry[7])/2-s[0]/2,t[1]]},stop:function(){o._trimConnection(),o.fireConnectionEditEvent()}}),o}var rt=(at.prototype.setGeometry=function(t,e){this.geometry=t,this.edited=null!=t&&!e},at.prototype.getGeometry=function(){return this.geometry},at.prototype.exportGeometry=function(){if(null==this.geometry)return null;var t=[],e=[],n=[],s=[];return Array.prototype.push.apply(t,this.geometry.source),Array.prototype.push.apply(e,this.geometry.target),Array.prototype.push.apply(n,this.geometry.controlPoints[0]),Array.prototype.push.apply(s,this.geometry.controlPoints[1]),{source:t,target:e,controlPoints:[n,s]}},at.prototype._importGeometry=function(t){return!(null==t||(null==t.controlPoints||2!=t.controlPoints.length?(console.log("EditableBezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),1):2!=t.controlPoints[0].length||2!=t.controlPoints[1].length?(console.log("EditableBezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),1):null==t.source||4!=t.source.length?(console.log("EditableBezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),1):null==t.target||4!=t.target.length?(console.log("EditableBezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),1):(this.setGeometry(t,!1),0)))},at.prototype._clearEdits=function(){this.geometry=null,this.edited=!1},at.prototype.isEdited=function(){return this.edited},at.prototype.isEditable=function(){return!0},at.prototype._compute=function(t,e){var n=e.sourcePos,s=e.targetPos,i=Math.abs(n[0]-s[0]),o=Math.abs(n[1]-s[1]);if(this.showLoopback&&e.sourceEndpoint.elementId===e.targetEndpoint.elementId){this.isLoopbackCurrently=!0;var r=e.sourcePos[0],a=e.sourcePos[1]-this.margin,h=r,l=a-this.loopbackRadius,c=h-this.loopbackRadius,u=l-this.loopbackRadius;i=2*this.loopbackRadius,o=2*this.loopbackRadius,t.points[0]=c,t.points[1]=u,t.points[2]=i,t.points[3]=o,this._super.addSegment(this,"Arc",{loopback:!0,x1:r-c+4,y1:a-u,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:r-c-4,y2:a-u,cx:h-c,cy:l-u})}else this.isLoopbackCurrently=!1,this._computeBezier(t,e,n,s,i,o)},at.prototype.setAnchorOrientation=function(t,e){},at);function at(t){t=t||{},this._super=A.Connectors.AbstractConnector.apply(this,arguments),this.showLoopback=!1!==t.showLoopback,this.curviness=t.curviness||10,this.margin=t.margin||5,this.proximityLimit=t.proximityLimit||80,this.clockwise=t.orientation&&"clockwise"===t.orientation,this.loopbackRadius=t.loopbackRadius||25,this.isLoopbackCurrently=!1}var ht,lt=(t(ct,ht=rt),ct.prototype.getCurviness=function(){return this.majorAnchor},ct.prototype._findControlPoint=function(t,e,n,s,i,o,r){var a=[];return o[0]!==r[0]||o[1]===r[1]?(0===r[0]?a.push(n[0]<e[0]?t[0]+this.minorAnchor:t[0]-this.minorAnchor):a.push(t[0]+this.majorAnchor*r[0]),0===r[1]?a.push(n[1]<e[1]?t[1]+this.minorAnchor:t[1]-this.minorAnchor):a.push(t[1]+this.majorAnchor*o[1])):(0===o[0]?a.push(e[0]<n[0]?t[0]+this.minorAnchor:t[0]-this.minorAnchor):a.push(t[0]-this.majorAnchor*o[0]),0===o[1]?a.push(e[1]<n[1]?t[1]+this.minorAnchor:t[1]-this.minorAnchor):a.push(t[1]+this.majorAnchor*r[1])),a},ct.prototype._computeBezier=function(t,e,n,s,i,o){var r,a,h=n[0]<s[0]?i:0,l=n[1]<s[1]?o:0,c=n[0]<s[0]?0:i,u=n[1]<s[1]?0:o;a=!0!==this.edited?(r=this._findControlPoint([h,l],n,s,e.sourceEndpoint,e.targetEndpoint,t.so,t.to),this._findControlPoint([c,u],s,n,e.targetEndpoint,e.sourceEndpoint,t.to,t.so)):(r=this.geometry.controlPoints[0],this.geometry.controlPoints[1]),this.geometry={controlPoints:[r,a],source:e.sourcePos,target:e.targetPos},this._super.addSegment(this,"Bezier",{x1:h,y1:l,x2:c,y2:u,cp1x:r[0],cp1y:r[1],cp2x:a[0],cp2y:a[1]})},ct);function ct(t){var e=ht.call(this,t)||this;return t=t||{},e.type="EditableBezier",e.majorAnchor=t.curviness||150,e.minorAnchor=10,e}A.Connectors.EditableBezier=lt,k.extend(lt,A.Connectors.AbstractEditableConnector);var ut,pt=(t(dt,ut=rt),dt.prototype._computeBezier=function(t,e,n,s,i,o){var r,a,h,l,c=e.sourcePos[0]<e.targetPos[0]?0:i,u=e.sourcePos[1]<e.targetPos[1]?0:o,p=e.sourcePos[0]<e.targetPos[0]?i:0,d=e.sourcePos[1]<e.targetPos[1]?o:0;if(0===e.sourcePos[2]&&(c-=this.margin),1===e.sourcePos[2]&&(c+=this.margin),0===e.sourcePos[3]&&(u-=this.margin),1===e.sourcePos[3]&&(u+=this.margin),0===e.targetPos[2]&&(p-=this.margin),1===e.targetPos[2]&&(p+=this.margin),0===e.targetPos[3]&&(d-=this.margin),1===e.targetPos[3]&&(d+=this.margin),!0!==this.edited){var g=(c+p)/2,m=(u+d)/2,y=this._segment(c,u,p,d),f=Math.sqrt(Math.pow(p-c,2)+Math.pow(d-u,2));this._controlPoint=this._findControlPoint(g,m,y,e.sourcePos,e.targetPos,this.curviness,this.curviness,f,this.proximityLimit)}else this._controlPoint=this.geometry.controlPoints[0];r=this._controlPoint[0],a=this._controlPoint[0],h=this._controlPoint[1],l=this._controlPoint[1],this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:e.sourcePos,target:e.targetPos},this._super.addSegment(this,"Bezier",{x1:p,y1:d,x2:c,y2:u,cp1x:r,cp1y:h,cp2x:a,cp2y:l})},dt.prototype._segment=function(t,e,n,s){return t<=n&&s<=e?1:t<=n&&e<=s?2:n<=t&&e<=s?3:4},dt.prototype._findControlPoint=function(t,e,n,s,i,o,r,a,h){return a<=h?[t,e]:1===n?s[3]<=0&&1<=i[3]?[t+(s[2]<.5?-1*o:o),e]:1<=s[2]&&i[2]<=0?[t,e+(s[3]<.5?-1*r:r)]:[t+-1*o,e+-1*r]:2===n?1<=s[3]&&i[3]<=0?[t+(s[2]<.5?-1*o:o),e]:1<=s[2]&&i[2]<=0?[t,e+(s[3]<.5?-1*r:r)]:[t+o,e+-1*r]:3===n?1<=s[3]&&i[3]<=0?[t+(s[2]<.5?-1*o:o),e]:s[2]<=0&&1<=i[2]?[t,e+(s[3]<.5?-1*r:r)]:[t+-1*o,e+-1*r]:4===n?s[3]<=0&&1<=i[3]?[t+(s[2]<.5?-1*o:o),e]:s[2]<=0&&1<=i[2]?[t,e+(s[3]<.5?-1*r:r)]:[t+o,e+-1*r]:void 0},dt);function dt(t){var e=ut.call(this,t)||this;return e.type="EditableStateMachine",e}A.Connectors.EditableStateMachine=pt,k.extend(pt,A.Connectors.AbstractEditableConnector);var gt,mt=(t(yt,gt=H),yt.prototype._updateOrigin=function(){this.sp=this._jsPlumb.getOffset(this.current.endpoints[0].canvas),this.tp=this._jsPlumb.getOffset(this.current.endpoints[1].canvas),this.origin=[Math.min(this.sp.left,this.tp.left),Math.min(this.sp.top,this.tp.top)],this.center=[(this.sp.left+this.tp.left)/2,(this.sp.top+this.tp.top)/2],this.nodeQuadrant=Biltong.quadrant([this.sp.left,this.sp.top],[this.tp.left,this.tp.top])},yt.prototype._updateConnectorInfo=function(){this._updateOrigin();var t=this.current.getConnector().geometry;t&&t.controlPoints&&(this.cp=t.controlPoints,this.cp1[0]=t.controlPoints[0][0],this.cp1[1]=t.controlPoints[0][1],this.cp2[0]=t.controlPoints[1][0],this.cp2[1]=t.controlPoints[1][1])},yt.prototype._updateQuadrants=function(){var n=[this.origin[0]+this.cp2[0],this.origin[1]+this.cp2[1]],s=[this.origin[0]+this.cp1[0],this.origin[1]+this.cp1[1]];this.sourceMidpoints.sort(function(t,e){return Biltong.lineLength(t,n)<Biltong.lineLength(e,n)?-1:1}),this.sourceFace=this.sourceMidpoints[0][2],this.targetMidpoints.sort(function(t,e){return Biltong.lineLength(t,s)<Biltong.lineLength(e,s)?-1:1}),this.targetFace=this.targetMidpoints[0][2]},yt.prototype._updateHandlePositions=function(){if(this.mode===E)this.h1.style.left=this.origin[0]+(this.cp1[0]+this.cp2[0])/2+C,this.h1.style.top=this.origin[1]+(this.cp1[1]+this.cp2[1])/2+C,this.h3.style.left=this.origin[0]+this.cp1[0]+C,this.h3.style.top=this.origin[1]+this.cp1[1]+C,this.h4.style.left=this.origin[0]+this.cp2[0]+C,this.h4.style.top=this.origin[1]+this.cp2[1]+C;else{this.h1.style.left=this.origin[0]+this.cp1[0]+C,this.h1.style.top=this.origin[1]+this.cp1[1]+C;var t=this.lockHandles?this.cp1:this.cp2;this.h2.style.left=this.origin[0]+t[0]+C,this.h2.style.top=this.origin[1]+t[1]+C}this._updateQuadrants()},yt.prototype._setGeometry=function(){this.current.getConnector().setGeometry({controlPoints:[this.cp1,this.cp2]}),this._jsPlumb.repaint(this.current.endpoints[0].elementId),this.current.endpoints[0].elementId!==this.current.endpoints[1].elementId&&this._jsPlumb.repaint(this.current.endpoints[1].elementId)},yt.prototype._updateGuidelines=function(){et(this.h1,this.tp,this.l1,this.origin[0]+this.cp1[0],this.origin[1]+this.cp1[1]);var t=this.lockHandles?this.cp1:this.cp2;et(this.lockHandles?this.h1:this.h2,this.sp,this.l2,this.origin[0]+t[0],this.origin[1]+t[1])},yt.prototype._toBiltongPoint=function(t){return{x:t[0],y:t[1]}},yt.prototype._activate=function(t,e,n){if(null!=this.current._jsPlumb){this.cp1=[0,0],this.cp2=[0,0],this.cp=[this.cp1,this.cp2],n=n||{},this.mode=n.mode||"single",this._updateConnectorInfo(),this.h1=$(this.sp.left+this.cp[0][0],this.sp.top+this.cp[0][1],[u,c,p].join(" ")),this.h2=$(this.sp.left+this.cp[1][0],this.sp.top+this.cp[1][1],[u,c,d].join(" ")),this.h1._jsPlumbControlPoint=this.cp1,this.h2._jsPlumbControlPoint=this.cp2,this.h3=$(this.origin[0]+this.cp[0][0],this.origin[1]+this.cp[0][1],[g,m].join(" ")),this.h4=$(this.origin[0]+this.cp[0][0],this.origin[1]+this.cp[0][1],[g,f].join(" ")),this.mode===E&&(this.h3.style.display=_,this.h4.style.display=_,this._jsPlumb.appendElement(this.h3),this._jsPlumb.appendElement(this.h4),this.flipY=this.tp.top<this.sp.top),this._jsPlumb.appendElement(this.h1),this._jsPlumb.appendElement(this.h2),this.h1Size=[this.h1.offsetWidth,this.h1.offsetHeight],this.h1.style.display=_,this.lockHandles||(this.h2.style.display=_,this.h2Size=[this.h2.offsetWidth,this.h2.offsetHeight]),this.mode===E&&(this.h3.style.display=_,this.h4.style.display=_,this.h3Size=[this.h3.offsetWidth,this.h3.offsetHeight],this.h4Size=[this.h4.offsetWidth,this.h4.offsetHeight]),this.l1=nt(this.h1,this.tp,this.origin[0]+this.cp[0][0],this.origin[1]+this.cp[0][1]),this.l2=nt(this.lockHandles?this.h1:this.h2,this.sp,this.origin[0]+this.cp[1][0],this.origin[1]+this.cp[1][1]),this._jsPlumb.appendElement(this.l1),this._jsPlumb.appendElement(this.l2);var s=this._jsPlumb.getSize(this.current.source),i=this._jsPlumb.getOffset(this.current.source),o=this._jsPlumb.getSize(this.current.target),r=this._jsPlumb.getOffset(this.current.target);this.sourceCenter=[i.left+s[0]/2,i.top+s[1]/2],this.targetCenter=[r.left+o[0]/2,r.top+o[1]/2],this.sourceMidpoints=[[i.left,this.sourceCenter[1],P],[this.sourceCenter[0],i.top,x],[i.left+s[0],this.sourceCenter[1],j],[this.sourceCenter[0],i.top+s[1],S]],this.targetMidpoints=[[r.left,this.targetCenter[1],P],[this.targetCenter[0],r.top,x],[r.left+o[0],this.targetCenter[1],j],[this.targetCenter[0],r.top+o[1],S]],this._updateHandlePositions();var a=!1!==n.guidelines;this.l1.style.display=a?_:v,this.l2.style.display=a?_:v,this.sp=this._jsPlumb.getOffset(this.current.endpoints[0].canvas),this.tp=this._jsPlumb.getOffset(this.current.endpoints[1].canvas),this._updateGuidelines(),this.current.addClass(h),this._setGeometry()}},yt.prototype._elementDragged=function(t){this._updateOrigin(),this._updateHandlePositions(),this._updateGuidelines()},yt.prototype._elementDragging=function(t){this.sp=this._jsPlumb.getOffset(this.current.endpoints[0].canvas),this.tp=this._jsPlumb.getOffset(this.current.endpoints[1].canvas),this._updateGuidelines()},yt.prototype._clearHandles=function(){!function(t){for(var e=0;e<t.length;e++)null!=t[e]&&t[e].parentNode&&t[e].parentNode.removeChild(t[e])}([this.h1,this.h2,this.h3,this.h4,this.l1,this.l2])},yt.prototype._repaint=function(t){},yt.prototype._update=function(){this._updateOrigin(),this._updateConnectorInfo(),this._updateHandlePositions(),this._updateGuidelines()},yt);function yt(t){var c=gt.call(this,t)||this;return c.cp1=[0,0],c.cp2=[0,0],c.flipY=!1,c.noEdits=!0,c._addDragHandler({selector:a(u),drag:function(t){c.noEdits&&(c._setGeometry(),c.noEdits=!1);var e=t.drag.getDragElement()._jsPlumbControlPoint,n=t.pos[0]-c.origin[0],s=t.pos[1]-c.origin[1];if(c.lockHandles)if(c.mode===E){var i=Biltong.lineLength(c.center,t.pos),o=Biltong.perpendicularLineTo(c._toBiltongPoint(c.center),c._toBiltongPoint(t.pos),1.5*i),r=Math.min(o[0].y,o[1].y),a=Math.min(o[0].x,o[1].x),h=Math.max(o[0].y,o[1].y),l=Math.max(o[0].x,o[1].x);o=[null,[{x:l,y:r},{x:a,y:h}],[{x:l,y:h},{x:a,y:r}],[{x:a,y:h},{x:l,y:r}],[{x:a,y:r},{x:l,y:h}]][c.nodeQuadrant],c.cp1[0]=o[0].x-c.origin[0],c.cp1[1]=o[0].y-c.origin[1],c.cp2[0]=o[1].x-c.origin[0],c.cp2[1]=o[1].y-c.origin[1],c.h3.style.left=c.origin[0]+c.cp1[0]+C,c.h3.style.top=c.origin[1]+c.cp1[1]+C,c.h4.style.left=c.origin[0]+c.cp2[0]+C,c.h4.style.top=c.origin[1]+c.cp2[1]+C}else c.cp1[0]=n,c.cp1[1]=s,c.cp2[0]=n,c.cp2[1]=s;else e[0]=n,e[1]=s;c._updateQuadrants(),c._setGeometry(),c._updateGuidelines()},stop:function(){c.noEdits||c.fireConnectionEditEvent(),c.noEdits=!0}}),c}var ft,bt=(t(vt,ft=mt),vt);function vt(t){var e=ft.call(this,t)||this;return e.lockHandles=!0,e}function _t(){}e.jsPlumbToolkitEditableConnectors=_t,e.jsPlumb.ConnectorEditors={EditableFlowchart:it,EditableBezier:mt,EditableStateMachine:bt},"undefined"!=typeof exports&&(exports.jsPlumbToolkitEditableConnectors=_t)}).call("undefined"!=typeof window?window:this);