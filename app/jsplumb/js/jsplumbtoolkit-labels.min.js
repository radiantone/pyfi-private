(function(){var o,t=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});function e(t){return{left:parseInt(t.el.style.left||0,10),top:parseInt(t.el.style.top||0,10)}}function r(t,e){var n=t.connector.paintExtents.xmin<0?-t.connector.paintExtents.xmin:0,o=t.connector.paintExtents.ymin<0?-t.connector.paintExtents.ymin:0,i=e.left-t.connectorOffset.left,r=e.top-t.connectorOffset.top,a=t.connector.findSegmentForPoint(i-n,r-o);return t.label.loc=a.connectorLocation,a.connectorLocation}var n=(i.prototype.updateEdge=function(t,e,n){if("label"===e.id){var o={};o[this.surface.getLabelLocationAttribute(t)]=n,this.toolkit.updateEdge(t,o)}},i);function i(t){var r=this;this.surface=t.surface,this.jsPlumb=this.surface.getJsPlumb(),this.toolkit=this.surface.getToolkit(),this.getLabel=t.getLabel||function(t){return t.getOverlay("label")},this.toolkit.bind("edgeUpdated",function(t){var e=r.surface.getRenderedConnection(t.edge.getId()),n=r.getLabel(e);if(n){var o=r.surface.getLabelLocationAttribute(t.edge),i=t.edge.data[o];i&&(n.loc=i,e.repaint())}})}var a,c=(t(s,a=n),s);function s(t){var o=a.call(this,t)||this,e=o,i=!1;return o._dragManager=new Katavorio({bind:function(){e.jsPlumb.on.apply(e.jsPlumb,arguments)}.bind(o),unbind:function(){e.jsPlumb.off.apply(e.jsPlumb,arguments)}.bind(o),getSize:function(t){return e.jsPlumb.getSize(t)},getConstrainingRectangle:function(t){return[t.parentNode.scrollWidth,t.parentNode.scrollHeight]},getPosition:function(t){return[parseInt(t.style.left||"0",10),parseInt(t.style.top||"0",10)]},setPosition:function(t,e){t.style.left=e[0]+"px",t.style.top=e[1]+"px"},addClass:function(t,e){t.classList.add(e)},removeClass:function(t,e){t.classList.remove(e)},intersects:Biltong.intersects,indexOf:function(t,e){return t.indexOf(e)}}),o._dragManager.draggable(o.surface.getContainer(),{selector:".jtk-overlay",start:function(t){if("label"!==t.drag.getDragElement()._jsPlumb.id)return!1;i=!1},drag:function(t){i=!0},stop:function(t){if(i){var e=t.el._jsPlumb.component.getConnector(),n=r({connectorOffset:{left:parseInt(e.canvas.style.left,10),top:parseInt(e.canvas.style.top,10)},label:t.el._jsPlumb,connector:e},{left:t.finalPos[0],top:t.finalPos[1]});o.updateEdge(t.el._jsPlumb.component.edge,t.el._jsPlumb,n)}},constrain:function(t,e,n,o){var i=e._jsPlumb.component.getConnector(),r=parseInt(i.canvas.style.left,10),a=parseInt(i.canvas.style.top,10),c=t[0]-r,s=t[1]-a,l=i.paintExtents.xmin<0?-i.paintExtents.xmin:0,f=i.paintExtents.ymin<0?-i.paintExtents.ymin:0,u=i.findSegmentForPoint(c-l,s-f);return[u.x+r+l,u.y+a+f]}}),o}var l,f=(t(u,l=n),u.prototype.execute=function(){var s=this;this.cache.clear();var t=this.jsPlumb.select(),l=[];t.each(function(t){var e=s.getLabel(t);if(null!=e){var n=e.getElement(),o=s.jsPlumb.getId(n),i=s.jsPlumb.getSize(n),r=t.getConnector(),a={left:parseInt(r.canvas.style.left,10),top:parseInt(r.canvas.style.top,10)},c={connection:t,edge:t.edge,label:e,el:n,size:i,id:o,connector:r,connectorOffset:a};l.push(c),s.cache.set(o,c)}}),this.magnetizer.setElements(l);var e=this.magnetizer.executeAtCenter({padding:[this.padding,this.padding]});for(var n in e){var o=this.cache.get(n);o&&o.edge&&this.updateEdge(o.edge,o.label,o.label.loc)}this.jsPlumb.repaintEverything()},u.prototype.reset=function(){this.dirtyCache.clear(),this.cache.clear(),this.jsPlumb.repaintEverything(!0)},u);function u(t){var p=l.call(this,t)||this;return p.padding=t.padding||5,p.debug=t.debug,p.fireOnNewConnections=!1!==t.fireOnNewConnections,p.fireAfterDrag=!1!==t.fireAfterDrag,p.cache=new Map,p.dirtyCache=new Map,p.surface.bind("nodeMoveStart",function(t){p.dirtyCache.set(t.node.id,!0)}),p.surface.bind("nodeMoveEnd",function(t){p.fireAfterDrag&&p.execute(),p.dirtyCache.set(t.node.id,!1)}),p.magnetizer=Farahey.getInstance({getPosition:e,setPosition:r,padding:t.padding,getSize:function(t){return t.size},getId:function(t){return t.id},constrain:function(t,e,n){var o=p.cache.get(t),i=o.connector,r=o.connectorOffset,a=e[0]+n.left,c=e[1]+n.top,s=a-r.left,l=c-r.top,f=i.findSegmentForPoint(s,l),u=r.left+f.x,d=r.top+f.y;return{left:u-e[0],top:d-e[1]}},filter:function(t){return!1!==p.dirtyCache.get(p.cache.get(t).connection.sourceId)&&!1!==p.dirtyCache.get(p.cache.get(t).connection.targetId)}}),p.fireOnNewConnections&&p.jsPlumb.bind("connection",p.execute.bind(p)),p}this.jsPlumbToolkitLabelSpacer=f,this.jsPlumbToolkitLabelDragManager=c,"undefined"!=typeof exports&&(exports.jsPlumbToolkitLabelSpacer=f,exports.jsPlumbToolkitLabelDragManager=c)}).call("undefined"!=typeof window?window:this);