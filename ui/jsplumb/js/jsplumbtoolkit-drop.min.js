(function(){var p="Group",n="mousemove",i="mouseout",s=(t.prototype.setEnabled=function(t){this.enabled=t},t.prototype.setSurface=function(t){this.surface=t,this.toolkit=t.getToolkit(),this.surfaceCanvas=t.getContainer(),this._jsPlumb=t.getJsPlumb()},t.prototype.isEffectivelyOnCanvas=function(t){var e=this.isCurrentlyOnCanvasElement;return e||"touchmove"!==t.type||(e=!0),e},t.prototype.getAllNodesAndGroups=function(){var t=[];return Array.prototype.push.apply(t,this.toolkit.getNodes()),Array.prototype.push.apply(t,this.toolkit.getGroups()),t},t.prototype._adjustForTransformations=function(){var s=0,o=0,a=function(t){if(null!=t&&t!==document.body){var e=window.getComputedStyle(t).transform.match(/(-?[0-9\.]+)/g);e&&(s+=parseInt(e[4],10),o+=parseInt(e[5],10)),a(t.parentNode)}};a(this.surface.getJsPlumb().getContainer()),this._translateX=s,this._translateY=o},t.prototype.getAllConnectors=function(a){var r=this,n=[];return this.surface.getJsPlumb().select().each(function(t){if(t.edge&&r.edgeDropFilter(a,t.edge)){var e=t.getConnector(),s=t.getConnector().canvas,o={x:parseInt(s.style.left,10),y:parseInt(s.style.top,10),w:parseInt(s.getAttribute("width"),10),h:parseInt(s.getAttribute("height"),10)};n.push({connection:t,connector:e,el:s,r:o,id:t.edge.id,edge:t.edge}),r._jsPlumb.addClass(s,r.dragActiveClass)}}),n},t.prototype._cleanupClasses=function(e){var s=this;this.currentNodeList.forEach(function(t){e||s._jsPlumb.removeClass(t[1],s.dragActiveClass),s._jsPlumb.removeClass(t[1],s.dragHoverClass)}),this.currentEdgeList.forEach(function(t){e||s._jsPlumb.removeClass(t.el,s.dragActiveClass),s._jsPlumb.removeClass(t.el,s.dragHoverClass)}),this._jsPlumb.removeClass(this.surfaceCanvas,this.dragActiveClass),this._jsPlumb.removeClass(this.surfaceCanvas,this.dragHoverClass)},t);function t(t){var c=this;this.viewportPosition=null,this._translateX=0,this._translateY=0,this.surface=t.surface,this._jsPlumb=this.surface.getJsPlumb(),this.toolkit=this.surface.getToolkit(),this.surfaceCanvas=this.surface.getContainer(),this.enabled=!1!==t.enabled,this.canvasSelector=t.canvasSelector||null,this.source=t.source,this.selector=t.selector,this.scope=t.scope||jsPlumbUtil.uuid(),this.dropFilter=t.dropFilter||function(t,e){return!0},this.canvasDropFilter=t.canvasDropFilter||function(t){return!0},this.edgeDropFilter=t.edgeDropFilter||function(t,e){return!0},this.onDrag=t.onDrag,this.onDrop=t.onDrop,this.onEdgeDrop=t.onEdgeDrop,this.onCanvasDrop=t.onCanvasDrop,this.dragActiveClass=t.dragActiveClass||"jtk-drag-drop-active",this.dragHoverClass=t.dragHoverClass||"jtk-drag-drop-hover",this.currentNodeList=[],this.dataGenerator=t.dataGenerator||function(){return{}},this.canvasMoveListener=function(t){var e=t.srcElement||t.target;c.isCurrentlyOnCanvasElement=e===c.surfaceCanvas||null!=c.canvasSelector&&jsPlumbUtil.matchesSelector(e,c.canvasSelector)},this.canvasMouseOutListener=function(t){c.isCurrentlyOnCanvasElement=!1},this.katavorio=new Katavorio({bind:function(){this._jsPlumb.on.apply(this._jsPlumb,arguments)}.bind(this),unbind:function(){this._jsPlumb.off.apply(this._jsPlumb,arguments)}.bind(this),getSize:function(t){return c._jsPlumb.getSize(t)},getConstrainingRectangle:function(t){return[t.parentNode.scrollWidth,t.parentNode.scrollHeight]},getPosition:function(t){return[parseInt(t.style.left,10),parseInt(t.style.top,10)]},setPosition:function(t,e){t.style.left=e[0]+"px",t.style.top=e[1]+"px"},addClass:function(){this._jsPlumb.addClass.apply(this._jsPlumb,arguments)}.bind(this),removeClass:function(){this._jsPlumb.removeClass.apply(this._jsPlumb,arguments)}.bind(this),intersects:Biltong.intersects,indexOf:function(t,e){return t.indexOf(e)},scope:this.scope,css:{draggable:"jtk-draggable",drag:"jtk-drag",selected:"jtk-drag-selected",active:"jtk-drag-active",hover:"jtk-drag-hover",ghostProxy:"jtk-ghost-proxy"}}),this.katavorio.draggable(this.source,{scope:this.scope,clone:!0,start:function(t){if(!c.enabled)return!1;var e=t.drag.getDragElement();e.style.pointerEvents="none",c.candidateData=c.dataGenerator(e),c.currentNodeList.length=0,c.candidate=null,c._adjustForTransformations(),c.onDrop&&c.getAllNodesAndGroups().forEach(function(t){var e=c.surface.getRenderedElement(t);e&&(c.dropFilter(c.candidateData,t)?(c.currentNodeList.push([t,e]),c._jsPlumb.addClass(e,c.dragActiveClass)):c._jsPlumb.removeClass(e,c.dragActiveClass))});c.currentEdgeList=c.onEdgeDrop?c.getAllConnectors(c.candidateData):[],c.onCanvasDrop&&c.canvasDropFilter(c.candidateData)&&(c.canDropOnCanvas=!0,c.isCurrentlyOnCanvasElement=!1,c._jsPlumb.on(c.surfaceCanvas,n,c.canvasMoveListener),c._jsPlumb.on(c.surfaceCanvas,i,c.canvasMouseOutListener))},stop:function(t){c._jsPlumb.off(c.surfaceCanvas,n,c.canvasMoveListener),c._jsPlumb.off(c.surfaceCanvas,i,c.canvasMouseOutListener),c._cleanupClasses();var e=c.surface.mapLocation(c.viewportPosition[0],c.viewportPosition[1]);if(c.candidate){if(c.candidate.edge&&c.onEdgeDrop)c.onEdgeDrop(c.candidateData,c.candidate.edge,t.el,t.e,t.pos,e);else if(c.onDrop){var s,o=void 0,a=c.candidate.el.jtk.group||c.candidate.el.jtk.node;if(a.objectType===p){var r=c.surface.getJsPlumb().getGroup(a.id);o=c.surface.getJsPlumb().getOffset(r.getDragArea())}else o=c.surface.getJsPlumb().getOffset(c.candidate.el);s={left:e.left-o.left,top:e.top-o.top},c.onDrop(c.candidateData,a,t.el,t.e,t.pos,e,o,s)}}else c.canDropOnCanvas&&c.isCurrentlyOnCanvasElement&&null!=c.viewportPosition&&c.onCanvasDrop&&c.onCanvasDrop(c.candidateData,e,t.el,t.e,t.pos);c.isCurrentlyOnCanvasElement=!1},drag:function(t){c._cleanupClasses(!0);var e=[t.pos[0]-c._translateX,t.pos[1]-c._translateY];c.viewportPosition=e,c.candidate=null;var s=c.surface.mapLocation.apply(c.surface,e);if(c.onDrop){var o=c.surface.findIntersectingNodes(e,t.drag.size,!1);c.candidate=o.filter(function(e){return-1<jsPlumbUtil.findWithFunction(c.currentNodeList,function(t){return t[1]===e.el})})[0]}if(!c.candidate&&c.onEdgeDrop)for(var a=c.surface.getZoom(),r={x:s.left,y:s.top,w:t.drag.size[0]/a,h:t.drag.size[1]/a},n=0;n<c.currentEdgeList.length;n++){var i=c.currentEdgeList[n],l=i.r,u=i.connector;if(Biltong.intersects(r,l))if(0<u.boundingBoxIntersection({x:r.x-l.x,y:r.y-l.y,w:r.w,h:r.h}).length){c.candidate=i;break}}c.candidate?c._jsPlumb.addClass(c.candidate.el,c.dragHoverClass):c.canDropOnCanvas&&(c.isCurrentlyOnCanvasElement=c.isEffectivelyOnCanvas(t.e),c.isCurrentlyOnCanvasElement&&c.surface.isInViewport(e[0],e[1])?(c.viewportPosition=e,c._jsPlumb.addClass(c.surfaceCanvas,c.dragHoverClass)):c._jsPlumb.addClass(c.surface.getContainer(),c.dragActiveClass)),c.onDrag&&c.onDrag(c.candidateData,t.e,e,s)},selector:this.selector})}var e=(o.prototype._mapToPositionAttributes=function(t,e){var s={};for(var o in t)"left"===o?s[this.modelPositionAttributes[0]]=t[o]:"top"===o?s[this.modelPositionAttributes[1]]=t[o]:s[o]=t[o];return jsPlumb.extend(s,e),s},o.prototype.setEnabled=function(t){this.dropManager.setEnabled(t)},o.prototype.setSurface=function(t){this.surface=t,this.toolkit=this.surface.getToolkit(),this.modelPositionAttributes=this.surface.getModelPositionAttributes(),this.dropManager.setSurface(t)},o);function o(t){var d=this;this.surface=t.surface,this.toolkit=this.surface.getToolkit(),this.modelPositionAttributes=this.surface.getModelPositionAttributes(),this.typeGenerator=t.typeGenerator||function(t){return t.type},this.groupIdentifier=t.groupIdentifier||function(t,e){return"true"===e.getAttribute("jtk-is-group")},this.allowDropOnEdge=!1!==t.allowDropOnEdge,this.allowDropOnGroup=!1!==t.allowDropOnGroup,this.allowDropOnCanvas=!1!==t.allowDropOnCanvas,this.allowNodeDropOnCanvas=!1!==t.allowNodeDropOnCanvas,this.magnetize=!1!==t.magnetize;var e={surface:this.surface,onCanvasDrop:this.allowDropOnCanvas?function(t,e,s,o,a){var r=d.typeGenerator(t),n=d.groupIdentifier(t,s),i=d._mapToPositionAttributes({left:e.left,top:e.top},t);n?d.toolkit.addFactoryGroup(r,i,function(t){d.surface.setPosition(t,e.left,e.top)}):d.allowNodeDropOnCanvas&&d.toolkit.addFactoryNode(r,i,function(t){d.surface.setPosition(t,e.left,e.top)})}:null,onDrop:function(t,e,s,o,a,r,n,i){if(d.allowDropOnGroup){var l=d.groupIdentifier(t,s);if(e.objectType===p&&!l){var u=d.typeGenerator(t),c=d._mapToPositionAttributes({group:e.id,left:i.left,top:i.top},t);d.toolkit.addFactoryNode(u,c,function(t){d.surface.setPosition(t,i.left,i.top),d.surface.relayoutGroup(e)})}}},onEdgeDrop:this.allowDropOnEdge?function(t,o,e,s,a,r){function n(t){var e=o.source,s=o.target;d.toolkit.removeEdge(o),d.toolkit.addEdge({source:e,target:t}),d.toolkit.addEdge({source:t,target:s}),!1!==d.magnetize?d.surface.setMagnetizedPosition(t,r.left,r.top):d.surface.setPosition(t,r.left,r.top)}var i=d.typeGenerator(t),l=d._mapToPositionAttributes({left:r.left,top:r.top},t);d.groupIdentifier(t,e)?d.toolkit.addFactoryGroup(i,l,n):d.toolkit.addFactoryNode(i,l,n)}:null,source:t.source,selector:t.selector,dataGenerator:t.dataGenerator,canvasSelector:t.canvasSelector};this.dropManager=new s(e)}this.jsPlumbToolkitDropManager=s,this.SurfaceDropManager=e,"undefined"!=typeof exports&&(exports.jsPlumbToolkitDropManager=s,exports.SurfaceDropManager=e)}).call("undefined"!=typeof window?window:this);