(function(){function i(){}function l(i){return function(n,r,e,t){i.apply(i,arguments);function o(){if(n.group){var e=r[0].querySelector("[jtk-group-content]")||r[0];if(!0!==r[0]._jtkGroupProcessed&&r[0]._jtkGroupNodes){for(var t=0;t<r[0]._jtkGroupNodes.length;t++)e.appendChild(r[0]._jtkGroupNodes[t].el);delete r[0]._jtkGroupNodes}e.setAttribute("jtk-group-content","true"),r[0]._jtkGroupProcessed=!0}n.$emit("refresh",n.node||n.group)}n.$watch(null,o),n.$watchCollection(n.node?"node":"group",o)}}function a(e,t){for(var n=e.$parent,r=e[t];null!=n&&null==r;)r=n[t],n=n.$parent;null!=r&&(e[t]=r)}angular.module("$jsPlumb",[]).factory("jsPlumbFactory",["$compile","jsPlumbService","$timeout",function(s,d,f){return{instance:function(u){return{restrict:"E",template:(u=u||{}).template||"<div class='jtk-angular-directive' style='height:100%;' ng-transclude></div>",transclude:!0,scope:{renderParams:"=",params:"=",data:"=",format:"=",jtkId:"@",surfaceId:"@",init:"="},replace:u.replace,controller:["$scope","$attrs",function(e,t){this.jtk=d.getToolkit(t.toolkitId,e.params),this.data=e.data,e.toolkit=this.jtk;var n=this;e.$on("refresh",function(e,t){n.jtk.updateNode(t)}),u.controller&&u.controller.apply(this,arguments)}],controllerAs:u.controllerAs,link:function(l,e,t,n){var r=n.jtk,o=arguments,i=jsPlumb.extend({},l.renderParams);delete i.miniview;var a=t.format,c=0;jsPlumb.extend(i,{container:u.replace?e[0]:e[0].childNodes[0],templateRenderer:{render:function(e,t,n,r){var o=l.$new();o[r]=t,o.toolkit=l.toolkit,o.surface=l.surface;var i=angular.element("<"+e+" "+r+'="'+r+'" toolkit="toolkit" surface="surface"></'+e+">");return s(i)(o),i[0]},cleanup:function(e,t){t.parentNode&&t.parentNode.removeChild(t)}},id:t.surfaceId}),i.id=i.id||jsPlumbUtil.uuid(),i.enhancedView=!1,i.connectionHandler=function(e,t){c++,f(t)},null!=t.miniview&&(i.miniview={container:t.miniview}),jsPlumbToolkit.ready(function(){l.surface=r.render(i),d.addSurface(i.id,l.surface),l.surface.bind("nodeAdded",function(e){if(e.node.group){var t=l.surface.getRenderedGroup(e.node.group.id);t&&!0!==t._jtkGroupProcessed&&(t._jtkGroupNodes=t._jtkGroupNodes||[],t._jtkGroupNodes.push(e))}}),l.toolkit.bind("nodeUpdated",function(){f(function(){l.$apply()})}),l.toolkit.bind("dataLoadStart",function(){c=0}),l.toolkit.bind("dataLoadEnd",function(){0<c&&f(l.surface.getJsPlumb().getGroupManager().refreshAllGroups),c=0}),l.surface.bind("edgeAdded",function(e){l.surface.getJsPlumb().revalidate(e.connection.source)}),u.link&&u.link.apply(this,o),l.data&&r.load({data:l.data,type:a}),l.init&&f(function(){l.init.apply(l,o)})}),u.link&&u.link.apply(this,arguments)}}},node:function(n){var e={};if(jsPlumb.extend(e,n||{}),e.restrict="E",e.scope=e.scope||{},e.scope.node="=",e.scope.toolkit="=",e.scope.surface="=",e.link=l(e.link||i),n.inherit)if(null==e.controller)e.controller=["$scope",function(e){for(var t=0;t<n.inherit.length;t++)a(e,n.inherit[t])}];else{if(null==e.controller.length)throw new TypeError("Controller spec must be in strict format to use inherit parameter with jsPlumb Angular integration");var t=e.controller.indexOf("$scope"),r=!1;-1==t&&(e.controller.unshift("$scope"),r=!(t=0));var o=e.controller.pop();e.controller.push(function(){for(var e=0;e<n.inherit.length;e++)a(arguments[t],n.inherit[e]);o.apply(this,r?arguments.slice(1):arguments)})}return e},group:function(n){var e={};if(jsPlumb.extend(e,n||{}),e.restrict="E",e.scope=e.scope||{},e.scope.group="=",e.scope.toolkit="=",e.scope.surface="=",e.link=l(e.link||i),n.inherit)if(null==e.controller)e.controller=["$scope",function(e){for(var t=0;t<n.inherit.length;t++)a(e,n.inherit[t])}];else{if(null==e.controller.length)throw new TypeError("Controller spec must be in strict format to use inherit parameter with jsPlumb Angular integration");var t=e.controller.indexOf("$scope"),r=!1;-1==t&&(e.controller.unshift("$scope"),r=!(t=0));var o=e.controller.pop();e.controller.push(function(){for(var e=0;e<n.inherit.length;e++)a(arguments[t],n.inherit[e]);o.apply(this,r?arguments.slice(1):arguments)})}return e},miniview:function(e){return{restrict:"AE",scope:{surfaceId:"@"},replace:!0,template:"<div></div>",link:function(e,t,n){e.$watch(null,function(){d.addMiniview(n.surfaceId,{container:t})})}}}}}]).service("jsPlumbService",["$templateCache","$timeout",function(e,r){var o=new jsPlumbUtil.EventGenerator,i={},l={},a={},c={palette:function(e,t){new SurfaceDropManager({source:t.element,selector:t.selector,surface:e,dataGenerator:t.generator,onCanvasDrop:t.onDrop})},miniview:function(e,t){var n=e.createMiniview({container:t.container});e.getToolkit().bind("dataLoadEnd",function(){r(n.invalidate)}),e.getToolkit().bind("nodeAdded",function(e){r(function(){n.invalidate(e.node.id)})})}};this.bind=function(t,n,r){o.bind(t,function(e){e.id==n&&r(e.toolkit,n,t)})},this.getToolkit=function(e,t){return e=e||jsPlumbUtil.uuid(),null!=i[e]?i[e]:function(e,t){var n=jsPlumbToolkit.newInstance(t||{});return n._ngId=e,i[e]=n,o.fire("ready",{id:e,toolkit:n}),n}(e,t)},this.resetToolkit=function(e){var t=i[e];if(t){t.clear();var n=t.getRenderers();if(null!=n)for(var r in n)delete l[n[r]._ngId];delete i[e]}},this.addSurface=function(e,t){if((l[e]=t)._ngId=e,a[e])for(var n=0;n<a[e].length;n++)try{a[e][n][1](t,a[e][n][0])}catch(e){"undefined"!=typeof console&&console.log("Cannot create component "+e)}delete a[e]},this.getSurface=function(e){return l[e]},this.addComponent=function(e,t,n){!function(e,t,n){var r=l[e];r?n(r,t):(a[e]=a[e]||[],a[e].push([t,n]))}(e,t,c[n])},this.addPalette=function(e,t){this.addComponent(e,t,"palette")},this.addMiniview=function(e,t){this.addComponent(e,t,"miniview")}}]).directive("jsplumbMiniview",["jsPlumbFactory",function(e){return e.miniview()}]).directive("jsplumbToolkit",["jsPlumbFactory",function(e){return e.instance()}]).directive("jsplumbPalette",["jsPlumbService","$timeout",function(o,e){return{restrict:"AE",scope:{generator:"=",onDrop:"="},link:function(t,n,r){e(function(){var e=o.getSurface(r.surfaceId);e&&(t.droppablesHandler=new SurfaceDropManager({source:n[0],selector:r.selector,surface:e,dataGenerator:t.generator,onCanvasDrop:t.onDrop}))})}}}])}).call("undefined"!=typeof window?window:this);